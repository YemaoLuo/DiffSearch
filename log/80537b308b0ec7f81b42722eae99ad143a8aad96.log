80537b308b0ec7f81b42722eae99ad143a8aad96
==================================================
Move the offending code to the server. Avoid sending a message when nothing has actually been written.
==================================================
Remy Maucherat
==================================================
Mon Dec 1 22:35:30 2014 +0000
==================================================
WsFrameBase.java
Move the offending code to the server. Avoid sending a message when nothing has actually been written.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1642773 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsRemoteEndpointImplBase.java
index 61b4374700..3cd7759bc4 100644
--- a/java/org/apache/tomcat/websocket/WsFrameBase.java
+++ b/java/org/apache/tomcat/websocket/WsFrameBase.java
@@ -390,10 +390,8 @@ public abstract class WsFrameBase {
                         messageBufferText.toString(), last);
             } else {
                 // Caller ensures last == true if this branch is used
-                if (messageBufferText.remaining() > 0) {
-                    ((MessageHandler.Whole<String>) textMsgHandler).onMessage(
-                            messageBufferText.toString());
-                }
+                ((MessageHandler.Whole<String>) textMsgHandler).onMessage(
+                        messageBufferText.toString());
             }
         } catch (Throwable t) {
             handleThrowableOnSend(t);
@@ -585,9 +583,7 @@ public abstract class WsFrameBase {
                 ((MessageHandler.Partial<ByteBuffer>) binaryMsgHandler).onMessage(msg, last);
             } else {
                 // Caller ensures last == true if this branch is used
-                if (msg.remaining() > 0) {
-                    ((MessageHandler.Whole<ByteBuffer>) binaryMsgHandler).onMessage(msg);
-                }
+                ((MessageHandler.Whole<ByteBuffer>) binaryMsgHandler).onMessage(msg);
             }
         } catch(Throwable t) {
             handleThrowableOnSend(t);

==================================================
