45546eedaf137a26cd7f282dc747b065a6a0df5b
==================================================
Revert r1740044.
==================================================
Keiichi Fujino
==================================================
Thu Apr 21 07:09:45 2016 +0000
==================================================
ChannelCoordinator.java
Revert r1740044.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1740242 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ChannelInterceptorBase.java
index 67461720d6..ec55dc8d37 100644
--- a/java/org/apache/catalina/tribes/group/ChannelCoordinator.java
+++ b/java/org/apache/catalina/tribes/group/ChannelCoordinator.java
@@ -151,10 +151,10 @@ public class ChannelCoordinator extends ChannelInterceptorBase implements Messag
             //listens to with the local membership settings
             if ( Channel.SND_RX_SEQ==(svc & Channel.SND_RX_SEQ) ) {
                 clusterReceiver.setMessageListener(this);
-                clusterReceiver.setChannel(channel);
+                clusterReceiver.setChannel(getChannel());
                 clusterReceiver.start();
                 //synchronize, big time FIXME
-                Member localMember = channel.getLocalMember(false);
+                Member localMember = getChannel().getLocalMember(false);
                 if (localMember instanceof StaticMember) {
                     // static member
                     StaticMember staticMember = (StaticMember)localMember;
@@ -171,14 +171,14 @@ public class ChannelCoordinator extends ChannelInterceptorBase implements Messag
                 valid = true;
             }
             if ( Channel.SND_TX_SEQ==(svc & Channel.SND_TX_SEQ) ) {
-                clusterSender.setChannel(channel);
+                clusterSender.setChannel(getChannel());
                 clusterSender.start();
                 valid = true;
             }
 
             if ( Channel.MBR_RX_SEQ==(svc & Channel.MBR_RX_SEQ) ) {
                 membershipService.setMembershipListener(this);
-                membershipService.setChannel(channel);
+                membershipService.setChannel(getChannel());
                 if (membershipService instanceof McastService) {
                     ((McastService)membershipService).setMessageListener(this);
                 }
@@ -186,7 +186,7 @@ public class ChannelCoordinator extends ChannelInterceptorBase implements Messag
                 valid = true;
             }
             if ( Channel.MBR_TX_SEQ==(svc & Channel.MBR_TX_SEQ) ) {
-                membershipService.setChannel(channel);
+                membershipService.setChannel(getChannel());
                 membershipService.start(MembershipService.MBR_TX);
                 valid = true;
             }
@@ -247,7 +247,7 @@ public class ChannelCoordinator extends ChannelInterceptorBase implements Messag
             }
 
             startLevel = (startLevel & (~svc));
-            channel = null;
+            setChannel(null);
         } catch (Exception x) {
             throw new ChannelException(x);
         }

==================================================
MessageDispatchInterceptor.java
index acf367b116..f2c6362552 100644
--- a/java/org/apache/catalina/tribes/group/ChannelInterceptorBase.java
+++ b/java/org/apache/catalina/tribes/group/ChannelInterceptorBase.java
@@ -29,7 +29,7 @@ public abstract class ChannelInterceptorBase implements ChannelInterceptor {
 
     private ChannelInterceptor next;
     private ChannelInterceptor previous;
-    protected Channel channel;
+    private Channel channel;
     //default value, always process
     protected int optionFlag = 0;
 

==================================================
TcpPingInterceptor.java
index b5b20fba0d..e3465445c5 100644
--- a/java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java
+++ b/java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java
@@ -111,7 +111,7 @@ public class MessageDispatchInterceptor extends ChannelInterceptorBase {
             return;
         }
         String channelName = "";
-        if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+        if (getChannel().getName() != null) channelName = "[" + getChannel().getName() + "]";
         executor = ExecutorFactory.newThreadPool(maxSpareThreads, maxThreads, keepAliveTime,
                 TimeUnit.MILLISECONDS,
                 new TcclThreadFactory("MessageDispatchInterceptor.MessageDispatchThread" + channelName));

==================================================
McastService.java
index 35d999e8ef..3d6a1c1c61 100644
--- a/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
+++ b/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
@@ -70,7 +70,7 @@ public class TcpPingInterceptor extends ChannelInterceptorBase {
             thread = new PingThread();
             thread.setDaemon(true);
             String channelName = "";
-            if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+            if (getChannel().getName() != null) channelName = "[" + getChannel().getName() + "]";
             thread.setName("TcpPingInterceptor.PingThread" + channelName +"-"+cnt.addAndGet(1));
             thread.start();
         }

==================================================
McastServiceImpl.java
index 590421b05b..a34e3d21f6 100644
--- a/java/org/apache/catalina/tribes/membership/McastService.java
+++ b/java/org/apache/catalina/tribes/membership/McastService.java
@@ -78,7 +78,7 @@ public class McastService implements MembershipService,MembershipListener,Messag
 
     protected byte[] domain;
 
-    protected Channel channel;
+    private Channel channel;
 
     /**
      * Create a membership service.

==================================================
ReceiverBase.java
index 56696d16b3..c6219d0616 100644
--- a/java/org/apache/catalina/tribes/membership/McastServiceImpl.java
+++ b/java/org/apache/catalina/tribes/membership/McastServiceImpl.java
@@ -155,7 +155,7 @@ public class McastServiceImpl {
      */
     protected final boolean localLoopbackDisabled;
 
-    protected Channel channel;
+    private Channel channel;
 
     /**
      * Create a new mcast service instance.

==================================================
ReplicationTransmitter.java
index 568c298725..485951afe9 100644
--- a/java/org/apache/catalina/tribes/transport/ReceiverBase.java
+++ b/java/org/apache/catalina/tribes/transport/ReceiverBase.java
@@ -80,7 +80,7 @@ public abstract class ReceiverBase implements ChannelReceiver, ListenCallback, R
     private long maxIdleTime = 60000;
 
     private ExecutorService executor;
-    protected Channel channel;
+    private Channel channel;
 
     public ReceiverBase() {
     }

==================================================
BioReceiver.java
index 354d962865..1ab66e9a8e 100644
--- a/java/org/apache/catalina/tribes/transport/ReplicationTransmitter.java
+++ b/java/org/apache/catalina/tribes/transport/ReplicationTransmitter.java
@@ -30,7 +30,7 @@ import org.apache.catalina.tribes.transport.nio.PooledParallelSender;
  */
 public class ReplicationTransmitter implements ChannelSender {
 
-    protected Channel channel;
+    private Channel channel;
 
     public ReplicationTransmitter() {
     }

==================================================
NioReceiver.java
index ca4aaf4301..965e59c8bd 100644
--- a/java/org/apache/catalina/tribes/transport/bio/BioReceiver.java
+++ b/java/org/apache/catalina/tribes/transport/bio/BioReceiver.java
@@ -54,7 +54,7 @@ public class BioReceiver extends ReceiverBase implements Runnable {
             getBind();
             bind();
             String channelName = "";
-            if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+            if (getChannel().getName() != null) channelName = "[" + getChannel().getName() + "]";
             Thread t = new Thread(this, "BioReceiver" + channelName);
             t.setDaemon(true);
             t.start();

==================================================
