22d03e8ef8bf1bc1dca64f46698451e697d54218
==================================================
Add draft 1.3 cipher definitions as OpenSSL master is starting to advertise them
==================================================
Mark Thomas
==================================================
Fri Mar 16 10:40:37 2018 +0000
==================================================
Constants.java
Add draft 1.3 cipher definitions as OpenSSL master is starting to advertise them

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1826958 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Authentication.java
index c6087a7b52..ca5c0e4a15 100644
--- a/java/org/apache/tomcat/util/net/Constants.java
+++ b/java/org/apache/tomcat/util/net/Constants.java
@@ -29,6 +29,7 @@ public class Constants {
      */
     public static final String SSL_PROTO_ALL        = "all";
     public static final String SSL_PROTO_TLS        = "TLS";
+    public static final String SSL_PROTO_TLSv1_3    = "TLSv1.3";
     public static final String SSL_PROTO_TLSv1_2    = "TLSv1.2";
     public static final String SSL_PROTO_TLSv1_1    = "TLSv1.1";
     // Two different forms for TLS 1.0

==================================================
Cipher.java
index 658a916a73..6489deaa6f 100644
--- a/java/org/apache/tomcat/util/net/openssl/ciphers/Authentication.java
+++ b/java/org/apache/tomcat/util/net/openssl/ciphers/Authentication.java
@@ -18,16 +18,17 @@
 package org.apache.tomcat.util.net.openssl.ciphers;
 
 public enum Authentication {
-    RSA /* RSA auth */,
-    DSS /* DSS auth */,
-    aNULL /* no auth (i.e. use ADH or AECDH) */,
-    DH /* Fixed DH auth (kDHd or kDHr) */,
-    ECDH /* Fixed ECDH auth (kECDHe or kECDHr) */,
-    KRB5 /* KRB5 auth */,
-    ECDSA/* ECDSA auth*/,
-    PSK /* PSK auth */,
+    RSA    /* RSA auth */,
+    DSS    /* DSS auth */,
+    aNULL  /* no auth (i.e. use ADH or AECDH) */,
+    DH     /* Fixed DH auth (kDHd or kDHr) */,
+    ECDH   /* Fixed ECDH auth (kECDHe or kECDHr) */,
+    KRB5   /* KRB5 auth */,
+    ECDSA  /* ECDSA auth*/,
+    PSK    /* PSK auth */,
     GOST94 /* GOST R 34.10-94 signature auth */,
     GOST01 /* GOST R 34.10-2001 */,
-    FZA /* Fortezza */,
-    SRP
+    FZA    /* Fortezza */,
+    SRP,
+    ANY    /* TLS 1.3 */
 }

==================================================
KeyExchange.java
index 5dc0a24ad1..2a1fefc3a7 100644
--- a/java/org/apache/tomcat/util/net/openssl/ciphers/Cipher.java
+++ b/java/org/apache/tomcat/util/net/openssl/ciphers/Cipher.java
@@ -2695,7 +2695,96 @@ public enum Cipher {
             null
     ),
 
-    /* Cipher 0x00FF  TLS_EMPTY_RENEGOTIATION_INFO_SCSV
+    // Cipher 0x00FF  TLS_EMPTY_RENEGOTIATION_INFO_SCSV
+
+    // TLS 1.3 ciphers (draft - v26)
+    // Cipher 1301
+    TLS_AES_128_GCM_SHA256(
+            0x1301,
+            "TLS_AES_128_GCM_SHA256",
+            KeyExchange.ANY,
+            Authentication.ANY,
+            Encryption.AES128GCM,
+            MessageDigest.AEAD,
+            Protocol.TLSv1_3,
+            false,
+            EncryptionLevel.HIGH,
+            true,
+            128,
+            128,
+            null,
+            null
+    ),
+    // Cipher 1302
+    TLS_AES_256_GCM_SHA384(
+            0x1302,
+            "TLS_AES_256_GCM_SHA384",
+            KeyExchange.ANY,
+            Authentication.ANY,
+            Encryption.AES256GCM,
+            MessageDigest.AEAD,
+            Protocol.TLSv1_3,
+            false,
+            EncryptionLevel.HIGH,
+            true,
+            256,
+            256,
+            null,
+            null
+    ),
+    // Cipher 1303
+    TLS_CHACHA20_POLY1305_SHA256(
+            0x1303,
+            "TLS_CHACHA20_POLY1305_SHA256",
+            KeyExchange.ANY,
+            Authentication.ANY,
+            Encryption.CHACHA20POLY1305,
+            MessageDigest.AEAD,
+            Protocol.TLSv1_3,
+            false,
+            EncryptionLevel.HIGH,
+            true,
+            256,
+            256,
+            null,
+            null
+    ),
+    // Cipher 1304
+    TLS_AES_128_CCM_SHA256(
+            0x1304,
+            "TLS_AES_128_CCM_SHA256",
+            KeyExchange.ANY,
+            Authentication.ANY,
+            Encryption.AES128CCM,
+            MessageDigest.AEAD,
+            Protocol.TLSv1_3,
+            false,
+            EncryptionLevel.HIGH,
+            true,
+            128,
+            128,
+            null,
+            null
+    ),
+    // Cipher 1305
+    TLS_AES_128_CCM_8_SHA256(
+            0x1305,
+            "TLS_AES_128_CCM_8_SHA256",
+            KeyExchange.ANY,
+            Authentication.ANY,
+            Encryption.AES128CCM8,
+            MessageDigest.AEAD,
+            Protocol.TLSv1_3,
+            false,
+            EncryptionLevel.HIGH,
+            true,
+            128,
+            128,
+            null,
+            null
+    ),
+
+    /*
      * Cipher 0x5600  TLS_FALLBACK_SCSV
      *
      * No other ciphers defined until 0xC001 below

==================================================
Protocol.java
index 945b63d58d..03f28d9bd8 100644
--- a/java/org/apache/tomcat/util/net/openssl/ciphers/KeyExchange.java
+++ b/java/org/apache/tomcat/util/net/openssl/ciphers/KeyExchange.java
@@ -32,5 +32,6 @@ enum KeyExchange {
     SRP   /* SSL_kSRP   - SRP */,
     RSAPSK,
     ECDHEPSK,
-    DHEPSK
+    DHEPSK,
+    ANY   /* TLS 1.3 */
 }

==================================================
