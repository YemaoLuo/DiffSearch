f90fc8d6af726fe9f9bdf8576ec345835a507ce3
==================================================
Fix regression producing invalid MBean names when using IPV6
==================================================
Rainer Jung
==================================================
Sun Jul 10 06:53:36 2011 +0000
==================================================
AbstractProtocol.java
Fix regression producing invalid MBean names when using IPV6
addresses for connectors.

- revert r1135088

- remove the surrounding quotes only when
  passing the name to the endpoint, so they
  don't end up in the middle of thread names.
  The thread names are used as MBean attribute
  values, but not in MBean names.


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1144785 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestRegistration.java
index bb46867736..63142cf137 100644
--- a/java/org/apache/coyote/AbstractProtocol.java
+++ b/java/org/apache/coyote/AbstractProtocol.java
@@ -233,8 +233,7 @@ public abstract class AbstractProtocol implements ProtocolHandler,
             name.append('-');
         }
         name.append(endpoint.getPort());
-        String quotedName = ObjectName.quote(name.toString());
-        return quotedName.substring(1, quotedName.length()-1);
+        return ObjectName.quote(name.toString());
     }
 
     
@@ -363,7 +362,8 @@ public abstract class AbstractProtocol implements ProtocolHandler,
                     getHandler().getGlobal(), rgOname, null );
         }
 
-        endpoint.setName(getName());
+        String endpointName = getName();
+        endpoint.setName(endpointName.substring(1, endpointName.length()-1));
 
         try {
             endpoint.init();

==================================================
