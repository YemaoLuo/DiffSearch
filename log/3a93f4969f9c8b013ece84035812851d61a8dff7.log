3a93f4969f9c8b013ece84035812851d61a8dff7
==================================================
Add processing support for window update frames (required initial support for streams)
==================================================
Mark Thomas
==================================================
Wed May 13 12:45:56 2015 +0000
==================================================
ConnectionSettings.java
Add processing support for window update frames (required initial support for streams)

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1679196 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http2UpgradeHandler.java
index ffc929103e..fd113f7acd 100644
--- a/java/org/apache/coyote/http2/ConnectionSettings.java
+++ b/java/org/apache/coyote/http2/ConnectionSettings.java
@@ -27,6 +27,7 @@ public class ConnectionSettings {
     private final Log log = LogFactory.getLog(ConnectionSettings.class);
     private final StringManager sm = StringManager.getManager(ConnectionSettings.class);
 
+    public static final long DEFAULT_WINDOW_SIZE = (1 << 16) - 1;
     private static final long UNLIMITED = 1 << 32; // Use the maximum possible
     private static final long MAX_WINDOW_SIZE = (1 << 31) - 1;
     private static final long MIN_MAX_FRAME_SIZE = 1 << 14;
@@ -35,7 +36,7 @@ public class ConnectionSettings {
     private volatile long headerTableSize = 4096;
     private volatile long enablePush = 1;
     private volatile long maxConcurrentStreams = UNLIMITED;
-    private volatile long initialWindowSize = (1 << 16) - 1;
+    private volatile long initialWindowSize = DEFAULT_WINDOW_SIZE;
     private volatile long maxFrameSize = MIN_MAX_FRAME_SIZE;
     private volatile long maxHeaderListSize = UNLIMITED;
 

==================================================
Stream.java
index 79e0c66ccf..b277428eb9 100644
--- a/java/org/apache/coyote/http2/LocalStrings.properties
+++ b/java/org/apache/coyote/http2/LocalStrings.properties
@@ -30,8 +30,8 @@ hpackhuffman.huffmanEncodedHpackValueDidNotEndWithEOS=Huffman encoded value in H
 
 upgradeHandler.connectionError=An error occurred that requires the HTTP/2 connection to be closed.
 upgradeHandler.payloadTooBig=The payload is [{0}] bytes long but the maximum frame size is [{1}]
+upgradeHandler.processFrame=Processing frame of type [{0}] for stream [{2}] with flags [{1}] and payload size [{3}]
 upgradeHandler.processFrame.ioerror=An I/O error occurred while reading an incoming HTTP/2 frame
-upgradeHandler.processFrameSettings=Processing settings frame for stream [{1}] with flags [{0}] and payload size [{2}]
 upgradeHandler.processFrameSettings.ackWithNonZeroPayload=Settings frame received with the ACK flag set and payload present
 upgradeHandler.processFrameSettings.invalidPayloadSize=Settings frame received with a payload size of [{0}] which is not a multiple of 6
 upgradeHandler.processFrameSettings.invalidStream=Settings frame received for stream [{0}]

==================================================
