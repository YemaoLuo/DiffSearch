aac5b7ca1e72d24090cb553e9fccd958e0e45e60
==================================================
More refactoring to remove some cyclic dependencies
==================================================
Mark Emlyn
==================================================
Fri Feb 3 12:12:35 2012 +0000
==================================================
Service.java
More refactoring to remove some cyclic dependencies

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1240111 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Connector.java
index da9295ea6e..d1af177c5d 100644
--- a/java/org/apache/catalina/Service.java
+++ b/java/org/apache/catalina/Service.java
@@ -91,9 +91,15 @@ public interface Service extends Lifecycle {
      */
     public void setParentClassLoader(ClassLoader parent);
 
-    // --------------------------------------------------------- Public Methods
+    /**
+     * Obtain the domain under which this container will be / has been
+     * registered.
+     */
+    public String getDomain();
 
 
+    // --------------------------------------------------------- Public Methods
+
     /**
      * Add a new Connector to the set of defined Connectors, and associate it
      * with this Service's Container.

==================================================
StandardServer.java
index 65bdca4b9c..56b3663ced 100644
--- a/java/org/apache/catalina/connector/Connector.java
+++ b/java/org/apache/catalina/connector/Connector.java
@@ -27,7 +27,6 @@ import org.apache.catalina.LifecycleException;
 import org.apache.catalina.LifecycleState;
 import org.apache.catalina.Service;
 import org.apache.catalina.core.AprLifecycleListener;
-import org.apache.catalina.mbeans.MBeanUtils;
 import org.apache.catalina.util.LifecycleMBeanBase;
 import org.apache.coyote.Adapter;
 import org.apache.coyote.ProtocolHandler;
@@ -1049,7 +1048,12 @@ public class Connector extends LifecycleMBeanBase  {
 
     @Override
     protected String getDomainInternal() {
-        return MBeanUtils.getDomain(getService());
+        Service s = getService();
+        if (s == null) {
+            return null;
+        } else {
+            return service.getDomain();
+        }
     }
 
     @Override

==================================================
StandardService.java
index 90cc705aaf..ea855f9696 100644
--- a/java/org/apache/catalina/core/StandardServer.java
+++ b/java/org/apache/catalina/core/StandardServer.java
@@ -36,7 +36,6 @@ import org.apache.catalina.Server;
 import org.apache.catalina.Service;
 import org.apache.catalina.deploy.NamingResources;
 import org.apache.catalina.mbeans.MBeanFactory;
-import org.apache.catalina.mbeans.MBeanUtils;
 import org.apache.catalina.startup.Catalina;
 import org.apache.catalina.util.LifecycleMBeanBase;
 import org.apache.catalina.util.ServerInfo;
@@ -859,7 +858,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
         if (services.length > 0) {
             Service service = services[0];
             if (service != null) {
-                domain = MBeanUtils.getDomain(service);
+                domain = service.getDomain();
             }
         }
         return domain;

==================================================
