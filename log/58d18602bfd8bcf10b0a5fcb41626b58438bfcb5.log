58d18602bfd8bcf10b0a5fcb41626b58438bfcb5
==================================================
https://issues.apache.org/bugzilla/show_bug.cgi?id=48817
==================================================
Filip Hanik
==================================================
Fri Apr 29 17:33:15 2011 +0000
==================================================
DataSourceProxy.java
https://issues.apache.org/bugzilla/show_bug.cgi?id=48817
Add in setValidator to support dependency injection frameworks like Spring etc


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1097895 13f79535-47bb-0310-9956-ffa450edef68



==================================================
PoolConfiguration.java
index e8399913eb..225d07a3cc 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java
@@ -844,6 +844,14 @@ public class DataSourceProxy implements PoolConfiguration {
     public Validator getValidator() {
         return getPoolProperties().getValidator();
     }
+    
+    /** 
+     * {@inheritDoc}
+     */
+    public void setValidator(Validator validator) {
+        getPoolProperties().setValidator(validator);
+    }
+
 
     /** 
      * {@inheritDoc}

==================================================
PoolProperties.java
index b8d2515cb2..b4ddb34bc3 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolConfiguration.java
@@ -542,6 +542,13 @@ public interface PoolConfiguration {
      * @return the optional validator object - may be null
      */
     public Validator getValidator();
+    
+    /**
+     * Sets the validator object
+     * If this is a non null object, it will be used as a validator instead of the validationQuery
+     * If this is null, remove the usage of the validator.
+     */
+    public void setValidator(Validator validator);
 
     /**
      * avoid excess validation, only run validation at most at this frequency - time in milliseconds. 

==================================================
ConnectionPool.java
index be013393d8..5a1272f43a 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/PoolProperties.java
@@ -358,6 +358,19 @@ public class PoolProperties implements PoolConfiguration {
     public Validator getValidator() {
         return validator;
     }
+    
+    /** 
+     * {@inheritDoc}
+     */
+    public void setValidator(Validator validator) {
+        this.validator = validator;
+        if (validator!=null) {
+            this.validatorClassName = validator.getClass().getName();
+        } else {
+            this.validatorClassName = null;
+        }
+    }
+
 
     /** 
      * {@inheritDoc}

==================================================
