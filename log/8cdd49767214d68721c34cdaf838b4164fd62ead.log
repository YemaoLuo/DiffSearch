8cdd49767214d68721c34cdaf838b4164fd62ead
==================================================
Add an extra field to keep around the configured protocol
==================================================
remm remm@apache.org
==================================================
Wed Apr 8 10:37:16 2020 +0200
==================================================
Connector.java
Add an extra field to keep around the configured protocol

This is simpler and more accurate that converting it back from the class
name.


==================================================
ProtocolHandler.java
index f529161567..2a56d16590 100644
--- a/java/org/apache/catalina/connector/Connector.java
+++ b/java/org/apache/catalina/connector/Connector.java
@@ -73,6 +73,7 @@ public class Connector extends LifecycleMBeanBase  {
 
 
     public Connector(String protocol) {
+        configuredProtocol = protocol;
         ProtocolHandler p = null;
         try {
             p = ProtocolHandler.create(protocol);
@@ -94,6 +95,7 @@ public class Connector extends LifecycleMBeanBase  {
 
     public Connector(ProtocolHandler protocolHandler) {
         protocolHandlerClassName = protocolHandler.getClass().getName();
+        configuredProtocol = protocolHandlerClassName;
         this.protocolHandler = protocolHandler;
         // Default for Connector depends on this system property
         setThrowOnFailure(Boolean.getBoolean("org.apache.catalina.startup.EXIT_ON_INIT_FAILURE"));
@@ -258,6 +260,12 @@ public class Connector extends LifecycleMBeanBase  {
     protected final String protocolHandlerClassName;
 
 
+    /**
+     * Name of the protocol that was configured.
+     */
+    protected final String configuredProtocol;
+
+
     /**
      * Coyote protocol handler.
      */
@@ -651,7 +659,7 @@ public class Connector extends LifecycleMBeanBase  {
      * @return the Coyote protocol handler in use.
      */
     public String getProtocol() {
-        return ProtocolHandler.getProtocol(getProtocolHandlerClassName());
+        return configuredProtocol;
     }
 
 

==================================================
