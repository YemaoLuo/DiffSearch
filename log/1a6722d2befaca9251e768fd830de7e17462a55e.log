1a6722d2befaca9251e768fd830de7e17462a55e
==================================================
57187 again: handle * before mapping.
==================================================
Remy Maucherat
==================================================
Mon Nov 10 13:35:02 2014 +0000
==================================================
CoyoteAdapter.java
57187 again: handle * before mapping.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1637839 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Mapper.java
index 689b280145..0fc80a82f1 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -604,6 +604,27 @@ public class CoyoteAdapter implements Adapter {
             req.serverName().setString(proxyName);
         }
 
+        // Check for ping OPTIONS * request
+        if (req.requestURI().equals("*")) {
+            if (req.method().equalsIgnoreCase("OPTIONS")) {
+                StringBuilder allow = new StringBuilder();
+                allow.append("GET, HEAD, POST, PUT, DELETE");
+                // Trace if allowed
+                if (connector.getAllowTrace()) {
+                    allow.append(", TRACE");
+                }
+                // Always allow options
+                allow.append(", OPTIONS");
+                res.setHeader("Allow", allow.toString());
+            } else {
+                res.setStatus(404);
+                res.setMessage("Not found");
+            }
+            connector.getService().getContainer().logAccess(
+                    request, response, 0, true);
+            return false;
+        }
+
         // Copy the raw URI to the decodedURI
         MessageBytes decodedURI = req.decodedURI();
         decodedURI.duplicate(req.requestURI());

==================================================
