ce24a10e8e1c819281c94ca8a6d8720d27d62a83
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53406
==================================================
Mark Emlyn
==================================================
Wed Jun 13 15:46:30 2012 +0000
==================================================
Http11AprProcessor.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53406
Fix possible stack overflow on connection close when using Comet (fhanik)

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1349922 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11NioProcessor.java
index f913a0d9a9..22613aa763 100644
--- a/java/org/apache/coyote/http11/Http11AprProcessor.java
+++ b/java/org/apache/coyote/http11/Http11AprProcessor.java
@@ -144,7 +144,7 @@ public class Http11AprProcessor extends AbstractHttp11Processor<Long> {
 
         rp.setStage(org.apache.coyote.Constants.STAGE_ENDED);
 
-        if (error) {
+        if (error || status==SocketStatus.STOP) {
             return SocketState.CLOSED;
         } else if (!comet) {
             inputBuffer.nextRequest();

==================================================
