d5303a506c7533803d2b3bc46e6120ce673a6667
==================================================
Expand tests and fix escaping issue when searching for users by filter
==================================================
Mark Thomas
==================================================
Tue Apr 13 11:43:51 2021 +0100
==================================================
JNDIRealm.java
Expand tests and fix escaping issue when searching for users by filter


==================================================
TestJNDIRealmIntegration.java
index c16c7b7150..ec36187bbf 100644
--- a/java/org/apache/catalina/realm/JNDIRealm.java
+++ b/java/org/apache/catalina/realm/JNDIRealm.java
@@ -1585,7 +1585,9 @@ public class JNDIRealm extends RealmBase {
         }
 
         // Form the search filter
-        String filter = connection.userSearchFormat.format(new String[] { username });
+        // Escape in case username contains a character with special meaning in
+        // a search filter.
+        String filter = connection.userSearchFormat.format(new String[] { doFilterEscaping(username) });
 
         // Set up the search controls
         SearchControls constraints = new SearchControls();
@@ -1753,6 +1755,8 @@ public class JNDIRealm extends RealmBase {
             return false;
         }
 
+        // This is returned from the directory so will be attribute value
+        // escaped if required
         String dn = user.getDN();
         if (dn == null) {
             return false;

==================================================
