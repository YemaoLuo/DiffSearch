70af3aa151d6188acb1f7a10f2b17fed7cab38af
==================================================
Minor cleanups, improve logic (less returns) and possibly fix a scenario where failed could be called twice in SSL.
==================================================
Remy Maucherat
==================================================
Mon Apr 7 23:19:27 2014 +0000
==================================================
InternalNio2OutputBuffer.java
Minor cleanups, improve logic (less returns) and possibly fix a scenario where failed could be called twice in SSL.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1585616 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Nio2ServletInputStream.java
index 33a30909d3..b382e305ee 100644
--- a/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java
@@ -50,9 +50,7 @@ public class InternalNio2OutputBuffer extends AbstractOutputBuffer<Nio2Channel>
      * Default constructor.
      */
     public InternalNio2OutputBuffer(Response response, int headerBufferSize) {
-
         super(response, headerBufferSize);
-
         outputStreamOutputBuffer = new SocketOutputBuffer();
     }
 

==================================================
Nio2ServletOutputStream.java
index de08b6c34e..a818b9e3e2 100644
--- a/java/org/apache/coyote/http11/upgrade/Nio2ServletInputStream.java
+++ b/java/org/apache/coyote/http11/upgrade/Nio2ServletInputStream.java
@@ -183,7 +183,6 @@ public class Nio2ServletInputStream extends AbstractServletInputStream {
                     }
                 }
             } else if (nRead == -1) {
-                // TODO i18n
                 throw new EOFException();
             }
 

==================================================
SecureNio2Channel.java
index c7e5b672c6..ba82ebed96 100644
--- a/java/org/apache/coyote/http11/upgrade/Nio2ServletOutputStream.java
+++ b/java/org/apache/coyote/http11/upgrade/Nio2ServletOutputStream.java
@@ -51,7 +51,6 @@ public class Nio2ServletOutputStream extends AbstractServletOutputStream<Nio2Cha
             public void completed(Integer nBytes, ByteBuffer attachment) {
                 if (nBytes.intValue() < 0) {
                     failed(new EOFException(), attachment);
-                    return;
                 } else if (attachment.hasRemaining()) {
                     channel.write(attachment, socketWrapper.getTimeout(),
                             TimeUnit.MILLISECONDS, attachment, completionHandler);

==================================================
