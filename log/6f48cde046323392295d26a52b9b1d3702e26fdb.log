6f48cde046323392295d26a52b9b1d3702e26fdb
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48643
==================================================
Mark Emlyn
==================================================
Sun Feb 7 22:16:40 2010 +0000
==================================================
FileStore.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48643
Clean up

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@907502 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardManager.java
index 6eafdfb3d9..28da3441fd 100644
--- a/java/org/apache/catalina/session/FileStore.java
+++ b/java/org/apache/catalina/session/FileStore.java
@@ -258,12 +258,13 @@ public final class FileStore extends StoreBase {
         }
 
         FileInputStream fis = null;
+        BufferedInputStream bis = null;
         ObjectInputStream ois = null;
         Loader loader = null;
         ClassLoader classLoader = null;
         try {
             fis = new FileInputStream(file.getAbsolutePath());
-            BufferedInputStream bis = new BufferedInputStream(fis);
+            bis = new BufferedInputStream(fis);
             Container container = manager.getContainer();
             if (container != null)
                 loader = container.getLoader();
@@ -278,13 +279,19 @@ public final class FileStore extends StoreBase {
                 manager.getContainer().getLogger().debug("No persisted data file found");
             return (null);
         } catch (IOException e) {
-            if (ois != null) {
+            if (bis != null) {
                 try {
-                    ois.close();
+                    bis.close();
+                } catch (IOException f) {
+                    // Ignore
+                }
+            }
+            if (fis != null) {
+                try {
+                    fis.close();
                 } catch (IOException f) {
                     // Ignore
                 }
-                ois = null;
             }
             throw e;
         }
@@ -297,12 +304,10 @@ public final class FileStore extends StoreBase {
             return (session);
         } finally {
             // Close the input stream
-            if (ois != null) {
-                try {
-                    ois.close();
-                } catch (IOException f) {
-                    // Ignore
-                }
+            try {
+                ois.close();
+            } catch (IOException f) {
+                // Ignore
             }
         }
     }
@@ -357,9 +362,9 @@ public final class FileStore extends StoreBase {
             fos = new FileOutputStream(file.getAbsolutePath());
             oos = new ObjectOutputStream(new BufferedOutputStream(fos));
         } catch (IOException e) {
-            if (oos != null) {
+            if (fos != null) {
                 try {
-                    oos.close();
+                    fos.close();
                 } catch (IOException f) {
                     // Ignore
                 }

==================================================
