f0d8e1b406dfcf1647991810a72649935e06e724
==================================================
Improve processing of errors that are wrapped into InvocationTargetException.
==================================================
Konstantin Kolinko
==================================================
Mon Nov 14 06:48:46 2011 +0000
==================================================
WebappLoader.java
Improve processing of errors that are wrapped into InvocationTargetException.
Rethrow errors that must be rethrown:
process exceptions thrown from Constructor.newInstance().
In DataSourceLinkFactory: unwrap exception from within InvocationTargetException.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1201608 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspServlet.java
index c9dc0c2fe8..65c69a1faf 100644
--- a/java/org/apache/catalina/loader/WebappLoader.java
+++ b/java/org/apache/catalina/loader/WebappLoader.java
@@ -603,6 +603,7 @@ public class WebappLoader extends LifecycleMBeanBase
                 .registerComponent(classLoader, cloname, null);
 
         } catch (Throwable t) {
+            t = ExceptionUtils.unwrapInvocationTargetException(t);
             ExceptionUtils.handleThrowable(t);
             log.error( "LifecycleException ", t );
             throw new LifecycleException("start: ", t);

==================================================
DataSourceLinkFactory.java
index 369e70a981..ddda24021a 100644
--- a/java/org/apache/jasper/servlet/JspServlet.java
+++ b/java/org/apache/jasper/servlet/JspServlet.java
@@ -104,6 +104,7 @@ public class JspServlet extends HttpServlet implements PeriodicEventListener {
                 Object[] args = { config, context };
                 options = (Options) ctor.newInstance(args);
             } catch (Throwable e) {
+                e = ExceptionUtils.unwrapInvocationTargetException(e);
                 ExceptionUtils.handleThrowable(e);
                 // Need to localize this.
                 log.warn("Failed to load engineOptionsClass", e);

==================================================
