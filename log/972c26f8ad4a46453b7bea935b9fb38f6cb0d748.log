972c26f8ad4a46453b7bea935b9fb38f6cb0d748
==================================================
Improve handling of case when an HTTP/2 client sends more data that is subject to flow control than the current window size allows.
==================================================
Mark Thomas
==================================================
Wed Jan 11 20:54:41 2017 +0000
==================================================
Http2Parser.java
Improve handling of case when an HTTP/2 client sends more data that is subject to flow control than the current window size allows.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1778348 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAbortedUpload.java
index 76df8f5a82..1b36ff96a2 100644
--- a/java/org/apache/coyote/http2/Http2Parser.java
+++ b/java/org/apache/coyote/http2/Http2Parser.java
@@ -178,6 +178,11 @@ class Http2Parser {
             }
         } else {
             synchronized (dest) {
+                if (dest.remaining() < dataLength) {
+                    swallow(streamId, dataLength, false);
+                    // Client has sent more data than permitted by Window size
+                    throw new StreamException("Client sent more data than stream window allowed", Http2Error.FLOW_CONTROL_ERROR, streamId);
+                }
                 input.fill(true, dest, dataLength);
                 // Process padding before sending any notifications in case
                 // padding is invalid.

==================================================
