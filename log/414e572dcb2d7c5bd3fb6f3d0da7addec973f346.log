414e572dcb2d7c5bd3fb6f3d0da7addec973f346
==================================================
Log warning if any jar scan does not find a TLD
==================================================
Jeremy Boynes
==================================================
Sat Feb 28 18:59:16 2015 +0000
==================================================
TldScanner.java
Log warning if any jar scan does not find a TLD

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1662989 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestTldScanner.java
index e5464fb9e7..70554a3204 100644
--- a/java/org/apache/jasper/servlet/TldScanner.java
+++ b/java/org/apache/jasper/servlet/TldScanner.java
@@ -278,17 +278,13 @@ public class TldScanner {
     }
 
     class TldScannerCallback implements JarScannerCallback {
-        private boolean tldFound = false;
-        private boolean jarFound = false;
+        private boolean foundJarWithoutTld = false;
 
         @Override
         public void scan(JarURLConnection urlConn, String webappPath,
                 boolean isWebapp) throws IOException {
-            if (!jarFound) {
-                jarFound = true;
-            }
             boolean found = false;
-            URL jarURL = null;
+            URL jarURL;
             try (Jar jar = JarFactory.newInstance(urlConn.getURL())) {
                 jarURL = jar.getJarFileURL();
                 jar.nextEntry();
@@ -309,9 +305,8 @@ public class TldScanner {
                     }
                 }
             }
-            if (found) {
-                tldFound = true;
-            } else {
+            if (!found) {
+                foundJarWithoutTld = true;
                 if (log.isDebugEnabled()) {
                     log.debug(Localizer.getMessage("jsp.tldCache.noTldInJar",
                             jarURL.toString()));
@@ -322,9 +317,6 @@ public class TldScanner {
         @Override
         public void scan(File file, final String webappPath, boolean isWebapp)
                 throws IOException {
-            if (!jarFound) {
-                jarFound = true;
-            }
             File metaInf = new File(file, "META-INF");
             if (!metaInf.isDirectory()) {
                 return;
@@ -356,7 +348,6 @@ public class TldScanner {
                         URL url = file.toUri().toURL();
                         TldResourcePath path = new TldResourcePath(url, resourcePath);
                         parseTld(path);
-                        tldFound = true;
                     } catch (SAXException e) {
                         throw new IOException(e);
                     }
@@ -382,7 +373,7 @@ public class TldScanner {
 
 
         boolean scanFoundNoTLDs() {
-            return jarFound && !tldFound;
+            return foundJarWithoutTld;
         }
     }
 }

==================================================
