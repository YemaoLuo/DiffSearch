6569d7ad8a70f08db66c50f09c70f546faefff91
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60722
==================================================
Mark Thomas
==================================================
Wed Feb 15 22:22:52 2017 +0000
==================================================
AsyncContextImpl.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60722
Take account of the dispatchersUseEncodedPaths setting on the current Context when generating paths for dispatches triggered by AsyncContext.dispatch()

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1783155 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAsyncContextImpl.java
index 1a3a595237..8dcae1fc36 100644
--- a/java/org/apache/catalina/core/AsyncContextImpl.java
+++ b/java/org/apache/catalina/core/AsyncContextImpl.java
@@ -41,6 +41,7 @@ import org.apache.catalina.Globals;
 import org.apache.catalina.Host;
 import org.apache.catalina.Valve;
 import org.apache.catalina.connector.Request;
+import org.apache.catalina.util.URLEncoder;
 import org.apache.coyote.ActionCode;
 import org.apache.coyote.AsyncContextCallback;
 import org.apache.coyote.RequestInfo;
@@ -162,6 +163,9 @@ public class AsyncContextImpl implements AsyncContext, AsyncContextCallback {
         if (pathInfo != null) {
             path += pathInfo;
         }
+        if (this.context.getDispatchersUseEncodedPaths()) {
+            path = URLEncoder.DEFAULT.encode(path, "UTF-8");
+        }
         dispatch(path);
     }
 

==================================================
