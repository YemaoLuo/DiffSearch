eeb7351219bd8803c0053e1e80444664a7cf5b51
==================================================
Expand tests to cover escaping of substituted roleBaes values
==================================================
Mark Thomas
==================================================
Tue Apr 13 15:19:31 2021 +0100
==================================================
JNDIRealm.java
Expand tests to cover escaping of substituted roleBaes values

While the UnboundedID LDAP SDK doesn't appear to have a preference some
servers (Windows AD, OpenLDAP) do appear to.



==================================================
TestJNDIRealmIntegration.java
index 43e9ca8918..04768e88b4 100644
--- a/java/org/apache/catalina/realm/JNDIRealm.java
+++ b/java/org/apache/catalina/realm/JNDIRealm.java
@@ -1904,7 +1904,9 @@ public class JNDIRealm extends RealmBase {
             Name name = np.parse(dn);
             String nameParts[] = new String[name.size()];
             for (int i = 0; i < name.size(); i++) {
-                nameParts[i] = name.get(i);
+                // May have been returned with \<char> escaping rather than
+                // \<hex><hex>. Make sure it is \<hex><hex>.
+                nameParts[i] =  convertToHexEscape(name.get(i));
             }
             base = connection.roleBaseFormat.format(nameParts);
         } else {

==================================================
