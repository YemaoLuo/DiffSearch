f0e76d230478e485eed3c23f07f11f33148a07a9
==================================================
up sync from 6.0
==================================================
Filip Hanik
==================================================
Fri Jul 20 22:28:05 2007 +0000
==================================================
CoyoteAdapter.java
up sync from 6.0
http://svn.apache.org/viewvc?view=rev&rev=554814
http://svn.apache.org/viewvc?view=rev&rev=555304 



git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@558178 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index 73118acd86..3011edab18 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -510,7 +510,7 @@ public class CoyoteAdapter
             if (request.isRequestedSessionIdFromURL()) {
                 // This is not optimal, but as this is not very common, it
                 // shouldn't matter
-                redirectPath = redirectPath + ";jsessionid=" 
+                redirectPath = redirectPath + ";" + Globals.SESSION_PARAMETER_NAME + "=" 
                     + request.getRequestedSessionId();
             }
             if (query != null) {

==================================================
RealmBase.java
index ba28742c97..5041348b67 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -1447,7 +1447,8 @@ public class Response
             String file = url.getFile();
             if ((file == null) || !file.startsWith(contextPath))
                 return (false);
-            if( file.indexOf(";jsessionid=" + session.getIdInternal()) >= 0 )
+            String tok = ";" + Globals.SESSION_PARAMETER_NAME + "=" + session.getIdInternal();
+            if( file.indexOf(tok, contextPath.length()) >= 0 )
                 return (false);
         }
 
@@ -1581,7 +1582,9 @@ public class Response
         }
         StringBuffer sb = new StringBuffer(path);
         if( sb.length() > 0 ) { // jsessionid can't be first.
-            sb.append(";jsessionid=");
+            sb.append(";");
+            sb.append(Globals.SESSION_PARAMETER_NAME);
+            sb.append("=");
             sb.append(sessionId);
         }
         sb.append(anchor);

==================================================
