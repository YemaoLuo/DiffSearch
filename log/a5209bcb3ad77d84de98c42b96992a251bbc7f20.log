a5209bcb3ad77d84de98c42b96992a251bbc7f20
==================================================
Adjust examples to the latest implementation
==================================================
Filip Hanik
==================================================
Fri Mar 26 15:21:39 2010 +0000
==================================================
Async0.java
Adjust examples to the latest implementation


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@927911 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Async3.java
index 5a5af978ed..194beb8f66 100644
--- a/webapps/examples/WEB-INF/classes/async/Async0.java
+++ b/webapps/examples/WEB-INF/classes/async/Async0.java
@@ -34,8 +34,8 @@ public class Async0 extends HttpServlet {
     private static final Log log = LogFactory.getLog(Async0.class);
 
     @Override
-    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
-        if (req.isAsyncStarted()) {
+    protected void service(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException {
+        if (Boolean.TRUE == req.getAttribute("dispatch")) {
             log.info("Received dispatch, completing on the worker thread.");
             req.getAsyncContext().complete();
             log.info("After complete called started:"+req.isAsyncStarted());
@@ -47,6 +47,7 @@ public class Async0 extends HttpServlet {
             Runnable run = new Runnable() {
                 public void run() {
                     try {
+                        req.setAttribute("dispatch", Boolean.TRUE);
                         Thread.currentThread().setName("Async0-Thread");
                         log.info("Putting AsyncThread to sleep");
                         Thread.sleep(2*1000);

==================================================
