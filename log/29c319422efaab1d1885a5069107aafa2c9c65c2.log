29c319422efaab1d1885a5069107aafa2c9c65c2
==================================================
First pass at implementing compression for responses
==================================================
Mark Thomas
==================================================
Thu Nov 30 10:20:45 2017 +0000
==================================================
Stream.java
First pass at implementing compression for responses

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1816703 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StreamProcessor.java
index 6cc2f50a1e..b48b7c3a6b 100644
--- a/java/org/apache/coyote/http2/Stream.java
+++ b/java/org/apache/coyote/http2/Stream.java
@@ -34,6 +34,7 @@ import org.apache.coyote.InputBuffer;
 import org.apache.coyote.Request;
 import org.apache.coyote.Response;
 import org.apache.coyote.http.HttpOutputBuffer;
+import org.apache.coyote.http11.OutputFilter;
 import org.apache.coyote.http2.HpackDecoder.HeaderEmitter;
 import org.apache.juli.logging.Log;
 import org.apache.juli.logging.LogFactory;
@@ -58,7 +59,7 @@ class Stream extends AbstractStream implements HeaderEmitter {
     static {
         Response response =  new Response();
         response.setStatus(100);
-        StreamProcessor.prepareHeaders(response);
+        StreamProcessor.prepareHeaders(null, response, true, null, null);
         ACK_HEADERS = response.getMimeHeaders();
     }
 
@@ -414,6 +415,11 @@ class Stream extends AbstractStream implements HeaderEmitter {
     }
 
 
+    final void addOutputFilter(OutputFilter filter) {
+        http2OutputBuffer.addFilter(filter);
+    }
+
+
     final void writeTrailers() throws IOException {
         Supplier<Map<String,String>> supplier = coyoteResponse.getTrailerFields();
         if (supplier == null) {

==================================================
