284a540aa73824529e931751bb4815c89ae1768a
==================================================
Revert change as the issue seems different, despite similarities
==================================================
remm remm@apache.org
==================================================
Mon Apr 15 13:35:39 2019 +0200
==================================================
Http2Parser.java
Revert change as the issue seems different, despite similarities


==================================================
TestStream.java
index 967175f048..f5e19865b2 100644
--- a/java/org/apache/coyote/http2/Http2Parser.java
+++ b/java/org/apache/coyote/http2/Http2Parser.java
@@ -580,13 +580,13 @@ class Http2Parser {
         // going to be thrown.
         hpackDecoder.getHeaderEmitter().validateHeaders();
 
+        output.headersEnd(streamId);
+
         if (headersEndStream) {
             output.receivedEndOfStream(streamId);
             headersEndStream = false;
         }
 
-        output.headersEnd(streamId);
-
         // Reset size for new request if the buffer was previously expanded
         if (headerReadBuffer.capacity() > Constants.DEFAULT_HEADER_READ_BUFFER_SIZE) {
             headerReadBuffer = ByteBuffer.allocate(Constants.DEFAULT_HEADER_READ_BUFFER_SIZE);

==================================================
