3f20e75607eb3d929fadb018f73dfa7fae46b76e
==================================================
Add JPMS metadata for use of ServiceProvider API by WebSocket
==================================================
Mark Thomas
==================================================
Fri Nov 6 10:01:49 2020 +0000
==================================================
ContainerProvider.java
Add JPMS metadata for use of ServiceProvider API by WebSocket



==================================================
ServerEndpointConfig.java
index 33a8af2879..fdc54f6a75 100644
--- a/java/jakarta/websocket/ContainerProvider.java
+++ b/java/jakarta/websocket/ContainerProvider.java
@@ -19,10 +19,13 @@ package jakarta.websocket;
 import java.util.Iterator;
 import java.util.ServiceLoader;
 
+import aQute.bnd.annotation.spi.ServiceConsumer;
+
 /**
  * Use the {@link ServiceLoader} mechanism to provide instances of the WebSocket
  * client container.
  */
+@ServiceConsumer(value=ContainerProvider.class)
 public abstract class ContainerProvider {
 
     private static final String DEFAULT_PROVIDER_CLASS_NAME =

==================================================
WsContainerProvider.java
index 4fb16d301e..33a7112600 100644
--- a/java/jakarta/websocket/server/ServerEndpointConfig.java
+++ b/java/jakarta/websocket/server/ServerEndpointConfig.java
@@ -29,6 +29,8 @@ import jakarta.websocket.EndpointConfig;
 import jakarta.websocket.Extension;
 import jakarta.websocket.HandshakeResponse;
 
+import aQute.bnd.annotation.spi.ServiceConsumer;
+
 /**
  * Provides configuration information for WebSocket endpoints published to a
  * server. Applications may provide their own implementation or use
@@ -139,6 +141,7 @@ public interface ServerEndpointConfig extends EndpointConfig {
     }
 
 
+    @ServiceConsumer(value=Configurator.class)
     public class Configurator {
 
         private static volatile Configurator defaultImpl = null;

==================================================
DefaultServerEndpointConfigurator.java
index ad990f17d5..c3b52a37f6 100644
--- a/java/org/apache/tomcat/websocket/WsContainerProvider.java
+++ b/java/org/apache/tomcat/websocket/WsContainerProvider.java
@@ -19,6 +19,7 @@ package org.apache.tomcat.websocket;
 import jakarta.websocket.ContainerProvider;
 import jakarta.websocket.WebSocketContainer;
 
+@aQute.bnd.annotation.spi.ServiceProvider(value=ContainerProvider.class)
 public class WsContainerProvider extends ContainerProvider {
 
     @Override

==================================================
