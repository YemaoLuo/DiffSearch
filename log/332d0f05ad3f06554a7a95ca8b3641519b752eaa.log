332d0f05ad3f06554a7a95ca8b3641519b752eaa
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43080 and https://issues.apache.org/bugzilla/show_bug.cgi?id=43079
==================================================
Mark Emlyn
==================================================
Sun May 4 10:41:48 2008 +0000
==================================================
StandardContext.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43080 and https://issues.apache.org/bugzilla/show_bug.cgi?id=43079
Move warning to StandardContext so a) we can check all url-patterns and b) we associate the message with the context.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@653195 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityCollection.java
index ef8e67fda7..18f59aafa7 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -5040,20 +5040,38 @@ public class StandardContext
             return (false);
         }
         if (urlPattern.startsWith("*.")) {
-            if (urlPattern.indexOf('/') < 0)
+            if (urlPattern.indexOf('/') < 0) {
+                checkUnusualURLPattern(urlPattern);
                 return (true);
-            else
+            } else
                 return (false);
         }
         if ( (urlPattern.startsWith("/")) &&
-                (urlPattern.indexOf("*.") < 0))
+                (urlPattern.indexOf("*.") < 0)) {
+            checkUnusualURLPattern(urlPattern);
             return (true);
-        else
+        } else
             return (false);
 
     }
 
 
+    /**
+     * Check for unusual but valid <code>&lt;url-pattern&gt;</code>s.
+     * See Bugzilla 34805, 43079 & 43080
+     */
+    private void checkUnusualURLPattern(String urlPattern) {
+        if (log.isInfoEnabled()) {
+            if(urlPattern.endsWith("*") && (urlPattern.length() < 2 ||
+                    urlPattern.charAt(urlPattern.length()-2) != '/')) {
+                log.info("Suspicious url pattern: \"" + urlPattern + "\"" +
+                        " in context [" + getName() + "] - see" +
+                        " section SRV.11.2 of the Servlet specification" );
+            }
+        }
+    }
+
+
     // ------------------------------------------------------------- Operations
 
 

==================================================
