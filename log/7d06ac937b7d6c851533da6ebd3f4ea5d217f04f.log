7d06ac937b7d6c851533da6ebd3f4ea5d217f04f
==================================================
Hook up a few more constants
==================================================
Mark Emlyn
==================================================
Wed Feb 1 20:10:21 2012 +0000
==================================================
Globals.java
Hook up a few more constants

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1239296 13f79535-47bb-0310-9956-ffa450edef68



==================================================
CometEventImpl.java
index 68aaeec3d4..1224a1bb66 100644
--- a/java/org/apache/catalina/Globals.java
+++ b/java/org/apache/catalina/Globals.java
@@ -154,9 +154,11 @@ public final class Globals {
      * per-connection request timeout through Comet API.
      *
      * @see org.apache.catalina.comet.CometEvent#setTimeout(int)
+     *
+     * Duplicated here for neater code in the catalina packages.
      */
     public static final String COMET_TIMEOUT_SUPPORTED_ATTR =
-        "org.apache.tomcat.comet.timeout.support";
+            org.apache.coyote.Constants.COMET_TIMEOUT_SUPPORTED_ATTR;
 
 
     /**
@@ -165,9 +167,11 @@ public final class Globals {
      * timeout for Comet API. The value is in milliseconds.
      *
      * @see org.apache.catalina.comet.CometEvent#setTimeout(int)
+     *
+     * Duplicated here for neater code in the catalina packages.
      */
     public static final String COMET_TIMEOUT_ATTR =
-        "org.apache.tomcat.comet.timeout";
+        org.apache.coyote.Constants.COMET_TIMEOUT_ATTR;
 
 
     /**

==================================================
Request.java
index a5d20ac53e..97c54b14f0 100644
--- a/java/org/apache/catalina/connector/CometEventImpl.java
+++ b/java/org/apache/catalina/connector/CometEventImpl.java
@@ -22,6 +22,7 @@ import javax.servlet.ServletException;
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 
+import org.apache.catalina.Globals;
 import org.apache.catalina.comet.CometEvent;
 import org.apache.tomcat.util.res.StringManager;
 
@@ -121,8 +122,10 @@ public class CometEventImpl implements CometEvent {
     @Override
     public void setTimeout(int timeout) throws IOException, ServletException,
             UnsupportedOperationException {
-        if (request.getAttribute("org.apache.tomcat.comet.timeout.support") == Boolean.TRUE) {
-            request.setAttribute("org.apache.tomcat.comet.timeout", Integer.valueOf(timeout));
+        if (request.getAttribute(Globals.COMET_TIMEOUT_SUPPORTED_ATTR) ==
+                Boolean.TRUE) {
+            request.setAttribute(Globals.COMET_TIMEOUT_ATTR,
+                    Integer.valueOf(timeout));
             if (request.isComet()) {
                 request.setCometTimeout(timeout);
             }

==================================================
Constants.java
index 294ae9bde5..1007e1e49e 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -942,9 +942,9 @@ public class Request
      * The underlying connector may also expose request attributes. These all
      * have names starting with "org.apache.tomcat" and include:
      * <ul>
-     * <li>org.apache.tomcat.sendfile.support</li>
-     * <li>{@link Globals#COMET_SUPPORTED_ATTR</li>
-     * <li>org.apache.tomcat.comet.timeout.support</li>
+     * <li>{@link Globals#SENDFILE_SUPPORTED_ATTR}</li>
+     * <li>{@link Globals#COMET_SUPPORTED_ATTR}</li>
+     * <li>{@link Globals#COMET_TIMEOUT_SUPPORTED_ATTR}</li>
      * </ul>
      * Connector implementations may return some, all or none of these
      * attributes and may also support additional attributes.

==================================================
AbstractHttp11Processor.java
index c28fb850a3..2040f47cd8 100644
--- a/java/org/apache/coyote/Constants.java
+++ b/java/org/apache/coyote/Constants.java
@@ -67,4 +67,25 @@ public final class Constants {
     public static final String COMET_SUPPORTED_ATTR =
         "org.apache.tomcat.comet.support";
 
+
+    /**
+     * The request attribute that is set to the value of {@code Boolean.TRUE}
+     * if connector processing this request supports setting
+     * per-connection request timeout through Comet API.
+     *
+     * @see org.apache.catalina.comet.CometEvent#setTimeout(int)
+     */
+    public static final String COMET_TIMEOUT_SUPPORTED_ATTR =
+        "org.apache.tomcat.comet.timeout.support";
+
+
+    /**
+     * The request attribute that can be set to a value of type
+     * {@code java.lang.Integer} to specify per-connection request
+     * timeout for Comet API. The value is in milliseconds.
+     *
+     * @see org.apache.catalina.comet.CometEvent#setTimeout(int)
+     */
+    public static final String COMET_TIMEOUT_ATTR =
+        "org.apache.tomcat.comet.timeout";
 }

==================================================
Http11NioProcessor.java
index 5fc78160a4..fcc0ca0344 100644
--- a/java/org/apache/coyote/http11/AbstractHttp11Processor.java
+++ b/java/org/apache/coyote/http11/AbstractHttp11Processor.java
@@ -1285,7 +1285,8 @@ public abstract class AbstractHttp11Processor<S> extends AbstractProcessor<S> {
         }
         // Advertise comet timeout support
         if (endpoint.getUseCometTimeout()) {
-            request.setAttribute("org.apache.tomcat.comet.timeout.support",
+            request.setAttribute(
+                    org.apache.coyote.Constants.COMET_TIMEOUT_SUPPORTED_ATTR,
                     Boolean.TRUE);
         }
 

==================================================
