3549def9252c6c00dd18885d96b1697b37bb6e3c
==================================================
Fix WebSocket's non blocking call
==================================================
Filip Hanik
==================================================
Thu Mar 1 23:05:51 2012 +0000
==================================================
Http11NioProtocol.java
Fix WebSocket's non blocking call
http://tomcat.markmail.org/thread/drj7zgq2csfdnvoh#query:+page:1+mid:y4dheqpm2wx5xzba+state:results



git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1295978 13f79535-47bb-0310-9956-ffa450edef68



==================================================
UpgradeNioProcessor.java
index 432986a74d..18b415a3f3 100644
--- a/java/org/apache/coyote/http11/Http11NioProtocol.java
+++ b/java/org/apache/coyote/http11/Http11NioProtocol.java
@@ -296,12 +296,7 @@ public class Http11NioProtocol extends AbstractHttp11JsseProtocol {
         protected void upgradePoll(SocketWrapper<NioChannel> socket,
                 Processor<NioChannel> processor) {
             connections.put(socket.getSocket(), processor);
-
-            SelectionKey key = socket.getSocket().getIOChannel().keyFor(
-                    socket.getSocket().getPoller().getSelector());
-            key.interestOps(SelectionKey.OP_READ);
-            ((KeyAttachment) socket).interestOps(
-                    SelectionKey.OP_READ);
+            socket.getSocket().getPoller().add(socket.getSocket());
         }
     }
 }

==================================================
