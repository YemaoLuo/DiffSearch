ed4a025817470154100fa2fd665c3fd5061b3f70
==================================================
kkolinko review
==================================================
Mark Emlyn
==================================================
Fri Jun 6 17:14:19 2014 +0000
==================================================
StandardHostValve.java
kkolinko review
Use finishResponse() rather than flushBuffer to avoid chunking if not necessary.
Add finishResponse() to ErrorReportValve.report()
Don;t try and reset the response if it has already been marked as in error

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1600965 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ErrorReportValve.java
index 4b0de2256d..a7345e3064 100644
--- a/java/org/apache/catalina/core/StandardHostValve.java
+++ b/java/org/apache/catalina/core/StandardHostValve.java
@@ -290,7 +290,7 @@ final class StandardHostValve extends ValveBase {
                                  request.getRequestURI());
             if (custom(request, response, errorPage)) {
                 try {
-                    response.flushBuffer();
+                    response.finishResponse();
                 } catch (ClientAbortException e) {
                     // Ignore
                 } catch (IOException e) {
@@ -366,7 +366,7 @@ final class StandardHostValve extends ValveBase {
                               realError.getClass());
             if (custom(request, response, errorPage)) {
                 try {
-                    response.flushBuffer();
+                    response.finishResponse();
                 } catch (IOException e) {
                     container.getLogger().warn("Exception Processing " + errorPage, e);
                 }

==================================================
