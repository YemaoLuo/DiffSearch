5418e2bb8aec0e1d3a65a7a331b3f8860dbf4576
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54262
==================================================
Mark Emlyn
==================================================
Mon Jan 7 18:44:22 2013 +0000
==================================================
WebXml.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54262
An empty <absolute-ordering /> should turn off all web-fragments. Based on a patch by  Violeta Georgieva.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1429946 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WebRuleSet.java
index 5c6597b3b4..2cd9e9e10f 100644
--- a/java/org/apache/catalina/deploy/WebXml.java
+++ b/java/org/apache/catalina/deploy/WebXml.java
@@ -76,16 +76,17 @@ public class WebXml {
     // web.xml only elements
     // Absolute Ordering
     private Set<String> absoluteOrdering = null;
-    public void addAbsoluteOrdering(String fragmentName) {
+    public void createAbsoluteOrdering() {
         if (absoluteOrdering == null) {
             absoluteOrdering = new LinkedHashSet<>();
         }
+    }
+    public void addAbsoluteOrdering(String fragmentName) {
+        createAbsoluteOrdering();
         absoluteOrdering.add(fragmentName);
     }
     public void addAbsoluteOrderingOthers() {
-        if (absoluteOrdering == null) {
-            absoluteOrdering = new LinkedHashSet<>();
-        }
+        createAbsoluteOrdering();
         absoluteOrdering.add(ORDER_OTHERS);
     }
     public Set<String> getAbsoluteOrdering() {

==================================================
TestContextConfig.java
index 12d9791912..9b04b25559 100644
--- a/java/org/apache/catalina/startup/WebRuleSet.java
+++ b/java/org/apache/catalina/startup/WebRuleSet.java
@@ -1131,6 +1131,12 @@ final class AbsoluteOrderingRule extends Rule {
                     "webRuleSet.absoluteOrderingCount"));
         } else {
             isAbsoluteOrderingSet = true;
+            WebXml webXml = (WebXml) digester.peek();
+            webXml.createAbsoluteOrdering();
+            if (digester.getLogger().isDebugEnabled()) {
+                digester.getLogger().debug(
+                        webXml.getClass().getName() + ".setAbsoluteOrdering()");
+            }
         }
     }
 }

==================================================
