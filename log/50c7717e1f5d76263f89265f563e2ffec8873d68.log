50c7717e1f5d76263f89265f563e2ffec8873d68
==================================================
Fix FindBugs warnings
==================================================
Mark Emlyn
==================================================
Sun Jan 16 13:24:49 2011 +0000
==================================================
TestOrderInterceptor.java
index 9cb76151a7..ed135693eb 100644
--- a/res/findbugs/filter-false-positives.xml
+++ b/res/findbugs/filter-false-positives.xml
@@ -58,6 +58,11 @@
     <Class name="org.apache.naming.resources.ResourceAttributes" />
     <Bug code="CN" />
   </Match>
+  <Match>
+    <!-- Class name is appropriate -->
+    <Class name="org.apache.tomcat.util.bcel.classfile.CodeException"/>
+    <Bug code="Nm" />
+  </Match>
   <Match>
     <!-- Returning null here is fine -->
     <Class name="org.apache.tomcat.util.buf.MessageBytes"/>
@@ -85,4 +90,59 @@
   <Match>
     <Class name="org.apache.el.parser.ParseException" />
   </Match>
+  <!-- Test code -->
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.channel.TestChannelOptionFlag" />
+    <Method name="tearDown" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.channel.TestChannelStartStop" />
+    <Method name="tearDown" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.channel.TestChannelStartStop" />
+    <Method name="testDoublePartialStart" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.channel.TestChannelStartStop" />
+    <Method name="testFalseOption" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.channel.TestRemoteProcessException" />
+   <Bug code="Nm" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.interceptors.TestNonBlockingCoordinator" />
+    <Method name="testCoord1" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.membership.TestTcpFailureDetector" />
+    <Method name="tearDown" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.transport.SocketReceive$1" />
+    <Method name="run" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.transport.SocketTribesReceive$1" />
+    <Method name="run" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.transport.SocketTribesReceive" />
+    <Method name="main" />
+    <Bug code="DE" />
+  </Match>
+  <Match>
+    <Class name="org.apache.catalina.tribes.test.transport.SocketValidateReceive$1" />
+    <Method name="run" />
+    <Bug code="DE" />
+  </Match>
 </FindBugsFilter>
\ No newline at end of file

==================================================
TestSenderConnections.java
index 42a53e2b85..95a4a59407 100644
--- a/test/org/apache/catalina/tribes/test/interceptors/TestOrderInterceptor.java
+++ b/test/org/apache/catalina/tribes/test/interceptors/TestOrderInterceptor.java
@@ -84,7 +84,7 @@ public class TestOrderInterceptor extends TestCase {
         Member[] dest = channels[0].getMembers();
         final AtomicInteger value = new AtomicInteger(0);
         for ( int i=0; i<100; i++ ) {
-            channels[0].send(dest,new Integer(value.getAndAdd(1)),0);
+            channels[0].send(dest,Integer.valueOf(value.getAndAdd(1)),0);
         }
         Thread.sleep(5000);
         for ( int i=0; i<test.length; i++ ) {
@@ -102,7 +102,7 @@ public class TestOrderInterceptor extends TestCase {
                 for (int i = 0; i < 100; i++) {
                     try {
                         synchronized (channels[0]) {
-                            channels[0].send(dest, new Integer(value.getAndAdd(1)), 0);
+                            channels[0].send(dest, Integer.valueOf(value.getAndAdd(1)), 0);
                         }
                     }catch ( Exception x ) {
                         exceptionQueue.add(x);
@@ -153,7 +153,7 @@ public class TestOrderInterceptor extends TestCase {
         }
         int cnt = 0;
         int total = 0;
-        boolean fail = false;
+        volatile boolean fail = false;
         @Override
         public synchronized void messageReceived(Serializable msg, Member sender) {
             total++;
@@ -171,7 +171,6 @@ public class TestOrderInterceptor extends TestCase {
     }
     
     public static class MangleOrderInterceptor extends ChannelInterceptorBase {
-        int cnt = 1;
         ChannelMessage hold = null;
         Member[] dest = null;
         @Override

==================================================
TestDomainFilter.java
index adb336cc42..ea296a54f7 100644
--- a/test/org/apache/catalina/tribes/test/io/TestSenderConnections.java
+++ b/test/org/apache/catalina/tribes/test/io/TestSenderConnections.java
@@ -111,7 +111,7 @@ public class TestSenderConnections extends TestCase {
         }
     }
 
-    public class TestMsgListener implements ChannelListener {
+    public static class TestMsgListener implements ChannelListener {
         public String name = null;
         public TestMsgListener(String name) {
             this.name = name;

==================================================
TestMemberArrival.java
index ecc28f6866..19c5cefd1a 100644
--- a/test/org/apache/catalina/tribes/test/membership/TestDomainFilter.java
+++ b/test/org/apache/catalina/tribes/test/membership/TestDomainFilter.java
@@ -91,7 +91,7 @@ public class TestDomainFilter
         super.tearDown();
     }
 
-    public class TestMbrListener
+    public static class TestMbrListener
         implements MembershipListener {
         public String name = null;
         public TestMbrListener(String name) {

==================================================
TestTcpFailureDetector.java
index 5476db283b..3fb99f0320 100644
--- a/test/org/apache/catalina/tribes/test/membership/TestMemberArrival.java
+++ b/test/org/apache/catalina/tribes/test/membership/TestMemberArrival.java
@@ -88,7 +88,7 @@ public class TestMemberArrival
         super.tearDown();
     }
 
-    public class TestMbrListener
+    public static class TestMbrListener
         implements MembershipListener {
         public String name = null;
         public TestMbrListener(String name) {

==================================================
SocketValidateReceive.java
index 514c359ae1..83f4fe79c8 100644
--- a/test/org/apache/catalina/tribes/test/membership/TestTcpFailureDetector.java
+++ b/test/org/apache/catalina/tribes/test/membership/TestTcpFailureDetector.java
@@ -135,7 +135,7 @@ public class TestTcpFailureDetector extends TestCase {
         super.tearDown();
     }
     
-    public class TestMbrListener implements MembershipListener {
+    public static class TestMbrListener implements MembershipListener {
         public String name = null;
         public TestMbrListener(String name) {
             this.name = name;

==================================================
