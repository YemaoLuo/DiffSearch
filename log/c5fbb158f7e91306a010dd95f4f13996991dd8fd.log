c5fbb158f7e91306a010dd95f4f13996991dd8fd
==================================================
Add utility Server listener
==================================================
remm remm@apache.org
==================================================
Tue May 28 16:40:30 2019 +0200
==================================================
Container.java
Add utility Server listener

Its purpose is to replicate adding a Listener in context.xml. Also add
new container events to notify container add and remove before start and
after stop (respectively) so that containers can actually be configured
before a possible lifecycle change.


==================================================
ContainerBase.java
index 177b2d24d0..0b30247c99 100644
--- a/java/org/apache/catalina/Container.java
+++ b/java/org/apache/catalina/Container.java
@@ -82,6 +82,13 @@ public interface Container extends Lifecycle {
     // ----------------------------------------------------- Manifest Constants
 
 
+    /**
+     * The ContainerEvent event type sent when a child container is added
+     * by <code>addChild()</code>, but before it is started.
+     */
+    public static final String ADD_CHILD_BEFORE_START_EVENT = "addChildBeforeStart";
+
+
     /**
      * The ContainerEvent event type sent when a child container is added
      * by <code>addChild()</code>.
@@ -96,6 +103,13 @@ public interface Container extends Lifecycle {
     public static final String ADD_VALVE_EVENT = "addValve";
 
 
+    /**
+     * The ContainerEvent event type sent when a child container is removed
+     * by <code>removeChild()</code>, but before it is stopped.
+     */
+    public static final String REMOVE_CHILD_BEFORE_STOP_EVENT = "removeChildBeforeStop";
+
+
     /**
      * The ContainerEvent event type sent when a child container is removed
      * by <code>removeChild()</code>.

==================================================
FrameworkListener.java
index cee5e42740..f3a30111ac 100644
--- a/java/org/apache/catalina/core/ContainerBase.java
+++ b/java/org/apache/catalina/core/ContainerBase.java
@@ -703,6 +703,8 @@ public abstract class ContainerBase extends LifecycleMBeanBase
             children.put(child.getName(), child);
         }
 
+        fireContainerEvent(ADD_CHILD_BEFORE_START_EVENT, child);
+
         // Start child
         // Don't do this inside sync block - start can be a slow process and
         // locking the children object can cause problems elsewhere
@@ -798,6 +800,8 @@ public abstract class ContainerBase extends LifecycleMBeanBase
             return;
         }
 
+        fireContainerEvent(REMOVE_CHILD_BEFORE_STOP_EVENT, child);
+
         try {
             if (child.getState().isAvailable()) {
                 child.stop();

==================================================
