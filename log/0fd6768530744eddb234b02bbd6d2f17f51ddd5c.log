0fd6768530744eddb234b02bbd6d2f17f51ddd5c
==================================================
Revert patch - it caused a regression. Correct patch to follow.
==================================================
Mark Emlyn
==================================================
Tue Oct 7 20:48:45 2008 +0000
==================================================
ELSupport.java
Revert patch - it caused a regression. Correct patch to follow.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@702628 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestELSupport.java
index d65a6b3f61..51e3649902 100644
--- a/java/org/apache/el/lang/ELSupport.java
+++ b/java/org/apache/el/lang/ELSupport.java
@@ -224,18 +224,18 @@ public class ELSupport {
                 return ((BigDecimal) number).toBigInteger();
             }
             if (number instanceof BigInteger) {
-                return number;
+                return new BigInteger(number.toString());
             }
             return BigInteger.valueOf(number.longValue());
         }
         if (BigDecimal.class.equals(type)) {
             if (number instanceof BigDecimal) {
-                return number;
+                return new BigDecimal(number.toString());
             }
             if (number instanceof BigInteger) {
                 return new BigDecimal((BigInteger) number);
             }
-            return new BigDecimal(number.toString());
+            return new BigDecimal(number.doubleValue());
         }
         if (Byte.TYPE == type || Byte.class.equals(type)) {
             return new Byte(number.byteValue());
@@ -341,7 +341,7 @@ public class ELSupport {
     public final static Object coerceToType(final Object obj, final Class type)
             throws IllegalArgumentException {
         if (type == null || Object.class.equals(type) ||
-                (obj != null && type.isAssignableFrom(obj.getClass()))) {
+                (obj != null && type.equals(obj.getClass()))) {
             return obj;
         }
         if (String.class.equals(type)) {
@@ -356,6 +356,9 @@ public class ELSupport {
         if (Boolean.class.equals(type) || Boolean.TYPE == type) {
             return coerceToBoolean(obj);
         }
+        if (obj != null && type.isAssignableFrom(obj.getClass())) {
+            return obj;
+        }
         if (type.isEnum()) {
             return coerceToEnum(obj, type);
         }

==================================================
