4fe7e810b687d273642208718253e1ec2848967c
==================================================
Refactor to remove use of ThreadLocal
==================================================
Mark Thomas
==================================================
Fri Feb 24 12:23:22 2023 +0000
==================================================
CoyoteAdapter.java
Refactor to remove use of ThreadLocal

ThreadLocal.get() calls Thread.currentThread() so caching the thread (or
its attributes) in a ThreadLocal doesn't offer any performance benefits.


==================================================
Request.java
index 54c3185cec..7443b2cb6a 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -75,12 +75,8 @@ public class CoyoteAdapter implements Adapter {
     public static final int ADAPTER_NOTES = 1;
 
 
-    private static final ThreadLocal<String> THREAD_NAME = ThreadLocal
-            .withInitial(() -> Thread.currentThread().getName());
-
     // ----------------------------------------------------------- Constructors
 
-
     /**
      * Construct a new CoyoteProcessor associated with the specified connector.
      *
@@ -125,7 +121,6 @@ public class CoyoteAdapter implements Adapter {
         boolean success = true;
         AsyncContextImpl asyncConImpl = request.getAsyncContextInternal();
 
-        req.getRequestProcessor().setWorkerThreadName(THREAD_NAME.get());
         req.setRequestThread();
 
         try {
@@ -333,7 +328,6 @@ public class CoyoteAdapter implements Adapter {
         boolean async = false;
         boolean postParseSuccess = false;
 
-        req.getRequestProcessor().setWorkerThreadName(THREAD_NAME.get());
         req.setRequestThread();
 
         try {

==================================================
