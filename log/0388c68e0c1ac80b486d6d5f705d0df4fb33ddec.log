0388c68e0c1ac80b486d6d5f705d0df4fb33ddec
==================================================
Fix the remaining instances of new String(byte[] b, String enc) that can be fixed
==================================================
Mark Emlyn
==================================================
Tue Jun 28 07:22:28 2011 +0000
==================================================
Request.java
Fix the remaining instances of new String(byte[] b, String enc) that can be fixed

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1140463 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SSIServletExternalResolver.java
index 5ae0226502..2d26be08da 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -1592,12 +1592,12 @@ public class Request
         // Ensure that the specified encoding is valid
         byte buffer[] = new byte[1];
         buffer[0] = (byte) 'a';
-        @SuppressWarnings("unused")
-        String s = new String(buffer, enc);
 
+        // Confirm that the encoding name is valid
+        B2CConverter.getCharset(enc);
+        
         // Save the validated encoding
         coyoteRequest.setCharacterEncoding(enc);
-
     }
 
 

==================================================
Base64.java
index b3580942c1..40682c49e8 100644
--- a/java/org/apache/catalina/ssi/SSIServletExternalResolver.java
+++ b/java/org/apache/catalina/ssi/SSIServletExternalResolver.java
@@ -36,6 +36,7 @@ import javax.servlet.http.HttpServletResponse;
 import org.apache.catalina.connector.Request;
 import org.apache.catalina.util.RequestUtil;
 import org.apache.coyote.Constants;
+import org.apache.tomcat.util.buf.B2CConverter;
 
 /**
  * An implementation of SSIExternalResolver that is used with servlets.
@@ -542,7 +543,8 @@ public class SSIServletExternalResolver implements SSIExternalResolver {
             if (inputEncoding == null) {
                 retVal = new String( bytes );
             } else {
-                retVal = new String (bytes, inputEncoding);
+                retVal = new String (bytes,
+                        B2CConverter.getCharset(inputEncoding));
             }
 
             //make an assumption that an empty response is a failure. This is

==================================================
