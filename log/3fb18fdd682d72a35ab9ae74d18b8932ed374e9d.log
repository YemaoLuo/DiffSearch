3fb18fdd682d72a35ab9ae74d18b8932ed374e9d
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58544
==================================================
Violeta Georgieva
==================================================
Wed Oct 28 15:02:03 2015 +0000
==================================================
CGIServlet.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58544
Switch from 
request.getContentLength to request.getContentLengthLong
urlConnection.getContentLength to urlConnection.getContentLengthLong

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1711026 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WebdavServlet.java
index b9f875d4f9..7b5399ea8c 100644
--- a/java/org/apache/catalina/servlets/CGIServlet.java
+++ b/java/org/apache/catalina/servlets/CGIServlet.java
@@ -371,7 +371,7 @@ public final class CGIServlet extends HttpServlet {
         out.println("<li><b>characterEncoding</b> = " +
                        req.getCharacterEncoding());
         out.println("<li><b>contentLength</b> = " +
-                       req.getContentLength());
+                       req.getContentLengthLong());
         out.println("<li><b>contentType</b> = " +
                        req.getContentType());
         Enumeration<Locale> locales = req.getLocales();
@@ -1078,9 +1078,9 @@ public final class CGIServlet extends HttpServlet {
              * if there is no content, so we cannot put 0 or -1 in as per the
              * Servlet API spec.
              */
-            int contentLength = req.getContentLength();
+            long contentLength = req.getContentLengthLong();
             String sContentLength = (contentLength <= 0 ? "" :
-                Integer.toString(contentLength));
+                Long.toString(contentLength));
             envp.put("CONTENT_LENGTH", sContentLength);
 
 

==================================================
SSIServletExternalResolver.java
index d6a9078df1..5941fa1f44 100644
--- a/java/org/apache/catalina/servlets/WebdavServlet.java
+++ b/java/org/apache/catalina/servlets/WebdavServlet.java
@@ -472,7 +472,7 @@ public class WebdavServlet
 
         Node propNode = null;
 
-        if (req.getContentLength() > 0) {
+        if (req.getContentLengthLong() > 0) {
             DocumentBuilder documentBuilder = getDocumentBuilder();
 
             try {
@@ -716,7 +716,7 @@ public class WebdavServlet
             return;
         }
 
-        if (req.getContentLength() > 0) {
+        if (req.getContentLengthLong() > 0) {
             DocumentBuilder documentBuilder = getDocumentBuilder();
             try {
                 // Document document =

==================================================
ExtendedAccessLogValve.java
index f86e2d798f..89a1692720 100644
--- a/java/org/apache/catalina/ssi/SSIServletExternalResolver.java
+++ b/java/org/apache/catalina/ssi/SSIServletExternalResolver.java
@@ -170,9 +170,9 @@ public class SSIServletExternalResolver implements SSIExternalResolver {
             }
         } else if(nameParts[0].equals("CONTENT")) {
             if (nameParts[1].equals("LENGTH")) {
-                int contentLength = req.getContentLength();
+                long contentLength = req.getContentLengthLong();
                 if (contentLength >= 0) {
-                    retVal = Integer.toString(contentLength);
+                    retVal = Long.toString(contentLength);
                 }
             } else if (nameParts[1].equals("TYPE")) {
                 retVal = req.getContentType();
@@ -504,7 +504,7 @@ public class SSIServletExternalResolver implements SSIExternalResolver {
         long fileSize = -1;
         try {
             URLConnection urlConnection = getURLConnection(path, virtual);
-            fileSize = urlConnection.getContentLength();
+            fileSize = urlConnection.getContentLengthLong();
         } catch (IOException e) {
             // Ignore this. It will always fail for non-file based includes
         }

==================================================
TomcatBaseTest.java
index e54b4fad90..c3b700880b 100644
--- a/java/org/apache/catalina/valves/ExtendedAccessLogValve.java
+++ b/java/org/apache/catalina/valves/ExtendedAccessLogValve.java
@@ -813,7 +813,7 @@ public class ExtendedAccessLogValve extends AccessLogValve {
                 @Override
                 public void addElement(CharArrayWriter buf, Date date,
                         Request request, Response response, long time) {
-                    buf.append(wrap("" + request.getContentLength()));
+                    buf.append(wrap("" + request.getContentLengthLong()));
                 }
             };
         } else if ("characterEncoding".equals(parameter)) {

==================================================
