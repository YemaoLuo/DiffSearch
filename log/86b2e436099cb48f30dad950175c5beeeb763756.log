86b2e436099cb48f30dad950175c5beeeb763756
==================================================
 Make timing attacks against the Realm implementations harder. (schultz)
==================================================
Mark Thomas
==================================================
Tue Aug 30 22:55:29 2016 +0000
==================================================
DataSourceRealm.java
 Make timing attacks against the Realm implementations harder. (schultz)

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1758499 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JDBCRealm.java
index d5ac10a743..8eb9e12aac 100644
--- a/java/org/apache/catalina/realm/DataSourceRealm.java
+++ b/java/org/apache/catalina/realm/DataSourceRealm.java
@@ -303,6 +303,8 @@ public class DataSourceRealm extends RealmBase {
 
         if(dbCredentials == null) {
             // User was not found in the database.
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (containerLog.isTraceEnabled())
                 containerLog.trace(sm.getString("dataSourceRealm.authenticateFailure",

==================================================
MemoryRealm.java
index fc93598352..cff5411150 100644
--- a/java/org/apache/catalina/realm/JDBCRealm.java
+++ b/java/org/apache/catalina/realm/JDBCRealm.java
@@ -384,6 +384,8 @@ public class JDBCRealm
 
         if (dbCredentials == null) {
             // User was not found in the database.
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (containerLog.isTraceEnabled())
                 containerLog.trace(sm.getString("jdbcRealm.authenticateFailure",

==================================================
RealmBase.java
index aec126fa90..9beddf6a72 100644
--- a/java/org/apache/catalina/realm/MemoryRealm.java
+++ b/java/org/apache/catalina/realm/MemoryRealm.java
@@ -125,7 +125,9 @@ public class MemoryRealm  extends RealmBase {
         GenericPrincipal principal = principals.get(username);
 
         if(principal == null || principal.getPassword() == null) {
-            // User was not found in the database of the password was null
+            // User was not found in the database or the password was null
+            // Waste a bit of time as not to reveal that the user does not exist.
+            getCredentialHandler().mutate(credentials);
 
             if (log.isDebugEnabled())
                 log.debug(sm.getString("memoryRealm.authenticateFailure", username));

==================================================
