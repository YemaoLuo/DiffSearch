453b894b7deb055b2ff357275e4303b9ce84ebc5
==================================================
Remainder of fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57938
==================================================
Mark Thomas
==================================================
Tue Jun 16 09:24:52 2015 +0000
==================================================
Request.java
Remainder of fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57938
Change the meaning of maxPostSize="0" from unlimited to not allowed since:
- this is consistent with maxSavePostSize
- this is more intuitive
- Tomcat already behaved this way in some circumstances

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1685744 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestRequest.java
index 95bbb86fa6..f40c14dd70 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -2696,7 +2696,7 @@ public class Request
                                 // Should not be possible
                             }
                         }
-                        if (maxPostSize > 0) {
+                        if (maxPostSize >= 0) {
                             // Have to calculate equivalent size. Not completely
                             // accurate but close enough.
                             if (charset == null) {
@@ -3008,7 +3008,7 @@ public class Request
 
             if (len > 0) {
                 int maxPostSize = connector.getMaxPostSize();
-                if ((maxPostSize > 0) && (len > maxPostSize)) {
+                if ((maxPostSize >= 0) && (len > maxPostSize)) {
                     Context context = getContext();
                     if (context != null && context.getLogger().isDebugEnabled()) {
                         context.getLogger().debug(
@@ -3100,7 +3100,7 @@ public class Request
         int len = 0;
         while (len > -1) {
             len = getStream().read(buffer, 0, CACHED_POST_LEN);
-            if (connector.getMaxPostSize() > 0 &&
+            if (connector.getMaxPostSize() >= 0 &&
                     (body.getLength() + len) > connector.getMaxPostSize()) {
                 // Too much data
                 checkSwallowInput();

==================================================
