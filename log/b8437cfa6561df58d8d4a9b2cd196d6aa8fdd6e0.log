b8437cfa6561df58d8d4a9b2cd196d6aa8fdd6e0
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50928
==================================================
Mark Emlyn
==================================================
Tue Mar 15 22:51:10 2011 +0000
==================================================
JSSESocketFactory.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50928
Don't ignore keyPass attribute

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1081969 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestSsl.java
index cecf041909..2484b0d19a 100644
--- a/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java
+++ b/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java
@@ -565,7 +565,11 @@ public class JSSESocketFactory implements ServerSocketFactory, SSLUtil {
         }
 
         KeyManagerFactory kmf = KeyManagerFactory.getInstance(algorithm);
-        kmf.init(ks, keystorePass.toCharArray());
+        String keyPass = endpoint.getKeyPass();
+        if (keyPass == null) {
+            keyPass = keystorePass;
+        }
+        kmf.init(ks, keyPass.toCharArray());
 
         kms = kmf.getKeyManagers();
         if (keyAlias != null) {

==================================================
TesterSupport.java
index ee58505418..37c5e931d0 100644
--- a/test/org/apache/tomcat/util/net/TestSsl.java
+++ b/test/org/apache/tomcat/util/net/TestSsl.java
@@ -57,6 +57,24 @@ public class TestSsl extends TomcatBaseTest {
         assertTrue(res.toString().indexOf("<h1>Hello World!</h1>") > 0);
     }
 
+    public void testKeyPass() throws Exception {
+        TesterSupport.configureClientSsl();
+        
+        Tomcat tomcat = getTomcatInstance();
+
+        File appDir = new File(getBuildDirectory(), "webapps/examples");
+        tomcat.addWebapp(null, "/examples", appDir.getAbsolutePath());
+        
+        TesterSupport.initSsl(tomcat, "localhost-copy1.jks", "changeit",
+                "tomcatpass");
+
+        tomcat.start();
+        ByteChunk res = getUrl("https://localhost:" + getPort() +
+            "/examples/servlets/servlet/HelloWorldExample");
+        assertTrue(res.toString().indexOf("<h1>Hello World!</h1>") > 0);
+    }
+
+
     boolean handshakeDone = false;
     
     public void testRenegotiateFail() throws Exception {

==================================================
