92a8440df8355f58e09f0732e77be722c78b44ec
==================================================
Added realm name support for JASPIC modules 
==================================================
Mark Thomas
==================================================
Tue Jun 23 11:13:20 2015 +0000
==================================================
JaspicAuthenticator.java
Added realm name support for JASPIC modules 
Patch by fjodorver

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1687025 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MessageInfoImpl.java
index 0dd90a2412..31ec7e6078 100644
--- a/java/org/apache/catalina/authenticator/jaspic/JaspicAuthenticator.java
+++ b/java/org/apache/catalina/authenticator/jaspic/JaspicAuthenticator.java
@@ -23,7 +23,6 @@ import java.util.Set;
 import javax.security.auth.Subject;
 import javax.security.auth.message.AuthException;
 import javax.security.auth.message.AuthStatus;
-import javax.security.auth.message.MessageInfo;
 import javax.security.auth.message.config.AuthConfigFactory;
 import javax.security.auth.message.config.AuthConfigProvider;
 import javax.security.auth.message.config.ServerAuthConfig;
@@ -69,7 +68,8 @@ public class JaspicAuthenticator extends AuthenticatorBase {
             return true;
         }
 
-        MessageInfo messageInfo = new MessageInfoImpl(request, response, true, getAuthMethod());
+        MessageInfoImpl messageInfo = new MessageInfoImpl(request, response, true, getAuthMethod());
+        messageInfo.setRealmName(getRealmName(context));
 
         AuthConfigFactory factory = AuthConfigFactory.getFactory();
         String appContext = getAppContextId(request);

==================================================
TomcatAuthModule.java
index 8d210a078c..fccd891892 100644
--- a/java/org/apache/catalina/authenticator/jaspic/MessageInfoImpl.java
+++ b/java/org/apache/catalina/authenticator/jaspic/MessageInfoImpl.java
@@ -28,6 +28,7 @@ import org.apache.catalina.connector.Request;
 public class MessageInfoImpl implements MessageInfo {
     public static final String IS_MANDATORY = "javax.security.auth.message.MessagePolicy.isMandatory";
     public static final String AUTH_METHOD = "javax.servlet.http.authType";
+    public static final String REALM_NAME = "javax.servlet.http.realmName";
 
     private final Map<String, Object> map = new HashMap<>();
     private HttpServletRequest request;
@@ -44,6 +45,10 @@ public class MessageInfoImpl implements MessageInfo {
         map.put(AUTH_METHOD, authMethod);
     }
 
+    public void setRealmName(String realmName) {
+        map.put(REALM_NAME, realmName);
+    }
+
     @Override
     @SuppressWarnings("rawtypes")
     // JASPIC uses raw types

==================================================
