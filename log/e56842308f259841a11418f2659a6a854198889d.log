e56842308f259841a11418f2659a6a854198889d
==================================================
Fix Find Bugs warnings - thread safety of data formatting
==================================================
Mark Emlyn
==================================================
Sun Jul 15 21:03:04 2012 +0000
==================================================
WebdavServlet.java
Fix Find Bugs warnings - thread safety of data formatting

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1361796 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ConcurrentDateFormat.java
index 2ed85940dd..2315d7d484 100644
--- a/java/org/apache/catalina/servlets/WebdavServlet.java
+++ b/java/org/apache/catalina/servlets/WebdavServlet.java
@@ -26,7 +26,6 @@ import java.io.StringWriter;
 import java.io.Writer;
 import java.security.MessageDigest;
 import java.security.NoSuchAlgorithmException;
-import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.Enumeration;
 import java.util.Hashtable;
@@ -49,6 +48,7 @@ import javax.xml.parsers.DocumentBuilder;
 import javax.xml.parsers.DocumentBuilderFactory;
 import javax.xml.parsers.ParserConfigurationException;
 
+import org.apache.catalina.util.ConcurrentDateFormat;
 import org.apache.catalina.util.DOMWriter;
 import org.apache.catalina.util.MD5Encoder;
 import org.apache.catalina.util.XMLWriter;
@@ -199,8 +199,9 @@ public class WebdavServlet
     /**
      * Simple date format for the creation date ISO representation (partial).
      */
-    protected static final SimpleDateFormat creationDateFormat =
-        new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'", Locale.US);
+    protected static final ConcurrentDateFormat creationDateFormat =
+        new ConcurrentDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'", Locale.US,
+                TimeZone.getTimeZone("GMT"));
 
 
      /**
@@ -215,15 +216,8 @@ public class WebdavServlet
     protected static final MD5Encoder md5Encoder = new MD5Encoder();
 
 
-
-    static {
-        creationDateFormat.setTimeZone(TimeZone.getTimeZone("GMT"));
-    }
-
-
     // ----------------------------------------------------- Instance Variables
 
-
     /**
      * Repository of the locks put on single resources.
      * <p>
@@ -2606,27 +2600,7 @@ public class WebdavServlet
      * Get creation date in ISO format.
      */
     private String getISOCreationDate(long creationDate) {
-        StringBuilder creationDateValue = new StringBuilder
-            (creationDateFormat.format
-             (new Date(creationDate)));
-        /*
-        int offset = Calendar.getInstance().getTimeZone().getRawOffset()
-            / 3600000; // FIXME ?
-        if (offset < 0) {
-            creationDateValue.append("-");
-            offset = -offset;
-        } else if (offset > 0) {
-            creationDateValue.append("+");
-        }
-        if (offset != 0) {
-            if (offset < 10)
-                creationDateValue.append("0");
-            creationDateValue.append(offset + ":00");
-        } else {
-            creationDateValue.append("Z");
-        }
-        */
-        return creationDateValue.toString();
+        return creationDateFormat.format(new Date(creationDate));
     }
 
     /**

==================================================
