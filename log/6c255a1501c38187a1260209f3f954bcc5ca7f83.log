6c255a1501c38187a1260209f3f954bcc5ca7f83
==================================================
Avoid API change
==================================================
remm remm@apache.org
==================================================
Wed Oct 30 10:58:13 2019 +0100
==================================================
AbstractProtocol.java
Avoid API change

Deprecate method since it is now replaced by
AbstractEndpoint.getConnections.


==================================================
AbstractEndpoint.java
index 9cfa6e9055..d3d9d93e88 100644
--- a/java/org/apache/coyote/AbstractProtocol.java
+++ b/java/org/apache/coyote/AbstractProtocol.java
@@ -19,6 +19,7 @@ package org.apache.coyote;
 import java.net.InetAddress;
 import java.nio.ByteBuffer;
 import java.util.Collections;
+import java.util.HashSet;
 import java.util.Set;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ExecutionException;
@@ -1037,8 +1038,16 @@ public abstract class AbstractProtocol<S> implements ProtocolHandler,
 
 
         @Override
-        public Set<SocketWrapperBase<S>> getOpenSockets() {
-            return proto.getEndpoint().getConnections();
+        public Set<S> getOpenSockets() {
+            Set<SocketWrapperBase<S>> set = proto.getEndpoint().getConnections();
+            Set<S> result = new HashSet<>();
+            for (SocketWrapperBase<S> socketWrapper : set) {
+                S socket = socketWrapper.getSocket();
+                if (socket != null) {
+                    result.add(socket);
+                }
+            }
+            return result;
         }
 
 

==================================================
