6a9431ccffa211ee364bf20a5b6c3213a1b059c5
==================================================
If we know we are closing the connection, don't drain input.
==================================================
William Barker
==================================================
Sat Nov 15 02:30:12 2008 +0000
==================================================
Http11AprProcessor.java
If we know we are closing the connection, don't drain input.
This way uploading a 100GB file doesn't tie up the thread 
if the servlet has rejected it.



git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@714214 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11NioProcessor.java
index b1908acbdc..fae37f9775 100644
--- a/java/org/apache/coyote/http11/Http11AprProcessor.java
+++ b/java/org/apache/coyote/http11/Http11AprProcessor.java
@@ -860,6 +860,11 @@ public class Http11AprProcessor implements ActionHook {
 
             // Finish the handling of the request
             if (!comet) {
+                // If we know we are closing the connection, don't drain input.
+                // This way uploading a 100GB file doesn't tie up the thread 
+                // if the servlet has rejected it.
+                if(error)
+                    inputBuffer.setSwallowInput(false);
                 endRequest();
             }
 

==================================================
Http11Processor.java
index 5214336168..70a4784ab5 100644
--- a/java/org/apache/coyote/http11/Http11NioProcessor.java
+++ b/java/org/apache/coyote/http11/Http11NioProcessor.java
@@ -893,6 +893,11 @@ public class Http11NioProcessor implements ActionHook {
 
             // Finish the handling of the request
             if (!comet) {
+                // If we know we are closing the connection, don't drain input.
+                // This way uploading a 100GB file doesn't tie up the thread 
+                // if the servlet has rejected it.
+                if(error)
+                    inputBuffer.setSwallowInput(false);
                 endRequest();
             }
 

==================================================
