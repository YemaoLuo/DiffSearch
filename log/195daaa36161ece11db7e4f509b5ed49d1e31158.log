195daaa36161ece11db7e4f509b5ed49d1e31158
==================================================
Port relevant parts of fix for bug 40999.
==================================================
Mark Emlyn
==================================================
Mon Nov 20 23:37:43 2006 +0000
==================================================
