a46bacbb5bade7d372b79f1369779cbb5c1aa82b
==================================================
Add an method that enables JNDI and a test case to make sure it works
==================================================
Mark Emlyn
==================================================
Mon Sep 7 15:54:08 2009 +0000
==================================================
Tomcat.java
Add an method that enables JNDI and a test case to make sure it works

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@812210 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestTomcat.java
index d8f1552606..4279d5f40c 100644
--- a/java/org/apache/catalina/startup/Tomcat.java
+++ b/java/org/apache/catalina/startup/Tomcat.java
@@ -369,8 +369,8 @@ public class Tomcat {
     }
 
     /**
-     * Get the server object. You can add listeners and 
-     * few more customizations.  
+     * Get the server object. You can add listeners and few more
+     * customizations. JNDI is disabled by default.  
      */
     public StandardServer getServer() {
         
@@ -527,6 +527,31 @@ public class Tomcat {
         Logger.getLogger(base).setLevel(Level.WARNING);
     }
     
+    /**
+     * Enables JNDI naming which is disabled by default.
+     */
+    public void enableNaming() {
+        // Make sure getServer() has been called as that is where naming is
+        // disabled
+        getServer();
+        
+        System.setProperty("catalina.useNaming", "true");
+        String value = "org.apache.naming";
+        String oldValue =
+            System.getProperty(javax.naming.Context.URL_PKG_PREFIXES);
+        if (oldValue != null) {
+            value = value + ":" + oldValue;
+        }
+        System.setProperty(javax.naming.Context.URL_PKG_PREFIXES, value);
+        value = System.getProperty
+            (javax.naming.Context.INITIAL_CONTEXT_FACTORY);
+        if (value == null) {
+            System.setProperty
+                (javax.naming.Context.INITIAL_CONTEXT_FACTORY,
+                 "org.apache.naming.java.javaURLContextFactory");
+        }
+    }
+
     /**
      * Provide default configuration for a context. This is the programmatic
      * equivalent of the default web.xml. 

==================================================
