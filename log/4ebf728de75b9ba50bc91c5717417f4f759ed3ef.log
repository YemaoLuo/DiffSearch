4ebf728de75b9ba50bc91c5717417f4f759ed3ef
==================================================
Apply patch 08 from jboynes to improve cookie handling.
==================================================
Mark Emlyn
==================================================
Wed May 21 18:54:28 2014 +0000
==================================================
CookieSupport.java
Apply patch 08 from jboynes to improve cookie handling.
Encapsulate use of ALWAYS_ADD_EXPIRES as it only applies to Set-Cookie generation.
The patch should be safe since the logic is unchanged.


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1596651 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SetCookieSupport.java
index 5572dacf46..044bf9d131 100644
--- a/java/org/apache/tomcat/util/http/CookieSupport.java
+++ b/java/org/apache/tomcat/util/http/CookieSupport.java
@@ -43,13 +43,6 @@ public final class CookieSupport {
      */
     public static final boolean ALLOW_HTTP_SEPARATORS_IN_V0;
 
-    /**
-     * If set to false, we don't use the IE6/7 Max-Age/Expires work around.
-     * Default is usually true. If STRICT_SERVLET_COMPLIANCE==true then default
-     * is false. Explicitly setting always takes priority.
-     */
-    public static final boolean ALWAYS_ADD_EXPIRES;
-
     /**
      * If set to true, the <code>/</code> character will be treated as a
      * separator. Default is usually false. If STRICT_SERVLET_COMPLIANCE==true
@@ -97,15 +90,6 @@ public final class CookieSupport {
                 "org.apache.tomcat.util.http.ServerCookie.ALLOW_HTTP_SEPARATORS_IN_V0",
                 "false")).booleanValue();
 
-        String alwaysAddExpires = System.getProperty(
-        "org.apache.tomcat.util.http.ServerCookie.ALWAYS_ADD_EXPIRES");
-        if (alwaysAddExpires == null) {
-            ALWAYS_ADD_EXPIRES = !STRICT_SERVLET_COMPLIANCE;
-        } else {
-            ALWAYS_ADD_EXPIRES =
-                Boolean.valueOf(alwaysAddExpires).booleanValue();
-        }
-
         String preserveCookieHeader = System.getProperty(
                 "org.apache.tomcat.util.http.ServerCookie.PRESERVE_COOKIE_HEADER");
         if (preserveCookieHeader == null) {

==================================================
