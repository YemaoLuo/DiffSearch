da5f2492dc9d96755dfea43859244df6797b0af5
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48424
==================================================
Mark Emlyn
==================================================
Tue Jan 5 19:53:38 2010 +0000
==================================================
Connector.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48424
Based on a patch by Ivan
Ensure that the ObjectNames for the Connectors are always generated using the same method

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@896193 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MBeanUtils.java
index 6253e766b1..10ea6ee14e 100644
--- a/java/org/apache/catalina/connector/Connector.java
+++ b/java/org/apache/catalina/connector/Connector.java
@@ -932,14 +932,21 @@ public class Connector
 
     protected ObjectName createObjectName(String domain, String type)
             throws MalformedObjectNameException {
-        String encodedAddr = null;
-        if (getProperty("address") != null) {
-            encodedAddr = URLEncoder.encode(getProperty("address").toString());
+        Object addressObj = getProperty("address");
+
+        StringBuilder sb = new StringBuilder(domain);
+        sb.append(":type=");
+        sb.append(type);
+        sb.append(",port=");
+        sb.append(getPort());
+        if (addressObj != null) {
+            String address = addressObj.toString();
+            if (address.length() > 0) {
+                sb.append(",address=");
+                sb.append(ObjectName.quote(address));
+            }
         }
-        String addSuffix = (getProperty("address") == null) ? "" : ",address="
-                + encodedAddr;
-        ObjectName _oname = new ObjectName(domain + ":type=" + type + ",port="
-                + getPort() + addSuffix);
+        ObjectName _oname = new ObjectName(sb.toString());
         return _oname;
     }
 

==================================================
