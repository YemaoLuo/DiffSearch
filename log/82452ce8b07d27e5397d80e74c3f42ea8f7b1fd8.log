82452ce8b07d27e5397d80e74c3f42ea8f7b1fd8
==================================================
Corrected use of Channel.getMembers() in cluster
==================================================
Filip Hanik
==================================================
Mon Feb 11 17:29:06 2008 +0000
==================================================
SimpleTcpCluster.java
Corrected use of Channel.getMembers() in cluster
Added debug hints to warning messages based on what may be wrong


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@620533 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MemberImpl.java
index eca8863901..1f568ca4d6 100644
--- a/java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java
+++ b/java/org/apache/catalina/ha/tcp/SimpleTcpCluster.java
@@ -824,8 +824,9 @@ public class SimpleTcpCluster
                 } else
                     log.error("Unable to send message to local member " + msg);
             } else {
-                if (channel.getMembers().length>0)
-                    channel.send(channel.getMembers(),msg,channelSendOptions);
+                Member[] destmembers = channel.getMembers();
+                if (destmembers.length>0)
+                    channel.send(destmembers,msg,channelSendOptions);
                 else if (log.isDebugEnabled()) 
                     log.debug("No members in cluster, ignoring message:"+msg);
             }

==================================================
NioReceiver.java
index c1e5ce1d97..7598ccbae2 100644
--- a/java/org/apache/catalina/tribes/membership/MemberImpl.java
+++ b/java/org/apache/catalina/tribes/membership/MemberImpl.java
@@ -319,7 +319,7 @@ public class MemberImpl implements Member, java.io.Externalizable {
         int pos = offset;
         
         if (XByteBuffer.firstIndexOf(data,offset,TRIBES_MBR_BEGIN)!=pos) {
-            throw new IllegalArgumentException("Invalid package, should start with:"+org.apache.catalina.tribes.util.Arrays.toString(TRIBES_MBR_BEGIN));
+            throw new IllegalArgumentException("Invalid package, should start with:"+org.apache.catalina.tribes.util.Arrays.toString(TRIBES_MBR_BEGIN)+" Possibly an incompatible client broadcasting on the same multicast address.");
         }
 
         if ( length < (TRIBES_MBR_BEGIN.length+4) ) {

==================================================
