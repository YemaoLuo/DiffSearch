4c2378d727c4151f9a3d4faf772937434fc4cbaf
==================================================
JSP 2.2 - Add omit attribute to <jsp:attribute>
==================================================
Mark Emlyn
==================================================
Wed Dec 23 20:05:25 2009 +0000
==================================================
Generator.java
JSP 2.2 - Add omit attribute to <jsp:attribute>

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@893617 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Node.java
index a0e11aaa21..18c5bfbfc6 100644
--- a/java/org/apache/jasper/compiler/Generator.java
+++ b/java/org/apache/jasper/compiler/Generator.java
@@ -1950,6 +1950,10 @@ class Generator {
             for (int i = 0; attrs != null && i < attrs.length; i++) {
                 String attrStr = null;
                 if (attrs[i].isNamedAttribute()) {
+                    if (attrs[i].getNamedAttributeNode().isOmit()) {
+                        // Skip this attribute - JSP.5-7
+                        continue;
+                    }
                     attrStr = generateNamedAttributeValue(attrs[i]
                             .getNamedAttributeNode());
                 } else {

==================================================
Validator.java
index 2388815603..1f0852c81d 100644
--- a/java/org/apache/jasper/compiler/Node.java
+++ b/java/org/apache/jasper/compiler/Node.java
@@ -1864,6 +1864,10 @@ abstract class Node implements TagConstants {
         // True if this node is to be trimmed, or false otherwise
         private boolean trim = true;
 
+        // True if this attribute should be omitted from the output if
+        // used with a <jsp:element>, otherwise false
+        private boolean omit = false;
+
         private ChildInfo childInfo;
 
         private String name;
@@ -1886,6 +1890,10 @@ abstract class Node implements TagConstants {
                 // (if null or true, leave default of true)
                 trim = false;
             }
+            if ("true".equals(this.getAttributeValue("omit"))) {
+                // (if null or false, leave default of false)
+                omit = true;
+            }
             childInfo = new ChildInfo();
             name = this.getAttributeValue("name");
             if (name != null) {
@@ -1925,6 +1933,10 @@ abstract class Node implements TagConstants {
             return trim;
         }
 
+        public boolean isOmit() {
+            return omit;
+        }
+
         /**
          * @return A unique temporary variable name to store the result in.
          *         (this probably could go elsewhere, but it's convenient here)

==================================================
