294c52b2161b993df95c5537d428ee12f4629a60
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53460
==================================================
Mark Emlyn
==================================================
Tue Jun 26 19:57:07 2012 +0000
==================================================
Generator.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53460
There are two parts to this fix:
- don't swallow exceptions when the PageContext can't be created
- if the PageContext is null when an error occurs (and therefore can't be used to handle the error) propagate the exception wrapped in a ServletException and let the container handle it.
Note: This is the version of the fix for back-porting to 7.0.x. There is some obvious but API changing clean-up that can simplify this in trunk.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1354197 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspFactoryImpl.java
index d3322afc23..9f6612a772 100644
--- a/java/org/apache/jasper/compiler/Generator.java
+++ b/java/org/apache/jasper/compiler/Generator.java
@@ -3395,7 +3395,7 @@ class Generator {
         out.printil("try { out.clearBuffer(); } catch (java.io.IOException e) {}");
         out.popIndent();
         out.printil("if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);");
-        out.printil("else log(t.getMessage(), t);");
+        out.printil("else throw new ServletException(t);");
         out.popIndent();
         out.printil("}");
         out.popIndent();

==================================================
