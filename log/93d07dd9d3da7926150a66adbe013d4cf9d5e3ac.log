93d07dd9d3da7926150a66adbe013d4cf9d5e3ac
==================================================
Internal path always refers to the ResourceSet so access it form their
==================================================
Mark Thomas
==================================================
Tue Jan 27 19:36:26 2015 +0000
==================================================
AbstractArchiveResource.java
Internal path always refers to the ResourceSet so access it form their
directly.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1655124 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JarResource.java
index f8dfe91e62..5cc06ecec1 100644
--- a/java/org/apache/catalina/webresources/AbstractArchiveResource.java
+++ b/java/org/apache/catalina/webresources/AbstractArchiveResource.java
@@ -38,7 +38,7 @@ public abstract class AbstractArchiveResource extends AbstractResource {
 
     protected AbstractArchiveResource(AbstractArchiveResourceSet archiveResourceSet,
             String webAppPath, String base, String baseUrl, JarEntry jarEntry,
-            String internalPath, Manifest manifest, String codeBaseUrl) {
+            Manifest manifest, String codeBaseUrl) {
         super(archiveResourceSet.getRoot(), webAppPath);
         this.base = base;
         this.baseUrl = baseUrl;
@@ -50,6 +50,7 @@ public abstract class AbstractArchiveResource extends AbstractResource {
         if (resourceName.charAt(resourceName.length() - 1) == '/') {
             resourceName = resourceName.substring(0, resourceName.length() - 1);
         }
+        String internalPath = archiveResourceSet.getInternalPath();
         if (internalPath.length() > 0 && resourceName.equals(
                 internalPath.subSequence(1, internalPath.length()))) {
             name = "";

==================================================
JarResourceSet.java
index aea5f6ae81..aa6cea72ac 100644
--- a/java/org/apache/catalina/webresources/JarResource.java
+++ b/java/org/apache/catalina/webresources/JarResource.java
@@ -34,9 +34,8 @@ public class JarResource extends AbstractArchiveResource {
     private static final Log log = LogFactory.getLog(JarResource.class);
 
     public JarResource(AbstractArchiveResourceSet archiveResourceSet, String webAppPath,
-            String base, String baseUrl, JarEntry jarEntry, String internalPath,
-            Manifest manifest) {
-        super(archiveResourceSet, webAppPath, base, "jar:" + baseUrl, jarEntry, internalPath,
+            String base, String baseUrl, JarEntry jarEntry, Manifest manifest) {
+        super(archiveResourceSet, webAppPath, base, "jar:" + baseUrl, jarEntry,
                 manifest, baseUrl);
     }
 

==================================================
JarWarResource.java
index 1d6b5dada3..e89314d28a 100644
--- a/java/org/apache/catalina/webresources/JarResourceSet.java
+++ b/java/org/apache/catalina/webresources/JarResourceSet.java
@@ -79,7 +79,7 @@ public class JarResourceSet extends AbstractArchiveResourceSet {
     protected WebResource createArchiveResource(JarEntry jarEntry,
             String webAppPath, Manifest manifest) {
         return new JarResource(this, webAppPath, getBase(), getBaseUrlString(),
-                jarEntry, getInternalPath(), manifest);
+                jarEntry, manifest);
     }
 
     //-------------------------------------------------------- Lifecycle methods

==================================================
JarWarResourceSet.java
index c07b43d0d8..14bd39324e 100644
--- a/java/org/apache/catalina/webresources/JarWarResource.java
+++ b/java/org/apache/catalina/webresources/JarWarResource.java
@@ -37,10 +37,9 @@ public class JarWarResource extends AbstractArchiveResource {
     private final String archivePath;
 
     public JarWarResource(AbstractArchiveResourceSet archiveResourceSet, String webAppPath,
-            String base, String baseUrl, JarEntry jarEntry, String archivePath,
-            String internalPath, Manifest manifest) {
+            String base, String baseUrl, JarEntry jarEntry, String archivePath, Manifest manifest) {
         super(archiveResourceSet, webAppPath, base, "jar:war:" + baseUrl + "^/" + archivePath,
-                jarEntry, internalPath, manifest, "jar:" + baseUrl + "!/" + archivePath);
+                jarEntry, manifest, "jar:" + baseUrl + "!/" + archivePath);
         this.archivePath = archivePath;
     }
 

==================================================
