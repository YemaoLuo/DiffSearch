6cdfbef2b4afc5473285ddebf41f7b3bbb65f303
==================================================
Move control of caching and linking options from the Context to the WebResourceRoot to enable them to by changed while the web application is running.
==================================================
Mark Emlyn
==================================================
Sat Dec 28 14:06:07 2013 +0000
==================================================
StandardContext.java
Move control of caching and linking options from the Context to the WebResourceRoot to enable them to by changed while the web application is running.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1553826 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Cache.java
index b823b1b129..a3ccc6793c 100644
--- a/java/org/apache/catalina/core/mbeans-descriptors.xml
+++ b/java/org/apache/catalina/core/mbeans-descriptors.xml
@@ -65,11 +65,6 @@
          type="org.apache.catalina.core.StandardContext"
          className="org.apache.catalina.mbeans.ContextMBean">
 
-    <attribute name="allowLinking"
-               description="Allow symlinking to outside the webapp root directory, if the webapp is an exploded directory"
-               is="true"
-               type="boolean"/>
-
     <attribute name="altDDName"
                description="The alternate deployment descriptor name."
                type="java.lang.String" />
@@ -83,23 +78,6 @@
                type="java.lang.String"
                writeable="false"/>
 
-    <attribute name="cacheMaxSize"
-               description="Maximum cache size in KB"
-               type="int"/>
-
-    <attribute name="cacheObjectMaxSize"
-               description="Maximum cached object size in KB"
-               type="int"/>
-
-    <attribute name="cacheTTL"
-               description="Time interval in ms between cache refeshes"
-               type="int"/>
-
-    <attribute name="cachingAllowed"
-               description="Should we cache static resources for this webapp"
-               is="true"
-               type="boolean"/>
-
     <attribute name="children"
                description="Object names of all children"
                type="[Ljavax.management.ObjectName;"/>

==================================================
StandardRoot.java
index 2fdc35e175..add9ce638a 100644
--- a/java/org/apache/catalina/webresources/LocalStrings.properties
+++ b/java/org/apache/catalina/webresources/LocalStrings.properties
@@ -18,7 +18,8 @@ abstractResource.getContentTooLarge=Unable to return [{0}] as a byte array since
 
 cache.addFail=Unable to add the resource at [{0}] to the cache because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache
 cache.backgroundEvictFail=The background cache eviction process was unable to free [{0}] percent of the cache for Context [{1}] - consider increasing the maximum size of the cache. After eviction approximately [{2}] KB of data remained in the cache.
-cache.objectMaxSizeTooBig=The value specified for the maximum object size to cache [{0}]kB is greater than Integer.MAX_VALUE bytes which is the maximum size that can be cached. The limit will be set to Integer.MAX_VALUE bytes.
+cache.objectMaxSizeTooBig=The value of [{0}]kB for objectMaxSize is larger than the limit of maxSize/20 so has been reduced to [{1}]kB
+cache.objectMaxSizeTooBigBytes=The value specified for the maximum object size to cache [{0}]kB is greater than Integer.MAX_VALUE bytes which is the maximum size that can be cached. The limit will be set to Integer.MAX_VALUE bytes.
 
 dirResourceSet.writeExists=The target of the write already exists
 dirResourceSet.writeNpe=The input stream may not be null

==================================================
TestWarDirContext.java
index 446faf827b..784d03e9a2 100644
--- a/java/org/apache/catalina/webresources/mbeans-descriptors.xml
+++ b/java/org/apache/catalina/webresources/mbeans-descriptors.xml
@@ -57,8 +57,13 @@
                 group="WebResourceRoot"
                  type="org.apache.catalina.webresources.Cache">
 
-    <attribute   name="size"
-          description="The current estimate of the cache size in kB"
+    <attribute   name="hitCount"
+          description="The number of requests for resources that were served from the cache"
+                 type="long"
+            writeable="false"/>
+
+    <attribute   name="lookupCount"
+          description="The number of requests for resources"
                  type="long"
             writeable="false"/>
 
@@ -72,20 +77,15 @@
                  type="int"
             writeable="true"/>
 
-    <attribute   name="ttl"
-          description="The time-to-live for cache entries in milliseconds"
-                 type="long"
-            writeable="true"/>
-
-    <attribute   name="lookupCount"
-          description="The number of requests for resources"
+    <attribute   name="size"
+          description="The current estimate of the cache size in kB"
                  type="long"
             writeable="false"/>
 
-    <attribute   name="hitCount"
-          description="The number of requests for resources that were served from the cache"
+    <attribute   name="ttl"
+          description="The time-to-live for cache entries in milliseconds"
                  type="long"
-            writeable="false"/>
+            writeable="true"/>
 
   </mbean>
 

==================================================
