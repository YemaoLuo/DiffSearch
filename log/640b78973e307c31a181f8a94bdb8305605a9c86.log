640b78973e307c31a181f8a94bdb8305605a9c86
==================================================
Fix BZ 64509 - Correctly parse RFC 2109
==================================================
Mark Thomas
==================================================
Wed Jun 10 20:53:46 2020 +0100
==================================================
Cookie.java
Fix BZ 64509 - Correctly parse RFC 2109


==================================================
TestCookie.java
index 17410f8c26..181e05296e 100644
--- a/java/org/apache/tomcat/util/http/parser/Cookie.java
+++ b/java/org/apache/tomcat/util/http/parser/Cookie.java
@@ -274,8 +274,9 @@ public class Cookie {
             skipResult = skipByte(bb, COMMA_BYTE);
             if (skipResult == SkipResult.FOUND) {
                 parseAttributes = false;
+            } else {
+                skipResult = skipByte(bb, SEMICOLON_BYTE);
             }
-            skipResult = skipByte(bb, SEMICOLON_BYTE);
             if (skipResult == SkipResult.EOF) {
                 parseAttributes = false;
                 moreToProcess = false;
@@ -303,8 +304,9 @@ public class Cookie {
                     skipResult = skipByte(bb, COMMA_BYTE);
                     if (skipResult == SkipResult.FOUND) {
                         parseAttributes = false;
+                    } else {
+                        skipResult = skipByte(bb, SEMICOLON_BYTE);
                     }
-                    skipResult = skipByte(bb, SEMICOLON_BYTE);
                     if (skipResult == SkipResult.EOF) {
                         parseAttributes = false;
                         moreToProcess = false;
@@ -333,8 +335,9 @@ public class Cookie {
                     skipResult = skipByte(bb, COMMA_BYTE);
                     if (skipResult == SkipResult.FOUND) {
                         parseAttributes = false;
+                    } else {
+                        skipResult = skipByte(bb, SEMICOLON_BYTE);
                     }
-                    skipResult = skipByte(bb, SEMICOLON_BYTE);
                     if (skipResult == SkipResult.EOF) {
                         parseAttributes = false;
                         moreToProcess = false;

==================================================
