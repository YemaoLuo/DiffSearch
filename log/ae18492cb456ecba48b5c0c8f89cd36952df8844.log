ae18492cb456ecba48b5c0c8f89cd36952df8844
==================================================
Fix SEND_FILE bug, with Java NIO you can only change the key interest ops on the poller thread, so we have to make sure we fire off an event
==================================================
Filip Hanik
==================================================
Wed Nov 19 23:39:17 2008 +0000
==================================================
Http11NioProcessor.java
Fix SEND_FILE bug, with Java NIO you can only change the key interest ops on the poller thread, so we have to make sure we fire off an event


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@719129 13f79535-47bb-0310-9956-ffa450edef68



==================================================
NioEndpoint.java
index 70a4784ab5..425d8c4867 100644
--- a/java/org/apache/coyote/http11/Http11NioProcessor.java
+++ b/java/org/apache/coyote/http11/Http11NioProcessor.java
@@ -921,7 +921,7 @@ public class Http11NioProcessor implements ActionHook {
                 sendfileData.keepAlive = keepAlive;
                 SelectionKey key = socket.getIOChannel().keyFor(socket.getPoller().getSelector());
                 //do the first write on this thread, might as well
-                openSocket = socket.getPoller().processSendfile(key,ka,true);
+                openSocket = socket.getPoller().processSendfile(key,ka,true,true);
                 break;
             }
 

==================================================
