b5f46bf74ca9c6e1436bdb0d2de8591476e62858
==================================================
Session manager performance
==================================================
Mark Emlyn
==================================================
Tue Nov 16 17:13:29 2010 +0000
==================================================
ManagerBase.java
Session manager performance
Narrow sync - few % improvement

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1035699 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Benchmarks.java
index 4b2acd5f85..08c60faac9 100644
--- a/java/org/apache/catalina/session/ManagerBase.java
+++ b/java/org/apache/catalina/session/ManagerBase.java
@@ -980,7 +980,7 @@ public abstract class ManagerBase extends LifecycleMBeanBase
     /**
      * Generate and return a new session identifier.
      */
-    protected synchronized String generateSessionId() {
+    protected String generateSessionId() {
 
         byte random[] = new byte[16];
         String jvmRoute = getJvmRoute();
@@ -996,8 +996,10 @@ public abstract class ManagerBase extends LifecycleMBeanBase
             }
 
             while (resultLenBytes < this.sessionIdLength) {
-                getRandomBytes(random);
-                random = getDigest().digest(random);
+                synchronized (this) {
+                    getRandomBytes(random);
+                    random = getDigest().digest(random);
+                }
                 for (int j = 0;
                 j < random.length && resultLenBytes < this.sessionIdLength;
                 j++) {

==================================================
