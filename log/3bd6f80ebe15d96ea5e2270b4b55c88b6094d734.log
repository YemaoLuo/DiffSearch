3bd6f80ebe15d96ea5e2270b4b55c88b6094d734
==================================================
Do not add CSRF nonce parameter and suppress Referer header for external links in Manager and Host Manager web applications.
==================================================
Konstantin Kolinko
==================================================
Sat Feb 16 09:45:00 2019 +0000
==================================================
Constants.java
Do not add CSRF nonce parameter and suppress Referer header for external links in Manager and Host Manager web applications.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1853693 13f79535-47bb-0310-9956-ffa450edef68



==================================================
HTMLManagerServlet.java
index 4c3d09ab35..fb0b67e0aa 100644
--- a/java/org/apache/catalina/manager/Constants.java
+++ b/java/org/apache/catalina/manager/Constants.java
@@ -23,6 +23,8 @@ public class Constants {
 
     public static final String Package = "org.apache.catalina.manager";
 
+    public static final String REL_EXTERNAL = "rel=\"noopener noreferrer\"";
+
     public static final String HTML_HEADER_SECTION;
     public static final String BODY_HEADER_SECTION;
     public static final String MESSAGE_SECTION;
@@ -118,11 +120,11 @@ public class Constants {
             "<table cellspacing=\"4\" border=\"0\">\n" +
             " <tr>\n" +
             "  <td colspan=\"2\">\n" +
-            "   <a href=\"https://tomcat.apache.org/\">\n" +
+            "   <a href=\"https://tomcat.apache.org/\" " + REL_EXTERNAL + ">\n" +
             "    <img border=\"0\" alt=\"The Tomcat Servlet/JSP Container\"\n" +
             "         align=\"left\" src=\"{0}/images/tomcat.gif\">\n" +
             "   </a>\n" +
-            "   <a href=\"https://www.apache.org/\">\n" +
+            "   <a href=\"https://www.apache.org/\" " + REL_EXTERNAL + ">\n" +
             "    <img border=\"0\" alt=\"The Apache Software Foundation\" align=\"right\"\n" +
             "         src=\"{0}/images/asf-logo.svg\" style=\"width: 266px; height: 83px;\">\n" +
             "   </a>\n" +
@@ -159,8 +161,8 @@ public class Constants {
             "</tr>\n" +
             " <tr>\n" +
             "  <td class=\"row-left\"><a href=\"{1}\">{2}</a></td>\n" +
-            "  <td class=\"row-center\"><a href=\"{3}\">{4}</a></td>\n" +
-            "  <td class=\"row-center\"><a href=\"{5}\">{6}</a></td>\n" +
+            "  <td class=\"row-center\"><a href=\"{3}\" " + REL_EXTERNAL + ">{4}</a></td>\n" +
+            "  <td class=\"row-center\"><a href=\"{5}\" " + REL_EXTERNAL + ">{6}</a></td>\n" +
             "  <td class=\"row-right\"><a href=\"{7}\">{8}</a></td>\n" +
             " </tr>\n" +
             "</table>\n" +
@@ -215,6 +217,5 @@ public class Constants {
 
     public static final String XML_STYLE =
         "<?xml-stylesheet type=\"text/xsl\" href=\"{0}/xform.xsl\" ?>\n";
-
 }
 

==================================================
StatusManagerServlet.java
index d70ee7a6cb..faab38531f 100644
--- a/java/org/apache/catalina/manager/HTMLManagerServlet.java
+++ b/java/org/apache/catalina/manager/HTMLManagerServlet.java
@@ -373,11 +373,11 @@ public final class HTMLManagerServlet extends ManagerServlet {
         args[0] = smClient.getString("htmlManagerServlet.manager");
         args[1] = response.encodeURL(request.getContextPath() + "/html/list");
         args[2] = smClient.getString("htmlManagerServlet.list");
-        args[3] = response.encodeURL
+        args[3] = // External link
             (request.getContextPath() + "/" +
              smClient.getString("htmlManagerServlet.helpHtmlManagerFile"));
         args[4] = smClient.getString("htmlManagerServlet.helpHtmlManager");
-        args[5] = response.encodeURL
+        args[5] = // External link
             (request.getContextPath() + "/" +
              smClient.getString("htmlManagerServlet.helpManagerFile"));
         args[6] = smClient.getString("htmlManagerServlet.helpManager");
@@ -455,9 +455,11 @@ public final class HTMLManagerServlet extends ManagerServlet {
                 }
 
                 args = new Object[7];
-                args[0] = "<a href=\"" +
-                        URLEncoder.DEFAULT.encode(contextPath + "/", StandardCharsets.UTF_8) +
-                        "\">" + Escape.htmlElementContent(displayPath) + "</a>";
+                args[0] = // External link
+                        "<a href=\""
+                        + URLEncoder.DEFAULT.encode(contextPath + "/", StandardCharsets.UTF_8)
+                        + "\" " + Constants.REL_EXTERNAL + ">"
+                        + Escape.htmlElementContent(displayPath) + "</a>";
                 if ("".equals(ctxt.getWebappVersion())) {
                     args[1] = noVersion;
                 } else {

==================================================
Constants.java
index 84beaca3bd..1fc7be204b 100644
--- a/java/org/apache/catalina/manager/StatusManagerServlet.java
+++ b/java/org/apache/catalina/manager/StatusManagerServlet.java
@@ -235,11 +235,11 @@ public class StatusManagerServlet
         args[0] = smClient.getString("htmlManagerServlet.manager");
         args[1] = response.encodeURL(request.getContextPath() + "/html/list");
         args[2] = smClient.getString("htmlManagerServlet.list");
-        args[3] = response.encodeURL
+        args[3] = // External link
             (request.getContextPath() + "/" +
              smClient.getString("htmlManagerServlet.helpHtmlManagerFile"));
         args[4] = smClient.getString("htmlManagerServlet.helpHtmlManager");
-        args[5] = response.encodeURL
+        args[5] = // External link
             (request.getContextPath() + "/" +
              smClient.getString("htmlManagerServlet.helpManagerFile"));
         args[6] = smClient.getString("htmlManagerServlet.helpManager");

==================================================
HTMLHostManagerServlet.java
index a3bf7fcb27..a5f6ab714e 100644
--- a/java/org/apache/catalina/manager/host/Constants.java
+++ b/java/org/apache/catalina/manager/host/Constants.java
@@ -23,6 +23,8 @@ public class Constants {
 
     public static final String Package = "org.apache.catalina.manager.host";
 
+    public static final String REL_EXTERNAL = org.apache.catalina.manager.Constants.REL_EXTERNAL;
+
     public static final String MESSAGE_SECTION =
         "<table border=\"1\" cellspacing=\"0\" cellpadding=\"3\">\n" +
         " <tr>\n" +
@@ -41,8 +43,8 @@ public class Constants {
         "</tr>\n" +
         " <tr>\n" +
         "  <td class=\"row-left\"><a href=\"{1}\">{2}</a></td>\n" +
-        "  <td class=\"row-center\"><a href=\"{3}\">{4}</a></td>\n" +
-        "  <td class=\"row-center\"><a href=\"{5}\">{6}</a></td>\n" +
+        "  <td class=\"row-center\"><a href=\"{3}\" " + REL_EXTERNAL + ">{4}</a></td>\n" +
+        "  <td class=\"row-center\"><a href=\"{5}\" " + REL_EXTERNAL + ">{6}</a></td>\n" +
         "  <td class=\"row-right\"><a href=\"{7}\">{8}</a></td>\n" +
         " </tr>\n" +
         "</table>\n" +
@@ -85,6 +87,5 @@ public class Constants {
         "</body>\n" +
         "</html>";
     public static final String CHARSET="utf-8";
-
 }
 

==================================================
