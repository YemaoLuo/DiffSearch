33baa7d6f4b12319eb8ce52cf07a0d4c4c630492
==================================================
Add back uri normalization for cache lookup. Test submitted by Violeta Georgieva.
==================================================
Remy Maucherat
==================================================
Fri Dec 13 11:55:32 2013 +0000
==================================================
TagLibraryInfoImpl.java
Add back uri normalization for cache lookup. Test submitted by Violeta Georgieva.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1550695 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestTagLibraryInfo.java
index dfa7698c67..a4440e73ed 100644
--- a/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
+++ b/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
@@ -46,6 +46,7 @@ import org.apache.tomcat.util.descriptor.tld.TagXml;
 import org.apache.tomcat.util.descriptor.tld.TaglibXml;
 import org.apache.tomcat.util.descriptor.tld.TldResourcePath;
 import org.apache.tomcat.util.descriptor.tld.ValidatorXml;
+import org.apache.tomcat.util.http.RequestUtil;
 import org.apache.tomcat.util.scan.Jar;
 
 /**
@@ -214,6 +215,9 @@ class TagLibraryInfoImpl extends TagLibraryInfo implements TagConstants {
         } else if (uri.charAt(0) != '/') {
             // noroot_rel_uri, resolve against the current JSP page
             uri = ctxt.resolveRelativeUri(uri);
+            if (uri != null) {
+                uri = RequestUtil.normalize(uri);
+            }
         }
 
         URL url = null;

==================================================
