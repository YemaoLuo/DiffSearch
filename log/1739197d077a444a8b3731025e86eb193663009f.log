1739197d077a444a8b3731025e86eb193663009f
==================================================
Fix likely cause of occasional unit test failures.
==================================================
Mark Thomas
==================================================
Mon Apr 18 14:14:06 2016 +0000
==================================================
AbstractTestFileResourceSet.java
Fix likely cause of occasional unit test failures.
Defensive copy was being taken of wrong location.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1739762 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestFileResourceSet.java
index 3bd30c6c7a..fb24affa92 100644
--- a/test/org/apache/catalina/webresources/AbstractTestFileResourceSet.java
+++ b/test/org/apache/catalina/webresources/AbstractTestFileResourceSet.java
@@ -31,7 +31,7 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
         this.readOnly = readOnly;
     }
 
-    protected abstract String getDir1();
+    protected abstract File getDir2();
 
     @Override
     public WebResourceRoot getWebResourceRoot() {
@@ -41,22 +41,22 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
         root.setMainResources(webResourceSet);
 
         WebResourceSet f1 = new FileResourceSet(root, "/f1.txt",
-                getDir1() + "/f1.txt", "/");
+                "test/webresources/dir1/f1.txt", "/");
         f1.setReadOnly(readOnly);
         root.addPreResources(f1);
 
         WebResourceSet f2 = new FileResourceSet(root, "/f2.txt",
-                getDir1() + "/f2.txt", "/");
+                "test/webresources/dir1/f2.txt", "/");
         f2.setReadOnly(readOnly);
         root.addPreResources(f2);
 
         WebResourceSet d1f1 = new FileResourceSet(root, "/d1/d1-f1.txt",
-                getDir1() + "/d1/d1-f1.txt", "/");
+                "test/webresources/dir1/d1/d1-f1.txt", "/");
         d1f1.setReadOnly(readOnly);
         root.addPreResources(d1f1);
 
         WebResourceSet d2f1 = new FileResourceSet(root, "/d2/d2-f1.txt",
-                getDir1() + "/d2/d2-f1.txt", "/");
+                "test/webresources/dir1/d2/d2-f1.txt", "/");
         d2f1.setReadOnly(readOnly);
         root.addPreResources(d2f1);
 
@@ -70,7 +70,7 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
 
     @Override
     public File getBaseDir() {
-        return new File("test/webresources/dir2");
+        return getDir2();
     }
 
     @Override

==================================================
TestFileResourceSetReadOnly.java
index d4523e1a0f..59ea59044f 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSet.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSet.java
@@ -31,13 +31,13 @@ import org.apache.catalina.startup.TomcatBaseTest;
 public class TestFileResourceSet extends AbstractTestFileResourceSet {
 
     private static Path tempDir;
-    private static File dir1;
+    private static File dir2;
 
     @BeforeClass
     public static void before() throws IOException {
         tempDir = Files.createTempDirectory("test", new FileAttribute[0]);
-        dir1 = new File(tempDir.toFile(), "dir1");
-        TomcatBaseTest.recursiveCopy(new File("test/webresources/dir1").toPath(), dir1.toPath());
+        dir2 = new File(tempDir.toFile(), "dir2");
+        TomcatBaseTest.recursiveCopy(new File("test/webresources/dir2").toPath(), dir2.toPath());
     }
 
     @AfterClass
@@ -51,8 +51,8 @@ public class TestFileResourceSet extends AbstractTestFileResourceSet {
     }
 
     @Override
-    protected String getDir1() {
-        return dir1.getAbsolutePath();
+    protected File getDir2() {
+        return dir2;
     }
 
     @Override

==================================================
TestFileResourceSetVirtual.java
index 8b29410426..732617ea52 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSetReadOnly.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSetReadOnly.java
@@ -31,13 +31,13 @@ import org.apache.catalina.startup.TomcatBaseTest;
 public class TestFileResourceSetReadOnly extends AbstractTestFileResourceSet {
 
     private static Path tempDir;
-    private static File dir1;
+    private static File dir2;
 
     @BeforeClass
     public static void before() throws IOException {
         tempDir = Files.createTempDirectory("test", new FileAttribute[0]);
-        dir1 = new File(tempDir.toFile(), "dir1");
-        TomcatBaseTest.recursiveCopy(new File("test/webresources/dir1").toPath(), dir1.toPath());
+        dir2 = new File(tempDir.toFile(), "dir2");
+        TomcatBaseTest.recursiveCopy(new File("test/webresources/dir2").toPath(), dir2.toPath());
     }
 
     @AfterClass
@@ -51,8 +51,8 @@ public class TestFileResourceSetReadOnly extends AbstractTestFileResourceSet {
     }
 
     @Override
-    protected String getDir1() {
-        return dir1.getAbsolutePath();
+    protected File getDir2() {
+        return dir2;
     }
 
     @Override

==================================================
