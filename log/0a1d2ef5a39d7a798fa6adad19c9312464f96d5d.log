0a1d2ef5a39d7a798fa6adad19c9312464f96d5d
==================================================
Connector refactoring.
==================================================
Mark Emlyn
==================================================
Wed Jun 22 23:13:37 2011 +0000
==================================================
AjpNioProtocol.java
Connector refactoring.
Start moving the NIO connectors towards using SocketWrapper<NioChannel> rather than NioChannel to align them with BIO/APR and permit further refactoring.
Do this in small steps since when I tried to do it in one hit, everything broke.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1138677 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11NioProtocol.java
index cef916ce7c..7396517ae1 100644
--- a/java/org/apache/coyote/ajp/AjpNioProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpNioProtocol.java
@@ -31,6 +31,7 @@ import org.apache.tomcat.util.net.NioEndpoint;
 import org.apache.tomcat.util.net.NioEndpoint.Handler;
 import org.apache.tomcat.util.net.SSLImplementation;
 import org.apache.tomcat.util.net.SocketStatus;
+import org.apache.tomcat.util.net.SocketWrapper;
 
 
 /**
@@ -166,7 +167,9 @@ public class AjpNioProtocol extends AbstractAjpProtocol {
         }
 
         @Override
-        public SocketState process(NioChannel socket, SocketStatus status) {
+        public SocketState process(SocketWrapper<NioChannel> socketWrapper,
+                SocketStatus status) {
+            NioChannel socket = socketWrapper.getSocket();
             AjpNioProcessor processor = connections.remove(socket);
 
             NioEndpoint.KeyAttachment att = (NioEndpoint.KeyAttachment)socket.getAttachment(false);

==================================================
NioEndpoint.java
index a6351b97c7..79dbf8728b 100644
--- a/java/org/apache/coyote/http11/Http11NioProtocol.java
+++ b/java/org/apache/coyote/http11/Http11NioProtocol.java
@@ -33,6 +33,7 @@ import org.apache.tomcat.util.net.NioEndpoint.Handler;
 import org.apache.tomcat.util.net.SSLImplementation;
 import org.apache.tomcat.util.net.SecureNioChannel;
 import org.apache.tomcat.util.net.SocketStatus;
+import org.apache.tomcat.util.net.SocketWrapper;
 
 
 /**
@@ -228,7 +229,9 @@ public class Http11NioProtocol extends AbstractHttp11JsseProtocol {
 
 
         @Override
-        public SocketState process(NioChannel socket, SocketStatus status) {
+        public SocketState process(SocketWrapper<NioChannel> socketWrapper,
+                SocketStatus status) {
+            NioChannel socket = socketWrapper.getSocket();
             Http11NioProcessor processor = connections.remove(socket);
 
             NioEndpoint.KeyAttachment att = (NioEndpoint.KeyAttachment)socket.getAttachment(false);

==================================================
