71550e29cddb20416fbdc346a0502df1450dfaf8
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54537
==================================================
Filip Hanik
==================================================
Thu Aug 7 21:47:11 2014 +0000
==================================================
StatementFinalizer.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54537
Use a linked list to handle O(1) insert and remove operations.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1616602 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StatementFinalizerTest.java
index 67d45c85a9..e4aac0f2af 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementFinalizer.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementFinalizer.java
@@ -16,15 +16,16 @@
  */
 package org.apache.tomcat.jdbc.pool.interceptor;
 
-import java.lang.ref.WeakReference;
-import java.lang.reflect.Method;
-import java.sql.Statement;
-import java.util.ArrayList;
-
 import org.apache.juli.logging.Log;
 import org.apache.juli.logging.LogFactory;
 import org.apache.tomcat.jdbc.pool.ConnectionPool;
 import org.apache.tomcat.jdbc.pool.PooledConnection;
+
+import java.lang.ref.WeakReference;
+import java.lang.reflect.Method;
+import java.sql.Statement;
+import java.util.LinkedList;
+import java.util.List;
 /**
  * Keeps track of statements associated with a connection and invokes close upon {@link java.sql.Connection#close()}
  * Useful for applications that dont close the associated statements after being done with a connection.
@@ -33,7 +34,7 @@ import org.apache.tomcat.jdbc.pool.PooledConnection;
 public class StatementFinalizer extends AbstractCreateStatementInterceptor {
     private static final Log log = LogFactory.getLog(StatementFinalizer.class);
 
-    protected ArrayList<WeakReference<Statement>> statements = new ArrayList<>();
+    protected List<WeakReference<Statement>> statements = new LinkedList<>();
 
     @Override
     public Object createStatement(Object proxy, Method method, Object[] args, Object statement, long time) {

==================================================
