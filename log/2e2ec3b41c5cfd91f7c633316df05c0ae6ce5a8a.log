2e2ec3b41c5cfd91f7c633316df05c0ae6ce5a8a
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56717
==================================================
Konstantin Kolinko
==================================================
Mon Jul 14 23:57:35 2014 +0000
==================================================
MapperListener.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56717
Fix duplicate registration of MapperListener during repeated starts of embedded Tomcat.
Properly unregister it when Tomcat stops.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1610562 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestMapperListener.java
index 1a4eff6efe..b8535ff3fa 100644
--- a/java/org/apache/catalina/mapper/MapperListener.java
+++ b/java/org/apache/catalina/mapper/MapperListener.java
@@ -116,6 +116,9 @@ public class MapperListener extends LifecycleMBeanBase
     @Override
     public void stopInternal() throws LifecycleException {
         setState(LifecycleState.STOPPING);
+
+        Engine engine = (Engine) service.getContainer();
+        removeListeners(engine);
     }
 
 

==================================================
