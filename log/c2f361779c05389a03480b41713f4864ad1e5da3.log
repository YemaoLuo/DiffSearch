c2f361779c05389a03480b41713f4864ad1e5da3
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55399
==================================================
Mark Emlyn
==================================================
Thu Aug 15 20:51:38 2013 +0000
==================================================
AbstractAjpProcessor.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55399
Have the message in the response line use the locale set for the response.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1514485 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractOutputBuffer.java
index db86b4bb78..e425f301ab 100644
--- a/java/org/apache/coyote/ajp/AbstractAjpProcessor.java
+++ b/java/org/apache/coyote/ajp/AbstractAjpProcessor.java
@@ -947,7 +947,8 @@ public abstract class AbstractAjpProcessor<S> extends AbstractProcessor<S> {
             message = response.getMessage();
         }
         if (message == null){
-            message = HttpMessages.getMessage(response.getStatus());
+            message = HttpMessages.getInstance(
+                    response.getLocale()).getMessage(response.getStatus());
         }
         if (message == null) {
             // mod_jk + httpd 2.x fails with a null status message - bug 45026

==================================================
SpdyProcessor.java
index 4b88c85759..ee259cd384 100644
--- a/java/org/apache/coyote/http11/AbstractOutputBuffer.java
+++ b/java/org/apache/coyote/http11/AbstractOutputBuffer.java
@@ -133,7 +133,7 @@ public abstract class AbstractOutputBuffer<S> implements OutputBuffer {
         finished = false;
 
         // Cause loading of HttpMessages
-        HttpMessages.getMessage(200);
+        HttpMessages.getInstance(response.getLocale()).getMessage(200);
     }
 
 
@@ -427,7 +427,8 @@ public abstract class AbstractOutputBuffer<S> implements OutputBuffer {
             message = response.getMessage();
         }
         if (message == null) {
-            write(HttpMessages.getMessage(status));
+            write(HttpMessages.getInstance(
+                    response.getLocale()).getMessage(status));
         } else {
             write(message);
         }

==================================================
HttpMessages.java
index a87eea258e..d9b3a236dd 100644
--- a/java/org/apache/coyote/spdy/SpdyProcessor.java
+++ b/java/org/apache/coyote/spdy/SpdyProcessor.java
@@ -440,7 +440,8 @@ public class SpdyProcessor extends AbstractProcessor<Object> implements
                 message = response.getMessage();
             }
             if (message == null) {
-                message = HttpMessages.getMessage(response.getStatus());
+                message = HttpMessages.getInstance(
+                        response.getLocale()).getMessage(response.getStatus());
             }
             if (message == null) {
                 // mod_jk + httpd 2.x fails with a null status message - bug

==================================================
