c84b71992f21b06752df81cb643c0c6d4116cace
==================================================
Refactor to use IOTools to copy from InputStream to OutputStream
==================================================
Mark Thomas
==================================================
Thu Nov 15 20:43:32 2018 +0000
==================================================
AbstractCatalinaTask.java
Refactor to use IOTools to copy from InputStream to OutputStream

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1846679 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ManagerServlet.java
index 810a03e7ab..0d30fe2f2e 100644
--- a/java/org/apache/catalina/ant/AbstractCatalinaTask.java
+++ b/java/org/apache/catalina/ant/AbstractCatalinaTask.java
@@ -16,10 +16,10 @@
  */
 package org.apache.catalina.ant;
 
-import java.io.BufferedOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
+import java.io.OutputStream;
 import java.net.Authenticator;
 import java.net.HttpURLConnection;
 import java.net.PasswordAuthentication;
@@ -210,17 +210,8 @@ public abstract class AbstractCatalinaTask extends BaseRedirectorHelperTask {
 
             // Send the request data (if any)
             if (istream != null) {
-                try (BufferedOutputStream ostream = new BufferedOutputStream(
-                                hconn.getOutputStream(), 1024)) {
-                    byte buffer[] = new byte[1024];
-                    while (true) {
-                        int n = istream.read(buffer);
-                        if (n < 0) {
-                            break;
-                        }
-                        ostream.write(buffer, 0, n);
-                    }
-                    ostream.flush();
+                try (OutputStream ostream = hconn.getOutputStream()) {
+                    IOTools.flow(istream, ostream);
                 } finally {
                     try {
                         istream.close();

==================================================
HostConfig.java
index e961a2914c..add8aa0dee 100644
--- a/java/org/apache/catalina/manager/ManagerServlet.java
+++ b/java/org/apache/catalina/manager/ManagerServlet.java
@@ -16,11 +16,11 @@
  */
 package org.apache.catalina.manager;
 
-import java.io.BufferedOutputStream;
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileOutputStream;
 import java.io.IOException;
+import java.io.OutputStream;
 import java.io.PrintWriter;
 import java.security.cert.Certificate;
 import java.security.cert.X509Certificate;
@@ -61,6 +61,7 @@ import org.apache.catalina.connector.Connector;
 import org.apache.catalina.core.StandardHost;
 import org.apache.catalina.startup.ExpandWar;
 import org.apache.catalina.util.ContextName;
+import org.apache.catalina.util.IOTools;
 import org.apache.catalina.util.ServerInfo;
 import org.apache.coyote.ProtocolHandler;
 import org.apache.coyote.http11.AbstractHttp11Protocol;
@@ -1665,16 +1666,8 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
         }
 
         try (ServletInputStream istream = request.getInputStream();
-                BufferedOutputStream ostream =
-                        new BufferedOutputStream(new FileOutputStream(war), 1024)) {
-            byte buffer[] = new byte[1024];
-            while (true) {
-                int n = istream.read(buffer);
-                if (n < 0) {
-                    break;
-                }
-                ostream.write(buffer, 0, n);
-            }
+                OutputStream ostream = new FileOutputStream(war)) {
+            IOTools.flow(istream, ostream);
         } catch (IOException e) {
             if (war.exists() && !war.delete()) {
                 writer.println(
@@ -1682,7 +1675,6 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
             }
             throw e;
         }
-
     }
 
 

==================================================
