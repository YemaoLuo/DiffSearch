560b041d392e8ce98e44bd2f131cf9815c27cfd1
==================================================
Servlet 4.0
==================================================
Mark Thomas
==================================================
Sat Oct 10 11:34:48 2015 +0000
==================================================
TestSchemaValidation.java
Servlet 4.0
Update tests for 4.0 schemas

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1707866 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestJspCServletContext.java
index 7c60cf4e9b..f0f6b09123 100644
--- a/test/javax/servlet/resources/TestSchemaValidation.java
+++ b/test/javax/servlet/resources/TestSchemaValidation.java
@@ -130,5 +130,17 @@ public class TestSchemaValidation {
         Assert.assertEquals(0, handler.getWarnings().size());
     }
 
-    // TODO Servlet 4.0
+    @Test
+    public void testWebapp_4_0() throws Exception {
+        XmlErrorHandler handler = new XmlErrorHandler();
+        Digester digester = DigesterFactory.newDigester(
+                true, true, new WebRuleSet(false), true);
+        digester.setErrorHandler(handler);
+        digester.push(new WebXml());
+        WebXml desc = (WebXml) digester.parse(
+                new File("test/webapp-4.0/WEB-INF/web.xml"));
+        Assert.assertEquals("4.0", desc.getVersion());
+        Assert.assertEquals(0, handler.getErrors().size());
+        Assert.assertEquals(0, handler.getWarnings().size());
+    }
 }

==================================================
TestWebXml.java
index 0765fc3d39..748a62a541 100644
--- a/test/org/apache/jasper/servlet/TestJspCServletContext.java
+++ b/test/org/apache/jasper/servlet/TestJspCServletContext.java
@@ -113,8 +113,15 @@ public class TestJspCServletContext {
         Assert.assertEquals(1, context.getEffectiveMinorVersion());
     }
 
-    // TODO Servlet 4.0
-    // Once a 4.0 web.xml is available
+    @Test
+    public void testWebapp_4_0() throws Exception {
+        File appDir = new File("test/webapp-4.0");
+        JspCServletContext context = new JspCServletContext(
+                null, appDir.toURI().toURL(), null, false, false);
+        Assert.assertEquals(4, context.getEffectiveMajorVersion());
+        Assert.assertEquals(0, context.getEffectiveMinorVersion());
+    }
+
 
     @Test
     public void testWebresources() throws Exception {

==================================================
