6ff2fe3f1121a0b381ae63bd12d258b5532d826c
==================================================
- Improve the handshake end detection using the getHandshakeCount that was modified in native. Although checking the certificate was there is a hack that worked in some cases, it was most likely incorrect.
==================================================
Remy Maucherat
==================================================
Fri Dec 11 16:38:19 2015 +0000
==================================================
SSL.java
- Improve the handshake end detection using the getHandshakeCount that was modified in native. Although checking the certificate was there is a hack that worked in some cases, it was most likely incorrect.
- Ideally SSL_set_info_callback can be used for even better state tracking eventually, but it needs a lot more native work.
- Add a flag to know that an extra wrap should be done when an error occurs during handshake.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1719472 13f79535-47bb-0310-9956-ffa450edef68



==================================================
OpenSSLEngine.java
index 789b8d706a..c684b5d34c 100644
--- a/java/org/apache/tomcat/jni/SSL.java
+++ b/java/org/apache/tomcat/jni/SSL.java
@@ -357,6 +357,11 @@ public final class SSL {
      */
     public static native boolean hasOp(int op);
 
+    /**
+     * Return the handshake completed count.
+     */
+    public static native int getHandshakeCount(long ssl);
+
     /*
      * Begin Twitter API additions
      */

==================================================
