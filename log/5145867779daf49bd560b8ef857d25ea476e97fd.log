5145867779daf49bd560b8ef857d25ea476e97fd
==================================================
Clean-up
==================================================
Mark Thomas
==================================================
Tue Feb 27 22:37:01 2018 +0000
==================================================
Context.java
Clean-up
A running Context always has a non-null Authenticator
Clean-up the few remaining places that the unnecessary null checks remained.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1825514 13f79535-47bb-0310-9956-ffa450edef68



==================================================
CoyoteAdapter.java
index 491d976036..c62b4eaaa1 100644
--- a/java/org/apache/catalina/Context.java
+++ b/java/org/apache/catalina/Context.java
@@ -699,8 +699,8 @@ public interface Context extends Container, ContextBind {
     public void setJarScanner(JarScanner jarScanner);
 
     /**
-     * @return the {@link Authenticator} that is used by this context or
-     * <code>null</code> if none is used.
+     * @return the {@link Authenticator} that is used by this context. This is
+     *         always non-{@code null} for a started Context
      */
     public Authenticator getAuthenticator();
 

==================================================
Request.java
index de3ba9ca34..9bc308ef6f 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -849,12 +849,7 @@ public class CoyoteAdapter implements Adapter {
             }
             if (req.getRemoteUserNeedsAuthorization()) {
                 Authenticator authenticator = request.getContext().getAuthenticator();
-                if (authenticator == null) {
-                    // No security constraints configured for the application so
-                    // no need to authorize the user. Use the CoyotePrincipal to
-                    // provide the authenticated user.
-                    request.setUserPrincipal(new CoyotePrincipal(username));
-                } else if (!(authenticator instanceof AuthenticatorBase)) {
+                if (!(authenticator instanceof AuthenticatorBase)) {
                     if (log.isDebugEnabled()) {
                         log.debug(sm.getString("coyoteAdapter.authorize", username));
                     }

==================================================
