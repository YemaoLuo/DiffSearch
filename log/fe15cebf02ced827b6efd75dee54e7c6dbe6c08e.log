fe15cebf02ced827b6efd75dee54e7c6dbe6c08e
==================================================
New interface to remove dependency between valve and session packages
==================================================
Mark Emlyn
==================================================
Fri Feb 3 09:44:00 2012 +0000
==================================================
StoreManager.java
New interface to remove dependency between valve and session packages

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1240047 13f79535-47bb-0310-9956-ffa450edef68



==================================================
PersistentManagerBase.java
new file mode 100644
index 0000000000..ae0d4534ab
--- /dev/null
+++ b/java/org/apache/catalina/StoreManager.java
@@ -0,0 +1,38 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.catalina;
+
+/**
+ * PersistentManager would have been a better name but that would have clashed
+ * with the implementation name.
+ */
+public interface StoreManager {
+
+    /**
+     * Return the Store object which manages persistent Session
+     * storage for this Manager.
+     */
+    Store getStore();
+
+    /**
+     * Remove this Session from the active Sessions for this Manager,
+     * but not from the Store. (Used by the PersistentValve)
+     *
+     * @param session Session to be removed
+     */
+    void removeSuper(Session session);
+}

==================================================
PersistentValve.java
index 041bdcac66..b94222092e 100644
--- a/java/org/apache/catalina/session/PersistentManagerBase.java
+++ b/java/org/apache/catalina/session/PersistentManagerBase.java
@@ -30,6 +30,7 @@ import org.apache.catalina.LifecycleException;
 import org.apache.catalina.LifecycleState;
 import org.apache.catalina.Session;
 import org.apache.catalina.Store;
+import org.apache.catalina.StoreManager;
 import org.apache.catalina.security.SecurityUtil;
 import org.apache.juli.logging.Log;
 import org.apache.juli.logging.LogFactory;
@@ -47,7 +48,8 @@ import org.apache.juli.logging.LogFactory;
  * @version $Id$
  */
 
-public abstract class PersistentManagerBase extends ManagerBase {
+public abstract class PersistentManagerBase extends ManagerBase
+        implements StoreManager {
 
     private static final Log log = LogFactory.getLog(PersistentManagerBase.class);
 

==================================================
