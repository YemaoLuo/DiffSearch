f5a023eb260c020a7c947d9502aa5c67e092b1f7
==================================================
Update I/O implementations to support returning -1 for end of stream.
==================================================
Mark Thomas
==================================================
Sun Feb 22 18:49:37 2015 +0000
==================================================
AprEndpoint.java
Update I/O implementations to support returning -1 for end of stream.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1661517 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Nio2Endpoint.java
index 051b6ca604..378c2fb290 100644
--- a/java/org/apache/tomcat/util/net/AprEndpoint.java
+++ b/java/org/apache/tomcat/util/net/AprEndpoint.java
@@ -2495,7 +2495,7 @@ public class AprEndpoint extends AbstractEndpoint<Long> {
                     return 0;
                 }
             } else if (-result == Status.APR_EOF) {
-                throw new EOFException(sm.getString("socket.apr.clientAbort"));
+                return -1;
             } else if ((OS.IS_WIN32 || OS.IS_WIN64) &&
                     (-result == Status.APR_OS_START_SYSERR + 10053)) {
                 // 10053 on Windows is connection aborted

==================================================
NioEndpoint.java
index b7a5d3dd4e..ea6dac3b6d 100644
--- a/java/org/apache/tomcat/util/net/Nio2Endpoint.java
+++ b/java/org/apache/tomcat/util/net/Nio2Endpoint.java
@@ -1064,7 +1064,7 @@ public class Nio2Endpoint extends AbstractEndpoint<Nio2Channel> {
                 } else if (nRead == 0 && !block) {
                     readInterest = true;
                 } else if (nRead == -1) {
-                    throw new EOFException();
+                    return -1;
                 }
 
                 if (log.isDebugEnabled()) {

==================================================
