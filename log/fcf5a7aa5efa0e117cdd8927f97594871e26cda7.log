fcf5a7aa5efa0e117cdd8927f97594871e26cda7
==================================================
Fix refactoring of writing from the non-blocking write buffer to the network for NIO2.
==================================================
Mark Thomas
==================================================
Mon Aug 20 19:53:18 2018 +0000
==================================================
Nio2Endpoint.java
Fix refactoring of writing from the non-blocking write buffer to the network for NIO2.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1838473 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SocketWrapperBase.java
index 171ffea8d8..1364c455ac 100644
--- a/java/org/apache/tomcat/util/net/Nio2Endpoint.java
+++ b/java/org/apache/tomcat/util/net/Nio2Endpoint.java
@@ -1183,6 +1183,19 @@ public class Nio2Endpoint extends AbstractJsseEndpoint<Nio2Channel,AsynchronousS
          */
         @Override
         protected void writeNonBlocking(ByteBuffer from) throws IOException {
+            writeNonBlockingInternal(from);
+        }
+
+
+        /**
+         * {@inheritDoc}
+         * <p>
+         * Overridden for NIO2 to enable a gathering write to be used to write
+         * all of the remaining data in a single additional write should a
+         * non-blocking write leave data in the buffer.
+         */
+        @Override
+        protected void writeNonBlockingInternal(ByteBuffer from) throws IOException {
             // Note: Possible alternate behavior:
             // If there's non blocking abuse (like a test writing 1MB in a single
             // "non blocking" write), then block until the previous write is

==================================================
