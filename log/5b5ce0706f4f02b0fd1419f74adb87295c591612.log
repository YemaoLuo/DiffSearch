5b5ce0706f4f02b0fd1419f74adb87295c591612
==================================================
Remove unnecessary privileged block from getAttributesScope.
==================================================
Mark Thomas
==================================================
Thu Apr 6 20:44:24 2017 +0000
==================================================
PageContextImpl.java
Remove unnecessary privileged block from getAttributesScope.
I can't see anything in doGetAttributeScope that would trigger a security check.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1790460 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityClassLoad.java
index de26955c57..2009a764a8 100644
--- a/java/org/apache/jasper/runtime/PageContextImpl.java
+++ b/java/org/apache/jasper/runtime/PageContextImpl.java
@@ -347,29 +347,16 @@ public class PageContextImpl extends PageContext {
     public int getAttributesScope(final String name) {
 
         if (name == null) {
-            throw new NullPointerException(Localizer
-                    .getMessage("jsp.error.attribute.null_name"));
-        }
-
-        if (SecurityUtil.isPackageProtectionEnabled()) {
-            return (AccessController
-                    .doPrivileged(new PrivilegedAction<Integer>() {
-                        @Override
-                        public Integer run() {
-                            return Integer.valueOf(doGetAttributeScope(name));
-                        }
-                    })).intValue();
-        } else {
-            return doGetAttributeScope(name);
+            throw new NullPointerException(Localizer.getMessage("jsp.error.attribute.null_name"));
         }
-    }
 
-    private int doGetAttributeScope(String name) {
-        if (attributes.get(name) != null)
+        if (attributes.get(name) != null) {
             return PAGE_SCOPE;
+        }
 
-        if (request.getAttribute(name) != null)
+        if (request.getAttribute(name) != null) {
             return REQUEST_SCOPE;
+        }
 
         if (session != null) {
             try {
@@ -381,8 +368,9 @@ public class PageContextImpl extends PageContext {
             }
         }
 
-        if (context.getAttribute(name) != null)
+        if (context.getAttribute(name) != null) {
             return APPLICATION_SCOPE;
+        }
 
         return 0;
     }

==================================================
