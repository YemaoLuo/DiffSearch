4f990f188d5f5239b9a4b55ddd0cd8823c90cec8
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49445
==================================================
Keiichi Fujino
==================================================
Wed Jun 16 11:01:45 2010 +0000
==================================================
DeltaManager.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49445
The change in session ID is notified to other node. 

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@955190 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SessionMessage.java
index ca587ef094..c986d97758 100644
--- a/java/org/apache/catalina/ha/session/LocalStrings.properties
+++ b/java/org/apache/catalina/ha/session/LocalStrings.properties
@@ -55,6 +55,7 @@ deltaManager.startClustering=Starting clustering manager at {0}
 deltaManager.stopped=Manager [{0}] is stopping
 deltaManager.unloading.ioe=IOException while saving persisted sessions: {0}
 deltaManager.waitForSessionState=Manager [{0}], requesting session state from {1}. This operation will timeout if no session state has been received within {2} seconds.
+deltaManager.unableSerializeSessionID =Unable to serialize sessionID [{0}]
 deltaRequest.showPrincipal=Principal [{0}] is set to session {1}
 deltaRequest.wrongPrincipalClass=DeltaManager only support GenericPrincipal. Your realm used principal class {0}.
 deltaSession.notifying=Notifying cluster of expiration primary={0} sessionId [{1}]

==================================================
SessionMessageImpl.java
index 3408657291..2fb1af2e00 100644
--- a/java/org/apache/catalina/ha/session/SessionMessage.java
+++ b/java/org/apache/catalina/ha/session/SessionMessage.java
@@ -26,15 +26,13 @@ import org.apache.catalina.ha.ClusterMessage;
  * The following events are currently available:
  * <ul>
  *   <li><pre>public static final int EVT_SESSION_CREATED</pre><li>
+ *   <li><pre>public static final int EVT_SESSION_EXPIRED</pre><li>
  *   <li><pre>public static final int EVT_SESSION_ACCESSED</pre><li>
- *   <li><pre>public static final int EVT_ATTRIBUTE_ADDED</pre><li>
- *   <li><pre>public static final int EVT_ATTRIBUTE_REMOVED</pre><li>
- *   <li><pre>public static final int EVT_SESSION_EXPIRED_WONOTIFY</pre><li>
- *   <li><pre>public static final int EVT_SESSION_EXPIRED_WNOTIFY</pre><li>
  *   <li><pre>public static final int EVT_GET_ALL_SESSIONS</pre><li>
- *   <li><pre>public static final int EVT_SET_USER_PRINCIPAL</pre><li>
- *   <li><pre>public static final int EVT_SET_SESSION_NOTE</pre><li>
- *   <li><pre>public static final int EVT_REMOVE_SESSION_NOTE</pre><li>
+ *   <li><pre>public static final int EVT_SESSION_DELTA</pre><li>
+ *   <li><pre>public static final int EVT_ALL_SESSION_DATA</pre><li>
+ *   <li><pre>public static final int EVT_ALL_SESSION_TRANSFERCOMPLETE</pre><li>
+ *   <li><pre>public static final int EVT_CHANGE_SESSION_ID</pre><li>
  * </ul>
  *
  */
@@ -78,7 +76,11 @@ public interface SessionMessage extends ClusterMessage, java.io.Serializable
      * When a session state is complete transferred, this is the event.
      */
     public static final int EVT_ALL_SESSION_TRANSFERCOMPLETE = 14;
-    
+
+    /**
+     * Event type used when a sessionID has been changed.
+     */
+    public static final int EVT_CHANGE_SESSION_ID = 15;
 
     
     public String getContextName();

==================================================
