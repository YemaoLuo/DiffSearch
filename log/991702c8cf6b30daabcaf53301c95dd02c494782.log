991702c8cf6b30daabcaf53301c95dd02c494782
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50308
==================================================
Mark Emlyn
==================================================
Mon Nov 22 14:35:51 2010 +0000
==================================================
AsyncStateMachine.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50308
Allow asynchronous request processing to call AsyncContext.dispatch() once the asynchronous request has timed out. 

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1037735 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAsyncContextImpl.java
index fe996e2388..38ece40d94 100644
--- a/java/org/apache/coyote/AsyncStateMachine.java
+++ b/java/org/apache/coyote/AsyncStateMachine.java
@@ -213,7 +213,8 @@ public class AsyncStateMachine {
         boolean doDispatch = false;
         if (state == AsyncState.STARTING) {
             state = AsyncState.MUST_DISPATCH;
-        } else if (state == AsyncState.STARTED) {
+        } else if (state == AsyncState.STARTED ||
+                state == AsyncState.TIMING_OUT) {
             state = AsyncState.DISPATCHING;
             doDispatch = true;
         } else {

==================================================
