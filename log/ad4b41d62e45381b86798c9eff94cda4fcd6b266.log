ad4b41d62e45381b86798c9eff94cda4fcd6b266
==================================================
Simplify Attribute.readAttribute()
==================================================
Konstantin Kolinko
==================================================
Fri Sep 12 11:05:52 2014 +0000
==================================================
Attribute.java
Simplify Attribute.readAttribute()
and remove a lot of swallow methods that are no longer used from Utility class.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1624497 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Utility.java
index 8e8328e0a3..381919ff14 100644
--- a/java/org/apache/tomcat/util/bcel/classfile/Attribute.java
+++ b/java/org/apache/tomcat/util/bcel/classfile/Attribute.java
@@ -90,77 +90,18 @@ public abstract class Attribute implements Serializable
         // Call proper constructor, depending on `tag'
         switch (tag)
         {
-        case Constants.ATTR_UNKNOWN:
-            Utility.swallowUnknownAttribute(file, length);
-            return null;
-        case Constants.ATTR_CONSTANT_VALUE:
-            Utility.swallowConstantValue(file);
-            return null;
-        case Constants.ATTR_SOURCE_FILE:
-            Utility.swallowSourceFile(file);
-            return null;
-        case Constants.ATTR_CODE:
-            Utility.swallowCode(file);
-            return null;
-        case Constants.ATTR_EXCEPTIONS:
-            Utility.swallowExceptionTable(file);
-            return null;
-        case Constants.ATTR_LINE_NUMBER_TABLE:
-            Utility.swallowLineNumberTable(file);
-            return null;
-        case Constants.ATTR_LOCAL_VARIABLE_TABLE:
-            Utility.swallowLocalVariableTable(file);
-            return null;
-        case Constants.ATTR_INNER_CLASSES:
-            Utility.swallowInnerClasses(file);
-            return null;
-        case Constants.ATTR_SYNTHETIC:
-            Utility.swallowSynthetic(length);
-            return null;
-        case Constants.ATTR_DEPRECATED:
-            Utility.swallowDeprecated(length);
-            return null;
-        case Constants.ATTR_PMG:
-            Utility.swallowPMCClass(file);
-            return null;
-        case Constants.ATTR_SIGNATURE:
-            Utility.swallowSignature(file);
-            return null;
-        case Constants.ATTR_STACK_MAP:
-            Utility.swallowStackMap(file);
-            return null;
         case Constants.ATTR_RUNTIME_VISIBLE_ANNOTATIONS:
             return new RuntimeVisibleAnnotations(name_index, length, file,
                     constant_pool);
-        case Constants.ATTR_RUNTIME_INVISIBLE_ANNOTATIONS:
-            Utility.swallowAnnotations(file);
-            return null;
         case Constants.ATTR_RUNTIME_VISIBLE_PARAMETER_ANNOTATIONS:
             return new RuntimeVisibleParameterAnnotations(name_index, length,
                     file, constant_pool);
-        case Constants.ATTR_RUNTIME_INVISIBLE_PARAMETER_ANNOTATIONS:
-            Utility.swallowParameterAnnotations(file);
-            return null;
         case Constants.ATTR_ANNOTATION_DEFAULT:
             return new AnnotationDefault(name_index, length, file,
                     constant_pool);
-        case Constants.ATTR_LOCAL_VARIABLE_TYPE_TABLE:
-            Utility.swallowLocalVariableTypeTable(file);
-            return null;
-        case Constants.ATTR_ENCLOSING_METHOD:
-            Utility.swallowEnclosingMethod(file);
-            return null;
-        case Constants.ATTR_STACK_MAP_TABLE:
-            Utility.swallowStackMapTable(file);
-            return null;
-        case Constants.ATTR_BOOTSTRAP_METHODS:
-            Utility.swallowBootstrapMethods(file);
-            return null;
-        case Constants.ATTR_METHOD_PARAMETERS:
-            Utility.swallowMethodParameters(file);
+        default: // All other attributes are skipped
+            Utility.skipFully(file, length);
             return null;
-        default: // Never reached
-            throw new IllegalStateException("Unrecognized attribute type tag parsed: " + tag);
         }
     }
 

==================================================
