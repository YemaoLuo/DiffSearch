ac225098f53bc202845b1ce12e8343bb19ce678f
==================================================
JspReader.singleFile is always true. The nested files it supports have
==================================================
Mark Emlyn
==================================================
Mon Oct 27 22:03:22 2014 +0000
==================================================
JspReader.java
JspReader.singleFile is always true. The nested files it supports have
not been used since Tomcat 3.x.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1634697 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Parser.java
index 1874fe459b..dd53883558 100644
--- a/java/org/apache/jasper/compiler/JspReader.java
+++ b/java/org/apache/jasper/compiler/JspReader.java
@@ -83,13 +83,6 @@ class JspReader {
      */
     private final ErrorDispatcher err;
 
-    /**
-     * Set to true when using the JspReader on a single file where we read up
-     * to the end and reset to the beginning many times.
-     * (as in ParserController.figureOutJspDocument()).
-     */
-    private boolean singleFile;
-
     /**
      * Constructor.
      *
@@ -127,7 +120,6 @@ class JspReader {
         this.err = err;
         sourceFiles = new Vector<>();
         currFileId = 0;
-        singleFile = false;
         pushFile(fname, reader);
     }
 
@@ -157,10 +149,6 @@ class JspReader {
      */
     boolean hasMoreInput() throws JasperException {
         if (current.cursor >= current.stream.length) {
-            if (singleFile) return false;
-            while (popFile()) {
-                if (current.cursor < current.stream.length) return true;
-            }
             return false;
         }
         return true;
@@ -195,7 +183,7 @@ class JspReader {
 
         int ch = current.stream[current.cursor];
 
-        mark.init(current, singleFile);
+        mark.init(current, true);
 
         current.cursor++;
 
@@ -415,7 +403,7 @@ class JspReader {
         while((result = indexOf(firstChar, ret)) != null) {
            if (result.booleanValue()) {
                if (restart != null) {
-                   restart.init(current, singleFile);
+                   restart.init(current, true);
                } else {
                    restart = mark();
                }
@@ -423,7 +411,7 @@ class JspReader {
                    if (peekChar() == limit.charAt(i)) {
                        nextChar();
                    } else {
-                       current.init(restart, singleFile);
+                       current.init(restart, true);
                        continue skip;
                    }
                }
@@ -597,10 +585,6 @@ class JspReader {
         return StringBuilder.toString();
     }
 
-    void setSingleFile(boolean val) {
-        singleFile = val;
-    }
-
 
     /**
      * Parse utils - Is current character a token delimiter ?

==================================================
ParserController.java
index 7e39f2ee52..635c45ce31 100644
--- a/java/org/apache/jasper/compiler/Parser.java
+++ b/java/org/apache/jasper/compiler/Parser.java
@@ -1786,7 +1786,6 @@ class Parser implements TagConstants {
     }
 
     private void parseFileDirectives(Node parent) throws JasperException {
-        reader.setSingleFile(true);
         reader.skipUntil("<");
         while (reader.hasMoreInput()) {
             start = reader.mark();

==================================================
