7aea9cb4f33cf7fc26ddebad9f0ac49e92e04a73
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55102
==================================================
Mark Emlyn
==================================================
Sun Jun 23 20:22:25 2013 +0000
==================================================
AccessLogValve.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55102
Add support for time to first byte to the AccessLog

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1495886 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index 606ac6cbbc..eae9d2be6c 100644
--- a/java/org/apache/catalina/valves/AccessLogValve.java
+++ b/java/org/apache/catalina/valves/AccessLogValve.java
@@ -1753,6 +1753,22 @@ public class AccessLogValve extends ValveBase implements AccessLog {
         }
     }
 
+    /**
+     * write time until first byte is written (commit time) in millis - %F
+     */
+    protected static class FirstByteTimeElement implements AccessLogElement {
+        @Override
+        public void addElement(CharArrayWriter buf, Date date, Request request, Response response, long time) {
+            long commitTime = response.getCoyoteResponse().getCommitTime();
+            if (commitTime == -1) {
+                buf.append('-');
+            } else {
+                long delta = commitTime - request.getCoyoteRequest().getStartTime();
+                buf.append(Long.toString(delta));
+            }
+        }
+    }
+
     /**
      * write Query string (prepended with a '?' if it exists) - %q
      */
@@ -2065,6 +2081,8 @@ public class AccessLogValve extends ValveBase implements AccessLog {
             return new ByteSentElement(false);
         case 'D':
             return new ElapsedTimeElement(true);
+        case 'F':
+            return new FirstByteTimeElement();
         case 'h':
             return new HostElement();
         case 'H':

==================================================
