a65466f13beed2f1111e65f5c569cd3b2f706406
==================================================
Fix BZ 65390 - revert code removal made in error
==================================================
Mark Thomas
==================================================
Fri Jun 18 16:54:45 2021 +0100
==================================================
Generator.java
Fix BZ 65390 - revert code removal made in error

https://bz.apache.org/bugzilla/show_bug.cgi?id=65390
The code is required and should not have been removed.
Test case based one code provided by tkuun@ai-ag.de


==================================================
TestGenerator.java
index 66ff231868..339de1fe04 100644
--- a/java/org/apache/jasper/compiler/Generator.java
+++ b/java/org/apache/jasper/compiler/Generator.java
@@ -3322,6 +3322,10 @@ class Generator {
             boolean tmpIsFragment = isFragment;
             isFragment = true;
             String pushBodyCountVarSave = pushBodyCountVar;
+            if (pushBodyCountVar != null) {
+                // Use a fixed name for push body count, to simplify code gen
+                pushBodyCountVar = "_jspx_push_body_count";
+            }
             visitBody(n);
             out = outSave;
             parent = tmpParent;

==================================================
