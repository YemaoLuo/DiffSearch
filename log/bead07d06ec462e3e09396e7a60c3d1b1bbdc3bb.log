bead07d06ec462e3e09396e7a60c3d1b1bbdc3bb
==================================================
Provide default implementations to reduce duplication.
==================================================
Mark Thomas
==================================================
Fri Aug 12 07:48:14 2016 +0000
==================================================
AbstractProcessor.java
Provide default implementations to reduce duplication.
Add some Javadoc

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1756114 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Processor.java
index bbaa3bcaff..8a75016684 100644
--- a/java/org/apache/coyote/LocalStrings.properties
+++ b/java/org/apache/coyote/LocalStrings.properties
@@ -19,6 +19,7 @@ abstractConnectionHandler.protocolexception.debug=ProtocolExceptions are normal,
 abstractConnectionHandler.socketexception.debug=SocketExceptions are normal, ignored
 abstractConnectionHandler.negotiatedProcessor.fail=Failed to create Processor for negotiated protocol [{0}]
 
+abstractProcessor.httpupgrade.notsupported=HTTP upgrade is not supported by this protocol
 abstractProcessor.nonContainerThreadError=An error occurred in processing while on a non-container thread. The connection will be closed immediately
 abstractProcessor.pushrequest.notsupported=Server push requests are not supported by this protocol
 abstractProcessor.socket.ssl=Exception getting SSL attributes

==================================================
AjpProcessor.java
index d3f6726c0c..c016c3ab81 100644
--- a/java/org/apache/coyote/Processor.java
+++ b/java/org/apache/coyote/Processor.java
@@ -46,8 +46,21 @@ public interface Processor {
      */
     SocketState process(SocketWrapperBase<?> socketWrapper, SocketEvent status) throws IOException;
 
+    /**
+     * Generate an upgrade token.
+     *
+     * @return An upgrade token encapsulating the information required to
+     *         process the upgrade request
+     *
+     * @throws IllegalStateException if this is called on a Processor that does
+     *         not support upgrading
+     */
     UpgradeToken getUpgradeToken();
 
+    /**
+     * @return {@code true} if the Processor is currently processing an upgrade
+     *         request, otherwise {@code false}
+     */
     boolean isUpgrade();
     boolean isAsync();
 
@@ -81,8 +94,12 @@ public interface Processor {
     void setSslSupport(SSLSupport sslSupport);
 
     /**
-     * Allows retrieving additional input during the upgrade process
+     * Allows retrieving additional input during the upgrade process.
+     *
      * @return leftover bytes
+     *
+     * @throws IllegalStateException if this is called on a Processor that does
+     *         not support upgrading
      */
     ByteBuffer getLeftoverInput();
 

==================================================
Http11Processor.java
index 8dfda2f48c..b9dddeb3fa 100644
--- a/java/org/apache/coyote/ajp/LocalStrings.properties
+++ b/java/org/apache/coyote/ajp/LocalStrings.properties
@@ -27,7 +27,6 @@ ajpprocessor.readtimeout=Timeout attempting to read data from the socket
 ajpprocessor.request.prepare=Error preparing request
 ajpprocessor.request.process=Error processing request
 ajpprocessor.certs.fail=Certificate conversion failed
-ajpprocessor.httpupgrade.notsupported=HTTP upgrade is not supported by the AJP protocol
 
 ajpmessage.null=Cannot append null value
 ajpmessage.overflow=Overflow error for buffer adding {0} bytes at position {1}

==================================================
StreamProcessor.java
index 532bd354aa..0f1d03827a 100644
--- a/java/org/apache/coyote/http2/LocalStrings.properties
+++ b/java/org/apache/coyote/http2/LocalStrings.properties
@@ -83,9 +83,7 @@ stream.outputBuffer.flush.debug=Connection [{0}], Stream [{1}], flushing output
 
 streamProcessor.error.connection=Connection [{0}], Stream [{1}], An error occurred during processing that was fatal to the connection
 streamProcessor.error.stream=Connection [{0}], Stream [{1}], An error occurred during processing that was fatal to the stream
-streamProcessor.httpupgrade.notsupported=HTTP upgrade is not supported within HTTP/2 streams
 streamProcessor.service.error=Error during request processing
-streamProcessor.ssl.error=Unable to retrieve SSL request attributes
 
 streamStateMachine.debug.change=Connection [{0}], Stream [{1}], State changed from [{2}] to [{3}]
 streamStateMachine.invalidFrame=Connection [{0}], Stream [{1}], State [{2}], Frame type [{3}]

==================================================
