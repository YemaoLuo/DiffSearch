b5f089ddf112f026010d6c401d06d069329aa36f
==================================================
Make the fix for bug 49555 more robust
==================================================
Mark Emlyn
==================================================
Sun Jul 11 16:37:32 2010 +0000
==================================================
ELFunctionMapper.java
Make the fix for bug 49555 more robust

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@963106 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestELInJsp.java
index 53d931e73e..235b402de3 100644
--- a/java/org/apache/jasper/compiler/ELFunctionMapper.java
+++ b/java/org/apache/jasper/compiler/ELFunctionMapper.java
@@ -294,8 +294,14 @@ public class ELFunctionMapper {
          * @param className Binary class name
          * @return          Canonical equivalent
          */
-        private String getCanonicalName(String className) {
-            return className.replace('$', '.');
+        private String getCanonicalName(String className) throws JasperException {
+            Class<?> clazz;
+            try {
+                clazz = Class.forName(className);
+            } catch (ClassNotFoundException e) {
+                throw new JasperException(e);
+            }
+            return clazz.getCanonicalName();
         }
     }
 }

==================================================
TesterFunctions.java
index e3bcf32a5c..fe1ac774d0 100644
--- a/test/org/apache/el/TestELInJsp.java
+++ b/test/org/apache/el/TestELInJsp.java
@@ -322,7 +322,7 @@ public class TestELInJsp extends TomcatBaseTest {
                 "/test/bug49555.jsp");
         
         String result = res.toString();
-        assertEcho(result, "00-" + TesterFunctions.Inner.RETVAL);
+        assertEcho(result, "00-" + TesterFunctions.Inner$Class.RETVAL);
     }
 
     public void testELMisc() throws Exception {

==================================================
