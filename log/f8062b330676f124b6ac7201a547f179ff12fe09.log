f8062b330676f124b6ac7201a547f179ff12fe09
==================================================
- Examples cleanup.
==================================================
Remy Maucherat
==================================================
Wed Apr 4 14:06:41 2007 +0000
==================================================
ChatServlet.java
- Examples cleanup.
- Submitted by Takayuki Kaneko and Markus SchÃ¶nhaber.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@525516 13f79535-47bb-0310-9956-ffa450edef68



==================================================
servletToJsp.java
index f27c3c0741..c74899ddd1 100644
--- a/webapps/examples/WEB-INF/classes/chat/ChatServlet.java
+++ b/webapps/examples/WEB-INF/classes/chat/ChatServlet.java
@@ -73,37 +73,15 @@ public class ChatServlet
         HttpServletResponse response = event.getHttpServletResponse();
         
         if (event.getEventType() == CometEvent.EventType.BEGIN) {
-            String action = request.getParameter("action");
-            if (action != null) {
-                if ("login".equals(action)) {
-                    String nickname = request.getParameter("nickname");
-                    request.getSession(true).setAttribute("nickname", nickname);
-                    response.sendRedirect("post.jsp");
-                    event.close();
-                    return;
-                } else {
-                    String nickname = (String) request.getSession(true).getAttribute("nickname");
-                    String message = request.getParameter("message");
-                    messageSender.send(nickname, message);
-                    response.sendRedirect("post.jsp");
-                    event.close();
-                    return;
-                }
-            } else {
-                if (request.getSession(true).getAttribute("nickname") == null) {
-                    // Redirect to "login"
-                    log("Redirect to login for session: " + request.getSession(true).getId());
-                    response.sendRedirect("login.jsp");
-                    event.close();
-                    return;
-                }
-            }
-            begin(event, request, response);
+            System.out.println("Begin for session: " + request.getSession(true).getId());
         } else if (event.getEventType() == CometEvent.EventType.ERROR) {
-            error(event, request, response);
+            System.out.println("Error for session: " + request.getSession(true).getId());
+            throw new ServletException("error: test message");
         } else if (event.getEventType() == CometEvent.EventType.END) {
-            end(event, request, response);
+            System.out.println("End for session: " + request.getSession(true).getId());
+            throw new ServletException("end: test message");
         } else if (event.getEventType() == CometEvent.EventType.READ) {
+            System.out.println("Read for session: " + request.getSession(true).getId());
             read(event, request, response);
         }
     }
@@ -139,6 +117,7 @@ public class ChatServlet
     protected void error(CometEvent event, HttpServletRequest request, HttpServletResponse response)
         throws IOException, ServletException {
         log("Error for session: " + request.getSession(true).getId());
+        System.out.println("Error2 for session: " + request.getSession(true).getId());
         synchronized(connections) {
             connections.remove(response);
         }
@@ -151,7 +130,10 @@ public class ChatServlet
         byte[] buf = new byte[512];
         do {
             int n = is.read(buf);
+            System.out.println("Read " + n + " for session: " + request.getSession(true).getId());
             if (n > 0) {
+                System.out.println("Read " + n + " bytes: " + new String(buf, 0, n) 
+                    + " for session: " + request.getSession(true).getId());
                 log("Read " + n + " bytes: " + new String(buf, 0, n) 
                         + " for session: " + request.getSession(true).getId());
             } else if (n < 0) {

==================================================
