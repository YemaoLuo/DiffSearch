7b24ed5b5020ee3874793309960faa4a2e6d44e1
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49665
==================================================
Mark Emlyn
==================================================
Tue Sep 28 17:23:05 2010 +0000
==================================================
Generator.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49665
Better handling for missing TLD files. Report JSP filename and location.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1002274 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspDocumentParser.java
index 8b25f5e099..8e0ac84889 100644
--- a/java/org/apache/jasper/compiler/Generator.java
+++ b/java/org/apache/jasper/compiler/Generator.java
@@ -1079,8 +1079,10 @@ class Generator {
                         + property
                         + "\")));");
             } else {
-                StringBuilder msg =
-                    new StringBuilder("jsp:getProperty for bean with name '");
+                StringBuilder msg = new StringBuilder();
+                msg.append("file:");
+                msg.append(n.getStart());
+                msg.append(" jsp:getProperty for bean with name '");
                 msg.append(name);
                 msg.append(
                         "'. Name was not previously introduced as per JSP.5.3");

==================================================
Parser.java
index 6b88cf7893..9faa07e504 100644
--- a/java/org/apache/jasper/compiler/JspDocumentParser.java
+++ b/java/org/apache/jasper/compiler/JspDocumentParser.java
@@ -1290,7 +1290,8 @@ class JspDocumentParser
                             prefix,
                             uri,
                             location,
-                            err);
+                            err,
+                            null);
                     if (ctxt.getOptions().isCaching()) {
                         ctxt.getOptions().getCache().put(uri, result);
                     }

==================================================
TagLibraryInfoImpl.java
index 612fb55121..fc30d333b5 100644
--- a/java/org/apache/jasper/compiler/Parser.java
+++ b/java/org/apache/jasper/compiler/Parser.java
@@ -385,7 +385,8 @@ class Parser implements TagConstants {
                     if (impl == null) {
                         TldLocation location = ctxt.getTldLocation(uri);
                         impl = new TagLibraryInfoImpl(ctxt, parserController,
-                                pageInfo, prefix, uri, location, err);
+                                pageInfo, prefix, uri, location, err,
+                                reader.mark());
                         if (ctxt.getOptions().isCaching()) {
                             ctxt.getOptions().getCache().put(uri, impl);
                         }

==================================================
