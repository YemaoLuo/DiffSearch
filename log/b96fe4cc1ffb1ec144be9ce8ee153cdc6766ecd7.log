b96fe4cc1ffb1ec144be9ce8ee153cdc6766ecd7
==================================================
Fix NPE in WebappLoader that happens when stop() is called after a failed start.
==================================================
Konstantin Kolinko
==================================================
Tue Jan 8 08:22:58 2013 +0000
==================================================
WebappLoader.java
Fix NPE in WebappLoader that happens when stop() is called after a failed start.
Add tests that a context can be started again after a failure.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1430165 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestStandardContext.java
index 34bf3a0b6c..be429bdf1f 100644
--- a/java/org/apache/catalina/loader/WebappLoader.java
+++ b/java/org/apache/catalina/loader/WebappLoader.java
@@ -487,7 +487,9 @@ public class WebappLoader extends LifecycleMBeanBase
         servletContext.removeAttribute(Globals.CLASS_PATH_ATTR);
 
         // Throw away our current class loader
-        ((Lifecycle) classLoader).stop();
+        if (classLoader != null) {
+            ((Lifecycle) classLoader).stop();
+        }
 
         try {
             String contextName = context.getName();

==================================================
