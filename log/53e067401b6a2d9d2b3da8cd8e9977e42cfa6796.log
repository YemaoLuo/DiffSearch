53e067401b6a2d9d2b3da8cd8e9977e42cfa6796
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48726
==================================================
Mark Emlyn
==================================================
Wed Feb 10 23:47:11 2010 +0000
==================================================
AbstractCatalinaTask.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48726
Prevent OOME when uploading large files with the deployer
Patch provided by 'adam'

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@908759 13f79535-47bb-0310-9956-ffa450edef68



==================================================
DeployTask.java
index 19541875aa..d4c89980c6 100644
--- a/java/org/apache/catalina/ant/AbstractCatalinaTask.java
+++ b/java/org/apache/catalina/ant/AbstractCatalinaTask.java
@@ -186,6 +186,8 @@ public abstract class AbstractCatalinaTask extends BaseRedirectorHelperTask {
                 if (contentLength >= 0) {
                     hconn.setRequestProperty("Content-Length",
                                              "" + contentLength);
+                    
+                    hconn.setFixedLengthStreamingMode(contentLength);
                 }
             } else {
                 hconn.setDoOutput(false);

==================================================
