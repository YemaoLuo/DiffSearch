737b8b9c52d78955ce4d4c56b2baca9ae3f4e18e
==================================================
Revert r1519798
==================================================
Mark Emlyn
==================================================
Tue Sep 3 19:06:52 2013 +0000
==================================================
CoyoteInputStream.java
Revert r1519798
I realised it wouldn't work just as I hit commit.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1519799 13f79535-47bb-0310-9956-ffa450edef68



==================================================
CoyoteOutputStream.java
index 2a2780cf3d..02aad199c1 100644
--- a/java/org/apache/catalina/connector/CoyoteInputStream.java
+++ b/java/org/apache/catalina/connector/CoyoteInputStream.java
@@ -40,7 +40,6 @@ public class CoyoteInputStream extends ServletInputStream {
 
 
     protected InputBuffer ib;
-    private volatile Boolean ready = null;
 
 
     protected CoyoteInputStream(InputBuffer ib) {
@@ -241,8 +240,7 @@ public class CoyoteInputStream extends ServletInputStream {
 
     @Override
     public boolean isReady() {
-        ready = Boolean.valueOf(ib.isReady());
-        return ready.booleanValue();
+        return ib.isReady();
     }
 
 
@@ -253,10 +251,9 @@ public class CoyoteInputStream extends ServletInputStream {
 
 
     private void checkNonBlockingRead() {
-        if (ib.isBlocking() && (ready == null || !ready.booleanValue())) {
+        if (ib.isBlocking() && !ib.isReady()) {
             throw new IllegalStateException(
                     sm.getString("coyoteInputStream.nbNotready"));
         }
-        ready = null;
     }
 }

==================================================
