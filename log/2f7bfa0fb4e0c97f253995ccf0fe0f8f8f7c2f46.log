2f7bfa0fb4e0c97f253995ccf0fe0f8f8f7c2f46
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57455
==================================================
Mark Thomas
==================================================
Wed Jan 21 10:08:15 2015 +0000
==================================================
Bootstrap.java
index ad860ac680..747f14b985 100644
--- a/conf/catalina.properties
+++ b/conf/catalina.properties
@@ -48,6 +48,8 @@ org.apache.jasper.,org.apache.naming.,org.apache.tomcat.
 #
 # Note: Values are enclosed in double quotes ("...") in case either the
 #       ${catalina.base} path or the ${catalina.home} path contains a comma.
+#       Because double quotes are used for quoting, the double quote character
+#       may not appear in a path.
 common.loader="${catalina.base}/lib","${catalina.base}/lib/*.jar","${catalina.home}/lib","${catalina.home}/lib/*.jar"
 
 #
@@ -61,6 +63,11 @@ common.loader="${catalina.base}/lib","${catalina.base}/lib/*.jar","${catalina.ho
 #     "foo/*.jar": Add all the JARs of the specified folder as class
 #                  repositories
 #     "foo/bar.jar": Add bar.jar as a class repository
+#
+# Note: Values may be enclosed in double quotes ("...") in case either the
+#       ${catalina.base} path or the ${catalina.home} path contains a comma.
+#       Because double quotes are used for quoting, the double quote character
+#       may not appear in a path.
 server.loader=
 
 #
@@ -75,6 +82,11 @@ server.loader=
 #     "foo/bar.jar": Add bar.jar as a class repository
 # Please note that for single jars, e.g. bar.jar, you need the URL form
 # starting with file:.
+#
+# Note: Values may be enclosed in double quotes ("...") in case either the
+#       ${catalina.base} path or the ${catalina.home} path contains a comma.
+#       Because double quotes are used for quoting, the double quote character
+#       may not appear in a path.
 shared.loader=
 
 # Default list of JAR files that should not be scanned using the JarScanner

==================================================
TestBootstrap.java
index bc39b4d84c..c2973fac98 100644
--- a/java/org/apache/catalina/startup/Bootstrap.java
+++ b/java/org/apache/catalina/startup/Bootstrap.java
@@ -568,14 +568,28 @@ public final class Bootstrap {
             String path = value.substring(matcher.start(), matcher.end());
 
             path = path.trim();
+            if (path.length() == 0) {
+                continue;
+            }
 
-            if (path.startsWith("\"") && path.length() > 1) {
+            char first = path.charAt(0);
+            char last = path.charAt(path.length() - 1);
+
+            if (first == '"' && last == '"' && path.length() > 1) {
                 path = path.substring(1, path.length() - 1);
                 path = path.trim();
-            }
-
-            if (path.length() == 0) {
-                continue;
+                if (path.length() == 0) {
+                    continue;
+                }
+            } else if (path.contains("\"")) {
+                // Unbalanced quotes
+                // Too early to use standard i18n support. The class path hasn't
+                // been configured.
+                throw new IllegalArgumentException(
+                        "The double quote [\"] character only be used to quote paths. It must " +
+                        "not appear in a path. This loader path is not valid: [" + value + "]");
+            } else {
+                // Not quoted - NO-OP
             }
 
             result.add(path);

==================================================
