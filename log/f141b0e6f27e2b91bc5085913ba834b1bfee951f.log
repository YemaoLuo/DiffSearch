f141b0e6f27e2b91bc5085913ba834b1bfee951f
==================================================
Ensure that /WEB-INF/classes is never processed as a web fragment.
==================================================
Mark Thomas
==================================================
Fri Feb 5 13:39:13 2016 +0000
==================================================
FragmentJarScannerCallback.java
Ensure that /WEB-INF/classes is never processed as a web fragment.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1728664 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Constants.java
index 06103d1323..2b51fc0c54 100644
--- a/java/org/apache/tomcat/util/descriptor/web/FragmentJarScannerCallback.java
+++ b/java/org/apache/tomcat/util/descriptor/web/FragmentJarScannerCallback.java
@@ -111,6 +111,11 @@ public class FragmentJarScannerCallback implements JarScannerCallback {
     @Override
     public void scan(File file, String webappPath, boolean isWebapp) throws IOException {
 
+        // Fragments unpacked in WEB-INF/classes are not handled
+        if ("/WEB-INF/classes".equals(webappPath)) {
+            return;
+        }
+
         WebXml fragment = new WebXml();
         fragment.setWebappJar(isWebapp);
         fragment.setDelegate(delegate);

==================================================
StandardJarScanner.java
index 2f7db18809..3da1da7774 100644
--- a/java/org/apache/tomcat/util/scan/Constants.java
+++ b/java/org/apache/tomcat/util/scan/Constants.java
@@ -33,6 +33,7 @@ public final class Constants {
     /* Commons strings */
     public static final String JAR_EXT = ".jar";
     public static final String WEB_INF_LIB = "/WEB-INF/lib/";
+    public static final String WEB_INF_CLASSES = "/WEB-INF/classes";
 
     /* Context attributes - used to pass short-cuts to Jasper */
     public static final String MERGED_WEB_XML =

==================================================
