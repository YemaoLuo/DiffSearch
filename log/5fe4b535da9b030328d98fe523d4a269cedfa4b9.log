5fe4b535da9b030328d98fe523d4a269cedfa4b9
==================================================
Add support for configuring session cookies and session tracking in web.xml
==================================================
Mark Emlyn
==================================================
Tue Dec 29 17:33:22 2009 +0000
==================================================
SessionConfig.java
Add support for configuring session cookies and session tracking in web.xml

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@894450 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WebRuleSet.java
index 63ffd540a5..176d99e5de 100644
--- a/java/org/apache/catalina/startup/LocalStrings.properties
+++ b/java/org/apache/catalina/startup/LocalStrings.properties
@@ -130,6 +130,14 @@ webXml.mergeConflictLoginConfig=A LoginConfig was defined inconsistently in mult
 webXml.mergeConflictOrder=Fragment relative ordering contains circular references. Thsi can be resolved by using absolute ordering in web.xml.
 webXml.mergeConflictResource=The Resource [{0}] was defined inconsistently in multiple fragments including fragment with name [{1}] located at [{2}]
 webXml.mergeConflictFilter=The Servlet [{0}] was defined inconsistently in multiple fragments including fragment with name [{1}] located at [{2}]
+webXml.mergeConflictSessionCookieName=The session cookie name was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionCookieDomain=The session cookie domain was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionCookiePath=The session cookie path was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionCookieComment=The session cookie comment was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionCookieHttpOnly=The session cookie http-only flag was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionCookieSecure=The session cookie secure flag was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionCookieMaxAge=The session cookie max-age was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
 webXml.mergeConflictSessionTimeout=The session timeout was defined inconsistently in multiple fragments with different values including fragment with name [{0}] located at [{1}]
+webXml.mergeConflictSessionTrackingMode=The session tracking modes were defined inconsistently in multiple fragments including fragment with name [{0}] located at [{1}]
 webXml.mergeConflictString=The [{0}] with name [{1}] was defined inconsistently in multiple fragments including fragment with name [{2}] located at [{3}]
 webXml.multipleOther=Multiple others entries in ordering

==================================================
WebXml.java
index 41c7129b47..ec6454c8c4 100644
--- a/java/org/apache/catalina/startup/WebRuleSet.java
+++ b/java/org/apache/catalina/startup/WebRuleSet.java
@@ -400,11 +400,29 @@ public class WebRuleSet extends RuleSetBase {
         digester.addCallParam(fullPrefix + "/servlet-mapping/servlet-name", 1);
         digester.addRule(fullPrefix + "/servlet-mapping/url-pattern", new CallParamMultiRule(0));
 
-        digester.addRule(fullPrefix + "/session-config",
-                         sessionConfig);
-        
+        digester.addRule(fullPrefix + "/session-config", sessionConfig);
+        digester.addObjectCreate(fullPrefix + "/session-config",
+                                 "org.apache.catalina.deploy.SessionConfig");
+        digester.addSetNext(fullPrefix + "/session-config", "setSessionConfig",
+                            "org.apache.catalina.deploy.SessionConfig");
         digester.addCallMethod(fullPrefix + "/session-config/session-timeout",
                                "setSessionTimeout", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/name",
+                               "setCookieName", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/domain",
+                               "setCookieDomain", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/path",
+                               "setCookiePath", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/comment",
+                               "setCookieComment", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/http-only",
+                               "setCookieHttpOnly", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/secure",
+                               "setCookieSecure", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/cookie-config/max-age",
+                               "setCookieMaxAge", 0);
+        digester.addCallMethod(fullPrefix + "/session-config/tracking-mode",
+                               "addSessionTrackingMode", 0);
 
         // Taglibs pre Servlet 2.4
         digester.addRule(fullPrefix + "/taglib", new TaglibLocationRule(false));

==================================================
