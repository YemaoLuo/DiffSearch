6090a479f671463b147505a7aa99c0eb94f9d889
==================================================
Another fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=60013
==================================================
Mark Thomas
==================================================
Tue Sep 20 19:20:46 2016 +0000
==================================================
RewriteValve.java
Another fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=60013
Fix QSA handling when there is no query string

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1761625 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestRewriteValve.java
index 005c445b1d..116145586a 100644
--- a/java/org/apache/catalina/valves/rewrite/RewriteValve.java
+++ b/java/org/apache/catalina/valves/rewrite/RewriteValve.java
@@ -532,7 +532,8 @@ public class RewriteValve extends ValveBase {
                         chunk = request.getCoyoteRequest().queryString().getCharChunk();
                         chunk.recycle();
                         chunk.append(ENCODER.encode(queryStringDecoded, uriEncoding));
-                        if (qsa) {
+                        if (qsa && originalQueryStringEncoded != null &&
+                                originalQueryStringEncoded.length() > 0) {
                             chunk.append('&');
                             chunk.append(originalQueryStringEncoded);
                         }

==================================================
