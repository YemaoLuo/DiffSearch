8111046353fb8fe7d2307b831a3ccdef9cb0b435
==================================================
Make initial Window size configurable.
==================================================
Mark Thomas
==================================================
Sun Jul 26 18:34:42 2015 +0000
==================================================
Http2Protocol.java
Make initial Window size configurable.
Define some constants for default configuration settings

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1692743 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http2UpgradeHandler.java
index 965f80aaee..5fb350d922 100644
--- a/java/org/apache/coyote/http2/Http2Protocol.java
+++ b/java/org/apache/coyote/http2/Http2Protocol.java
@@ -29,17 +29,26 @@ import org.apache.tomcat.util.net.SocketWrapperBase;
 
 public class Http2Protocol implements UpgradeProtocol {
 
-    private static final long DEFAULT_MAX_CONCURRENT_STREAMS = 200;
+    static final long DEFAULT_READ_TIMEOUT = 10000;
+    static final long DEFAULT_KEEP_ALIVE_TIMEOUT = 30000;
+    static final long DEFAULT_WRITE_TIMEOUT = 10000;
+    // The HTTP/2 specification recommends a minimum default of 100
+    static final long DEFAULT_MAX_CONCURRENT_STREAMS = 200;
+    // This default is defined by the HTTP/2 specification
+    static final int DEFAULT_INITIAL_WINDOW_SIZE = (1 << 16) - 1;
 
     private static final String HTTP_UPGRADE_NAME = "h2c";
     private static final String ALPN_NAME = "h2";
     private static final byte[] ALPN_IDENTIFIER = ALPN_NAME.getBytes(StandardCharsets.UTF_8);
 
     // All timeouts in milliseconds
-    private long readTimeout = 10000;
-    private long keepAliveTimeout = 30000;
-    private long writeTimeout = 10000;
+    private long readTimeout = DEFAULT_READ_TIMEOUT;
+    private long keepAliveTimeout = DEFAULT_KEEP_ALIVE_TIMEOUT;
+    private long writeTimeout = DEFAULT_WRITE_TIMEOUT;
     private long maxConcurrentStreams = DEFAULT_MAX_CONCURRENT_STREAMS;
+    // If a lower initial value is required, set it here but DO NOT change the
+    // default defined above.
+    private int initialWindowSize = DEFAULT_INITIAL_WINDOW_SIZE;
 
     @Override
     public String getHttpUpgradeName(boolean isSecure) {
@@ -77,6 +86,7 @@ public class Http2Protocol implements UpgradeProtocol {
         result.setKeepAliveTimeout(getKeepAliveTimeout());
         result.setWriteTimeout(getWriteTimeout());
         result.setMaxConcurrentStreams(getMaxConcurrentStreams());
+        result.setInitialWindowSize(getInitialWindowSize());
 
         return result;
     }
@@ -142,4 +152,14 @@ public class Http2Protocol implements UpgradeProtocol {
     public void setMaxConcurrentStreams(long maxConcurrentStreams) {
         this.maxConcurrentStreams = maxConcurrentStreams;
     }
+
+
+    public int getInitialWindowSize() {
+        return initialWindowSize;
+    }
+
+
+    public void setInitialWindowSize(int initialWindowSize) {
+        this.initialWindowSize = initialWindowSize;
+    }
 }

==================================================
