5611409bd65a230863f88851121cae30f99ebee6
==================================================
Access base directly
==================================================
Mark Thomas
==================================================
Tue Jan 27 19:37:37 2015 +0000
==================================================
AbstractArchiveResource.java
Access base directly

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1655127 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JarResource.java
index 9c24f8d4f4..52ecad2467 100644
--- a/java/org/apache/catalina/webresources/AbstractArchiveResource.java
+++ b/java/org/apache/catalina/webresources/AbstractArchiveResource.java
@@ -28,7 +28,6 @@ import java.util.jar.Manifest;
 public abstract class AbstractArchiveResource extends AbstractResource {
 
     private final AbstractArchiveResourceSet archiveResourceSet;
-    private final String base;
     private final String baseUrl;
     private final JarEntry resource;
     private final String codeBaseUrl;
@@ -37,11 +36,9 @@ public abstract class AbstractArchiveResource extends AbstractResource {
     private Certificate[] certificates;
 
     protected AbstractArchiveResource(AbstractArchiveResourceSet archiveResourceSet,
-            String webAppPath, String base, String baseUrl, JarEntry jarEntry,
-            String codeBaseUrl) {
+            String webAppPath, String baseUrl, JarEntry jarEntry, String codeBaseUrl) {
         super(archiveResourceSet.getRoot(), webAppPath);
         this.archiveResourceSet = archiveResourceSet;
-        this.base = base;
         this.baseUrl = baseUrl;
         this.resource = jarEntry;
         this.codeBaseUrl = codeBaseUrl;
@@ -65,7 +62,7 @@ public abstract class AbstractArchiveResource extends AbstractResource {
     }
 
     protected final String getBase() {
-        return base;
+        return archiveResourceSet.getBase();
     }
 
     protected final String getBaseUrl() {

==================================================
JarResourceSet.java
index dcd095c382..4f08102036 100644
--- a/java/org/apache/catalina/webresources/JarResource.java
+++ b/java/org/apache/catalina/webresources/JarResource.java
@@ -33,9 +33,8 @@ public class JarResource extends AbstractArchiveResource {
     private static final Log log = LogFactory.getLog(JarResource.class);
 
     public JarResource(AbstractArchiveResourceSet archiveResourceSet, String webAppPath,
-            String base, String baseUrl, JarEntry jarEntry) {
-        super(archiveResourceSet, webAppPath, base, "jar:" + baseUrl, jarEntry,
-                baseUrl);
+            String baseUrl, JarEntry jarEntry) {
+        super(archiveResourceSet, webAppPath, "jar:" + baseUrl, jarEntry, baseUrl);
     }
 
     @Override

==================================================
JarWarResource.java
index 183bf94517..c9049061e6 100644
--- a/java/org/apache/catalina/webresources/JarResourceSet.java
+++ b/java/org/apache/catalina/webresources/JarResourceSet.java
@@ -78,7 +78,7 @@ public class JarResourceSet extends AbstractArchiveResourceSet {
     @Override
     protected WebResource createArchiveResource(JarEntry jarEntry,
             String webAppPath, Manifest manifest) {
-        return new JarResource(this, webAppPath, getBase(), getBaseUrlString(), jarEntry);
+        return new JarResource(this, webAppPath, getBaseUrlString(), jarEntry);
     }
 
     //-------------------------------------------------------- Lifecycle methods

==================================================
JarWarResourceSet.java
index 1bc51266a7..6e59e7d7a9 100644
--- a/java/org/apache/catalina/webresources/JarWarResource.java
+++ b/java/org/apache/catalina/webresources/JarWarResource.java
@@ -36,8 +36,8 @@ public class JarWarResource extends AbstractArchiveResource {
     private final String archivePath;
 
     public JarWarResource(AbstractArchiveResourceSet archiveResourceSet, String webAppPath,
-            String base, String baseUrl, JarEntry jarEntry, String archivePath) {
-        super(archiveResourceSet, webAppPath, base, "jar:war:" + baseUrl + "^/" + archivePath,
+            String baseUrl, JarEntry jarEntry, String archivePath) {
+        super(archiveResourceSet, webAppPath, "jar:war:" + baseUrl + "^/" + archivePath,
                 jarEntry, "jar:" + baseUrl + "!/" + archivePath);
         this.archivePath = archivePath;
     }

==================================================
