1c83d3ad6a5bcad785f3a56cb1dc80a1a9d30cee
==================================================
- Slightly updated behavior for setCharEnc, and allow setting a session cookie from an included
==================================================
Remy Maucherat
==================================================
Tue Apr 4 00:01:51 2006 +0000
==================================================
Request.java
- Slightly updated behavior for setCharEnc, and allow setting a session cookie from an included
  resource in some cases.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@391183 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index faf0d421a0..94140c47e3 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -1421,6 +1421,9 @@ public class Request
     public void setCharacterEncoding(String enc)
         throws UnsupportedEncodingException {
 
+        if (usingReader)
+            return;
+        
         // Ensure that the specified encoding is valid
         byte buffer[] = new byte[1];
         buffer[0] = (byte) 'a';
@@ -2231,7 +2234,7 @@ public class Request
             Cookie cookie = new Cookie(Globals.SESSION_COOKIE_NAME,
                                        session.getIdInternal());
             configureSessionCookie(cookie);
-            response.addCookie(cookie);
+            response.addCookieInternal(cookie);
         }
 
         if (session != null) {

==================================================
