7efb5fb0a40bbb21d288e26585820809d3cc9f70
==================================================
Fix the remaining TODO in the new cookie parser
==================================================
Mark Emlyn
==================================================
Tue Sep 2 15:55:59 2014 +0000
==================================================
Cookie.java
Fix the remaining TODO in the new cookie parser

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1622040 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestCookies.java
index 5dd18bf4a2..2704502088 100644
--- a/java/org/apache/tomcat/util/http/parser/Cookie.java
+++ b/java/org/apache/tomcat/util/http/parser/Cookie.java
@@ -362,8 +362,7 @@ public class Cookie {
     private static void skipInvalidCookie(ByteBuffer bb) {
         logInvalidHeader(bb);
         // Invalid cookie value. Skip to the next semi-colon
-        // TODO Could be a comma
-        skipUntilSemiColon(bb);
+        skipUntilSemiColonOrComma(bb);
     }
 
     private static void skipLWS(ByteBuffer bb) {
@@ -386,6 +385,16 @@ public class Cookie {
     }
 
 
+    private static void skipUntilSemiColonOrComma(ByteBuffer bb) {
+        while(bb.hasRemaining()) {
+            byte b = bb.get();
+            if (b == SEMICOLON_BYTE || b == COMMA_BYTE) {
+                break;
+            }
+        }
+    }
+
+
     private static SkipResult skipByte(ByteBuffer bb, byte target) {
 
         if (!bb.hasRemaining()) {

==================================================
