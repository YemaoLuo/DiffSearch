3e7fd959c4c205f04031d054e85976e3b36e1fa5
==================================================
Code clean-up
==================================================
Mark Emlyn
==================================================
Sat Sep 18 11:53:19 2010 +0000
==================================================
JIoEndpoint.java
Code clean-up
Align end-point behaviours. Should then be easier to apply async chnages.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@998446 13f79535-47bb-0310-9956-ffa450edef68



==================================================
NioEndpoint.java
index 8371449f83..2200c9da86 100644
--- a/java/org/apache/tomcat/util/net/JIoEndpoint.java
+++ b/java/org/apache/tomcat/util/net/JIoEndpoint.java
@@ -180,8 +180,11 @@ public class JIoEndpoint extends AbstractEndpoint {
                     }
                 }
 
-                // Accept the next incoming connection from the server socket
+                if (!running) {
+                    break;
+                }
                 try {
+                    // Accept the next incoming connection from the server socket
                     Socket socket = serverSocketFactory.acceptSocket(serverSocket);
                     serverSocketFactory.initSocket(socket);
                     // Hand this socket off to an appropriate processor

==================================================
