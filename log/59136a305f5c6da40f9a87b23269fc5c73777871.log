59136a305f5c6da40f9a87b23269fc5c73777871
==================================================
Fix canonicalization of IPv6 addresses ending in "::"
==================================================
Mark Thomas
==================================================
Mon Jun 15 17:55:38 2020 +0100
==================================================
IPv6Utils.java
Fix canonicalization of IPv6 addresses ending in "::"

Based on a patch by syarramsetty-skyhook


==================================================
TestIPv6Utils.java
index 94b8c49d49..bccc0a2683 100644
--- a/java/org/apache/tomcat/util/net/IPv6Utils.java
+++ b/java/org/apache/tomcat/util/net/IPv6Utils.java
@@ -109,7 +109,7 @@ public class IPv6Utils {
         int length = ipv6AddressLength;
         int change = 0;
 
-        if (colonsPos >= 0 && colonsPos < ipv6AddressLength - 2) {
+        if (colonsPos >= 0 && colonsPos < ipv6AddressLength - 1) {
             int colonCounter = 0;
             for (int i = 0; i < ipv6AddressLength; i++) {
                 if (ipv6Address.charAt(i) == ':') {

==================================================
