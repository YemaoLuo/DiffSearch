35cc1aba67a30a7010e16b10cf9633758142c258
==================================================
adopted changes
==================================================
Filip Hanik
==================================================
Tue May 29 16:46:23 2007 +0000
==================================================
CoyoteAdapter.java
adopted changes


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@542586 13f79535-47bb-0310-9956-ffa450edef68



==================================================
OutputBuffer.java
index d74672d4af..2c58582eee 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -207,7 +207,7 @@ public class CoyoteAdapter
                 }
                 if (response.isClosed() || !request.isComet()) {
                     res.action(ActionCode.ACTION_COMET_END, null);
-                } else if (!error && read && request.getAvailable()) {
+                } else if (!error && read && request.isReadable()) {
                     // If this was a read and not all bytes have been read, or if no data
                     // was read from the connector, then it is an error
                     error = true;
@@ -292,7 +292,7 @@ public class CoyoteAdapter
 
                 if (request.isComet()) {
                     if (!response.isClosed() && !response.isError()) {
-                        if (request.getAvailable()) {
+                        if (request.isReadable()) {
                             // Invoke a read event right away if there are available bytes
                             if (event(req, res, SocketStatus.OPEN_READ)) {
                                 comet = true;

==================================================
Request.java
index 4f282a2f8d..c7e98da3cf 100644
--- a/java/org/apache/catalina/connector/OutputBuffer.java
+++ b/java/org/apache/catalina/connector/OutputBuffer.java
@@ -323,6 +323,14 @@ public class OutputBuffer extends Writer
 
     }
 
+    
+    /**
+     * Return the amount of bytes written by the lower layer.
+     */
+    protected int lastWrite() {
+        return coyoteResponse.getLastWrite();
+    }
+    
 
     // ------------------------------------------------- Bytes Handling Methods
 

==================================================
Response.java
index e05ebdf22e..73efb8e003 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -2252,7 +2252,7 @@ public class Request
     /**
      * Return true if bytes are available.
      */
-    public boolean getAvailable() {
+    public boolean isReadable() {
         return (inputBuffer.available() > 0);
     }
 

==================================================
Response.java
index 4561d22b5c..acb59c100e 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -529,6 +529,14 @@ public class Response
     }
 
 
+    /**
+     * Return true if bytes are available.
+     */
+    public boolean isWriteable() {
+        return (outputBuffer.lastWrite() > 0);
+    }
+
+    
     // ------------------------------------------------ ServletResponse Methods
 
 

==================================================
