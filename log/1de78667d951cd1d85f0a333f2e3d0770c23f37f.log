1de78667d951cd1d85f0a333f2e3d0770c23f37f
==================================================
System.load() expects absolute path.
==================================================
Igal Sapir
==================================================
Thu Oct 4 21:07:54 2018 +0000
==================================================
Library.java
System.load() expects absolute path.

Error message was being discarded during tests so now it is logged.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1842849 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TesterSupport.java
index 2ab9d82073..67a6bd9961 100644
--- a/java/org/apache/tomcat/jni/Library.java
+++ b/java/org/apache/tomcat/jni/Library.java
@@ -39,7 +39,7 @@ public final class Library {
         for (int i = 0; i < NAMES.length; i++) {
             File library = new File(binLib, System.mapLibraryName(NAMES[i]));
             try {
-                System.load(library.getPath());
+                System.load(library.getAbsolutePath());
                 loaded = true;
             } catch (ThreadDeath t) {
                 throw t;
@@ -83,7 +83,7 @@ public final class Library {
                             throw t;
                         }
                     }
-                    if (i > 0) {
+                    if (err.length() > 0) {
                         err.append(", ");
                     }
                     err.append(t.getMessage());

==================================================
TestOpenSSLConf.java
index b9e19114b6..6631dbf9ee 100644
--- a/test/org/apache/tomcat/util/net/TesterSupport.java
+++ b/test/org/apache/tomcat/util/net/TesterSupport.java
@@ -72,6 +72,7 @@ public final class TesterSupport {
     public static final String LOCALHOST_KEY_PEM = SSL_DIR + "localhost-key.pem";
     public static final boolean OPENSSL_AVAILABLE;
     public static final int OPENSSL_VERSION;
+    public static final String OPENSSL_ERROR;
 
     public static final String ROLE = "testrole";
 
@@ -82,16 +83,18 @@ public final class TesterSupport {
     static {
         boolean available = false;
         int version = 0;
+        String err = "";
         try {
             Library.initialize(null);
             available = true;
             version = SSL.version();
             Library.terminate();
         } catch (Exception | LibraryNotFoundError ex) {
-            // Ignore
+            err = ex.getMessage();
         }
         OPENSSL_AVAILABLE = available;
         OPENSSL_VERSION = version;
+        OPENSSL_ERROR = err;
     }
 
     public static boolean isOpensslAvailable() {

==================================================
