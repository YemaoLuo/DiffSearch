2d0450950ecaa004e5a95ebd392438a5cc451f92
==================================================
Pull up hasMoreDataToFlush()
==================================================
Mark Thomas
==================================================
Thu Jan 1 17:13:54 2015 +0000
==================================================
AbstractOutputBuffer.java
Pull up hasMoreDataToFlush()

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1648898 13f79535-47bb-0310-9956-ffa450edef68



==================================================
InternalAprOutputBuffer.java
index 27461b9c62..65335fd6bd 100644
--- a/java/org/apache/coyote/http11/AbstractOutputBuffer.java
+++ b/java/org/apache/coyote/http11/AbstractOutputBuffer.java
@@ -588,10 +588,15 @@ public abstract class AbstractOutputBuffer<S> implements OutputBuffer {
 
     //------------------------------------------------------ Non-blocking writes
 
-    protected abstract boolean hasMoreDataToFlush();
     protected abstract void registerWriteInterest() throws IOException;
 
 
+    protected boolean hasMoreDataToFlush() {
+        return (writeBufferFlipped && socketWriteBuffer.remaining() > 0) ||
+        (!writeBufferFlipped && socketWriteBuffer.position() > 0);
+    }
+
+
     /**
      * Writes any remaining buffered data.
      *

==================================================
InternalNio2OutputBuffer.java
index d886561f7f..8ea6d59b47 100644
--- a/java/org/apache/coyote/http11/InternalAprOutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalAprOutputBuffer.java
@@ -297,8 +297,7 @@ public class InternalAprOutputBuffer extends AbstractOutputBuffer<Long> {
 
     @Override
     protected synchronized boolean hasMoreDataToFlush() {
-        return (writeBufferFlipped && socketWriteBuffer.remaining() > 0) ||
-                (!writeBufferFlipped && socketWriteBuffer.position() > 0);
+        return super.hasMoreDataToFlush();
     }
 
 

==================================================
InternalNioOutputBuffer.java
index 0a201503d8..b706841577 100644
--- a/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java
@@ -454,12 +454,6 @@ public class InternalNio2OutputBuffer extends AbstractOutputBuffer<Nio2Channel>
         }
     }
 
-    @Override
-    protected boolean hasMoreDataToFlush() {
-        return (writeBufferFlipped && socketWriteBuffer.remaining() > 0) ||
-                (!writeBufferFlipped && socketWriteBuffer.position() > 0);
-    }
-
     @Override
     protected boolean hasBufferedData() {
         return bufferedWrites.size() > 0;

==================================================
