aa69db56e3f50886ce1dcbc14df55c13ed9ce4ea
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53071
==================================================
Mark Emlyn
==================================================
Mon Jun 11 09:24:53 2012 +0000
==================================================
ErrorReportValve.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53071
Stepping through the code, light dawns as to what the bug report was getting at.
Use the message from the Throwable for the error report if none was specified via sendError()

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1348762 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestErrorReportValve.java
index e330152d6f..a2a4b4b43b 100644
--- a/java/org/apache/catalina/valves/ErrorReportValve.java
+++ b/java/org/apache/catalina/valves/ErrorReportValve.java
@@ -141,7 +141,11 @@ public class ErrorReportValve extends ValveBase {
 
         String message = RequestUtil.filter(response.getMessage());
         if (message == null) {
-            message = "";
+            if (throwable != null) {
+                message = RequestUtil.filter(throwable.getMessage());
+            } else {
+                message = "";
+            }
         }
 
         // Do nothing if there is no report for the specified status code

==================================================
