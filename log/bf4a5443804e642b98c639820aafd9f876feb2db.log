bf4a5443804e642b98c639820aafd9f876feb2db
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49683
==================================================
Mark Emlyn
==================================================
Tue Aug 16 19:28:06 2011 +0000
==================================================
AjpAprProtocol.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49683
Use separate timeouts for socket  Timeout and keep-alive timeout

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1158426 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11AprProtocol.java
index d314cb2c93..aa873d8f06 100644
--- a/java/org/apache/coyote/ajp/AjpAprProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpAprProtocol.java
@@ -126,7 +126,7 @@ public class AjpAprProtocol extends AbstractAjpProtocol {
             recycledProcessors.offer(processor);
             if (addToPoller) {
                 ((AprEndpoint)proto.endpoint).getPoller().add(
-                        socket.getSocket().longValue());
+                        socket.getSocket().longValue(), true);
             }
         }
 

==================================================
AprEndpoint.java
index 47a6ac4d05..7d1851c76d 100644
--- a/java/org/apache/coyote/http11/Http11AprProtocol.java
+++ b/java/org/apache/coyote/http11/Http11AprProtocol.java
@@ -217,7 +217,7 @@ public class Http11AprProtocol extends AbstractHttp11Protocol {
             recycledProcessors.offer(processor);
             if (addToPoller) {
                 ((AprEndpoint)proto.endpoint).getPoller().add(
-                        socket.getSocket().longValue());
+                        socket.getSocket().longValue(), true);
             }
         }
 
@@ -236,7 +236,7 @@ public class Http11AprProtocol extends AbstractHttp11Protocol {
                 socket.setAsync(true);
             } else if (processor.comet) {
                 ((AprEndpoint) proto.endpoint).getCometPoller().add(
-                        socket.getSocket().longValue());
+                        socket.getSocket().longValue(), false);
             }
         }
 

==================================================
