0c698bc6e9f60d20980dab6389c6f30931e95c53
==================================================
Review action code usage across HTTP and AJP processors
==================================================
Mark Emlyn
==================================================
Fri Aug 30 09:50:30 2013 +0000
==================================================
CoyoteAdapter.java
Review action code usage across HTTP and AJP processors
- remove the unused POST_REQUEST action
- align ordering between AJP and HTTP for easier comparison
- add missing actions to AJP for implementation / review (see TODOs)
- document known NO-OPs for AJP
- ensure trying to use comet over AJP triggers an error

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1518926 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ActionCode.java
index 4ebf787c40..8a23c05e4a 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -425,7 +425,6 @@ public class CoyoteAdapter implements Adapter {
             if (!request.isAsync() && !comet) {
                 request.finishRequest();
                 response.finishResponse();
-                req.action(ActionCode.POST_REQUEST , null);
                 request.getMappingData().context.logAccess(
                         request, response,
                         System.currentTimeMillis() - req.getStartTime(),
@@ -561,7 +560,6 @@ public class CoyoteAdapter implements Adapter {
                             System.currentTimeMillis() - req.getStartTime(),
                             false);
                 }
-                req.action(ActionCode.POST_REQUEST , null);
             }
 
         } catch (IOException e) {

==================================================
AbstractAjpProcessor.java
index 5d4ccc179f..c3b60ff95c 100644
--- a/java/org/apache/coyote/ActionCode.java
+++ b/java/org/apache/coyote/ActionCode.java
@@ -40,12 +40,6 @@ public enum ActionCode {
 
     RESET,
 
-    /**
-     * Hook called after request, but before recycling. Can be used for logging,
-     * to update counters, custom cleanup - the request is still visible
-     */
-    POST_REQUEST,
-
     /**
      * Hook called if swallowing request input should be disabled.
      * Example: Cancel a large file upload.

==================================================
AbstractHttp11Processor.java
index a7f64905b2..c396063191 100644
--- a/java/org/apache/coyote/ajp/LocalStrings.properties
+++ b/java/org/apache/coyote/ajp/LocalStrings.properties
@@ -15,6 +15,7 @@
 ajpnioprotocol.releaseStart=Iterating through our connections to release a socket channel [{0}]
 ajpnioprotocol.releaseEnd=Done iterating through our connections to release a socket channel [{0}] released [{1}]
 
+ajpprocessor.comet.notsupported=Comet is not supported by the AJP protocol
 ajpprocessor.failedread=Socket read failed
 ajpprocessor.failedsend=Failed to send AJP message
 ajpprocessor.header.error=Header message parsing failed

==================================================
