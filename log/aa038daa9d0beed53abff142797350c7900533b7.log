aa038daa9d0beed53abff142797350c7900533b7
==================================================
Correctly use the readFully method. Add a utility method to sort absolute order
==================================================
Filip Hanik
==================================================
Thu Feb 17 16:23:44 2011 +0000
==================================================
AbsoluteOrder.java
Correctly use the readFully method. Add a utility method to sort absolute order


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1071677 13f79535-47bb-0310-9956-ffa450edef68



==================================================
RpcMessage.java
index e0adb5af86..e806a33fcd 100644
--- a/java/org/apache/catalina/tribes/group/AbsoluteOrder.java
+++ b/java/org/apache/catalina/tribes/group/AbsoluteOrder.java
@@ -19,6 +19,7 @@ package org.apache.catalina.tribes.group;
 import java.io.Serializable;
 import java.util.Arrays;
 import java.util.Comparator;
+import java.util.List;
 
 import org.apache.catalina.tribes.Member;
 
@@ -53,10 +54,14 @@ public class AbsoluteOrder {
 
 
     public static void absoluteOrder(Member[] members) {
-        if ( members == null || members.length == 0 ) return;
+        if ( members == null || members.length <= 1 ) return;
         Arrays.sort(members,comp);
     }
     
+    public static void absoluteOrder(List<Member> members) {
+        if ( members == null || members.size() <= 1 ) return;
+        java.util.Collections.sort(members, comp);
+    }
     
     public static class AbsoluteComparator implements Comparator<Member>,
             Serializable {

==================================================
MemberImpl.java
index 3e48d86875..6c6d6f83ad 100644
--- a/java/org/apache/catalina/tribes/group/RpcMessage.java
+++ b/java/org/apache/catalina/tribes/group/RpcMessage.java
@@ -56,10 +56,10 @@ public class RpcMessage implements Externalizable {
         reply = in.readBoolean();
         int length = in.readInt();
         uuid = new byte[length];
-        in.read(uuid, 0, length);
+        in.readFully(uuid);
         length = in.readInt();
         rpcId = new byte[length];
-        in.read(rpcId, 0, length);
+        in.readFully(rpcId);
         message = (Serializable)in.readObject();
     }
 
@@ -100,10 +100,10 @@ public class RpcMessage implements Externalizable {
             reply = true;
             int length = in.readInt();
             uuid = new byte[length];
-            in.read(uuid, 0, length);
+            in.readFully(uuid);
             length = in.readInt();
             rpcId = new byte[length];
-            in.read(rpcId, 0, length);
+            in.readFully(rpcId);
         }
 
         @Override

==================================================
AbstractReplicatedMap.java
index 22128329ab..1829144aac 100644
--- a/java/org/apache/catalina/tribes/membership/MemberImpl.java
+++ b/java/org/apache/catalina/tribes/membership/MemberImpl.java
@@ -622,7 +622,7 @@ public class MemberImpl implements Member, java.io.Externalizable {
     public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
         int length = in.readInt();
         byte[] message = new byte[length];
-        in.read(message);
+        in.readFully(message);
         getMember(message,this);
 
     }

==================================================
