4a9ff22e0c81788b19399d5b68e3b53708a3a4f7
==================================================
Ensure that JASPIC's CallbackHandler is thread-safe.
==================================================
Mark Thomas
==================================================
Mon May 9 18:18:05 2016 +0000
==================================================
AuthenticatorBase.java
Ensure that JASPIC's CallbackHandler is thread-safe.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1743019 13f79535-47bb-0310-9956-ffa450edef68



==================================================
CallbackHandlerImpl.java
index d8df02fe4b..65a77c3ca2 100644
--- a/java/org/apache/catalina/authenticator/AuthenticatorBase.java
+++ b/java/org/apache/catalina/authenticator/AuthenticatorBase.java
@@ -455,7 +455,7 @@ public abstract class AuthenticatorBase extends ValveBase
             messageInfo = new MessageInfoImpl(request.getRequest(), response.getResponse(), true);
             try {
                 ServerAuthConfig serverAuthConfig = jaspicProvider.getServerAuthConfig(
-                        "HttpServlet", jaspicAppContextID, new CallbackHandlerImpl());
+                        "HttpServlet", jaspicAppContextID, CallbackHandlerImpl.getInstance());
                 String authContextID = serverAuthConfig.getAuthContextID(messageInfo);
                 serverAuthContext = serverAuthConfig.getAuthContext(authContextID, null, null);
             } catch (AuthException e) {
@@ -1058,7 +1058,7 @@ public abstract class AuthenticatorBase extends ValveBase
             ServerAuthContext serverAuthContext;
             try {
                 ServerAuthConfig serverAuthConfig = provider.getServerAuthConfig("HttpServlet",
-                        jaspicAppContextID, new CallbackHandlerImpl());
+                        jaspicAppContextID, CallbackHandlerImpl.getInstance());
                 String authContextID = serverAuthConfig.getAuthContextID(messageInfo);
                 serverAuthContext = serverAuthConfig.getAuthContext(authContextID, null, null);
                 serverAuthContext.cleanSubject(messageInfo, client);

==================================================
