f074781590f1b8cad21af5b719aeb8053b7dd494
==================================================
Make the xmlBlockExternal option in Catalina and Jasper to be true by default.
==================================================
Konstantin Kolinko
==================================================
Wed Jan 29 21:19:57 2014 +0000
==================================================
StandardContext.java
Make the xmlBlockExternal option in Catalina and Jasper to be true by default.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1562597 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspC.java
index b166513200..a5df78338b 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -675,7 +675,7 @@ public class StandardContext extends ContainerBase
     /**
      * Attribute used to turn on/off the use of external entities.
      */
-    private boolean xmlBlockExternal = Globals.IS_SECURITY_ENABLED;
+    private boolean xmlBlockExternal = true;
 
 
     /**

==================================================
ImplicitTagLibraryInfo.java
index 9b7b53de11..44e078c0be 100644
--- a/java/org/apache/jasper/JspC.java
+++ b/java/org/apache/jasper/JspC.java
@@ -135,6 +135,7 @@ public class JspC extends Task implements Options {
     protected static final String SWITCH_DUMP_SMAP = "-dumpsmap";
     protected static final String SWITCH_VALIDATE_TLD = "-validateTld";
     protected static final String SWITCH_BLOCK_EXTERNAL = "-blockExternal";
+    protected static final String SWITCH_NO_BLOCK_EXTERNAL = "-no-blockExternal";
     protected static final String SHOW_SUCCESS ="-s";
     protected static final String LIST_ERRORS = "-l";
     protected static final int INC_WEBXML = 10;
@@ -166,7 +167,7 @@ public class JspC extends Task implements Options {
     protected boolean trimSpaces = false;
     protected boolean genStringAsCharArray = false;
     protected boolean validateTld;
-    protected boolean blockExternal;
+    protected boolean blockExternal = true;
     protected boolean xpoweredBy;
     protected boolean mappedFile = false;
     protected boolean poolingEnabled = true;
@@ -377,6 +378,8 @@ public class JspC extends Task implements Options {
                 setValidateTld(true);
             } else if (tok.equals(SWITCH_BLOCK_EXTERNAL)) {
                 setBlockExternal(true);
+            } else if (tok.equals(SWITCH_NO_BLOCK_EXTERNAL)) {
+                setBlockExternal(false);
             } else {
                 if (tok.startsWith("-")) {
                     throw new JasperException("Unrecognized option: " + tok +
@@ -1452,9 +1455,8 @@ public class JspC extends Task implements Options {
         if (isValidateTld()) {
             context.setInitParameter(Constants.XML_VALIDATION_TLD_INIT_PARAM, "true");
         }
-        if (isBlockExternal()) {
-            context.setInitParameter(Constants.XML_BLOCK_EXTERNAL_INIT_PARAM, "true");
-        }
+        context.setInitParameter(Constants.XML_BLOCK_EXTERNAL_INIT_PARAM,
+                String.valueOf(isBlockExternal()));
 
         TldScanner scanner = new TldScanner(
                 context, true, isValidateTld(), isBlockExternal());

==================================================
JspDocumentParser.java
index 28e2894713..edbb9a9d6e 100644
--- a/java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java
+++ b/java/org/apache/jasper/compiler/ImplicitTagLibraryInfo.java
@@ -128,7 +128,7 @@ class ImplicitTagLibraryInfo extends TagLibraryInfo {
                                 Constants.XML_BLOCK_EXTERNAL_INIT_PARAM);
                         boolean blockExternal;
                         if (blockExternalString == null) {
-                            blockExternal = Constants.IS_SECURITY_ENABLED;
+                            blockExternal = true;
                         } else {
                             blockExternal = Boolean.parseBoolean(blockExternalString);
                         }

==================================================
TagPluginManager.java
index fca5905caa..4b1134cad9 100644
--- a/java/org/apache/jasper/compiler/JspDocumentParser.java
+++ b/java/org/apache/jasper/compiler/JspDocumentParser.java
@@ -129,7 +129,7 @@ class JspDocumentParser
                 Constants.XML_BLOCK_EXTERNAL_INIT_PARAM);
         boolean blockExternal;
         if (blockExternalString == null) {
-            blockExternal = Constants.IS_SECURITY_ENABLED;
+            blockExternal = true;
         } else {
             blockExternal = Boolean.parseBoolean(blockExternalString);
         }

==================================================
TldCache.java
index 05e9b90138..e6d6cafc32 100644
--- a/java/org/apache/jasper/compiler/TagPluginManager.java
+++ b/java/org/apache/jasper/compiler/TagPluginManager.java
@@ -66,7 +66,7 @@ public class TagPluginManager {
                 Constants.XML_BLOCK_EXTERNAL_INIT_PARAM);
         boolean blockExternal;
         if (blockExternalString == null) {
-            blockExternal = Constants.IS_SECURITY_ENABLED;
+            blockExternal = true;
         } else {
             blockExternal = Boolean.parseBoolean(blockExternalString);
         }

==================================================
JasperInitializer.java
index cfa046518b..eb7cbcd21f 100644
--- a/java/org/apache/jasper/compiler/TldCache.java
+++ b/java/org/apache/jasper/compiler/TldCache.java
@@ -78,7 +78,7 @@ public class TldCache {
                 Constants.XML_BLOCK_EXTERNAL_INIT_PARAM);
         boolean blockExternal;
         if (blockExternalString == null) {
-            blockExternal = Constants.IS_SECURITY_ENABLED;
+            blockExternal = true;
         } else {
             blockExternal = Boolean.parseBoolean(blockExternalString);
         }

==================================================
JspCServletContext.java
index 0a399cf086..b87cbc515d 100644
--- a/java/org/apache/jasper/servlet/JasperInitializer.java
+++ b/java/org/apache/jasper/servlet/JasperInitializer.java
@@ -84,7 +84,7 @@ public class JasperInitializer implements ServletContainerInitializer {
                 Constants.XML_BLOCK_EXTERNAL_INIT_PARAM);
         boolean blockExternal;
         if (blockExternalString == null) {
-            blockExternal = Constants.IS_SECURITY_ENABLED;
+            blockExternal = true;
         } else {
             blockExternal = Boolean.parseBoolean(blockExternalString);
         }

==================================================
