fac62acab1ebcf94bf50ea972ba1752501684a82
==================================================
Protect the DefaultServlet against Filters etc writing to the response which will a) break partial get support and b) mean setting on content length will result in a truncated response.
==================================================
Mark Emlyn
==================================================
Wed Mar 30 12:04:48 2011 +0000
==================================================
ResponseFacade.java
Protect the DefaultServlet against Filters etc writing to the response which will a) break partial get support and b) mean setting on content length will result in a truncated response.
This also fixers some TCK failures since the TCK sometimes writes to the response with a filter.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1086918 13f79535-47bb-0310-9956-ffa450edef68



==================================================
DefaultServlet.java
index 989ebb358f..0f5d794615 100644
--- a/java/org/apache/catalina/connector/ResponseFacade.java
+++ b/java/org/apache/catalina/connector/ResponseFacade.java
@@ -163,6 +163,16 @@ public class ResponseFacade
     }
 
 
+    public long getContentWritten() {
+
+        if (response == null) {
+            throw new IllegalStateException(
+                            sm.getString("responseFacade.nullResponse"));
+        }
+
+        return response.getContentWritten();
+    }
+
     // ------------------------------------------------ ServletResponse Methods
 
 

==================================================
