4f1b667f15e6ed46d8704687dab5da73e7404552
==================================================
https://bz.apache.org/bugzilla/show_bug.cgi?id=63275 enc getContextPath
==================================================
Mark Thomas
==================================================
Thu Mar 21 14:46:14 2019 +0000
==================================================
ApplicationDispatcher.java
https://bz.apache.org/bugzilla/show_bug.cgi?id=63275 enc getContextPath

When using a RequestDispatcher ensure that
HttpServletRequest.getContextPath() returns an encoded path in the
dispatched request.


==================================================
TestApplicationContextGetRequestDispatcher.java
index cbaa8088d6..522e4a705d 100644
--- a/java/org/apache/catalina/core/ApplicationDispatcher.java
+++ b/java/org/apache/catalina/core/ApplicationDispatcher.java
@@ -371,7 +371,7 @@ final class ApplicationDispatcher implements AsyncDispatcher, RequestDispatcher
                 wrequest.setAttribute(RequestDispatcher.FORWARD_MAPPING, hrequest.getHttpServletMapping());
             }
 
-            wrequest.setContextPath(context.getPath());
+            wrequest.setContextPath(context.getEncodedPath());
             wrequest.setRequestURI(requestURI);
             wrequest.setServletPath(servletPath);
             wrequest.setPathInfo(pathInfo);
@@ -618,7 +618,7 @@ final class ApplicationDispatcher implements AsyncDispatcher, RequestDispatcher
         wrequest.setAttribute(Globals.DISPATCHER_REQUEST_PATH_ATTR, getCombinedPath());
         wrequest.setAttribute(AsyncContext.ASYNC_MAPPING, hrequest.getHttpServletMapping());
 
-        wrequest.setContextPath(context.getPath());
+        wrequest.setContextPath(context.getEncodedPath());
         wrequest.setRequestURI(requestURI);
         wrequest.setServletPath(servletPath);
         wrequest.setPathInfo(pathInfo);

==================================================
