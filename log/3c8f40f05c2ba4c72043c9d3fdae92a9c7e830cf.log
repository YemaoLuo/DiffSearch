3c8f40f05c2ba4c72043c9d3fdae92a9c7e830cf
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52445
==================================================
Mark Emlyn
==================================================
Fri Jan 13 20:29:13 2012 +0000
==================================================
AstValue.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52445
Do not assume method expressions have exactly three elements
Includes a test case

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1231285 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestMethodExpressionImpl.java
index c9bc4e4194..b200b96062 100644
--- a/java/org/apache/el/parser/AstValue.java
+++ b/java/org/apache/el/parser/AstValue.java
@@ -245,8 +245,8 @@ public final class AstValue extends SimpleNode {
         Method m = null;
         Object[] values = null;
         if (isParametersProvided()) {
-            values = ((AstMethodParameters)
-                    this.jjtGetChild(2)).getParameters(ctx);
+            values = ((AstMethodParameters) this.jjtGetChild(
+                    this.jjtGetNumChildren() - 1)).getParameters(ctx);
             Class<?>[] types = getTypesFromValues(values);
             m = ReflectionUtil.getMethod(t.base, t.property, types);
         } else {
@@ -329,9 +329,13 @@ public final class AstValue extends SimpleNode {
      */
     @Override
     public boolean isParametersProvided() {
-        if (this.children.length > 2
-                && this.jjtGetChild(2) instanceof AstMethodParameters) {
-            return true;
+        // Assumption is that method parameters, if present, will be the last
+        // child
+        int len = children.length;
+        if (len > 2) {
+            if (this.jjtGetChild(len - 1) instanceof AstMethodParameters) {
+                return true;
+            }
         }
         return false;
     }

==================================================
