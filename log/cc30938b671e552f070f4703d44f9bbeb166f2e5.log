cc30938b671e552f070f4703d44f9bbeb166f2e5
==================================================
try with resources
==================================================
Mark Emlyn
==================================================
Tue Mar 25 22:58:38 2014 +0000
==================================================
DataSourceRealm.java
try with resources

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1581579 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JDBCRealm.java
index 9fa9aed6a4..b7cdcd043b 100644
--- a/java/org/apache/catalina/realm/DataSourceRealm.java
+++ b/java/org/apache/catalina/realm/DataSourceRealm.java
@@ -408,37 +408,20 @@ public class DataSourceRealm extends RealmBase {
     protected String getPassword(Connection dbConnection,
                                  String username) {
 
-        ResultSet rs = null;
-        PreparedStatement stmt = null;
         String dbCredentials = null;
 
-        try {
-            stmt = credentials(dbConnection, username);
-            rs = stmt.executeQuery();
+        try (PreparedStatement stmt = credentials(dbConnection, username);
+                ResultSet rs = stmt.executeQuery()) {
             if (rs.next()) {
                 dbCredentials = rs.getString(1);
             }
 
             return (dbCredentials != null) ? dbCredentials.trim() : null;
 
-        } catch(SQLException e) {
+        } catch (SQLException e) {
             containerLog.error(
                     sm.getString("dataSourceRealm.getPassword.exception",
                                  username), e);
-        } finally {
-            try {
-                if (rs != null) {
-                    rs.close();
-                }
-                if (stmt != null) {
-                    stmt.close();
-                }
-            } catch (SQLException e) {
-                    containerLog.error(
-                        sm.getString("dataSourceRealm.getPassword.exception",
-                             username), e);
-
-            }
         }
 
         return null;
@@ -499,13 +482,10 @@ public class DataSourceRealm extends RealmBase {
             return null;
         }
 
-        ResultSet rs = null;
-        PreparedStatement stmt = null;
         ArrayList<String> list = null;
 
-        try {
-            stmt = roles(dbConnection, username);
-            rs = stmt.executeQuery();
+        try (PreparedStatement stmt = roles(dbConnection, username);
+                ResultSet rs = stmt.executeQuery()) {
             list = new ArrayList<>();
 
             while (rs.next()) {
@@ -519,20 +499,6 @@ public class DataSourceRealm extends RealmBase {
             containerLog.error(
                 sm.getString("dataSourceRealm.getRoles.exception", username), e);
         }
-        finally {
-            try {
-                if (rs != null) {
-                    rs.close();
-                }
-                if (stmt != null) {
-                    stmt.close();
-                }
-            } catch (SQLException e) {
-                    containerLog.error(
-                        sm.getString("dataSourceRealm.getRoles.exception",
-                                     username), e);
-            }
-        }
 
         return null;
     }

==================================================
