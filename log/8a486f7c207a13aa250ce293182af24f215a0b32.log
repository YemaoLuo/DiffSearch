8a486f7c207a13aa250ce293182af24f215a0b32
==================================================
Fix remaining issue described in https://issues.apache.org/bugzilla/show_bug.cgi?id=49218
==================================================
Mark Emlyn
==================================================
Wed May 12 11:10:03 2010 +0000
==================================================
BaseDirContext.java
Fix remaining issue described in https://issues.apache.org/bugzilla/show_bug.cgi?id=49218
doLookup should return null if the resource cannot be found and should not throw an exception
Fixes a potential infinite loop in VirtualDirContext

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@943447 13f79535-47bb-0310-9956-ffa450edef68



==================================================
FileDirContext.java
index b388050e38..5e72fa6696 100644
--- a/java/org/apache/naming/resources/BaseDirContext.java
+++ b/java/org/apache/naming/resources/BaseDirContext.java
@@ -1501,7 +1501,7 @@ public abstract class BaseDirContext implements DirContext {
     protected abstract Attributes doGetAttributes(String name, String[] attrIds)
         throws NamingException;
 
-    protected abstract Object doLookup(String name) throws NamingException;
+    protected abstract Object doLookup(String name);
 
     protected abstract NamingEnumeration<Binding> doListBindings(String name)
         throws NamingException;

==================================================
VirtualDirContext.java
index a3c0d13cf5..4e1a37d4c0 100644
--- a/java/org/apache/naming/resources/LocalStrings.properties
+++ b/java/org/apache/naming/resources/LocalStrings.properties
@@ -33,6 +33,7 @@ resources.invalidAliasMapping=The alias mapping ''{0}'' is not valid
 resources.invalidAliasNotAllowed=The alias location ''{0}'' is not allowed
 resources.invalidAliasNotExist=The alias location ''{0}'' does not exist
 resources.invalidAliasFile=The alias location ''{0}'' points to a file that is not a WAR file
+resources.invalidName=The name [{0}] is not valid
 standardResources.alreadyStarted=Resources has already been started
 standardResources.directory=File base {0} is not a directory
 standardResources.exists=File base {0} does not exist

==================================================
WARDirContext.java
index eeee2a5f5c..6974c09ea3 100644
--- a/java/org/apache/naming/resources/VirtualDirContext.java
+++ b/java/org/apache/naming/resources/VirtualDirContext.java
@@ -159,7 +159,7 @@ public class VirtualDirContext extends FileDirContext {
     }
 
     @Override
-    protected Object doLookup(String name) throws NamingException {
+    protected Object doLookup(String name) {
 
         // handle "virtual" tlds
         if (name.startsWith("/WEB-INF/") && name.endsWith(".tld")) {
@@ -178,7 +178,7 @@ public class VirtualDirContext extends FileDirContext {
             }
         }
 
-        return super.lookup(name);
+        return super.doLookup(name);
     }
 
     /**

==================================================
