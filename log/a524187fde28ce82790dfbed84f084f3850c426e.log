a524187fde28ce82790dfbed84f084f3850c426e
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48248
==================================================
Mark Emlyn
==================================================
Mon Nov 23 00:31:43 2009 +0000
==================================================
GroupChannel.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48248
Use volatile since field is accessed by multiple threads

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@883200 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MessageDispatchInterceptor.java
index 1665c0efad..5606926d81 100644
--- a/java/org/apache/catalina/tribes/group/GroupChannel.java
+++ b/java/org/apache/catalina/tribes/group/GroupChannel.java
@@ -644,7 +644,7 @@ public class GroupChannel extends ChannelInterceptorBase implements ManagedChann
             return counter++;
         }
 
-        protected boolean doRun = true;
+        protected volatile boolean doRun = true;
         protected GroupChannel channel;
         protected long sleepTime;
         public HeartbeatThread(GroupChannel channel, long sleepTime) {

==================================================
TcpPingInterceptor.java
index 13051e59cd..e7ff8d2063 100644
--- a/java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java
+++ b/java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java
@@ -42,7 +42,7 @@ public class MessageDispatchInterceptor extends ChannelInterceptorBase implement
 
     protected long maxQueueSize = 1024*1024*64; //64MB
     protected FastQueue queue = new FastQueue();
-    protected boolean run = false;
+    protected volatile boolean run = false;
     protected Thread msgDispatchThread = null;
     protected long currentSize = 0;
     protected boolean useDeepClone = true;

==================================================
McastServiceImpl.java
index 2a314340e2..282eb7f9bf 100644
--- a/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
+++ b/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
@@ -52,7 +52,7 @@ public class TcpPingInterceptor extends ChannelInterceptorBase {
 
     protected boolean useThread = false;
     protected boolean staticOnly = false;
-    protected boolean running = true;
+    protected volatile boolean running = true;
     protected PingThread thread = null;
     protected static AtomicInteger cnt = new AtomicInteger(0);
     

==================================================
