0651bcc198c9fdc59a562e7ec8aa5eb381e4bf6e
==================================================
Based on current usage within Tomcat, message length of 0 should result in null.
==================================================
Mark Emlyn
==================================================
Tue Jul 5 12:25:38 2011 +0000
==================================================
XByteBuffer.java
Based on current usage within Tomcat, message length of 0 should result in null.
Populate the test for this and ensure the test passes.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1143022 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestXByteBuffer.java
index 71f2d63315..b35bd10d77 100644
--- a/java/org/apache/catalina/tribes/io/XByteBuffer.java
+++ b/java/org/apache/catalina/tribes/io/XByteBuffer.java
@@ -561,7 +561,7 @@ public class XByteBuffer
         invokecount.addAndGet(1);
         Object message = null;
         if ( cls == null ) cls = new ClassLoader[0];
-        if (data != null) {
+        if (data != null && length > 0) {
             InputStream  instream = new ByteArrayInputStream(data,offset,length);
             ObjectInputStream stream = null;
             stream = (cls.length>0)? new ReplicationStream(instream,cls):new ObjectInputStream(instream);

==================================================
