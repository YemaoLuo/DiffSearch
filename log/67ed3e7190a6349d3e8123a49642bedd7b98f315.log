67ed3e7190a6349d3e8123a49642bedd7b98f315
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54781
==================================================
Mark Emlyn
==================================================
Tue Apr 23 19:58:34 2013 +0000
==================================================
WsFilter.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54781
Fix NPE if no matching Endpoint is found.
Handle forwarded requests as well.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1471123 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsServerContainer.java
index 75b2d01673..1770a81978 100644
--- a/java/org/apache/tomcat/websocket/server/WsFilter.java
+++ b/java/org/apache/tomcat/websocket/server/WsFilter.java
@@ -78,7 +78,7 @@ public class WsFilter implements Filter {
                 !headerContainsToken((HttpServletRequest) request,
                         Constants.UPGRADE_HEADER_NAME,
                         Constants.UPGRADE_HEADER_VALUE)) {
-            // Note an HTTP request that includes a valid upgrade request to
+            // Not an HTTP request that includes a valid upgrade request to
             // web socket
             chain.doFilter(request, response);
             return;
@@ -122,6 +122,13 @@ public class WsFilter implements Filter {
         }
         WsMappingResult mappingResult = sc.findMapping(path);
 
+        if (mappingResult == null) {
+            // No endpoint registered for the requested path. Let the
+            // application handle it (it might redirect or forward for example)
+            chain.doFilter(request, response);
+            return;
+        }
+
         ServerEndpointConfig sec = mappingResult.getConfig();
 
         // Origin check

==================================================
