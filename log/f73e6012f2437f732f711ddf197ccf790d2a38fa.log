f73e6012f2437f732f711ddf197ccf790d2a38fa
==================================================
Support Java 11 in Graal Native Images
==================================================
remm remm@apache.org
==================================================
Thu Nov 28 11:24:38 2019 +0100
==================================================
GraalCompat.java
Support Java 11 in Graal Native Images

Add support for Graal 19.3, since Graal now has Java 9+ [without
modules], the jre9Available needs to be accurate and match the substrate
VM (otherwise the direct byte buffer cleaner will not be there).
Java 11 support needs Graal 19.3 and it solves a lot of the big problems
Tomcat had with Graal with SunEC (now actually always available) and
ALPN now works.
The Graal support should now be like the regular JVM: you can use either
Java 8 or Java 11.


==================================================
JreCompat.java
index 53b67a1119..4ae501da05 100644
--- a/java/org/apache/tomcat/util/compat/GraalCompat.java
+++ b/java/org/apache/tomcat/util/compat/GraalCompat.java
@@ -17,8 +17,10 @@
 package org.apache.tomcat.util.compat;
 
 import java.io.IOException;
+import java.net.URL;
+import java.util.Deque;
 
-class GraalCompat extends JreCompat {
+class GraalCompat extends Jre9Compat {
 
     private static final boolean GRAAL;
 
@@ -44,4 +46,15 @@ class GraalCompat extends JreCompat {
     public void disableCachingForJarUrlConnections() throws IOException {
     }
 
+    @Override
+    public void addBootModulePath(Deque<URL> classPathUrlsToProcess) {
+        // No support for modules in native images
+    }
+
+    @Override
+    public boolean isExported(Class<?> type) {
+        // No support for modules in native images so return true
+        return true;
+    }
+
 }

==================================================
