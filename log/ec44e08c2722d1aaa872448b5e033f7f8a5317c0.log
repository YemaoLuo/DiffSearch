ec44e08c2722d1aaa872448b5e033f7f8a5317c0
==================================================
onDataAvailable() can't throw an IOE (and the user may swallow it anyway) so ensure that when the connection needs to be closed it really is closed.
==================================================
Mark Emlyn
==================================================
Wed Dec 19 22:22:36 2012 +0000
==================================================
AbstractProcessor.java
onDataAvailable() can't throw an IOE (and the user may swallow it anyway) so ensure that when the connection needs to be closed it really is closed.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1424171 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractServletInputStream.java
index 88b06cf070..3e6a9ed696 100644
--- a/java/org/apache/coyote/http11/upgrade/AbstractProcessor.java
+++ b/java/org/apache/coyote/http11/upgrade/AbstractProcessor.java
@@ -89,6 +89,9 @@ public abstract class AbstractProcessor<S>
             // Unexpected state
             return SocketState.CLOSED;
         }
+        if (upgradeServletInputStream.isCloseRequired()) {
+            return SocketState.CLOSED;
+        }
         return SocketState.UPGRADED;
     }
 

==================================================
