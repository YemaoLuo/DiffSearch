d23fd5f2a9efb201da014ed21c6359b36075f5eb
==================================================
Follow up on the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011
==================================================
Mark Emlyn
==================================================
Fri Nov 16 22:45:28 2012 +0000
==================================================
Out.java
Follow up on the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011
Need to use the body as the default if no default attribute is defined

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1410609 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestOut.java
index 75cdd1e7de..3a049cd69f 100644
--- a/java/org/apache/jasper/tagplugins/jstl/core/Out.java
+++ b/java/org/apache/jasper/tagplugins/jstl/core/Out.java
@@ -42,6 +42,7 @@ public final class Out implements TagPlugin {
         String strValName = ctxt.getTemporaryVariableName();
         String strDefName = ctxt.getTemporaryVariableName();
         String strEscapeXmlName = ctxt.getTemporaryVariableName();
+        String strSkipBodyName = ctxt.getTemporaryVariableName();
 
         //according to the tag file, the value attribute is mandatory.
         ctxt.generateJavaSource("String " + strValName + " = null;");
@@ -77,12 +78,16 @@ public final class Out implements TagPlugin {
 
         //main part.
         ctxt.generateJavaSource(
+                "boolean " + strSkipBodyName + " = " +
                 "org.apache.jasper.tagplugins.jstl.core.Out.output(out, " +
                 strValName + ", " + strDefName + ", " + strEscapeXmlName +
                 ");");
+        ctxt.generateJavaSource("if(!" + strSkipBodyName + ") {");
+        ctxt.generateBody();
+        ctxt.generateJavaSource("}");
     }
 
-    public static void output(JspWriter out, String value, String defaultValue,
+    public static boolean output(JspWriter out, String value, String defaultValue,
             boolean escapeXml) throws IOException {
         String v = value != null ? value : defaultValue;
         if (v != null) {
@@ -90,6 +95,9 @@ public final class Out implements TagPlugin {
                 v = org.apache.jasper.tagplugins.jstl.Util.escapeXml(v);
             }
             out.write(v);
+            return true;
+        } else {
+            return false;
         }
     }
 }

==================================================
