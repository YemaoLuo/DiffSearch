c183a752d4059c043352b5b986fb1f8da6850c1d
==================================================
Fix a handful of low severity SpotBugs reports
==================================================
Mark Thomas
==================================================
Fri Nov 24 17:42:36 2017 +0000
==================================================
FileMessageFactory.java
Fix a handful of low severity SpotBugs reports
- Failure to delete/rename a file should result have some visible outcome

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1816246 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ManagerServlet.java
index e6f6971599..d306660739 100644
--- a/java/org/apache/catalina/manager/LocalStrings.properties
+++ b/java/org/apache/catalina/manager/LocalStrings.properties
@@ -97,6 +97,7 @@ managerServlet.notSslConnector=SSL is not enabled for this connector
 managerServlet.objectNameFail=FAIL - Unable to register object name [{0}] for Manager Servlet
 managerServlet.postCommand=FAIL - Tried to use command [{0}] via a GET request but POST is required
 managerServlet.reloaded=OK - Reloaded application at context path [{0}]
+managerServlet.renameFail=FAIL - Unable to rename [{0}] to [{1}]. This may cause problems for future deployments.
 managerServlet.resourcesAll=OK - Listed global resources of all types
 managerServlet.resourcesType=OK - Listed global resources of type [{0}]
 managerServlet.saveFail=FAIL - Configuration save failed: [{0}]

==================================================
FileStore.java
index 3907bf69db..465fd0ba33 100644
--- a/java/org/apache/catalina/manager/ManagerServlet.java
+++ b/java/org/apache/catalina/manager/ManagerServlet.java
@@ -719,7 +719,11 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
                             return;
                         }
                         // Rename uploaded WAR file
-                        uploadedWar.renameTo(deployedWar);
+                        if (!uploadedWar.renameTo(deployedWar)) {
+                            writer.println(smClient.getString("managerServlet.renameFail",
+                                    uploadedWar, deployedWar));
+                            return;
+                        }
                     }
                     if (tag != null) {
                         // Copy WAR to the host's appBase

==================================================
StandardManager.java
index 222d9a88dd..5815915791 100644
--- a/java/org/apache/catalina/session/LocalStrings.properties
+++ b/java/org/apache/catalina/session/LocalStrings.properties
@@ -16,8 +16,9 @@
 fileStore.saving=Saving Session [{0}] to file [{1}]
 fileStore.loading=Loading Session [{0}] from file [{1}]
 fileStore.removing=Removing Session [{0}] at file [{1}]
-fileStore.deleteFailed=Unable to delete file [{0}] which is preventing the creation of the session storage location
 fileStore.createFailed=Unable to create directory [{0}] for the storage of session data
+fileStore.deleteFailed=Unable to delete file [{0}] which is preventing the creation of the session storage location
+fileStore.deleteSessionFailed=Unable to delete file [{0}] which is no longer required
 JDBCStore.close=Exception closing database connection [{0}]
 JDBCStore.saving=Saving Session [{0}] to database [{1}]
 JDBCStore.loading=Loading Session [{0}] from database [{1}]
@@ -39,6 +40,7 @@ managerBase.sessionTimeout=Invalid session timeout setting [{0}]
 managerBase.setContextNotNew=It is illegal to call setContext() to change the Context associated with a Manager if the Manager is not in the NEW state
 standardManager.loading=Loading persisted sessions from [{0}]
 standardManager.loading.exception=Exception while loading persisted sessions
+standardManager.deletePersistedFileFail=Unable to delete [{0}] after reading the persisted sessions. The continued presence of this file may cause future attempts to persist sessions to fail.
 standardManager.unloading=Saving persisted sessions to [{0}]
 standardManager.unloading.debug=Unloading persisted sessions
 standardManager.unloading.nosessions=No persisted sessions to unload

==================================================
