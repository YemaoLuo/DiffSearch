4ed7b7e939c774f3964c3c5d2dc6c2f49ea3cac7
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50408
==================================================
Mark Emlyn
==================================================
Fri Dec 3 21:49:54 2010 +0000
==================================================
CompositeELResolver.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50408
Fix <code>NoSuchMethodException</code> when using scoped variables with EL method invocation.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1042021 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestCompositeELResolver.java
index 34080be084..6d3065513c 100644
--- a/java/javax/el/CompositeELResolver.java
+++ b/java/javax/el/CompositeELResolver.java
@@ -21,6 +21,8 @@ import java.beans.FeatureDescriptor;
 import java.util.Iterator;
 import java.util.NoSuchElementException;
 
+import javax.servlet.jsp.el.ScopedAttributeELResolver;
+
 public class CompositeELResolver extends ELResolver {
 
     private int size;
@@ -118,6 +120,14 @@ public class CompositeELResolver extends ELResolver {
         for (int i = 0; i < sz; i++) {
             type = this.resolvers[i].getType(context, base, property);
             if (context.isPropertyResolved()) {
+                if (resolvers[i] instanceof ScopedAttributeELResolver) {
+                    // Special case since this will always return Object.class
+                    Object value =
+                        resolvers[i].getValue(context, base, property);
+                    if (value != null) {
+                        return value.getClass();
+                    }
+                }
                 return type;
             }
         }

==================================================
