8c6f2972beb5f4c7809dddf5633b696e3f069b4a
==================================================
Fix BZ 66419 - handle varargs call with single argument
==================================================
Mark Thomas
==================================================
Mon Jan 23 19:54:46 2023 +0000
==================================================
AstFunction.java
Fix BZ 66419 - handle varargs call with single argument


==================================================
TestAstFunction.java
index 4d67cfec36..bac8db1be9 100644
--- a/java/org/apache/el/parser/AstFunction.java
+++ b/java/org/apache/el/parser/AstFunction.java
@@ -163,7 +163,7 @@ public final class AstFunction extends SimpleNode {
                     if (m.isVarArgs() && i == methodParameterCount - 1) {
                         if (inputParameterCount < methodParameterCount) {
                             params[i] = new Object[] { null };
-                        } else if (inputParameterCount == methodParameterCount && paramTypes[i].isArray()) {
+                        } else if (inputParameterCount == methodParameterCount && isArray(parameters.jjtGetChild(i).getValue(ctx))) {
                             params[i] = parameters.jjtGetChild(i).getValue(ctx);
                         } else {
                             Object[] varargs = new Object[inputParameterCount - methodParameterCount + 1];
@@ -200,6 +200,15 @@ public final class AstFunction extends SimpleNode {
         return result;
     }
 
+
+    private boolean isArray(Object obj) {
+        if (obj == null) {
+            return false;
+        }
+        return obj.getClass().isArray();
+    }
+
+
     public void setLocalName(String localName) {
         this.localName = localName;
     }

==================================================
