87f89c1f1cac12072f7907940855cca8f75e5d5d
==================================================
Fix some resource leaks in the error handling for accessing files from JARs and WARs.
==================================================
Mark Thomas
==================================================
Thu Feb 18 12:26:50 2016 +0000
==================================================
JarResource.java
Fix some resource leaks in the error handling for accessing files from JARs and WARs.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1731055 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JarWarResource.java
index 480f2fbfa8..c32f43484b 100644
--- a/java/org/apache/catalina/webresources/JarResource.java
+++ b/java/org/apache/catalina/webresources/JarResource.java
@@ -39,8 +39,9 @@ public class JarResource extends AbstractArchiveResource {
 
     @Override
     protected JarInputStreamWrapper getJarInputStreamWrapper() {
+        JarFile jarFile = null;
         try {
-            JarFile jarFile = getArchiveResourceSet().openJarFile();
+            jarFile = getArchiveResourceSet().openJarFile();
             // Need to create a new JarEntry so the certificates can be read
             JarEntry jarEntry = jarFile.getJarEntry(getResource().getName());
             InputStream is = jarFile.getInputStream(jarEntry);
@@ -50,6 +51,9 @@ public class JarResource extends AbstractArchiveResource {
                 log.debug(sm.getString("jarResource.getInputStreamFail",
                         getResource().getName(), getBaseUrl()), e);
             }
+            if (jarFile != null) {
+                getArchiveResourceSet().closeJarFile();
+            }
             return null;
         }
     }

==================================================
