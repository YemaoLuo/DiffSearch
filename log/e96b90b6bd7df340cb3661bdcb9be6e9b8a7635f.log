e96b90b6bd7df340cb3661bdcb9be6e9b8a7635f
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51197
==================================================
Mark Emlyn
==================================================
Wed May 18 17:25:28 2011 +0000
==================================================
CoyoteAdapter.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51197
Fix possible dropped connection when sendError or sendRedirst are used during async processing.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1124342 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAsyncContextImpl.java
index 10fb3c55ba..e691eca98e 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -277,6 +277,9 @@ public class CoyoteAdapter implements Adapter {
                 if (ctxt != null) {
                     ctxt.fireRequestDestroyEvent(request);
                 }
+                // Lift any suspension (e.g. if sendError() was used by an async
+                // request
+                response.setSuspended(false);
             }
 
             if (status==SocketStatus.TIMEOUT) {

==================================================
