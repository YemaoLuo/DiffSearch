1911c81b7e3a03ed34f11e94528952b53347cadd
==================================================
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405
==================================================
Mark Emlyn
==================================================
Sat Dec 31 18:28:31 2011 +0000
==================================================
HttpSession.java
https://issues.apache.org/bugzilla/show_bug.cgi?id=52405
Servlet 3.0 Rev A updates
Item 3 of 20
maxActiveInterval <= 0 means never expire - previously 0 meant expire
immediately

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1226158 13f79535-47bb-0310-9956-ffa450edef68



==================================================
DeltaSession.java
index 54470db6a5..46b91acf67 100644
--- a/java/javax/servlet/http/HttpSession.java
+++ b/java/javax/servlet/http/HttpSession.java
@@ -116,8 +116,8 @@ public interface HttpSession {
 
     /**
      * Specifies the time, in seconds, between client requests before the
-     * servlet container will invalidate this session. A negative time indicates
-     * the session should never timeout.
+     * servlet container will invalidate this session. A zero or negative time
+     * indicates that the session should never timeout.
      *
      * @param interval
      *            An integer specifying the number of seconds
@@ -129,7 +129,7 @@ public interface HttpSession {
      * will keep this session open between client accesses. After this interval,
      * the servlet container will invalidate the session. The maximum time
      * interval can be set with the <code>setMaxInactiveInterval</code> method.
-     * A negative time indicates the session should never timeout.
+     * A zero or negative time indicates that the session should never timeout.
      *
      * @return an integer specifying the number of seconds this session remains
      *         open between client requests

==================================================
StandardSession.java
index bcd29be02f..1ac7ed81ba 100644
--- a/java/org/apache/catalina/ha/session/DeltaSession.java
+++ b/java/org/apache/catalina/ha/session/DeltaSession.java
@@ -276,16 +276,12 @@ public class DeltaSession extends StandardSession implements Externalizable,Clus
 
     public void setMaxInactiveInterval(int interval, boolean addDeltaRequest) {
         super.maxInactiveInterval = interval;
-        if (isValid && interval == 0) {
-            expire();
-        } else {
-            if (addDeltaRequest && (deltaRequest != null)) {
-                try {
-                    lock();
-                    deltaRequest.setMaxInactiveInterval(interval);
-                }finally{
-                    unlock();
-                }
+        if (addDeltaRequest && (deltaRequest != null)) {
+            try {
+                lock();
+                deltaRequest.setMaxInactiveInterval(interval);
+            }finally{
+                unlock();
             }
         }
     }
@@ -374,7 +370,7 @@ public class DeltaSession extends StandardSession implements Externalizable,Clus
         if (ACTIVITY_CHECK && accessCount.get() > 0) {
             return true;
         }
-        if (maxInactiveInterval >= 0) {
+        if (maxInactiveInterval > 0) {
             long timeNow = System.currentTimeMillis();
             int timeIdle;
             if (LAST_ACCESS_AT_START) {

==================================================
