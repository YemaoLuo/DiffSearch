ac7845648d2a4cf0e856c66863be55183c5c306b
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54450
==================================================
Mark Emlyn
==================================================
Wed Jan 23 10:57:27 2013 +0000
==================================================
DefaultInstanceManager.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54450
Correctly handle resource injection when part of the servlet properties uses @Resource and the other uses 'injection-target'
Includes test case
Patch provided by  Violeta Georgieva.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1437337 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestContextConfig.java
index 224a876030..0bb91972b2 100644
--- a/java/org/apache/catalina/core/DefaultInstanceManager.java
+++ b/java/org/apache/catalina/core/DefaultInstanceManager.java
@@ -348,9 +348,9 @@ public class DefaultInstanceManager implements InstanceManager {
                                 annotations.add(new AnnotationCacheEntry(
                                         method.getName(),
                                         method.getParameterTypes(),
-                                        injections.get(method.getName()),
+                                        injections.get(fieldName),
                                         AnnotationCacheEntryType.SETTER));
-                                break;
+                                continue;
                             }
                         }
                         if (method.isAnnotationPresent(Resource.class)) {

==================================================
TesterServletWithAnnotations.java
index 72566dfd2d..91f4d71496 100644
--- a/test/org/apache/catalina/startup/TestContextConfig.java
+++ b/test/org/apache/catalina/startup/TestContextConfig.java
@@ -127,7 +127,7 @@ public class TestContextConfig extends TomcatBaseTest {
     }
 
     @Test
-    public void testBug54448() throws Exception {
+    public void testBug54448and54450() throws Exception {
         Tomcat tomcat = getTomcatInstance();
 
         File appDir = new File("test/webapp-3.0-fragments");
@@ -142,7 +142,8 @@ public class TestContextConfig extends TomcatBaseTest {
 
         tomcat.start();
 
-        assertPageContains("/test/testServlet", "envEntry: 1");
+        assertPageContains("/test/testServlet",
+                "envEntry1: 1 envEntry2: 2 envEntry3: 33 envEntry4: 4");
     }
 
     private static class CustomDefaultServletSCI

==================================================
