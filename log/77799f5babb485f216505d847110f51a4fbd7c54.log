77799f5babb485f216505d847110f51a4fbd7c54
==================================================
Address root cause of ReadPendingException rather than swallowing it.
==================================================
Mark Emlyn
==================================================
Tue May 13 11:25:14 2014 +0000
==================================================
AsyncStateMachine.java
Address root cause of ReadPendingException rather than swallowing it.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1594198 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractHttp11Processor.java
index 6c468ec67d..da50646fe6 100644
--- a/java/org/apache/coyote/AsyncStateMachine.java
+++ b/java/org/apache/coyote/AsyncStateMachine.java
@@ -280,7 +280,9 @@ public class AsyncStateMachine<S> {
                 state == AsyncState.TIMING_OUT ||
                 state == AsyncState.ERROR) {
             state = AsyncState.DISPATCHING;
-            doDispatch = true;
+            if (!ContainerThreadMarker.isContainerThread()) {
+                doDispatch = true;
+            }
         } else {
             throw new IllegalStateException(
                     sm.getString("asyncStateMachine.invalidAsyncState",

==================================================
