9ee7d6afbfd0c0fe0a144a251dc7d14dfbb7a1b3
==================================================
Reduce memory footprint of closed http/2 streams
==================================================
Mark Thomas
==================================================
Thu Sep 24 21:36:19 2020 +0100
==================================================
Stream.java
Reduce memory footprint of closed http/2 streams

This refactoring replaces closed streams with a new RecycledStream
object and changes the mechanism used to look up known streams.
Refactor StreamStateMachine to remove reference to Stream



==================================================
StreamStateMachine.java
index 29cea54910..2c1b714d25 100644
--- a/java/org/apache/coyote/http2/Stream.java
+++ b/java/org/apache/coyote/http2/Stream.java
@@ -97,7 +97,7 @@ class Stream extends AbstractNonZeroStream implements HeaderEmitter {
         this.handler = handler;
         handler.addChild(this);
         setWindowSize(handler.getRemoteSettings().getInitialWindowSize());
-        state = new StreamStateMachine(this);
+        state = new StreamStateMachine(getConnectionId(), getIdAsString());
         if (coyoteRequest == null) {
             // HTTP/2 new request
             this.coyoteRequest = new Request();

==================================================
