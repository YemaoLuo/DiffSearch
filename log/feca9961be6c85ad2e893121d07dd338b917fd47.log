feca9961be6c85ad2e893121d07dd338b917fd47
==================================================
Fix SpotBugs warning and threading issue
==================================================
Mark Thomas
==================================================
Wed Jun 23 11:01:30 2021 +0100
==================================================
MemoryGroup.java
Fix SpotBugs warning and threading issue

The threading issue is that roles/groups can have entries removed
between the size test and the call to StringUtils.join()

Empty groups and/or role lists are not an issue so remove the test which
removes the need for the sync and removes the threading issue.


==================================================
MemoryUser.java
index d348693e7c..aad41804ee 100644
--- a/java/org/apache/catalina/users/MemoryGroup.java
+++ b/java/org/apache/catalina/users/MemoryGroup.java
@@ -171,13 +171,9 @@ public class MemoryGroup extends AbstractGroup {
             sb.append(description);
             sb.append("\"");
         }
-        synchronized (roles) {
-            if (roles.size() > 0) {
-                sb.append(" roles=\"");
-                StringUtils.join(roles, ',', Role::getRolename, sb);
-                sb.append("\"");
-            }
-        }
+        sb.append(" roles=\"");
+        StringUtils.join(roles, ',', Role::getRolename, sb);
+        sb.append("\"");
         sb.append("/>");
         return sb.toString();
     }

==================================================
