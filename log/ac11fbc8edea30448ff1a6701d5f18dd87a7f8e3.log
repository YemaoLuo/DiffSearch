ac11fbc8edea30448ff1a6701d5f18dd87a7f8e3
==================================================
Fix the logic for handling dispatches in a thread-safe manner. May be scope for a more efficient implementation.
==================================================
Mark Emlyn
==================================================
Sun Oct 6 21:43:18 2013 +0000
==================================================
AbstractProtocol.java
Fix the logic for handling dispatches in a thread-safe manner. May be scope for a more efficient implementation.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1529697 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SocketWrapper.java
index 8e6685a06b..4970fa5398 100644
--- a/java/org/apache/coyote/AbstractProtocol.java
+++ b/java/org/apache/coyote/AbstractProtocol.java
@@ -681,7 +681,7 @@ public abstract class AbstractProtocol<S> implements ProtocolHandler,
                     }
                 } while (state == SocketState.ASYNC_END ||
                         state == SocketState.UPGRADING ||
-                        dispatches.hasNext() && state != SocketState.CLOSED);
+                        dispatches != null && dispatches.hasNext() && state != SocketState.CLOSED);
 
                 if (state == SocketState.LONG) {
                     // In the middle of processing a request/response. Keep the

==================================================
