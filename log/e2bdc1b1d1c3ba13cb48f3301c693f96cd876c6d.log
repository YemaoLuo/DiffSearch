e2bdc1b1d1c3ba13cb48f3301c693f96cd876c6d
==================================================
Expand the check that the BackgroundProcessManager has correctly shut down at the end of the test to more WebSocket tests.
==================================================
Mark Thomas
==================================================
Thu Apr 14 12:48:14 2016 +0000
==================================================
TestWebSocketFrameClient.java
Expand the check that the BackgroundProcessManager has correctly shut down at the end of the test to more WebSocket tests.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1739079 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestWebSocketFrameClientSSL.java
index 77b17fea7b..fc76428745 100644
--- a/test/org/apache/tomcat/websocket/TestWebSocketFrameClient.java
+++ b/test/org/apache/tomcat/websocket/TestWebSocketFrameClient.java
@@ -32,11 +32,10 @@ import org.junit.Test;
 import org.apache.catalina.Context;
 import org.apache.catalina.servlets.DefaultServlet;
 import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
 import org.apache.tomcat.websocket.TesterMessageCountClient.BasicText;
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterProgrammaticEndpoint;
 
-public class TestWebSocketFrameClient extends TomcatBaseTest {
+public class TestWebSocketFrameClient extends WebSocketBaseTest {
 
     @Test
     public void testConnectToServerEndpoint() throws Exception {

==================================================
TestWsPingPongMessages.java
index ceaf6e1096..5468923201 100644
--- a/test/org/apache/tomcat/websocket/TestWebSocketFrameClientSSL.java
+++ b/test/org/apache/tomcat/websocket/TestWebSocketFrameClientSSL.java
@@ -33,13 +33,12 @@ import org.junit.Test;
 import org.apache.catalina.Context;
 import org.apache.catalina.servlets.DefaultServlet;
 import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
 import org.apache.tomcat.util.net.TesterSupport;
 import org.apache.tomcat.websocket.TesterMessageCountClient.BasicText;
 import org.apache.tomcat.websocket.TesterMessageCountClient.SleepingText;
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterProgrammaticEndpoint;
 
-public class TestWebSocketFrameClientSSL extends TomcatBaseTest {
+public class TestWebSocketFrameClientSSL extends WebSocketBaseTest {
 
     @Test
     public void testConnectToServerEndpoint() throws Exception {
@@ -150,20 +149,5 @@ public class TestWebSocketFrameClientSSL extends TomcatBaseTest {
 
         // Close the client session.
         wsSession.close();
-
-        // Make sure the background process has stopped (else in some test
-        // environments it will continue to run and break other tests that check
-        // it has stopped.
-        count = 0;
-        while (count < 50) {
-            if (BackgroundProcessManager.getInstance().getProcessCount() == 0) {
-                break;
-            }
-            Thread.sleep(100);
-            count++;
-        }
-
-        Assert.assertEquals(0, BackgroundProcessManager.getInstance().getProcessCount());
-
     }
 }

==================================================
TestWsRemoteEndpoint.java
index 11a938e4d6..466c9f09fa 100644
--- a/test/org/apache/tomcat/websocket/TestWsPingPongMessages.java
+++ b/test/org/apache/tomcat/websocket/TestWsPingPongMessages.java
@@ -33,12 +33,11 @@ import org.junit.Test;
 import org.apache.catalina.Context;
 import org.apache.catalina.servlets.DefaultServlet;
 import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterEndpoint;
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterProgrammaticEndpoint;
 
 
-public class TestWsPingPongMessages extends TomcatBaseTest {
+public class TestWsPingPongMessages extends WebSocketBaseTest {
 
     ByteBuffer applicationData = ByteBuffer.wrap(new String("mydata")
             .getBytes());

==================================================
TestWsSubprotocols.java
index b692f5dd80..9584e0e75d 100644
--- a/test/org/apache/tomcat/websocket/TestWsRemoteEndpoint.java
+++ b/test/org/apache/tomcat/websocket/TestWsRemoteEndpoint.java
@@ -38,7 +38,6 @@ import org.junit.Test;
 import org.apache.catalina.Context;
 import org.apache.catalina.servlets.DefaultServlet;
 import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
 import org.apache.tomcat.websocket.TesterMessageCountClient.AsyncBinary;
 import org.apache.tomcat.websocket.TesterMessageCountClient.AsyncHandler;
 import org.apache.tomcat.websocket.TesterMessageCountClient.AsyncText;
@@ -46,7 +45,7 @@ import org.apache.tomcat.websocket.TesterMessageCountClient.TesterAnnotatedEndpo
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterEndpoint;
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterProgrammaticEndpoint;
 
-public class TestWsRemoteEndpoint extends TomcatBaseTest {
+public class TestWsRemoteEndpoint extends WebSocketBaseTest {
 
     private static final String SEQUENCE = "ABCDE";
     private static final int S_LEN = SEQUENCE.length();

==================================================
TestWsWebSocketContainer.java
index 35a71677d4..afdbf9647f 100644
--- a/test/org/apache/tomcat/websocket/TestWsSubprotocols.java
+++ b/test/org/apache/tomcat/websocket/TestWsSubprotocols.java
@@ -36,11 +36,10 @@ import org.junit.Test;
 import org.apache.catalina.Context;
 import org.apache.catalina.servlets.DefaultServlet;
 import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
 import org.apache.tomcat.websocket.TesterMessageCountClient.TesterProgrammaticEndpoint;
 import org.apache.tomcat.websocket.server.TesterEndpointConfig;
 
-public class TestWsSubprotocols extends TomcatBaseTest {
+public class TestWsSubprotocols extends WebSocketBaseTest {
 
     @Test
     public void testWsSubprotocols() throws Exception {

==================================================
WebSocketBaseTest.java
index 125aab0cd7..73ec8d1adb 100644
--- a/test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java
+++ b/test/org/apache/tomcat/websocket/TestWsWebSocketContainer.java
@@ -50,7 +50,6 @@ import org.junit.Test;
 import org.apache.catalina.Context;
 import org.apache.catalina.servlets.DefaultServlet;
 import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
 import org.apache.tomcat.util.net.TesterSupport;
 import org.apache.tomcat.websocket.TesterMessageCountClient.BasicBinary;
 import org.apache.tomcat.websocket.TesterMessageCountClient.BasicHandler;
@@ -60,7 +59,7 @@ import org.apache.tomcat.websocket.TesterMessageCountClient.TesterProgrammaticEn
 import org.apache.tomcat.websocket.server.Constants;
 import org.apache.tomcat.websocket.server.WsContextListener;
 
-public class TestWsWebSocketContainer extends TomcatBaseTest {
+public class TestWsWebSocketContainer extends WebSocketBaseTest {
 
     private static final String MESSAGE_EMPTY = "";
     private static final String MESSAGE_STRING_1 = "qwerty";

==================================================
