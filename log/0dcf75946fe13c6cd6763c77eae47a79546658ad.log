0dcf75946fe13c6cd6763c77eae47a79546658ad
==================================================
add tests for setting v1 cookie values
==================================================
Jeremy Boynes
==================================================
Fri Jan 10 03:08:28 2014 +0000
==================================================
TestSetCookieSupport.java
add tests for setting v1 cookie values

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1557017 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestSetCookieSupportSeparatorsAllowed.java
index c70c8ecf86..9bb42751ca 100644
--- a/test/org/apache/tomcat/util/http/TestSetCookieSupport.java
+++ b/test/org/apache/tomcat/util/http/TestSetCookieSupport.java
@@ -33,6 +33,7 @@ public class TestSetCookieSupport {
     @Test
     public void v0NullValue() {
         Cookie cookie = new Cookie("foo", null);
+        // should this throw an IAE?
 //        Assert.assertEquals("foo=", SetCookieSupport.generateHeader(cookie));
         Assert.assertEquals("foo=\"\"", SetCookieSupport.generateHeader(cookie));
     }
@@ -109,4 +110,95 @@ public class TestSetCookieSupport {
 //        Assert.assertEquals("foo=a\"b\\c", SetCookieSupport.generateHeader(cookie));
         Assert.assertEquals("foo=\"a\\\"b\\\\c\"; Version=1", SetCookieSupport.generateHeader(cookie));
     }
+
+    @Test
+    public void v1simpleCookie() {
+        Cookie cookie = new Cookie("foo", "bar");
+        cookie.setVersion(1);
+        Assert.assertEquals("foo=bar; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1NullValue() {
+        Cookie cookie = new Cookie("foo", null);
+        cookie.setVersion(1);
+        // should this throw an IAE?
+        Assert.assertEquals("foo=\"\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1QuotedValue() {
+        Cookie cookie = new Cookie("foo", "\"bar\"");
+        cookie.setVersion(1);
+        // should this be escaping the quotes rather than passing through?
+        Assert.assertEquals("foo=\"bar\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1ValueContainsSemicolon() {
+        Cookie cookie = new Cookie("foo", "a;b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a;b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1ValueContainsComma() {
+        Cookie cookie = new Cookie("foo", "a,b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a,b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1ValueContainsSpace() {
+        Cookie cookie = new Cookie("foo", "a b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1ValueContainsEquals() {
+        Cookie cookie = new Cookie("foo", "a=b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a=b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Test
+    public void v1ValueContainsQuote() {
+        Cookie cookie = new Cookie("foo", "a\"b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a\\\"b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Ignore("bug 55975")
+    @Test
+    public void v1ValueContainsNonV0Separator() {
+        Cookie cookie = new Cookie("foo", "a()<>@,;:\\\"/[]?={}b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a()<>@,;:\\\\\\\"/[]?={}b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+    @Ignore("bug 55975")
+    @Test
+    public void v1ValueContainsBackslash() {
+        Cookie cookie = new Cookie("foo", "a\\b");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a\\\\b\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
+
+
+    @Ignore("bug 55975")
+    @Test
+    public void v1ValueContainsBackslashAndQuote() {
+        Cookie cookie = new Cookie("foo", "a\"b\\c");
+        cookie.setVersion(1);
+        // should this be throwing IAE rather than adding quotes?
+        Assert.assertEquals("foo=\"a\\\"b\\\\c\"; Version=1", SetCookieSupport.generateHeader(cookie));
+    }
 }

==================================================
