860b37515838b18ab3890e5698f5a21d20f54503
==================================================
Align code between connectors in preparation for pulling code up to the superclass
==================================================
Mark Emlyn
==================================================
Wed Jun 15 16:19:06 2011 +0000
==================================================
AjpNioProcessor.java
Align code between connectors in preparation for pulling code up to the superclass
No need to close the AJP connection if there was no error

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1136106 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpProcessor.java
index 34c1496c51..cef0e8a4a0 100644
--- a/java/org/apache/coyote/ajp/AjpNioProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpNioProcessor.java
@@ -363,7 +363,11 @@ public class AjpNioProcessor extends AbstractAjpProcessor {
             }
         } else {
             request.updateCounters();
-            return SocketState.CLOSED;
+            if (error) {
+                return SocketState.CLOSED;
+            } else {
+                return SocketState.OPEN;
+            }
         }
 
 

==================================================
