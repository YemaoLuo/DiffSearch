4807b2f0a3d3544a90c834e220f62d30010c8e40
==================================================
Fix some test failures now response bodies are available for error
==================================================
Mark Emlyn
==================================================
Mon Mar 5 18:45:27 2012 +0000
==================================================
TestDigestAuthenticator.java
Fix some test failures now response bodies are available for error
responses.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1297158 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestNonLoginAndBasicAuthenticator.java
index aaf3582ac3..d1b69b7ced 100644
--- a/test/org/apache/catalina/authenticator/TestDigestAuthenticator.java
+++ b/test/org/apache/catalina/authenticator/TestDigestAuthenticator.java
@@ -24,7 +24,7 @@ import java.util.List;
 import java.util.Map;
 
 import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertNull;
+import static org.junit.Assert.assertTrue;
 
 import org.junit.Test;
 
@@ -190,7 +190,8 @@ public class TestDigestAuthenticator extends TomcatBaseTest {
         int rc = getUrl("http://localhost:" + getPort() + uri, bc, reqHeaders,
                 respHeaders);
         assertEquals(401, rc);
-        assertNull(bc.toString());
+        assertTrue(bc.getLength() > 0);
+        bc.recycle();
 
         // Second request should succeed (if we use the server nonce)
         auth.clear();
@@ -215,7 +216,7 @@ public class TestDigestAuthenticator extends TomcatBaseTest {
             assertEquals("OK", bc.toString());
         } else {
             assertEquals(401, rc);
-            assertNull(bc.toString());
+            assertTrue(bc.getLength() > 0);
         }
 
         // Third request should succeed if we increment nc
@@ -233,7 +234,7 @@ public class TestDigestAuthenticator extends TomcatBaseTest {
             assertEquals("OK", bc.toString());
         } else {
             assertEquals(401, rc);
-            assertNull(bc.toString());
+            assertTrue(bc.getLength() > 0);
         }
     }
 

==================================================
TestSSOnonLoginAndBasicAuthenticator.java
index 8fe5b766b9..7f92f4f151 100644
--- a/test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java
+++ b/test/org/apache/catalina/authenticator/TestNonLoginAndBasicAuthenticator.java
@@ -22,7 +22,7 @@ import java.util.List;
 import java.util.Map;
 
 import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertNull;
+import static org.junit.Assert.assertTrue;
 
 import org.junit.Test;
 
@@ -154,7 +154,7 @@ public class TestNonLoginAndBasicAuthenticator extends TomcatBaseTest {
 
         if (expectedReject) {
             assertEquals(expectedRC, rc);
-            assertNull(bc.toString());
+            assertTrue(bc.getLength() > 0);
         }
         else {
             assertEquals(200, rc);
@@ -178,7 +178,7 @@ public class TestNonLoginAndBasicAuthenticator extends TomcatBaseTest {
 
         if (expectedReject1) {
             assertEquals(expectedRC1, rc);
-            assertNull(bc.toString());
+            assertTrue(bc.getLength() > 0);
         }
         else {
             assertEquals(200, rc);
@@ -200,13 +200,13 @@ public class TestNonLoginAndBasicAuthenticator extends TomcatBaseTest {
         Map<String,List<String>> respHeaders2 =
             new HashMap<String,List<String>>();
 
-        bc.reset();
+        bc.recycle();
         rc = getUrl(HTTP_PREFIX + getPort() + uri, bc, reqHeaders2,
                 respHeaders2);
 
         if (expectedReject2) {
             assertEquals(expectedRC2, rc);
-            assertNull(bc.toString());
+            assertTrue(bc.getLength() > 0);
         }
         else {
             assertEquals(200, rc);

==================================================
