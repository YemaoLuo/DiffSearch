c5ef6282a6134d598ddca6398397aa8acc49fdac
==================================================
- Add a new init param for controlling display of source fragments.
==================================================
Remy Maucherat
==================================================
Thu Sep 28 15:28:05 2006 +0000
==================================================
EmbeddedServletOptions.java
- Add a new init param for controlling display of source fragments.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@450897 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspC.java
index 6c3a320439..9904d4876c 100644
--- a/java/org/apache/jasper/EmbeddedServletOptions.java
+++ b/java/org/apache/jasper/EmbeddedServletOptions.java
@@ -179,6 +179,13 @@ public final class EmbeddedServletOptions implements Options {
      */
     private boolean xpoweredBy;
     
+    /**
+     * Should we include a source fragment in exception messages, which could be displayed
+     * to the developer ?
+     */
+    private boolean displaySourceFragment = true;
+
+    
     public String getProperty(String name ) {
         return settings.getProperty( name );
     }
@@ -367,6 +374,14 @@ public final class EmbeddedServletOptions implements Options {
         return null;
     }
 
+    /**
+     * Should we include a source fragment in exception messages, which could be displayed
+     * to the developer ?
+     */
+    public boolean getDisplaySourceFragment() {
+        return displaySourceFragment;
+    }
+
     /**
      * Create an EmbeddedServletOptions object using data available from
      * ServletConfig and ServletContext. 
@@ -653,6 +668,19 @@ public final class EmbeddedServletOptions implements Options {
             }
         }
         
+        String displaySourceFragment = config.getInitParameter("displaySourceFragment"); 
+        if (displaySourceFragment != null) {
+            if (displaySourceFragment.equalsIgnoreCase("true")) {
+                this.displaySourceFragment = true;
+            } else if (displaySourceFragment.equalsIgnoreCase("false")) {
+                this.displaySourceFragment = false;
+            } else {
+                if (log.isWarnEnabled()) {
+                    log.warn(Localizer.getMessage("jsp.warning.displaySourceFragment"));
+                }
+            }
+        }
+        
         // Setup the global Tag Libraries location cache for this
         // web-application.
         tldLocationsCache = new TldLocationsCache(context);

==================================================
Options.java
index 158a5d62a6..5f667bf486 100644
--- a/java/org/apache/jasper/JspC.java
+++ b/java/org/apache/jasper/JspC.java
@@ -385,6 +385,10 @@ public class JspC implements Options {
         this.xpoweredBy = xpoweredBy;
     }
 
+    public boolean getDisplaySourceFragment() {
+        return true;
+    }
+    
     public boolean getErrorOnUseBeanInvalidClassAttribute() {
         return errorOnUseBeanInvalidClassAttribute;
     }

==================================================
JspServletWrapper.java
index 3c5ef3856d..c68e02fcf4 100644
--- a/java/org/apache/jasper/resources/LocalStrings.properties
+++ b/java/org/apache/jasper/resources/LocalStrings.properties
@@ -155,6 +155,7 @@ jsp.warning.reloading=Warning: Invalid value for the initParam reloading. Will u
 jsp.warning.dumpSmap=Warning: Invalid value for the initParam dumpSmap. Will use the default value of \"false\"
 jsp.warning.genchararray=Warning: Invalid value for the initParam genStrAsCharArray. Will use the default value of \"false\"
 jsp.warning.suppressSmap=Warning: Invalid value for the initParam suppressSmap. Will use the default value of \"false\"
+jsp.warning.displaySourceFragment=Warning: Invalid value for the initParam displaySourceFragment. Will use the default value of \"true\"
 jsp.error.badtaglib=Unable to open taglibrary {0} : {1}
 jsp.error.badGetReader=Cannot create a reader when the stream is not buffered
 jsp.warning.unknown.element.in.taglib=Unknown element ({0}) in taglib
@@ -413,6 +414,8 @@ jsp.error.unbalanced.endtag=The end tag \"&lt;/{0}\" is unbalanced
 jsp.error.invalid.bean=The value for the useBean class attribute {0} is invalid.
 jsp.error.prefix.use_before_dcl=The prefix {0} specified in this tag directive has been previously used by an action in file {1} line {2}.
 
+jsp.exception=An exception occurred processing JSP page {0} at line {1}
+
 # JSP 2.1
 jsp.error.el.template.deferred=#{..} is not allowed in template text
 jsp.error.el.parse={0} : {1}

==================================================
