7702811772709abdcb9b4c2107f9bfacec78de90
==================================================
Refactor to reduce code duplication.
==================================================
Mark Thomas
==================================================
Mon Jun 26 12:39:15 2017 +0000
==================================================
RemoteAddrValve.java
Refactor to reduce code duplication.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1799895 13f79535-47bb-0310-9956-ffa450edef68



==================================================
RemoteHostValve.java
index 69c716044d..d8dc2a352f 100644
--- a/java/org/apache/catalina/valves/RemoteAddrValve.java
+++ b/java/org/apache/catalina/valves/RemoteAddrValve.java
@@ -39,48 +39,12 @@ public final class RemoteAddrValve extends RequestFilterValve {
     private static final Log log = LogFactory.getLog(RemoteAddrValve.class);
 
 
-    // ----------------------------------------------------- Instance Variables
-
-    /**
-     * Flag deciding whether we add the server connector port to the property
-     * compared in the filtering method. The port will be appended
-     * using a ";" as a separator.
-     */
-    volatile boolean addConnectorPort = false;
-
-    // ------------------------------------------------------------- Properties
-
-
-    /**
-     * Get the flag deciding whether we add the server connector port to the
-     * property compared in the filtering method. The port will be appended
-     * using a ";" as a separator.
-     * @return <code>true</code> to add the connector port, the default is
-     *  <code>false</code>
-     */
-    public boolean getAddConnectorPort() {
-        return addConnectorPort;
-    }
-
-
-    /**
-     * Set the flag deciding whether we add the server connector port to the
-     * property compared in the filtering method. The port will be appended
-     * using a ";" as a separator.
-     *
-     * @param addConnectorPort The new flag
-     */
-    public void setAddConnectorPort(boolean addConnectorPort) {
-        this.addConnectorPort = addConnectorPort;
-    }
-
-
     // --------------------------------------------------------- Public Methods
 
     @Override
     public void invoke(Request request, Response response) throws IOException, ServletException {
         String property;
-        if (addConnectorPort) {
+        if (getAddConnectorPort()) {
             property = request.getRequest().getRemoteAddr() + ";" + request.getConnector().getPort();
         } else {
             property = request.getRequest().getRemoteAddr();

==================================================
RequestFilterValve.java
index 90a9c71264..d94389bf9f 100644
--- a/java/org/apache/catalina/valves/RemoteHostValve.java
+++ b/java/org/apache/catalina/valves/RemoteHostValve.java
@@ -37,47 +37,12 @@ public final class RemoteHostValve extends RequestFilterValve {
     private static final Log log = LogFactory.getLog(RemoteHostValve.class);
 
 
-    // ----------------------------------------------------- Instance Variables
-
-    /**
-     * Flag deciding whether we add the server connector port to the property
-     * compared in the filtering method. The port will be appended
-     * using a ";" as a separator.
-     */
-    volatile boolean addConnectorPort = false;
-
-    // ------------------------------------------------------------- Properties
-
-
-    /**
-     * Get the flag deciding whether we add the server connector port to the
-     * property compared in the filtering method. The port will be appended
-     * using a ";" as a separator.
-     * @return <code>true</code> to add the connector port
-     */
-    public boolean getAddConnectorPort() {
-        return addConnectorPort;
-    }
-
-
-    /**
-     * Set the flag deciding whether we add the server connector port to the
-     * property compared in the filtering method. The port will be appended
-     * using a ";" as a separator.
-     *
-     * @param addConnectorPort The new flag
-     */
-    public void setAddConnectorPort(boolean addConnectorPort) {
-        this.addConnectorPort = addConnectorPort;
-    }
-
-
     // --------------------------------------------------------- Public Methods
 
     @Override
     public void invoke(Request request, Response response) throws IOException, ServletException {
         String property;
-        if (addConnectorPort) {
+        if (getAddConnectorPort()) {
             property = request.getRequest().getRemoteHost() + ";" + request.getConnector().getPort();
         } else {
             property = request.getRequest().getRemoteHost();

==================================================
