b6b07c527834b1b71ad01b939c6a7e37d1d0c927
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61854
==================================================
Mark Thomas
==================================================
Wed Dec 6 14:50:42 2017 +0000
==================================================
ELParser.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61854
When using sets and/or maps in EL expressions, ensure that Jasper correctly parses the expression.
Patch provided by Ricardo Martin Camarero.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1817298 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestELInJsp.java
index ced5dc2226..661b2694a3 100644
--- a/java/org/apache/jasper/compiler/ELParser.java
+++ b/java/org/apache/jasper/compiler/ELParser.java
@@ -106,11 +106,17 @@ public class ELParser {
         ELexpr = new ELNode.Nodes();
         curToken = null;
         prevToken = null;
+        int openBraces = 0;
         while (hasNext()) {
             curToken = nextToken();
             if (curToken instanceof Char) {
                 if (curToken.toChar() == '}') {
-                    break;
+                    openBraces--;
+                    if (openBraces < 0) {
+                        break;
+                    }
+                } else if (curToken.toChar() == '{') {
+                    openBraces++;
                 }
                 buf.append(curToken.toString());
             } else {

==================================================
