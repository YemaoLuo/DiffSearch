10c7942700b1c57f79dbf482a3717f656ecba8a4
==================================================
- Add web.xml style annotations (run as, roles declarations, etc).
==================================================
Remy Maucherat
==================================================
Thu Apr 6 23:47:05 2006 +0000
==================================================
ContextConfig.java
- Add web.xml style annotations (run as, roles declarations, etc).
- Note: commented out EJB and web services (similarly, the Persistence* annotations were not there).
- Submitted by Fabien Carrion.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@392123 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WebAnnotationSet.java
index 676898ccee..c43fc89bfe 100644
--- a/java/org/apache/catalina/startup/ContextConfig.java
+++ b/java/org/apache/catalina/startup/ContextConfig.java
@@ -75,7 +75,7 @@ public class ContextConfig
     // ----------------------------------------------------- Instance Variables
 
 
-    /*
+    /**
      * Custom mappings of login methods to authenticators
      */
     protected Map customAuthenticators;
@@ -286,6 +286,23 @@ public class ContextConfig
     // -------------------------------------------------------- protected Methods
 
 
+    /**
+     * Process the application classes annotations, if it exists.
+     */
+    protected void applicationAnnotationsConfig() {
+        
+        long t1=System.currentTimeMillis();
+        
+        WebAnnotationSet.loadApplicationAnnotations(context);
+        
+        long t2=System.currentTimeMillis();
+        if (context instanceof StandardContext) {
+            ((StandardContext) context).setStartupTime(t2-t1+
+                    ((StandardContext) context).getStartupTime());
+        }
+    }
+
+
     /**
      * Process the application configuration file, if it exists.
      */
@@ -1032,6 +1049,9 @@ public class ContextConfig
         // Process the default and application web.xml files
         defaultWebConfig();
         applicationWebConfig();
+        if (!context.getIgnoreAnnotations()) {
+            applicationAnnotationsConfig();
+        }
         if (ok) {
             validateSecurityRoles();
         }

==================================================
