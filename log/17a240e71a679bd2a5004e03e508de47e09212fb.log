17a240e71a679bd2a5004e03e508de47e09212fb
==================================================
Improve processing for async IO errors so that it goes through the normal code (including the "free" buffer method).
==================================================
Remy Maucherat
==================================================
Mon Sep 14 13:31:30 2015 +0000
==================================================
Nio2Endpoint.java
Improve processing for async IO errors so that it goes through the normal code (including the "free" buffer method).

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1702949 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecureNio2Channel.java
index ae1fc71e0e..e1e5450164 100644
--- a/java/org/apache/tomcat/util/net/Nio2Endpoint.java
+++ b/java/org/apache/tomcat/util/net/Nio2Endpoint.java
@@ -1639,6 +1639,8 @@ public class Nio2Endpoint extends AbstractJsseEndpoint<Nio2Channel> {
                             if (socket.getSocket().isHandshakeComplete() ||
                                     status == SocketStatus.STOP) {
                                 handshake = 0;
+                            } else if (status == SocketStatus.ERROR) {
+                                handshake = -1;
                             } else {
                                 handshake = socket.getSocket().handshake();
                                 // The handshake process reads/writes from/to the

==================================================
