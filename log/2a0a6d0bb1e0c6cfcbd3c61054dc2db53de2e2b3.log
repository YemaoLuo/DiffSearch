2a0a6d0bb1e0c6cfcbd3c61054dc2db53de2e2b3
==================================================
Add SSLEngine.getApplicationProtocol() to JreCompat
==================================================
Mark Thomas
==================================================
Thu Jan 19 23:55:48 2017 +0000
==================================================
Jre9Compat.java
Add SSLEngine.getApplicationProtocol() to JreCompat

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1779542 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JreCompat.java
index 2b37c72e4f..9709b6e669 100644
--- a/java/org/apache/tomcat/util/compat/Jre9Compat.java
+++ b/java/org/apache/tomcat/util/compat/Jre9Compat.java
@@ -19,20 +19,24 @@ package org.apache.tomcat.util.compat;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 
+import javax.net.ssl.SSLEngine;
 import javax.net.ssl.SSLParameters;
 
 class Jre9Compat extends JreCompat {
 
     private static final Class<?> inaccessibleObjectExceptionClazz;
     private static final Method setApplicationProtocolsMethod;
+    private static final Method getApplicationProtocolMethod;
 
     static {
         Class<?> c1 = null;
         Method m2 = null;
+        Method m3 = null;
 
         try {
             c1 = Class.forName("java.lang.reflect.InaccessibleObjectException");
-            SSLParameters.class.getMethod("setApplicationProtocolsMethod", String[].class);
+            m2 = SSLParameters.class.getMethod("setApplicationProtocolsMethod", String[].class);
+            m3 = SSLEngine.class.getMethod("getApplicationProtocol");
         } catch (SecurityException | NoSuchMethodException e) {
             // Should never happen
         } catch (ClassNotFoundException e) {
@@ -40,6 +44,7 @@ class Jre9Compat extends JreCompat {
         }
         inaccessibleObjectExceptionClazz = c1;
         setApplicationProtocolsMethod = m2;
+        getApplicationProtocolMethod = m3;
     }
 
 
@@ -66,4 +71,14 @@ class Jre9Compat extends JreCompat {
             throw new UnsupportedOperationException(e);
         }
     }
+
+
+    @Override
+    public String getApplicationProtocol(SSLEngine sslEngine) {
+    	try {
+            return (String) getApplicationProtocolMethod.invoke(sslEngine);
+        } catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {
+            throw new UnsupportedOperationException(e);
+        }
+    }
 }

==================================================
