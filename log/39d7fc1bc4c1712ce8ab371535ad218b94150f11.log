39d7fc1bc4c1712ce8ab371535ad218b94150f11
==================================================
Make the CSRF nonce cache serializable to fix an issue reported on the users list.
==================================================
Mark Emlyn
==================================================
Mon Mar 21 22:08:47 2011 +0000
==================================================
CsrfPreventionFilter.java
Make the CSRF nonce cache serializable to fix an issue reported on the users list.
Custom serialization code could shave ~20% but the code isn't as clean.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1083987 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestCsrfPreventionFilter.java
index 7151907ac2..0189632561 100644
--- a/java/org/apache/catalina/filters/CsrfPreventionFilter.java
+++ b/java/org/apache/catalina/filters/CsrfPreventionFilter.java
@@ -18,6 +18,7 @@
 package org.apache.catalina.filters;
 
 import java.io.IOException;
+import java.io.Serializable;
 import java.security.SecureRandom;
 import java.util.HashSet;
 import java.util.LinkedHashMap;
@@ -287,7 +288,9 @@ public class CsrfPreventionFilter extends FilterBase {
         }
     }
     
-    private static class LruCache<T> {
+    protected static class LruCache<T> implements Serializable {
+
+        private static final long serialVersionUID = 1L;
 
         // Although the internal implementation uses a Map, this cache
         // implementation is only concerned with the keys.

==================================================
