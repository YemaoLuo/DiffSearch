790e4e365823d162e014ee16c786a2ed8d950a0c
==================================================
Throw exception if max message size is too big
==================================================
Mark Emlyn
==================================================
Mon Dec 16 19:23:39 2013 +0000
==================================================
PojoMessageHandlerWholeBinary.java
index fc5e01c5ba..fab5360161 100644
--- a/java/org/apache/tomcat/websocket/pojo/LocalStrings.properties
+++ b/java/org/apache/tomcat/websocket/pojo/LocalStrings.properties
@@ -36,4 +36,5 @@ pojoMethodMapping.partialObject=Invalid Object and boolean parameters present on
 pojoMethodMapping.partialPong=Invalid PongMesssge and boolean parameters present on the method [{0}] of class [{1}] that was annotated with OnMessage
 pojoMethodMapping.partialReader=Invalid Reader and boolean parameters present on the method [{0}] of class [{1}] that was annotated with OnMessage
 pojoMethodMapping.pongWithPayload=Invalid PongMessgae and Message parameters present on the method [{0}] of class [{1}] that was annotated with OnMessage
-pojoMessageHandlerWhole.decodeIoFail=IO error while decoding message
\ No newline at end of file
+pojoMessageHandlerWhole.decodeIoFail=IO error while decoding message
+pojoMessageHandlerWhole.maxBufferSize=The maximum supported message size for this implementation in Integer.MAX_VALUE

==================================================
PojoMessageHandlerWholeText.java
index 2da4a0ab39..2af4944a1c 100644
--- a/java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeBinary.java
+++ b/java/org/apache/tomcat/websocket/pojo/PojoMessageHandlerWholeBinary.java
@@ -56,7 +56,8 @@ public class PojoMessageHandlerWholeBinary
         // Update binary text size handled by session
         if (maxMessageSize > -1 && maxMessageSize > session.getMaxBinaryMessageBufferSize()) {
             if (maxMessageSize > Integer.MAX_VALUE) {
-                // IAE
+                throw new IllegalArgumentException(sm.getString(
+                        "pojoMessageHandlerWhole.maxBufferSize"));
             }
             session.setMaxBinaryMessageBufferSize((int) maxMessageSize);
         }

==================================================
