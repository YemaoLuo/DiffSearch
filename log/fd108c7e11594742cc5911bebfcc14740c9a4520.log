fd108c7e11594742cc5911bebfcc14740c9a4520
==================================================
Add some plumbing to make the HTTP session ID available to the WeBSocket session. This will be required to implement WebSocket 1.0, section 7.2.
==================================================
Mark Emlyn
==================================================
Fri Jun 28 12:55:21 2013 +0000
==================================================
WsSession.java
Add some plumbing to make the HTTP session ID available to the WeBSocket session. This will be required to implement WebSocket 1.0, section 7.2.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1497756 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsWebSocketContainer.java
index ea3a52e571..7e5f2806de 100644
--- a/java/org/apache/tomcat/websocket/WsSession.java
+++ b/java/org/apache/tomcat/websocket/WsSession.java
@@ -69,6 +69,7 @@ public class WsSession implements Session {
     private final String subProtocol;
     private final Map<String,String> pathParameters;
     private final boolean secure;
+    private final String httpSessionId;
     private final String id;
 
     // Expected to handle message types of <String> only
@@ -100,8 +101,8 @@ public class WsSession implements Session {
             WsRemoteEndpointImplBase wsRemoteEndpoint,
             WsWebSocketContainer wsWebSocketContainer,
             URI requestUri, Map<String,List<String>> requestParameterMap,
-            String queryString, Principal userPrincipal, String subProtocol,
-            Map<String,String> pathParameters,
+            String queryString, Principal userPrincipal, String httpSessionId,
+            String subProtocol, Map<String,String> pathParameters,
             boolean secure, EndpointConfig endpointConfig)
                     throws DeploymentException {
         this.localEndpoint = localEndpoint;
@@ -127,6 +128,7 @@ public class WsSession implements Session {
         }
         this.queryString = queryString;
         this.userPrincipal = userPrincipal;
+        this.httpSessionId = httpSessionId;
         if (subProtocol == null) {
             this.subProtocol = "";
         } else {
@@ -522,6 +524,11 @@ public class WsSession implements Session {
     }
 
 
+    protected String getHttpSessionId() {
+        return httpSessionId;
+    }
+
+
     protected MessageHandler getTextMessageHandler() {
         return textMessageHandler;
     }

==================================================
WsHttpUpgradeHandler.java
index 17397faa5e..f765f06037 100644
--- a/java/org/apache/tomcat/websocket/WsWebSocketContainer.java
+++ b/java/org/apache/tomcat/websocket/WsWebSocketContainer.java
@@ -330,7 +330,7 @@ public class WsWebSocketContainer
 
 
         WsSession wsSession = new WsSession(endpoint, wsRemoteEndpointClient,
-                this, null, null, null, null, subProtocol,
+                this, null, null, null, null, null, subProtocol,
                 Collections.EMPTY_MAP, false,
                 clientEndpointConfiguration);
         endpoint.onOpen(wsSession, clientEndpointConfiguration);

==================================================
