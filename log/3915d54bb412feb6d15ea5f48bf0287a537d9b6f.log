3915d54bb412feb6d15ea5f48bf0287a537d9b6f
==================================================
Mask the password through all the JMX operations
==================================================
Filip Hanik
==================================================
Tue Jan 11 17:28:05 2011 +0000
==================================================
PoolUtilities.java
index b3bf62aee0..1bcba8e94d 100644
--- a/modules/jdbc-pool/build.properties.default
+++ b/modules/jdbc-pool/build.properties.default
@@ -28,7 +28,7 @@
 version.major=1
 version.minor=0
 version.build=9
-version.patch=1
+version.patch=2
 version.suffix=
 
 # ----- Default Base Path for Dependent Packages -----

==================================================
PooledConnection.java
new file mode 100644
index 0000000000..0b2a5ed961
--- /dev/null
+++ b/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PoolUtilities.java
@@ -0,0 +1,43 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.tomcat.jdbc.pool;
+
+import java.util.Properties;
+
+/**
+ * 
+ * @author fhanik
+ *
+ */
+public class PoolUtilities {
+    
+    public static final String PROP_USER = "user";
+    
+    public static final String PROP_PASSWORD = "password";
+    
+    public static Properties clone(Properties p) {
+        Properties c = new Properties();
+        c.putAll(p);
+        return c;
+    }
+    
+    public static Properties cloneWithoutPassword(Properties p) {
+        Properties result = clone(p);
+        result.remove(PROP_PASSWORD);
+        return result;
+    }
+}

==================================================
ConnectionPool.java
index 4f622fe612..3f270a83e3 100644
--- a/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
+++ b/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
@@ -41,9 +41,9 @@ public class PooledConnection {
      */
     private static final Log log = LogFactory.getLog(PooledConnection.class);
 
-    public static final String PROP_USER = "user";
+    public static final String PROP_USER = PoolUtilities.PROP_USER;
     
-    public static final String PROP_PASSWORD = "password";
+    public static final String PROP_PASSWORD = PoolUtilities.PROP_PASSWORD;
     
     /**
      * Validate when connection is borrowed flag
@@ -61,7 +61,6 @@ public class PooledConnection {
      * Validate when connection is initialized flag
      */
     public static final int VALIDATE_INIT = 4;
-
     /**
      * The properties for the connection pool
      */
@@ -260,7 +259,7 @@ public class PooledConnection {
             pwd = poolProperties.getPassword();
             getAttributes().put(PROP_PASSWORD, pwd);
         }
-        Properties properties = clone(poolProperties.getDbProperties());
+        Properties properties = PoolUtilities.clone(poolProperties.getDbProperties());
         if (usr != null) properties.setProperty(PROP_USER, usr);
         if (pwd != null) properties.setProperty(PROP_PASSWORD, pwd);
 
@@ -287,12 +286,6 @@ public class PooledConnection {
         }
     }
     
-    private Properties clone(Properties p) {
-        Properties c = new Properties();
-        c.putAll(p);
-        return c;
-    }
-    
     /**
      * 
      * @return true if connect() was called successfully and disconnect has not yet been called

==================================================
Async0IdleTestBug50477.java
index 1f3381ee99..6911066dbe 100755
--- a/modules/jdbc-pool/sign.sh
+++ b/modules/jdbc-pool/sign.sh
@@ -15,7 +15,7 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-VERSION=v1.0.9.1
+VERSION=v1.0.9.2
 for i in $(find output/release/$VERSION -name "*.zip" -o -name "*.tar.gz"); do
   echo Signing $i
   echo $1|gpg --passphrase-fd 0 -a -b $i

==================================================
JmxPasswordTest.java
index cebc458be4..cfc92101e7 100644
--- a/modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/Async0IdleTestBug50477.java
+++ b/modules/jdbc-pool/test/org/apache/tomcat/jdbc/test/Async0IdleTestBug50477.java
@@ -1,4 +1,3 @@
-
 /*
  * Licensed to the Apache Software Foundation (ASF) under one or more
  * contributor license agreements.  See the NOTICE file distributed with

==================================================
