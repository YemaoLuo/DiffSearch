01b7779f3ac62215cd1be35674f5ae1628323a95
==================================================
Close streams
==================================================
Violeta Georgieva
==================================================
Tue Dec 29 18:16:28 2015 +0000
==================================================
TestSendFile.java
Close streams

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1722205 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestVirtualContext.java
index 4573a7a338..ec7e7bf9ac 100644
--- a/test/org/apache/catalina/connector/TestSendFile.java
+++ b/test/org/apache/catalina/connector/TestSendFile.java
@@ -86,21 +86,21 @@ public class TestSendFile extends TomcatBaseTest{
     }
 
     public File generateFile(String dir, String suffix, int size) throws IOException {
-        String name = "testSendFile-"+System.currentTimeMillis()+suffix+".txt";
-        File f = new File(dir,name);
-        FileWriter fw = new FileWriter(f, false);
-        BufferedWriter w = new BufferedWriter(fw);
-        int defSize = 8192;
-        while (size > 0) {
-            int bytes = Math.min(size, defSize);
-            char[] b = new char[bytes];
-            Arrays.fill(b, 'X');
-            w.write(b);
-            size = size - bytes;
+        String name = "testSendFile-" + System.currentTimeMillis() + suffix + ".txt";
+        File f = new File(dir, name);
+        try (FileWriter fw = new FileWriter(f, false); BufferedWriter w = new BufferedWriter(fw);) {
+            int defSize = 8192;
+            while (size > 0) {
+                int bytes = Math.min(size, defSize);
+                char[] b = new char[bytes];
+                Arrays.fill(b, 'X');
+                w.write(b);
+                size = size - bytes;
+            }
+            w.flush();
         }
-        w.flush();
-        w.close();
-        System.out.println("Created file:"+f.getAbsolutePath()+" with "+f.length()+" bytes.");
+        System.out.println("Created file:" + f.getAbsolutePath() + " with " + f.length()
+                + " bytes.");
         return f;
 
     }

==================================================
TestWebRuleSet.java
index f05f70cbcf..603ebe1698 100644
--- a/test/org/apache/catalina/loader/TestVirtualContext.java
+++ b/test/org/apache/catalina/loader/TestVirtualContext.java
@@ -266,15 +266,13 @@ public class TestVirtualContext extends TomcatBaseTest {
             new File(additionWebInfClasses,
                 MyAnnotatedServlet.class.getPackage().getName().replace('.', '/'));
         Assert.assertTrue(targetPackageForAnnotatedClass.mkdirs());
-        InputStream annotatedServletClassInputStream =
-            this.getClass().getResourceAsStream(
+        try (InputStream annotatedServletClassInputStream = this.getClass().getResourceAsStream(
                 MyAnnotatedServlet.class.getSimpleName() + ".class");
-        FileOutputStream annotatedServletClassOutputStream =
-            new FileOutputStream(new File(targetPackageForAnnotatedClass,
-                MyAnnotatedServlet.class.getSimpleName() + ".class"));
-        IOUtils.copy(annotatedServletClassInputStream, annotatedServletClassOutputStream);
-        annotatedServletClassInputStream.close();
-        annotatedServletClassOutputStream.close();
+                FileOutputStream annotatedServletClassOutputStream = new FileOutputStream(new File(
+                        targetPackageForAnnotatedClass, MyAnnotatedServlet.class.getSimpleName()
+                                + ".class"));) {
+            IOUtils.copy(annotatedServletClassInputStream, annotatedServletClassOutputStream);
+        }
 
         ctx.setResources(new StandardRoot(ctx));
         File f1 = new File("test/webapp-virtual-webapp/target/classes");

==================================================
