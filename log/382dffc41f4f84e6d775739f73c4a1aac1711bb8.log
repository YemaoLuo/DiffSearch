382dffc41f4f84e6d775739f73c4a1aac1711bb8
==================================================
Replace loops with Collection.removeIf() when possible
==================================================
Emmanuel Bourg
==================================================
Wed Dec 2 01:34:34 2020 +0100
==================================================
ApplicationPushBuilder.java
Replace loops with Collection.removeIf() when possible



==================================================
SSIMediator.java
index be03176297..0b5679b9e2 100644
--- a/java/org/apache/catalina/core/ApplicationPushBuilder.java
+++ b/java/org/apache/catalina/core/ApplicationPushBuilder.java
@@ -22,7 +22,6 @@ import java.util.Arrays;
 import java.util.Collections;
 import java.util.Enumeration;
 import java.util.HashSet;
-import java.util.Iterator;
 import java.util.List;
 import java.util.Locale;
 import java.util.Map;
@@ -147,13 +146,7 @@ public class ApplicationPushBuilder implements PushBuilder {
             if (responseCookie.getMaxAge() < 0) {
                 // Path information not available so can only remove based on
                 // name.
-                Iterator<Cookie> cookieIterator = cookies.iterator();
-                while (cookieIterator.hasNext()) {
-                    Cookie cookie = cookieIterator.next();
-                    if (cookie.getName().equals(responseCookie.getName())) {
-                        cookieIterator.remove();
-                    }
-                }
+                cookies.removeIf(cookie -> cookie.getName().equals(responseCookie.getName()));
             } else {
                 cookies.add(new Cookie(responseCookie.getName(), responseCookie.getValue()));
             }

==================================================
WebappServiceLoader.java
index 1a1c892511..3de7bd52ab 100644
--- a/java/org/apache/catalina/ssi/SSIMediator.java
+++ b/java/org/apache/catalina/ssi/SSIMediator.java
@@ -21,7 +21,6 @@ import java.nio.charset.StandardCharsets;
 import java.util.Collection;
 import java.util.Date;
 import java.util.HashSet;
-import java.util.Iterator;
 import java.util.Locale;
 import java.util.Set;
 import java.util.TimeZone;
@@ -127,13 +126,7 @@ public class SSIMediator {
         variableNames.add("LAST_MODIFIED");
         ssiExternalResolver.addVariableNames(variableNames);
         //Remove any variables that are reserved by this class
-        Iterator<String> iter = variableNames.iterator();
-        while (iter.hasNext()) {
-            String name = iter.next();
-            if (isNameReserved(name)) {
-                iter.remove();
-            }
-        }
+        variableNames.removeIf(this::isNameReserved);
         return variableNames;
     }
 

==================================================
BackportTranslations.java
index e222940529..3c0415af20 100644
--- a/java/org/apache/catalina/startup/WebappServiceLoader.java
+++ b/java/org/apache/catalina/startup/WebappServiceLoader.java
@@ -27,7 +27,6 @@ import java.util.ArrayList;
 import java.util.Collections;
 import java.util.Enumeration;
 import java.util.HashSet;
-import java.util.Iterator;
 import java.util.LinkedHashSet;
 import java.util.List;
 import java.util.Set;
@@ -124,12 +123,7 @@ public class WebappServiceLoader<T> {
 
         // Filter the discovered container SCIs if required
         if (containerSciFilterPattern != null) {
-            Iterator<String> iter = containerServiceClassNames.iterator();
-            while (iter.hasNext()) {
-                if (containerSciFilterPattern.matcher(iter.next()).find()) {
-                    iter.remove();
-                }
-            }
+            containerServiceClassNames.removeIf(s -> containerSciFilterPattern.matcher(s).find());
         }
 
         // Obtaining the application provided configuration files is a little

==================================================
WebXml.java
index 1da15de6f6..cb20a01940 100644
--- a/java/org/apache/tomcat/buildutil/translate/BackportTranslations.java
+++ b/java/org/apache/tomcat/buildutil/translate/BackportTranslations.java
@@ -17,8 +17,6 @@
 package org.apache.tomcat.buildutil.translate;
 
 import java.io.IOException;
-import java.util.Iterator;
-import java.util.Map;
 import java.util.Properties;
 
 /**
@@ -63,13 +61,7 @@ public class BackportTranslations extends BackportBase {
             }
 
             // Remove translated values for keys that have been removed
-            Iterator<Map.Entry<Object,Object>> iter = targetTranslated.entrySet().iterator();
-            while (iter.hasNext()) {
-                Map.Entry<Object,Object> entry = iter.next();
-                if (!targetEnglish.containsKey(entry.getKey())) {
-                    iter.remove();
-                }
-            }
+            targetTranslated.entrySet().removeIf(entry -> !targetEnglish.containsKey(entry.getKey()));
             Utils.export(language, targetTranslated, storageDir);
         }
     }

==================================================
BaseNotificationBroadcaster.java
index 6dfa5f5065..7720fa0217 100644
--- a/java/org/apache/tomcat/util/descriptor/web/WebXml.java
+++ b/java/org/apache/tomcat/util/descriptor/web/WebXml.java
@@ -2391,13 +2391,7 @@ public class WebXml extends XmlEncodingBase implements DocumentProperties.Charse
             names.add(fragment.getName());
         }
         for (WebXml fragment : group) {
-            Iterator<String> after = fragment.getAfterOrdering().iterator();
-            while (after.hasNext()) {
-                String entry = after.next();
-                if (!names.contains(entry)) {
-                    after.remove();
-                }
-            }
+            fragment.getAfterOrdering().removeIf(entry -> !names.contains(entry));
         }
     }
     private static void orderFragments(Set<WebXml> orderedFragments,

==================================================
