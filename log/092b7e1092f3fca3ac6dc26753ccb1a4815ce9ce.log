092b7e1092f3fca3ac6dc26753ccb1a4815ce9ce
==================================================
Add low effort null check in facade
==================================================
remm remm@apache.org
==================================================
Wed Jan 5 13:23:04 2022 +0100
==================================================
CoyoteInputStream.java
Add low effort null check in facade

isReady is a likely target for uncontrolled async access, so add a check
for null there to throw a more informative ISE if possible, like is done
in Request/ResponseFacade for the most common calls.
As seen in BZ65780 (when faced with a NPE, users always assume it is a
Tomcat bug)


==================================================
CoyoteOutputStream.java
index 2f6f2210ae..ac3ce2d13c 100644
--- a/java/org/apache/catalina/connector/CoyoteInputStream.java
+++ b/java/org/apache/catalina/connector/CoyoteInputStream.java
@@ -198,6 +198,9 @@ public class CoyoteInputStream extends ServletInputStream {
 
     @Override
     public boolean isReady() {
+        if (ib == null) {
+            throw new IllegalStateException(sm.getString("coyoteInputStream.null"));
+        }
         return ib.isReady();
     }
 

==================================================
