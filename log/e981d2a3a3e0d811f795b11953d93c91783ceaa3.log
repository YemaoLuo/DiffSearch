e981d2a3a3e0d811f795b11953d93c91783ceaa3
==================================================
Add a system property for cipher configuration. Add a "simple but safe" default cipher suite in catalina.properties. More complex cipher suites that have been proposed are either not as safe (weak ciphers present) or not very compatible according to my testing (OpenJDK has trouble, but the Oracle JVM fares better).
==================================================
Remy Maucherat
==================================================
Fri Jul 11 11:16:13 2014 +0000
==================================================
AbstractEndpoint.java
index ad860ac680..037ff92960 100644
--- a/conf/catalina.properties
+++ b/conf/catalina.properties
@@ -126,6 +126,11 @@ xom-*.jar
 # scan types by configuring a JarScanner with a nested JarScanFilter.
 tomcat.util.scan.StandardJarScanFilter.jarsToScan=log4j-core*.jar,log4j-taglib*.jar
 
+# Default SSL cipher suite
+# Other OpenSSL syntax cipher suites that can be used in Tomcat:
+# https://wiki.mozilla.org/Security/Server_Side_TLS
+tomcat.ssl.ciphers=HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5
+
 # String cache configuration.
 tomcat.util.buf.StringCache.byte.enabled=true
 #tomcat.util.buf.StringCache.char.enabled=true

==================================================
AprEndpoint.java
index 41113a12a5..7e5ba7fa3b 100644
--- a/java/org/apache/tomcat/util/net/AbstractEndpoint.java
+++ b/java/org/apache/tomcat/util/net/AbstractEndpoint.java
@@ -919,7 +919,7 @@ public abstract class AbstractEndpoint<S> {
     public String getSslProtocol() { return sslProtocol;}
     public void setSslProtocol(String s) { sslProtocol = s;}
 
-    private String ciphers = null;
+    private String ciphers = System.getProperty("tomcat.ssl.ciphers");
     public String getCiphers() { return ciphers;}
     public void setCiphers(String s) {
         ciphers = s;
@@ -1005,7 +1005,7 @@ public abstract class AbstractEndpoint<S> {
     }
 
 
-    private String[] sslEnabledProtocolsarr =  new String[0];
+    private String[] sslEnabledProtocolsarr = new String[0];
     public String[] getSslEnabledProtocolsArray() {
         return this.sslEnabledProtocolsarr;
     }

==================================================
JSSESocketFactory.java
index 4d75895143..4d10b3c2f8 100644
--- a/java/org/apache/tomcat/util/net/AprEndpoint.java
+++ b/java/org/apache/tomcat/util/net/AprEndpoint.java
@@ -218,7 +218,7 @@ public class AprEndpoint extends AbstractEndpoint<Long> {
     /**
      * SSL cipher suite.
      */
-    protected String SSLCipherSuite = "ALL";
+    protected String SSLCipherSuite = System.getProperty("tomcat.ssl.ciphers", "ALL");
     public String getSSLCipherSuite() { return SSLCipherSuite; }
     public void setSSLCipherSuite(String SSLCipherSuite) { this.SSLCipherSuite = SSLCipherSuite; }
 

==================================================
