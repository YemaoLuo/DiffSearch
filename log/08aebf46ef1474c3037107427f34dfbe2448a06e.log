08aebf46ef1474c3037107427f34dfbe2448a06e
==================================================
Improve error reporting.
==================================================
Mark Emlyn
==================================================
Wed Nov 13 11:19:26 2013 +0000
==================================================
TagLibraryInfoImpl.java
Improve error reporting.
- Be more precise about the location of the file with the error
- Don't swallow exceptions

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1541472 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JarFileUrlJar.java
index 71e024403b..e5231d868e 100644
--- a/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
+++ b/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
@@ -187,13 +187,13 @@ class TagLibraryInfoImpl extends TagLibraryInfo implements TagConstants {
                 }
             } else {
                 // Tag library is packaged in JAR file
+                String uriExternal = jar.getJarFileURL().toExternalForm();
                 try {
                     in = jar.getInputStream(tldName);
-                    parseTLD(jar.getJarFileURL().toExternalForm(), in, jar);
+                    parseTLD(uriExternal + "!/" + tldName, in, jar);
                 } catch (Exception ex) {
-                    err.jspError(mark, "jsp.error.tld.unable_to_read",
-                            jar.getJarFileURL().toExternalForm(), tldName,
-                            ex.toString());
+                    err.jspError(mark, ex, "jsp.error.tld.unable_to_read",
+                            uriExternal, tldName, ex.toString());
                 }
             }
         } finally {

==================================================
