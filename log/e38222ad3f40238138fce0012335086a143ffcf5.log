e38222ad3f40238138fce0012335086a143ffcf5
==================================================
WebSocket 1.0 implementation part 14 of many
==================================================
Mark Emlyn
==================================================
Wed Dec 12 21:08:11 2012 +0000
==================================================
WsProtocolHandler.java
WebSocket 1.0 implementation part 14 of many
Add a RemoteEndpoint implementation (just stubs)
Add the plumbing between the WsProtocolHandler and the RemoteEndpoint implementation.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1420971 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsRemoteEndpoint.java
index 3ae601420d..8721dccee0 100644
--- a/java/org/apache/tomcat/websocket/WsProtocolHandler.java
+++ b/java/org/apache/tomcat/websocket/WsProtocolHandler.java
@@ -64,7 +64,9 @@ public class WsProtocolHandler implements ProtocolHandler {
         }
         WsFrame wsFrame = new WsFrame(sis, wsSession);
         sis.setReadListener(new WsReadListener(this, wsFrame));
-        sos.setWriteListener(new WsWriteListener(this));
+        WsRemoteEndpoint wsRemoteEndpoint = new WsRemoteEndpoint(sos);
+        wsSession.setRemote(wsRemoteEndpoint);
+        sos.setWriteListener(new WsWriteListener(this, wsRemoteEndpoint));
     }
 
 
@@ -119,16 +121,18 @@ public class WsProtocolHandler implements ProtocolHandler {
     private static class WsWriteListener implements WriteListener {
 
         private final WsProtocolHandler wsProtocolHandler;
+        private final WsRemoteEndpoint wsRemoteEndpoint;
 
-
-        private WsWriteListener(WsProtocolHandler wsProtocolHandler) {
+        private WsWriteListener(WsProtocolHandler wsProtocolHandler,
+                WsRemoteEndpoint wsRemoteEndpoint) {
             this.wsProtocolHandler = wsProtocolHandler;
+            this.wsRemoteEndpoint = wsRemoteEndpoint;
         }
 
 
         @Override
         public void onWritePossible() {
-            // TODO Auto-generated method stub
+            wsRemoteEndpoint.onWritePossible();
         }
 
 

==================================================
WsSession.java
new file mode 100644
index 0000000000..405a109266
--- /dev/null
+++ b/java/org/apache/tomcat/websocket/WsRemoteEndpoint.java
@@ -0,0 +1,138 @@
+/*
+ *  Licensed to the Apache Software Foundation (ASF) under one or more
+ *  contributor license agreements.  See the NOTICE file distributed with
+ *  this work for additional information regarding copyright ownership.
+ *  The ASF licenses this file to You under the Apache License, Version 2.0
+ *  (the "License"); you may not use this file except in compliance with
+ *  the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ *  Unless required by applicable law or agreed to in writing, software
+ *  distributed under the License is distributed on an "AS IS" BASIS,
+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  See the License for the specific language governing permissions and
+ *  limitations under the License.
+ */
+package org.apache.tomcat.websocket;
+
+import java.io.IOException;
+import java.io.OutputStream;
+import java.io.Writer;
+import java.nio.ByteBuffer;
+import java.util.concurrent.Future;
+
+import javax.servlet.ServletOutputStream;
+import javax.websocket.EncodeException;
+import javax.websocket.RemoteEndpoint;
+import javax.websocket.SendHandler;
+import javax.websocket.SendResult;
+
+public class WsRemoteEndpoint implements RemoteEndpoint {
+
+    private final ServletOutputStream sos;
+
+    public WsRemoteEndpoint(ServletOutputStream sos) {
+        this.sos = sos;
+    }
+
+    public void onWritePossible() {
+        // TODO
+    }
+
+    @Override
+    public void sendString(String text) throws IOException {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public void sendBytes(ByteBuffer data) throws IOException {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public void sendPartialString(String fragment, boolean isLast)
+            throws IOException {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public void sendPartialBytes(ByteBuffer partialByte, boolean isLast)
+            throws IOException {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public OutputStream getSendStream() throws IOException {
+        // TODO Auto-generated method stub
+        return null;
+    }
+
+
+    @Override
+    public Writer getSendWriter() throws IOException {
+        // TODO Auto-generated method stub
+        return null;
+    }
+
+
+    @Override
+    public void sendObject(Object o) throws IOException, EncodeException {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public void sendStringByCompletion(String text, SendHandler completion) {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public Future<SendResult> sendStringByFuture(String text) {
+        // TODO Auto-generated method stub
+        return null;
+    }
+
+
+    @Override
+    public Future<SendResult> sendBytesByFuture(ByteBuffer data) {
+        // TODO Auto-generated method stub
+        return null;
+    }
+
+
+    @Override
+    public void sendBytesByCompletion(ByteBuffer data, SendHandler completion) {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public Future<SendResult> sendObjectByFuture(Object obj) {
+        // TODO Auto-generated method stub
+        return null;
+    }
+
+
+    @Override
+    public void sendObjectByCompletion(Object obj, SendHandler completion) {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public void sendPing(ByteBuffer applicationData) {
+        // TODO Auto-generated method stub
+    }
+
+
+    @Override
+    public void sendPong(ByteBuffer applicationData) {
+        // TODO Auto-generated method stub
+    }
+}

==================================================
