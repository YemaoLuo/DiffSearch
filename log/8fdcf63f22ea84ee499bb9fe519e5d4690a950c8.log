8fdcf63f22ea84ee499bb9fe519e5d4690a950c8
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54716
==================================================
Mark Emlyn
==================================================
Tue Mar 19 19:58:34 2013 +0000
==================================================
BackgroundProcessManager.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54716
Additional fix. Avoid NPE on session de-registration.
Based on a patch by Nick Williams.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1458484 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsWebSocketContainer.java
index b55a45ae63..ccb6d868b7 100644
--- a/java/org/apache/tomcat/websocket/BackgroundProcessManager.java
+++ b/java/org/apache/tomcat/websocket/BackgroundProcessManager.java
@@ -71,7 +71,7 @@ public class BackgroundProcessManager {
     public void unregister(BackgroundProcess process) {
         synchronized (processesLock) {
             processes.remove(process);
-            if (processes.size() == 0) {
+            if (wsBackgroundThread != null && processes.size() == 0) {
                 wsBackgroundThread.halt();
                 wsBackgroundThread = null;
             }

==================================================
