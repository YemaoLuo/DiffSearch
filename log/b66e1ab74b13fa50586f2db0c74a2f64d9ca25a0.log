b66e1ab74b13fa50586f2db0c74a2f64d9ca25a0
==================================================
Add getTrailerFields() method to HttpServletResponse to align Tomcat's Servlet API implementation with the 4.0 release
==================================================
Mark Thomas
==================================================
Thu Sep 21 21:07:12 2017 +0000
==================================================
HttpServletResponse.java
Add getTrailerFields() method to HttpServletResponse to align Tomcat's Servlet API implementation with the 4.0 release

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1809228 13f79535-47bb-0310-9956-ffa450edef68



==================================================
HttpServletResponseWrapper.java
index 2f28d18d9e..a108654277 100644
--- a/java/javax/servlet/http/HttpServletResponse.java
+++ b/java/javax/servlet/http/HttpServletResponse.java
@@ -348,6 +348,8 @@ public interface HttpServletResponse extends ServletResponse {
      * <br>
      * Trailers that don't meet the requirements of RFC 7230, section 4.1.2 will
      * be ignored.
+     * <br>
+     * The default implementation is a NO-OP.
      *
      * @param supplier The supplier for the trailer headers
      *
@@ -361,6 +363,19 @@ public interface HttpServletResponse extends ServletResponse {
         // NO-OP
     }
 
+    /**
+     * Obtain the supplier of the trailer headers.
+     * <br>
+     * The default implementation returns null.
+     *
+     * @return The supplier for the trailer headers
+     *
+     * @since Servlet 4.0
+     */
+    public default Supplier<Map<String, String>> getTrailerFields() {
+        return null;
+    }
+
     /*
      * Server status codes; see RFC 2068.
      */

==================================================
Response.java
index 0855a37a54..ffe61f3816 100644
--- a/java/javax/servlet/http/HttpServletResponseWrapper.java
+++ b/java/javax/servlet/http/HttpServletResponseWrapper.java
@@ -282,4 +282,18 @@ public class HttpServletResponseWrapper extends ServletResponseWrapper
     public void setTrailerFields(Supplier<Map<String, String>> supplier) {
         this._getHttpServletResponse().setTrailerFields(supplier);
     }
+
+    /**
+     * {@inheritDoc}
+     * <p>
+     * The default implementation is to call
+     * {@link HttpServletResponse#getTrailerFields()}
+     * on the wrapper {@link HttpServletResponse}.
+     *
+     * @since Servlet 4.0
+     */
+    @Override
+    public Supplier<Map<String, String>> getTrailerFields() {
+        return this._getHttpServletResponse().getTrailerFields();
+    }
 }

==================================================
ResponseFacade.java
index d9306c5fb1..db21a01047 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -1159,6 +1159,12 @@ public class Response implements HttpServletResponse {
     }
 
 
+    @Override
+    public Supplier<Map<String, String>> getTrailerFields() {
+        return getCoyoteResponse().getTrailerFields();
+    }
+
+
     /**
      * Encode the session identifier associated with this response
      * into the specified redirect URL, if necessary.

==================================================
TesterHttpServletResponse.java
index 2efb02fe0e..6c04b17de2 100644
--- a/java/org/apache/catalina/connector/ResponseFacade.java
+++ b/java/org/apache/catalina/connector/ResponseFacade.java
@@ -648,4 +648,10 @@ public class ResponseFacade implements HttpServletResponse {
     public void setTrailerFields(Supplier<Map<String, String>> supplier) {
         response.setTrailerFields(supplier);
     }
+
+
+    @Override
+    public Supplier<Map<String, String>> getTrailerFields() {
+        return response.getTrailerFields();
+    }
 }

==================================================
