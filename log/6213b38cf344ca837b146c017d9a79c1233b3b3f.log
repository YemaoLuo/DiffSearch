6213b38cf344ca837b146c017d9a79c1233b3b3f
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52135
==================================================
Mark Emlyn
==================================================
Sat Jun 30 13:06:27 2012 +0000
==================================================
StandardContext.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52135
Implement support for a default error page. It appears that this was meant to be in the 3.0 spec but got left out in error.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1355726 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardHostValve.java
index 266470a4b6..b2a99abf7a 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -556,7 +556,8 @@ public class StandardContext extends ContainerBase
 
     /**
      * The status code error pages for this web application, keyed by
-     * HTTP status code (as an Integer).
+     * HTTP status code (as an Integer). Note status code zero is used for the
+     * default error page.
      */
     private HashMap<Integer, ErrorPage> statusPages =
         new HashMap<Integer, ErrorPage>();

==================================================
ErrorPage.java
index f8baff7477..d61cfc704c 100644
--- a/java/org/apache/catalina/core/StandardHostValve.java
+++ b/java/org/apache/catalina/core/StandardHostValve.java
@@ -279,6 +279,10 @@ final class StandardHostValve extends ValveBase {
         }
 
         ErrorPage errorPage = context.findErrorPage(statusCode);
+        if (errorPage == null) {
+            // Look for a default error page
+            errorPage = context.findErrorPage(0);
+        }
         if (errorPage != null) {
             response.setAppCommitted(false);
             request.setAttribute(RequestDispatcher.ERROR_STATUS_CODE,

==================================================
TestStandardHostValve.java
index 01ba94c493..3114fcc966 100644
--- a/java/org/apache/catalina/deploy/ErrorPage.java
+++ b/java/org/apache/catalina/deploy/ErrorPage.java
@@ -41,7 +41,8 @@ public class ErrorPage implements Serializable {
 
 
     /**
-     * The error (status) code for which this error page is active.
+     * The error (status) code for which this error page is active. Note that
+     * status code 0 is used for the default error page.
      */
     private int errorCode = 0;
 

==================================================
