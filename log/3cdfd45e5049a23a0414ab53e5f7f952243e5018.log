3cdfd45e5049a23a0414ab53e5f7f952243e5018
==================================================
Refactor to retain original behaviour
==================================================
Mark Thomas
==================================================
Wed Jan 18 18:10:00 2023 +0000
==================================================
Response.java
Refactor to retain original behaviour

Setting an invalid encoding should still set the encoding name


==================================================
CharsetHolder.java
index f5fb215c22..1c9008765b 100644
--- a/java/org/apache/coyote/Response.java
+++ b/java/org/apache/coyote/Response.java
@@ -502,7 +502,8 @@ public final class Response {
             return;
         }
 
-        charsetHolder = CharsetHolder.getValidatedInstance(characterEncoding);
+        charsetHolder = CharsetHolder.getInstance(characterEncoding);
+        charsetHolder.validate();
     }
 
 
@@ -562,8 +563,9 @@ public final class Response {
             this.contentType = m.toStringNoCharset();
             charsetValue = charsetValue.trim();
             if (charsetValue.length() > 0) {
+                charsetHolder = CharsetHolder.getInstance(charsetValue);
                 try {
-                    charsetHolder = CharsetHolder.getValidatedInstance(charsetValue);
+                    charsetHolder.validate();
                 } catch (UnsupportedEncodingException e) {
                     log.warn(sm.getString("response.encoding.invalid", charsetValue), e);
                 }

==================================================
