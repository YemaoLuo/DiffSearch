e329ceb5c7aa51c33f036b375e88d7e35cc50706
==================================================
Switch to using LongAddr to track request/error count for servlets
==================================================
Mark Thomas
==================================================
Tue Jan 24 13:22:34 2023 +0000
==================================================
StandardContext.java
Switch to using LongAddr to track request/error count for servlets


==================================================
StandardWrapper.java
index e0ca2f97c5..be5d325a72 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -4094,14 +4094,10 @@ public class StandardContext extends ContainerBase implements Context, Notificat
      * Gets the cumulative request count of all servlets in this StandardContext.
      *
      * @return Cumulative request count of all servlets in this StandardContext
-     *
-     * @deprecated The return type will change to long in Tomcat 11 onwards. Callers of this method should switch to
-     *                 storing the result of calls to this method in a long value rather than an int.
      */
-    @Deprecated
-    public int getRequestCount() {
+    public long getRequestCount() {
 
-        int result = 0;
+        long result = 0;
 
         Container[] children = findChildren();
         if (children != null) {
@@ -4117,14 +4113,10 @@ public class StandardContext extends ContainerBase implements Context, Notificat
      * Gets the cumulative error count of all servlets in this StandardContext.
      *
      * @return Cumulative error count of all servlets in this StandardContext
-     *
-     * @deprecated The return type will change to long in Tomcat 11 onwards. Callers of this method should switch to
-     *                 storing the result of calls to this method in a long value rather than an int.
      */
-    @Deprecated
-    public int getErrorCount() {
+    public long getErrorCount() {
 
-        int result = 0;
+        long result = 0;
 
         Container[] children = findChildren();
         if (children != null) {

==================================================
StandardWrapperValve.java
index d0d89d3aec..a3006fb496 100644
--- a/java/org/apache/catalina/core/StandardWrapper.java
+++ b/java/org/apache/catalina/core/StandardWrapper.java
@@ -1178,12 +1178,8 @@ public class StandardWrapper extends ContainerBase implements ServletConfig, Wra
      * Returns the number of requests processed by the wrapper.
      *
      * @return the number of requests processed by the wrapper.
-     *
-     * @deprecated The return type will change to long in Tomcat 11 onwards. Callers of this method should switch to
-     *                 storing the result of calls to this method in a long value rather than an int.
      */
-    @Deprecated
-    public int getRequestCount() {
+    public long getRequestCount() {
         return swValve.getRequestCount();
     }
 
@@ -1191,12 +1187,8 @@ public class StandardWrapper extends ContainerBase implements ServletConfig, Wra
      * Returns the number of requests processed by the wrapper that resulted in an error.
      *
      * @return the number of requests processed by the wrapper that resulted in an error.
-     *
-     * @deprecated The return type will change to long in Tomcat 11 onwards. Callers of this method should switch to
-     *                 storing the result of calls to this method in a long value rather than an int.
      */
-    @Deprecated
-    public int getErrorCount() {
+    public long getErrorCount() {
         return swValve.getErrorCount();
     }
 

==================================================
