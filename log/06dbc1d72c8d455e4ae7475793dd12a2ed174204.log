06dbc1d72c8d455e4ae7475793dd12a2ed174204
==================================================
Align ActionCode.COMMIT
==================================================
Mark Thomas
==================================================
Fri Aug 12 07:45:38 2016 +0000
==================================================
Http11Processor.java
Align ActionCode.COMMIT

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1756083 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StreamProcessor.java
index 00b67da880..ae386802bc 100644
--- a/java/org/apache/coyote/http11/Http11Processor.java
+++ b/java/org/apache/coyote/http11/Http11Processor.java
@@ -655,7 +655,6 @@ public class Http11Processor extends AbstractProcessor {
                 try {
                     // Validate and write response headers
                     prepareResponse();
-                    outputBuffer.commit();
                 } catch (IOException e) {
                     setErrorState(ErrorState.CLOSE_CONNECTION_NOW, e);
                 }
@@ -1439,7 +1438,7 @@ public class Http11Processor extends AbstractProcessor {
      * When committing the response, we have to validate the set of headers, as
      * well as setup the response filters.
      */
-    private void prepareResponse() {
+    private void prepareResponse() throws IOException {
 
         boolean entityBody = true;
         contentDelimitation = false;
@@ -1448,8 +1447,8 @@ public class Http11Processor extends AbstractProcessor {
 
         if (http09 == true) {
             // HTTP/0.9
-            outputBuffer.addActiveFilter
-                (outputFilters[Constants.IDENTITY_FILTER]);
+            outputBuffer.addActiveFilter(outputFilters[Constants.IDENTITY_FILTER]);
+            outputBuffer.commit();
             return;
         }
 
@@ -1603,6 +1602,7 @@ public class Http11Processor extends AbstractProcessor {
         }
         outputBuffer.endHeaders();
 
+        outputBuffer.commit();
     }
 
     private static boolean isConnectionClose(MimeHeaders headers) {

==================================================
