b9d5d658626b551b0ec60318d3a4bb2811eba6b6
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59450
==================================================
Mark Thomas
==================================================
Tue May 10 09:06:39 2016 +0000
==================================================
LegacyCookieProcessor.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59450
Correctly handle the case where the LegacyCookieProcessor is configured with allowHttpSepsInV0 set to false and forwardSlashIsSeparator set to true.
Patch provided by Kyohei Nakamura.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1743134 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestCookieProcessorGeneration.java
index fc91cb80a1..e0822b776c 100644
--- a/java/org/apache/tomcat/util/http/LegacyCookieProcessor.java
+++ b/java/org/apache/tomcat/util/http/LegacyCookieProcessor.java
@@ -179,9 +179,9 @@ public final class LegacyCookieProcessor implements CookieProcessor {
             }
         }
         if (getForwardSlashIsSeparator() && !allowHttpSepsInV0) {
-            allowedWithoutQuotes.set('/');
-        } else {
             allowedWithoutQuotes.clear('/');
+        } else {
+            allowedWithoutQuotes.set('/');
         }
     }
 
@@ -198,9 +198,9 @@ public final class LegacyCookieProcessor implements CookieProcessor {
             httpSeparatorFlags.clear('/');
         }
         if (forwardSlashIsSeparator && !getAllowHttpSepsInV0()) {
-            allowedWithoutQuotes.set('/');
-        } else {
             allowedWithoutQuotes.clear('/');
+        } else {
+            allowedWithoutQuotes.set('/');
         }
     }
 

==================================================
