82ba76c711234cd8d41cff915dfce1371aea4ad0
==================================================
Fix NPE to use Http11NioProtocol handler with default parameters!
==================================================
Peter Rossbach
==================================================
Fri Nov 7 21:40:37 2008 +0000
==================================================
NioEndpoint.java
Fix NPE to use Http11NioProtocol handler with default parameters!
# example:
<Executor name="tomcatThreadPool" namePrefix="catalina-exec-" 
        maxThreads="150" minSpareThreads="4"/>
<Connector executor="tomcatThreadPool"
               port="8080" protocol="org.apache.coyote.http11.Http11NioProtocol" 
               connectionTimeout="20000" 
               redirectPort="8443" />

Used at MAC OS X with "-Djava.net.preferIPv4Stack=true"

I am not sure that default returns are correct!

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@712278 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SocketProperties.java
index a53f93f9ec..57f61ddd7f 100644
--- a/java/org/apache/tomcat/util/net/NioEndpoint.java
+++ b/java/org/apache/tomcat/util/net/NioEndpoint.java
@@ -735,7 +735,12 @@ public class NioEndpoint {
             return;
 
         serverSock = ServerSocketChannel.open();
-        serverSock.socket().setPerformancePreferences(socketProperties.getPerformanceConnectionTime(),
+        int performanceConnectionTime = socketProperties.getPerformanceConnectionTime();
+        int performanceLatency= socketProperties.getPerformanceLatency();
+        int performanceBandwidth = socketProperties.getPerformanceBandwidth();
+        if (performanceConnectionTime != -1 && performanceLatency != -1 &&
+                performanceBandwidth != -1)
+            serverSock.socket().setPerformancePreferences(socketProperties.getPerformanceConnectionTime(),
                                                       socketProperties.getPerformanceLatency(),
                                                       socketProperties.getPerformanceBandwidth());
         InetSocketAddress addr = (address!=null?new InetSocketAddress(address,port):new InetSocketAddress(port));

==================================================
