3b81c38ec9a5ed32787aff70c0c4448fbb3d4c49
==================================================
Switch all the FileResource based tests to use dedicated temporary directories for all read/write tests.
==================================================
Mark Thomas
==================================================
Tue Sep 22 22:14:01 2015 +0000
==================================================
AbstractTestFileResourceSet.java
Switch all the FileResource based tests to use dedicated temporary directories for all read/write tests.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1704744 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestFileResourceSet.java
index 32adaa44e5..3bd30c6c7a 100644
--- a/test/org/apache/catalina/webresources/AbstractTestFileResourceSet.java
+++ b/test/org/apache/catalina/webresources/AbstractTestFileResourceSet.java
@@ -31,6 +31,8 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
         this.readOnly = readOnly;
     }
 
+    protected abstract String getDir1();
+
     @Override
     public WebResourceRoot getWebResourceRoot() {
         TesterWebResourceRoot root = new TesterWebResourceRoot();
@@ -39,22 +41,22 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
         root.setMainResources(webResourceSet);
 
         WebResourceSet f1 = new FileResourceSet(root, "/f1.txt",
-                "test/webresources/dir1/f1.txt", "/");
+                getDir1() + "/f1.txt", "/");
         f1.setReadOnly(readOnly);
         root.addPreResources(f1);
 
         WebResourceSet f2 = new FileResourceSet(root, "/f2.txt",
-                "test/webresources/dir1/f2.txt", "/");
+                getDir1() + "/f2.txt", "/");
         f2.setReadOnly(readOnly);
         root.addPreResources(f2);
 
         WebResourceSet d1f1 = new FileResourceSet(root, "/d1/d1-f1.txt",
-                "test/webresources/dir1/d1/d1-f1.txt", "/");
+                getDir1() + "/d1/d1-f1.txt", "/");
         d1f1.setReadOnly(readOnly);
         root.addPreResources(d1f1);
 
         WebResourceSet d2f1 = new FileResourceSet(root, "/d2/d2-f1.txt",
-                "test/webresources/dir1/d2/d2-f1.txt", "/");
+                getDir1() + "/d2/d2-f1.txt", "/");
         d2f1.setReadOnly(readOnly);
         root.addPreResources(d2f1);
 

==================================================
TestFileResourceSetReadOnly.java
index 5a0829d837..9050f754fa 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSet.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSet.java
@@ -16,9 +16,42 @@
  */
 package org.apache.catalina.webresources;
 
+import java.io.File;
+import java.io.IOException;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.nio.file.attribute.FileAttribute;
+
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
+
+import org.apache.catalina.startup.ExpandWar;
+import org.apache.catalina.startup.TomcatBaseTest;
+
 public class TestFileResourceSet extends AbstractTestFileResourceSet {
 
+    private static Path tempDir;
+    private static File dir1;
+
+    @BeforeClass
+    public static void before() throws IOException {
+        tempDir = Files.createTempDirectory("test", new FileAttribute[0]);
+        dir1 = new File(tempDir.toFile(), "dir1");
+        TomcatBaseTest.recurrsiveCopy(new File("test/webresources/dir1").toPath(), dir1.toPath());
+    }
+
+    @AfterClass
+    public static void after() {
+        ExpandWar.delete(tempDir.toFile());
+    }
+
+
     public TestFileResourceSet() {
         super(false);
     }
+
+    @Override
+    protected String getDir1() {
+        return dir1.getAbsolutePath();
+    }
 }
\ No newline at end of file

==================================================
TestFileResourceSetVirtual.java
index 8b473074cd..6a57fb8a18 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSetReadOnly.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSetReadOnly.java
@@ -18,7 +18,14 @@ package org.apache.catalina.webresources;
 
 public class TestFileResourceSetReadOnly extends AbstractTestFileResourceSet {
 
+    private static final String dir1 = "test/webresources/dir1";
+
     public TestFileResourceSetReadOnly() {
         super(true);
     }
+
+    @Override
+    protected String getDir1() {
+        return dir1;
+    }
 }
\ No newline at end of file

==================================================
