5dcc6407bc6c492e6aba728a234da2dc84aa29fa
==================================================
Fix NIO2 with AJP.
==================================================
Mark Thomas
==================================================
Sun Nov 23 22:50:09 2014 +0000
==================================================
AbstractProtocol.java
Fix NIO2 with AJP.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1641275 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Nio2Endpoint.java
index 13108200c9..3a4cd3cf94 100644
--- a/java/org/apache/coyote/AbstractProtocol.java
+++ b/java/org/apache/coyote/AbstractProtocol.java
@@ -693,7 +693,7 @@ public abstract class AbstractProtocol<S> implements ProtocolHandler,
                     // In keep-alive but between requests. OK to recycle
                     // processor. Continue to poll for the next request.
                     connections.remove(socket);
-                    release(wrapper, processor, false, true);
+                    release(wrapper, processor, false, false);
                 } else if (state == SocketState.SENDFILE) {
                     // Sendfile in progress. If it fails, the socket will be
                     // closed. If it works, the socket will be re-added to the

==================================================
