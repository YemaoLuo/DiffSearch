a6e3899d1922f23e629fe96709825b308a76d8cb
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61568
==================================================
Mark Thomas
==================================================
Fri Oct 6 13:15:57 2017 +0000
==================================================
PrivilegedSetTccl.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61568
Avoid a potential SecurityException when using the NIO2 connector and a new thread is added to the pool.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1811328 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TaskThreadFactory.java
index 2f70492f8d..739d915794 100644
--- a/java/org/apache/tomcat/util/security/PrivilegedSetTccl.java
+++ b/java/org/apache/tomcat/util/security/PrivilegedSetTccl.java
@@ -20,15 +20,22 @@ import java.security.PrivilegedAction;
 
 public class PrivilegedSetTccl implements PrivilegedAction<Void> {
 
-    private ClassLoader cl;
+    private final ClassLoader cl;
+    private final Thread t;
 
     public PrivilegedSetTccl(ClassLoader cl) {
+        this(Thread.currentThread(), cl);
+    }
+
+    public PrivilegedSetTccl(Thread t, ClassLoader cl) {
+        this.t = t;
         this.cl = cl;
     }
 
+
     @Override
     public Void run() {
-        Thread.currentThread().setContextClassLoader(cl);
+        t.setContextClassLoader(cl);
         return null;
     }
 }
\ No newline at end of file

==================================================
