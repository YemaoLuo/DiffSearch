7fe3749c050a81c69624cfd3ad447635ea70161b
==================================================
added in notes to myself about blocking the poller thread, that should be prohibited
==================================================
Filip Hanik
==================================================
Wed Feb 21 03:47:05 2007 +0000
==================================================
NioBlockingSelector.java
added in notes to myself about blocking the poller thread, that should be prohibited


git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@509880 13f79535-47bb-0310-9956-ffa450edef68



==================================================
NioEndpoint.java
index e046caa6d1..b9519cb351 100644
--- a/java/org/apache/tomcat/util/net/NioBlockingSelector.java
+++ b/java/org/apache/tomcat/util/net/NioBlockingSelector.java
@@ -68,6 +68,7 @@ public class NioBlockingSelector {
                     att.startLatch(1);
                     socket.getPoller().add(socket,SelectionKey.OP_WRITE);
                     att.getLatch().await(writeTimeout,TimeUnit.MILLISECONDS);
+                    att.resetLatch();
                 }catch (InterruptedException ignore) {
                 }
                 if ( att.getLatch() == null ) keycount = 1;
@@ -124,6 +125,7 @@ public class NioBlockingSelector {
                     att.startLatch(1);
                     socket.getPoller().add(socket,SelectionKey.OP_READ);
                     att.getLatch().await(readTimeout,TimeUnit.MILLISECONDS);
+                    att.resetLatch();
                 }catch (InterruptedException ignore) {
                 }
                 if ( att.getLatch() == null ) keycount = 1;

==================================================
