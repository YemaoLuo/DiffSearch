39eb4d690c60c73ef620cfaefa81dc8f40462c9e
==================================================
Pull up creation of Handler
==================================================
asf-sync-process asf-sync-process@unknown
==================================================
Sun Nov 8 16:53:06 2015 +0000
==================================================
AbstractAjpProtocol.java
Pull up creation of Handler

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1713252 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpAprProtocol.java
index f6950e5159..7de8b6b03d 100644
--- a/java/org/apache/coyote/ajp/AbstractAjpProtocol.java
+++ b/java/org/apache/coyote/ajp/AbstractAjpProtocol.java
@@ -48,6 +48,9 @@ public abstract class AbstractAjpProtocol<S> extends AbstractProtocol<S> {
         setSoTimeout(Constants.DEFAULT_CONNECTION_TIMEOUT);
         // AJP does not use Send File
         getEndpoint().setUseSendfile(false);
+        AjpConnectionHandler<S> cHandler = new AjpConnectionHandler<>(this);
+        setHandler(cHandler);
+        getEndpoint().setHandler(cHandler);
     }
 
 

==================================================
AjpNio2Protocol.java
index a0848badda..936810f40c 100644
--- a/java/org/apache/coyote/ajp/AjpAprProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpAprProtocol.java
@@ -44,9 +44,6 @@ public class AjpAprProtocol extends AbstractAjpProtocol<Long> {
 
     public AjpAprProtocol() {
         super(new AprEndpoint());
-        AjpConnectionHandler<Long> cHandler = new AjpConnectionHandler<>(this);
-        setHandler(cHandler);
-        ((AprEndpoint) getEndpoint()).setHandler(cHandler);
     }
 
 

==================================================
AjpNioProtocol.java
index 17268de08a..eee83cce64 100644
--- a/java/org/apache/coyote/ajp/AjpNio2Protocol.java
+++ b/java/org/apache/coyote/ajp/AjpNio2Protocol.java
@@ -37,9 +37,6 @@ public class AjpNio2Protocol extends AbstractAjpProtocol<Nio2Channel> {
 
     public AjpNio2Protocol() {
         super(new Nio2Endpoint());
-        AjpConnectionHandler<Nio2Channel> cHandler = new AjpConnectionHandler<>(this);
-        setHandler(cHandler);
-        ((Nio2Endpoint) getEndpoint()).setHandler(cHandler);
     }
 
 

==================================================
AbstractHttp11Protocol.java
index 0dafa4504d..6876f1857d 100644
--- a/java/org/apache/coyote/ajp/AjpNioProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpNioProtocol.java
@@ -36,9 +36,6 @@ public class AjpNioProtocol extends AbstractAjpProtocol<NioChannel> {
 
     public AjpNioProtocol() {
         super(new NioEndpoint());
-        AjpConnectionHandler<NioChannel> cHandler = new AjpConnectionHandler<>(this);
-        setHandler(cHandler);
-        ((NioEndpoint) getEndpoint()).setHandler(cHandler);
     }
 
 

==================================================
Http11AprProtocol.java
index 42c8dc13ca..2ac2efba04 100644
--- a/java/org/apache/coyote/http11/AbstractHttp11Protocol.java
+++ b/java/org/apache/coyote/http11/AbstractHttp11Protocol.java
@@ -53,6 +53,9 @@ public abstract class AbstractHttp11Protocol<S> extends AbstractProtocol<S> {
     public AbstractHttp11Protocol(AbstractEndpoint<S> endpoint) {
         super(endpoint);
         setSoTimeout(Constants.DEFAULT_CONNECTION_TIMEOUT);
+        Http11ConnectionHandler<S> cHandler = new Http11ConnectionHandler<>(this);
+        setHandler(cHandler);
+        getEndpoint().setHandler(cHandler);
     }
 
 

==================================================
Http11Nio2Protocol.java
index bac73c1535..1c3d8637f5 100644
--- a/java/org/apache/coyote/http11/Http11AprProtocol.java
+++ b/java/org/apache/coyote/http11/Http11AprProtocol.java
@@ -35,9 +35,6 @@ public class Http11AprProtocol extends AbstractHttp11Protocol<Long> {
 
     public Http11AprProtocol() {
         super(new AprEndpoint());
-        Http11ConnectionHandler<Long> cHandler = new Http11ConnectionHandler<>(this);
-        setHandler(cHandler);
-        getEndpoint().setHandler(cHandler);
     }
 
 

==================================================
Http11NioProtocol.java
index 7a5fad072a..9ec47a6a12 100644
--- a/java/org/apache/coyote/http11/Http11Nio2Protocol.java
+++ b/java/org/apache/coyote/http11/Http11Nio2Protocol.java
@@ -32,9 +32,6 @@ public class Http11Nio2Protocol extends AbstractHttp11JsseProtocol<Nio2Channel>
 
     public Http11Nio2Protocol() {
         super(new Nio2Endpoint());
-        Http11ConnectionHandler<Nio2Channel> cHandler = new Http11ConnectionHandler<>(this);
-        setHandler(cHandler);
-        getEndpoint().setHandler(cHandler);
     }
 
 

==================================================
