266cdbd3aa8ace9ccbc6f25fa6d2d125d4686c62
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61086
==================================================
Violeta Georgieva
==================================================
Tue Aug 1 07:08:36 2017 +0000
==================================================
Http11Processor.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61086
Ensure to explicitly signal an empty request body for HTTP 205 responses.
Additional fix to r1795278. Based on a patch provided by Alexandr Saperov.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1803616 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestHttp11Processor.java
index 1c6784db80..4bc39fdc58 100644
--- a/java/org/apache/coyote/http11/Http11Processor.java
+++ b/java/org/apache/coyote/http11/Http11Processor.java
@@ -851,6 +851,8 @@ public class Http11Processor extends AbstractProcessor {
                 // RFC 7231 requires the server to explicitly signal an empty
                 // response in this case
                 response.setContentLength(0);
+            } else {
+                response.setContentLength(-1);
             }
         }
 
@@ -882,9 +884,6 @@ public class Http11Processor extends AbstractProcessor {
         }
 
         MimeHeaders headers = response.getMimeHeaders();
-        if (!entityBody) {
-            response.setContentLength(-1);
-        }
         // A SC_NO_CONTENT response may include entity headers
         if (entityBody || statusCode == HttpServletResponse.SC_NO_CONTENT) {
             String contentType = response.getContentType();

==================================================
