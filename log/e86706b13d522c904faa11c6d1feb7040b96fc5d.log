e86706b13d522c904faa11c6d1feb7040b96fc5d
==================================================
Fix BZ 66582 - not all static imports are valid for EL
==================================================
Mark Thomas
==================================================
Tue May 2 13:30:30 2023 +0100
==================================================
PageContextImpl.java
Fix BZ 66582 - not all static imports are valid for EL

https://bz.apache.org/bugzilla/show_bug.cgi?id=66582


==================================================
TestImportELResolver.java
index fe27e29ef2..35de1fd956 100644
--- a/java/org/apache/jasper/runtime/PageContextImpl.java
+++ b/java/org/apache/jasper/runtime/PageContextImpl.java
@@ -698,7 +698,11 @@ public class PageContextImpl extends PageContext {
                     for (String classImport : classImports) {
                         if (classImport.startsWith("static ")) {
                             classImport = classImport.substring(7);
-                            ih.importStatic(classImport);
+                            try {
+                                ih.importStatic(classImport);
+                            } catch (ELException e) {
+                                // Ignore - not all static imports are valid for EL
+                            }
                         } else {
                             ih.importClass(classImport);
                         }

==================================================
TesterBug66582.java
index b68529d821..652f04dad1 100644
--- a/test/jakarta/servlet/jsp/el/TestImportELResolver.java
+++ b/test/jakarta/servlet/jsp/el/TestImportELResolver.java
@@ -16,6 +16,8 @@
  */
 package jakarta.servlet.jsp.el;
 
+import jakarta.servlet.http.HttpServletResponse;
+
 import org.junit.Assert;
 import org.junit.Test;
 
@@ -36,4 +38,18 @@ public class TestImportELResolver extends TomcatBaseTest {
         Assert.assertTrue(result.contains("EL  - Long min value is -9223372036854775808"));
         Assert.assertTrue(result.contains("JSP - Long min value is -9223372036854775808"));
     }
+
+
+    // https://bz.apache.org/bugzilla/show_bug.cgi?id=66582
+    @Test
+    public void testImportStaticFieldFromInterface() throws Exception {
+        getTomcatInstanceTestWebapp(false, true);
+
+        ByteChunk res = new ByteChunk();
+        int rc = getUrl("http://localhost:" + getPort() + "/test/bug6nnnn/bug66582.jsp", res, null);
+
+        Assert.assertEquals(HttpServletResponse.SC_OK, rc);
+        String result = res.toString();
+        Assert.assertFalse(result, result.contains("data"));
+    }
 }

==================================================
