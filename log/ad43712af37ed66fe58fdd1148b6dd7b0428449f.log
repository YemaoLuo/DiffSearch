ad43712af37ed66fe58fdd1148b6dd7b0428449f
==================================================
Does not fix the testsuite run, so revert.
==================================================
Remy Maucherat
==================================================
Wed Apr 9 23:57:09 2014 +0000
==================================================
AbstractServletOutputStream.java
Does not fix the testsuite run, so revert.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1586177 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Nio2ServletOutputStream.java
index c8e207bb4f..f236a983cb 100644
--- a/java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java
+++ b/java/org/apache/coyote/http11/upgrade/AbstractServletOutputStream.java
@@ -76,9 +76,6 @@ public abstract class AbstractServletOutputStream<S> extends ServletOutputStream
         synchronized (fireListenerLock) {
             boolean result = (buffer == null);
             fireListener = !result;
-            if (fireListener) {
-                registerWriteInterest();
-            }
             return result;
         }
     }
@@ -239,8 +236,4 @@ public abstract class AbstractServletOutputStream<S> extends ServletOutputStream
     protected abstract void doFlush() throws IOException;
 
     protected abstract void doClose() throws IOException;
-
-    protected void registerWriteInterest() {
-    }
-
 }

==================================================
TestWebSocketFrameClientSSL.java
index 0a4e7d9f84..66d07ed302 100644
--- a/java/org/apache/coyote/http11/upgrade/Nio2ServletOutputStream.java
+++ b/java/org/apache/coyote/http11/upgrade/Nio2ServletOutputStream.java
@@ -176,14 +176,4 @@ public class Nio2ServletOutputStream extends AbstractServletOutputStream<Nio2Cha
         channel.close(true);
     }
 
-    @Override
-    protected void registerWriteInterest() {
-        synchronized (completionHandler) {
-            if (writePending.availablePermits() > 0) {
-                // If no write is pending, notify
-                endpoint.processSocket(socketWrapper, SocketStatus.OPEN_WRITE, true);
-            }
-        }
-    }
-
 }

==================================================
