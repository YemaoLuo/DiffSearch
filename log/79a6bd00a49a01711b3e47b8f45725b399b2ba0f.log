79a6bd00a49a01711b3e47b8f45725b399b2ba0f
==================================================
Store JASPIC auth method in security message
==================================================
Mark Thomas
==================================================
Tue Jun 23 09:30:08 2015 +0000
==================================================
JaspicAuthenticator.java
Store JASPIC auth method in security message
Patch by fjodorver

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1687005 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MessageInfoImpl.java
index 6f14d0c897..8ee98c78fa 100644
--- a/java/org/apache/catalina/authenticator/jaspic/JaspicAuthenticator.java
+++ b/java/org/apache/catalina/authenticator/jaspic/JaspicAuthenticator.java
@@ -46,7 +46,7 @@ public class JaspicAuthenticator extends AuthenticatorBase {
     private static final Log log = LogFactory.getLog(JaspicAuthenticator.class);
 
     private static final String AUTH_TYPE = "JASPIC";
-    private static final String MESSAGE_LAYER = "HttpServlet";
+    public static final String MESSAGE_LAYER = "HttpServlet";
 
     private Subject serviceSubject;
 
@@ -65,7 +65,7 @@ public class JaspicAuthenticator extends AuthenticatorBase {
 
     @Override
     public boolean authenticate(Request request, HttpServletResponse response) throws IOException {
-        MessageInfo messageInfo = new MessageInfoImpl(request, response, true);
+        MessageInfo messageInfo = new MessageInfoImpl(request, response, true, getAuthMethod());
 
         AuthConfigFactory factory = AuthConfigFactory.getFactory();
         String appContext = getAppContextId(request);
@@ -149,6 +149,6 @@ public class JaspicAuthenticator extends AuthenticatorBase {
 
     @Override
     protected String getAuthMethod() {
-        return AUTH_TYPE;
+        return context.getLoginConfig().getAuthMethod();
     }
 }

==================================================
