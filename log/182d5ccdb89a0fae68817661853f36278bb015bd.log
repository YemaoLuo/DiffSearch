182d5ccdb89a0fae68817661853f36278bb015bd
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50228
==================================================
Konstantin Kolinko
==================================================
Mon Nov 22 17:40:09 2010 +0000
==================================================
BodyContentImpl.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50228
Improve recycling of BodyContentImpl.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1037794 13f79535-47bb-0310-9956-ffa450edef68



==================================================
PageContextImpl.java
index 153ee0ddeb..d9fb0f8a1b 100644
--- a/java/org/apache/jasper/runtime/BodyContentImpl.java
+++ b/java/org/apache/jasper/runtime/BodyContentImpl.java
@@ -605,7 +605,27 @@ public class BodyContentImpl extends BodyContent {
             clearBody();
         }
     }
-    
+
+    /**
+     * This method shall "reset" the internal state of a BodyContentImpl,
+     * releasing all internal references, and preparing it for potential
+     * reuse by a later invocation of {@link PageContextImpl#pushBody(Writer)}.
+     *
+     * <p>Note, that BodyContentImpl instances are usually owned by a
+     * PageContextImpl instance, and PageContextImpl instances are recycled
+     * and reused.
+     *
+     * @see PageContextImpl#release()
+     */
+    protected void recycle() {
+        this.writer = null;
+        try {
+            this.clear();
+        } catch (IOException ex) {
+            // ignore
+        }
+    }
+
     private void ensureOpen() throws IOException {
         if (closed) throw new IOException("Stream closed");
     }

==================================================
