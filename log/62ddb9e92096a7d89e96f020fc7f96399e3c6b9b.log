62ddb9e92096a7d89e96f020fc7f96399e3c6b9b
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50997
==================================================
Mark Emlyn
==================================================
Wed Mar 30 20:06:25 2011 +0000
==================================================
ContextConfig.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50997
Relax the requirement that directories must have a name ending in .jar to be treated as an expanded JAR file by the default JarScanner.
Based on patch by Rodion Zhitomirsky.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1087062 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardJarScanner.java
index a638767a33..76fec6ca84 100644
--- a/java/org/apache/catalina/startup/ContextConfig.java
+++ b/java/org/apache/catalina/startup/ContextConfig.java
@@ -2347,7 +2347,7 @@ public class ContextConfig
         public void scan(File file) throws IOException {
 
             InputStream stream = null;
-            WebXml fragment = null;
+            WebXml fragment = new WebXml();
             
             try {
                 File fragmentFile = new File(file, FRAGMENT_LOCATION);
@@ -2356,7 +2356,6 @@ public class ContextConfig
                     InputSource source =
                         new InputSource(fragmentFile.toURI().toURL().toString());
                     source.setByteStream(stream);
-                    fragment = new WebXml();
                     parseWebXml(source, fragment, true);
                 }
             } finally {
@@ -2367,15 +2366,11 @@ public class ContextConfig
                         ExceptionUtils.handleThrowable(t);
                     }
                 }
-                if (fragment == null) {
-                    fragments.put(file.toURI().toURL().toString(), fragment);
-                } else {
-                    fragment.setURL(file.toURI().toURL());
-                    if (fragment.getName() == null) {
-                        fragment.setName(fragment.getURL().toString());
-                    }
-                    fragments.put(fragment.getName(), fragment);
+                fragment.setURL(file.toURI().toURL());
+                if (fragment.getName() == null) {
+                    fragment.setName(fragment.getURL().toString());
                 }
+                fragments.put(fragment.getName(), fragment);
             }
         }
         

==================================================
