ca205c1c429f5a497c57fbbcdf17bf19d8ea0ec5
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54658
==================================================
Mark Emlyn
==================================================
Thu Mar 14 20:34:32 2013 +0000
==================================================
Part.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54658
Servlet 3.1: Implement getSubmittedFileName()
Patch provided by Nick Williams

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1456657 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Request.java
index 390c31e1bc..f804fa4851 100644
--- a/java/javax/servlet/http/Part.java
+++ b/java/javax/servlet/http/Part.java
@@ -47,6 +47,15 @@ public interface Part {
      */
     public String getName();
 
+    /**
+     * If this part represents an uploaded file, gets the file name submitted
+     * in the upload. Returns {@code null} if no file name is available or if
+     * this part is not a file upload.
+     *
+     * @return the submitted file name or {@code null}.
+     */
+    public String getSubmittedFileName();
+
     /**
      * Obtain the size of this part.
      */

==================================================
ApplicationPart.java
index d69369ffa9..610117e0af 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -2606,7 +2606,7 @@ public class Request
                 for (FileItem item : items) {
                     ApplicationPart part = new ApplicationPart(item, mce);
                     parts.add(part);
-                    if (part.getFilename() == null) {
+                    if (part.getSubmittedFileName() == null) {
                         String name = part.getName();
                         String value = null;
                         try {

==================================================
HTMLManagerServlet.java
index 7484ac2c0a..c5db46b58b 100644
--- a/java/org/apache/catalina/core/ApplicationPart.java
+++ b/java/org/apache/catalina/core/ApplicationPart.java
@@ -128,10 +128,21 @@ public class ApplicationPart implements Part {
         return fileItem.getString(encoding);
     }
 
+    /**
+     * Calls {@link #getSubmittedFileName()}.
+     *
+     * @deprecated Use {@link #getSubmittedFileName()} from Servlet 3.1 instead.
+     */
+    @Deprecated
+    public String getFilename() {
+        return getSubmittedFileName();
+    }
+
     /*
      * Adapted from FileUploadBase.getFileName()
      */
-    public String getFilename() {
+    @Override
+    public String getSubmittedFileName() {
         String fileName = null;
         String cd = getHeader("Content-Disposition");
         if (cd != null) {

==================================================
