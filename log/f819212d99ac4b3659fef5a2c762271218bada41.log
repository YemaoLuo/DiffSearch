f819212d99ac4b3659fef5a2c762271218bada41
==================================================
Start to hook up unused constants
==================================================
Mark Emlyn
==================================================
Wed Feb 1 19:44:00 2012 +0000
==================================================
Globals.java
Start to hook up unused constants

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1239285 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Request.java
index 5820144cd9..68aaeec3d4 100644
--- a/java/org/apache/catalina/Globals.java
+++ b/java/org/apache/catalina/Globals.java
@@ -142,9 +142,10 @@ public final class Globals {
     /**
      * The request attribute that is set to the value of {@code Boolean.TRUE}
      * if connector processing this request supports Comet API.
+     * Duplicated here for neater code in the catalina packages.
      */
     public static final String COMET_SUPPORTED_ATTR =
-        "org.apache.tomcat.comet.support";
+        org.apache.coyote.Constants.COMET_SUPPORTED_ATTR;
 
 
     /**

==================================================
StandardWrapperValve.java
index 24b60a9eb1..294ae9bde5 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -943,7 +943,7 @@ public class Request
      * have names starting with "org.apache.tomcat" and include:
      * <ul>
      * <li>org.apache.tomcat.sendfile.support</li>
-     * <li>org.apache.tomcat.comet.support</li>
+     * <li>{@link Globals#COMET_SUPPORTED_ATTR</li>
      * <li>org.apache.tomcat.comet.timeout.support</li>
      * </ul>
      * Connector implementations may return some, all or none of these

==================================================
Constants.java
index 52f89e7234..3032ca89e4 100644
--- a/java/org/apache/catalina/core/StandardWrapperValve.java
+++ b/java/org/apache/catalina/core/StandardWrapperValve.java
@@ -29,6 +29,7 @@ import javax.servlet.UnavailableException;
 import javax.servlet.http.HttpServletResponse;
 
 import org.apache.catalina.Context;
+import org.apache.catalina.Globals;
 import org.apache.catalina.LifecycleException;
 import org.apache.catalina.comet.CometEvent;
 import org.apache.catalina.comet.CometProcessor;
@@ -165,8 +166,8 @@ final class StandardWrapperValve
 
         // Identify if the request is Comet related now that the servlet has been allocated
         boolean comet = false;
-        if (servlet instanceof CometProcessor
-                && request.getAttribute("org.apache.tomcat.comet.support") == Boolean.TRUE) {
+        if (servlet instanceof CometProcessor && request.getAttribute(
+                Globals.COMET_SUPPORTED_ATTR) == Boolean.TRUE) {
             comet = true;
             request.setComet(true);
         }

==================================================
AbstractHttp11Processor.java
index fda206c9fe..c28fb850a3 100644
--- a/java/org/apache/coyote/Constants.java
+++ b/java/org/apache/coyote/Constants.java
@@ -59,4 +59,12 @@ public final class Constants {
         Boolean.valueOf(System.getProperty(
                 "org.apache.coyote.USE_CUSTOM_STATUS_MSG_IN_HEADER",
                 "false")).booleanValue();
+
+    /**
+     * The request attribute that is set to the value of {@code Boolean.TRUE}
+     * if connector processing this request supports Comet API.
+     */
+    public static final String COMET_SUPPORTED_ATTR =
+        "org.apache.tomcat.comet.support";
+
 }

==================================================
