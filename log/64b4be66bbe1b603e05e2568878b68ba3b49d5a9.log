64b4be66bbe1b603e05e2568878b68ba3b49d5a9
==================================================
Explicitly mark all our valves so that we can track down which ones we need to fix and make async aware
==================================================
Filip Hanik
==================================================
Fri Oct 9 22:02:35 2009 +0000
==================================================
AuthenticatorBase.java
Explicitly mark all our valves so that we can track down which ones we need to fix and make async aware




git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@823713 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SingleSignOn.java
index 0ea4832ffd..ae7ef6422b 100644
--- a/java/org/apache/catalina/authenticator/AuthenticatorBase.java
+++ b/java/org/apache/catalina/authenticator/AuthenticatorBase.java
@@ -80,6 +80,11 @@ public abstract class AuthenticatorBase
     private static Log log = LogFactory.getLog(AuthenticatorBase.class);
 
 
+    //------------------------------------------------------ Constructor
+    public AuthenticatorBase() {
+        super(true);
+    }
+
     // ----------------------------------------------------- Instance Variables
 
 

==================================================
StandardContextValve.java
index e76d6dc3bb..820c87baaa 100644
--- a/java/org/apache/catalina/authenticator/SingleSignOn.java
+++ b/java/org/apache/catalina/authenticator/SingleSignOn.java
@@ -66,6 +66,10 @@ public class SingleSignOn
     extends ValveBase
     implements Lifecycle, SessionListener {
 
+    //------------------------------------------------------ Constructor
+    public SingleSignOn() {
+        super(true);
+    }
 
     // ----------------------------------------------------- Instance Variables
 

==================================================
StandardEngineValve.java
index e6be2d8de6..d8b6ce6ccc 100644
--- a/java/org/apache/catalina/core/StandardContextValve.java
+++ b/java/org/apache/catalina/core/StandardContextValve.java
@@ -51,6 +51,10 @@ import org.apache.tomcat.util.buf.MessageBytes;
 final class StandardContextValve
     extends ValveBase {
 
+    //------------------------------------------------------ Constructor
+    public StandardContextValve() {
+        super(true);
+    }
 
     // ----------------------------------------------------- Instance Variables
 

==================================================
StandardHostValve.java
index b48d5f2158..3289916867 100644
--- a/java/org/apache/catalina/core/StandardEngineValve.java
+++ b/java/org/apache/catalina/core/StandardEngineValve.java
@@ -46,6 +46,11 @@ import org.apache.catalina.valves.ValveBase;
 final class StandardEngineValve
     extends ValveBase {
 
+    //------------------------------------------------------ Constructor
+    public StandardEngineValve() {
+        super(true);
+    }
+
 
     // ----------------------------------------------------- Instance Variables
 

==================================================
StandardWrapperValve.java
index 32354ad112..860caf8fde 100644
--- a/java/org/apache/catalina/core/StandardHostValve.java
+++ b/java/org/apache/catalina/core/StandardHostValve.java
@@ -59,6 +59,11 @@ final class StandardHostValve
 
     private static Log log = LogFactory.getLog(StandardHostValve.class);
 
+    //------------------------------------------------------ Constructor
+    public StandardHostValve() {
+        super(true);
+    }
+
     // ----------------------------------------------------- Instance Variables
 
 

==================================================
JvmRouteBinderValve.java
index 3f8a2761f1..43a949d4cd 100644
--- a/java/org/apache/catalina/core/StandardWrapperValve.java
+++ b/java/org/apache/catalina/core/StandardWrapperValve.java
@@ -52,6 +52,11 @@ import org.apache.tomcat.util.log.SystemLogHandler;
 final class StandardWrapperValve
     extends ValveBase {
 
+    //------------------------------------------------------ Constructor
+    public StandardWrapperValve() {
+        super(true);
+    }
+    
     // ----------------------------------------------------- Instance Variables
 
 

==================================================
ReplicationValve.java
index 1befc3a496..6077802d63 100644
--- a/java/org/apache/catalina/ha/session/JvmRouteBinderValve.java
+++ b/java/org/apache/catalina/ha/session/JvmRouteBinderValve.java
@@ -108,6 +108,11 @@ public class JvmRouteBinderValve extends ValveBase implements ClusterValve, Life
      */
     protected static final String info = "org.apache.catalina.ha.session.JvmRouteBinderValve/1.2";
 
+    //------------------------------------------------------ Constructor
+    public JvmRouteBinderValve() {
+        super(false);
+    }
+
     /*--Instance Variables--------------------------------------*/
 
     /**

==================================================
AccessLogValve.java
index 6cdee06579..043149fb4c 100644
--- a/java/org/apache/catalina/ha/tcp/ReplicationValve.java
+++ b/java/org/apache/catalina/ha/tcp/ReplicationValve.java
@@ -125,6 +125,7 @@ public class ReplicationValve
     // ------------------------------------------------------------- Properties
 
     public ReplicationValve() {
+        super(false);
     }
     
     /**

==================================================
CometConnectionManagerValve.java
index ecf1c69bfb..1ce4fbdb46 100644
--- a/java/org/apache/catalina/valves/AccessLogValve.java
+++ b/java/org/apache/catalina/valves/AccessLogValve.java
@@ -125,6 +125,11 @@ public class AccessLogValve
 
     private static Log log = LogFactory.getLog(AccessLogValve.class);
 
+    //------------------------------------------------------ Constructor
+    public AccessLogValve() {
+        super(false);
+    }
+
     // ----------------------------------------------------- Instance Variables
 
 

==================================================
ErrorReportValve.java
index 2f6b4ba5df..22ddb06ed5 100644
--- a/java/org/apache/catalina/valves/CometConnectionManagerValve.java
+++ b/java/org/apache/catalina/valves/CometConnectionManagerValve.java
@@ -57,6 +57,11 @@ import org.apache.tomcat.util.res.StringManager;
 public class CometConnectionManagerValve
     extends ValveBase
     implements Lifecycle, HttpSessionListener, LifecycleListener {
+    
+    //------------------------------------------------------ Constructor
+    public CometConnectionManagerValve() {
+        super(false);
+    }
 
 
     // ----------------------------------------------------- Instance Variables

==================================================
JDBCAccessLogValve.java
index 90394a910b..c80d3fa978 100644
--- a/java/org/apache/catalina/valves/ErrorReportValve.java
+++ b/java/org/apache/catalina/valves/ErrorReportValve.java
@@ -51,6 +51,10 @@ import org.apache.tomcat.util.res.StringManager;
 public class ErrorReportValve
     extends ValveBase {
 
+    //------------------------------------------------------ Constructor
+    public ErrorReportValve() {
+        super(false);
+    }
 
     // ----------------------------------------------------- Instance Variables
 

==================================================
PersistentValve.java
index a60a126f63..87f080ae97 100644
--- a/java/org/apache/catalina/valves/JDBCAccessLogValve.java
+++ b/java/org/apache/catalina/valves/JDBCAccessLogValve.java
@@ -143,7 +143,7 @@ public final class JDBCAccessLogValve
      * </pre>
      */
     public JDBCAccessLogValve() {
-        super();
+        super(false);
         driverName = null;
         connectionURL = null;
         tableName = "access";

==================================================
RequestFilterValve.java
index 4552ed65b8..944a4de8af 100644
--- a/java/org/apache/catalina/valves/PersistentValve.java
+++ b/java/org/apache/catalina/valves/PersistentValve.java
@@ -50,6 +50,10 @@ import org.apache.tomcat.util.res.StringManager;
 public class PersistentValve
     extends ValveBase {
 
+    //------------------------------------------------------ Constructor
+    public PersistentValve() {
+        super(false);
+    }
 
     // ----------------------------------------------------- Instance Variables
 

==================================================
SSLValve.java
index 74ec25c30e..cb25eaede6 100644
--- a/java/org/apache/catalina/valves/RequestFilterValve.java
+++ b/java/org/apache/catalina/valves/RequestFilterValve.java
@@ -68,6 +68,10 @@ import org.apache.tomcat.util.res.StringManager;
 public abstract class RequestFilterValve
     extends ValveBase {
 
+    //------------------------------------------------------ Constructor
+    public RequestFilterValve() {
+        super(true);
+    }
 
     // ----------------------------------------------------- Class Variables
 

==================================================
SemaphoreValve.java
index ceec1196b9..b9b1a29867 100644
--- a/java/org/apache/catalina/valves/SSLValve.java
+++ b/java/org/apache/catalina/valves/SSLValve.java
@@ -47,6 +47,14 @@ import org.apache.catalina.connector.Response;
 
 public class SSLValve
     extends ValveBase {
+    
+    
+    //------------------------------------------------------ Constructor
+    public SSLValve() {
+        super(true);
+    }
+
+
 
     public String mygetHeader(Request request, String header) {
         String strcert0 = request.getHeader(header);

==================================================
ValveBase.java
index 3886d412a6..c991710a7b 100644
--- a/java/org/apache/catalina/valves/SemaphoreValve.java
+++ b/java/org/apache/catalina/valves/SemaphoreValve.java
@@ -47,6 +47,10 @@ public class SemaphoreValve
     extends ValveBase
     implements Lifecycle {
 
+    //------------------------------------------------------ Constructor
+    public SemaphoreValve() {
+        super(false); //TODO - is this async aware
+    }
 
     // ----------------------------------------------------- Instance Variables
 

==================================================
