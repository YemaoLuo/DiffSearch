61194eebde1d5466ddaf48f161623141a14d81a2
==================================================
The javadoc needs to be reproducible.
==================================================
Mark Thomas
==================================================
Wed Mar 23 12:52:58 2022 +0000
==================================================
RepeatableArchive.java
index 902ade5dfc..a231c17197 100644
--- a/build.xml
+++ b/build.xml
@@ -2865,7 +2865,25 @@ skip.installer property in build.properties" />
       <patternset refid="text.files" />
     </fixcrlf>
 
-    <!-- Reproducible builds: consistent timestamps for distributed files -->
+    <!-- Reproducible builds: consistent timestamps for distributed files.   -->
+    <!-- Javadocs need additional processing.                                -->
+    <!-- 1. line endings vary between platforms for some files               -->
+    <!-- 2. The contents of generated zip files don't have fixed timestamps  --> 
+    <!-- Process the zip files first as the resulting zip files will need    -->
+    <!-- the last modified timestamp to be changed as well.                  -->
+    <fixcrlf srcdir="${tomcat.dist}/webapps/docs" eol="lf"
+        encoding="UTF-8" fixlast="false" >
+      <include name="**/*.js" />
+      <include name="**/element-list" />
+    </fixcrlf>
+    <taskdef name="repeatableArchive"
+             classname="org.apache.tomcat.buildutil.RepeatableArchive"
+             classpath="${tomcat.classes}" />
+    <repeatableArchive datetime="${ant.tstamp.now}">
+      <fileset dir="${tomcat.dist}/webapps/docs">
+        <include name="**/*.zip"/>
+      </fileset>
+    </repeatableArchive>
     <touch datetime="${tstamp.file}" pattern="yyyy-MM-dd HH:mm:ss">
       <fileset dir="${tomcat.dist}"/>
     </touch>

==================================================
