6aea8fe4d53fa8e76571746576a5717877e3b41a
==================================================
Move firing the events to StandardPipeline. This way calls to container.addValve() and container.getPipeline().addValve() will both trigger the event.
==================================================
Mark Emlyn
==================================================
Thu Feb 4 22:09:18 2010 +0000
==================================================
Container.java
Move firing the events to StandardPipeline. This way calls to container.addValve() and container.getPipeline().addValve() will both trigger the event.
Custom pipelines (unlikely but possible) would not trigger the event. The javadocs for Pipeline will be updated to note that they should in a following commit.
Part of removing the Pipeline interface from ContainerBase

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@906680 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ContainerBase.java
index 04a73b33fc..b566ff6b2b 100644
--- a/java/org/apache/catalina/Container.java
+++ b/java/org/apache/catalina/Container.java
@@ -440,4 +440,13 @@ public interface Container {
     public void removePropertyChangeListener(PropertyChangeListener listener);
 
 
+    /**
+     * Notify all container event listeners that a particular event has
+     * occurred for this Container.  The default implementation performs
+     * this notification synchronously using the calling thread.
+     *
+     * @param type Event type
+     * @param data Event data
+     */
+    public void fireContainerEvent(String type, Object data);
 }

==================================================
StandardPipeline.java
index e4b0b4362b..a2bfb5c751 100644
--- a/java/org/apache/catalina/core/ContainerBase.java
+++ b/java/org/apache/catalina/core/ContainerBase.java
@@ -1215,7 +1215,6 @@ public abstract class ContainerBase
     public synchronized void addValve(Valve valve) {
 
         pipeline.addValve(valve);
-        fireContainerEvent(ADD_VALVE_EVENT, valve);
     }
 
     public ObjectName[] getValveObjectNames() {
@@ -1264,7 +1263,6 @@ public abstract class ContainerBase
     public synchronized void removeValve(Valve valve) {
 
         pipeline.removeValve(valve);
-        fireContainerEvent(REMOVE_VALVE_EVENT, valve);
     }
 
 

==================================================
