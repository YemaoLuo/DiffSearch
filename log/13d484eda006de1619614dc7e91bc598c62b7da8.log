13d484eda006de1619614dc7e91bc598c62b7da8
==================================================
Remove class loader from the scan method as class loader is accessible
==================================================
Mark Emlyn
==================================================
Fri Jun 14 07:38:09 2013 +0000
==================================================
ContextConfig.java
Remove class loader from the scan method as class loader is accessible
from ServletContext.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1492973 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TldConfig.java
index 2070a98b5d..562b3de814 100644
--- a/java/org/apache/catalina/startup/ContextConfig.java
+++ b/java/org/apache/catalina/startup/ContextConfig.java
@@ -2042,8 +2042,7 @@ public class ContextConfig implements LifecycleListener {
         JarScanner jarScanner = context.getJarScanner();
         FragmentJarScannerCallback callback = new FragmentJarScannerCallback();
 
-        jarScanner.scan(context.getServletContext(),
-                context.getLoader().getClassLoader(), callback,
+        jarScanner.scan(context.getServletContext(), callback,
                 pluggabilityJarsToSkip);
 
         return callback.getFragments();

==================================================
TldLocationsCache.java
index b34c29d91b..1532dc1fbe 100644
--- a/java/org/apache/catalina/startup/TldConfig.java
+++ b/java/org/apache/catalina/startup/TldConfig.java
@@ -263,7 +263,6 @@ public final class TldConfig  implements LifecycleListener {
         // Stages 3b & 4
         JarScanner jarScanner = context.getJarScanner();
         jarScanner.scan(context.getServletContext(),
-                context.getLoader().getClassLoader(),
                 new TldJarScannerCallback(), noTldJars);
 
         // Now add all the listeners we found to the listeners for this context

==================================================
JarScanner.java
index f36d48a60f..2d08ea9174 100644
--- a/java/org/apache/jasper/compiler/TldLocationsCache.java
+++ b/java/org/apache/jasper/compiler/TldLocationsCache.java
@@ -242,9 +242,7 @@ public class TldLocationsCache {
 
             JarScanner jarScanner = JarScannerFactory.getJarScanner(ctxt);
             if (jarScanner != null) {
-                jarScanner.scan(ctxt,
-                        Thread.currentThread().getContextClassLoader(),
-                        new TldJarScannerCallback(), noTldJars);
+                jarScanner.scan(ctxt, new TldJarScannerCallback(), noTldJars);
             }
 
             initialized = true;

==================================================
StandardJarScanner.java
index 6e8446cda8..302775861b 100644
--- a/java/org/apache/tomcat/JarScanner.java
+++ b/java/org/apache/tomcat/JarScanner.java
@@ -33,12 +33,10 @@ public interface JarScanner {
      *
      * @param context       The ServletContext - used to locate and access
      *                      WEB-INF/lib
-     * @param classloader   The classloader - used to access JARs not in
-     *                      WEB-INF/lib
      * @param callback      The handler to process any JARs found
      * @param jarsToSkip    List of JARs to ignore
      */
-    public void scan(ServletContext context, ClassLoader classloader,
-            JarScannerCallback callback, Set<String> jarsToSkip);
+    public void scan(ServletContext context, JarScannerCallback callback,
+            Set<String> jarsToSkip);
 
 }

==================================================
