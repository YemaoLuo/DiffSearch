1902252416f63391461a4481bbd80360e1963ce7
==================================================
Make parsing of Content-Disposition headers more robust
==================================================
Mark Thomas
==================================================
Thu Aug 18 21:04:06 2022 +0100
==================================================
HttpParser.java
Make parsing of Content-Disposition headers more robust

Invalid filename directives will now be ignored rather than triggering a
500 response.


==================================================
TestHttpParser.java
index 2d21f02e68..4df0467194 100644
--- a/java/org/apache/tomcat/util/http/parser/HttpParser.java
+++ b/java/org/apache/tomcat/util/http/parser/HttpParser.java
@@ -218,6 +218,11 @@ public class HttpParser {
             char c = input.charAt(i);
             if (input.charAt(i) == '\\') {
                 i++;
+                if (i == end) {
+                    // Input (less surrounding quotes) ended with '\'. That is
+                    // invalid so return null.
+                    return null;
+                }
                 result.append(input.charAt(i));
             } else {
                 result.append(c);

==================================================
