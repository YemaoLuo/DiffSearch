5bb85b71c0d818151ba4aa9e12adf24c37ab0d4d
==================================================
Align WebSocket impl with changes to upgrade end-of-stream handling
==================================================
Mark Thomas
==================================================
Sun Feb 22 18:49:47 2015 +0000
==================================================
WsFrameServer.java
Align WebSocket impl with changes to upgrade end-of-stream handling

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1661519 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsHttpUpgradeHandler.java
index 51e05e4675..f0b0a6d14f 100644
--- a/java/org/apache/tomcat/websocket/server/WsFrameServer.java
+++ b/java/org/apache/tomcat/websocket/server/WsFrameServer.java
@@ -16,7 +16,6 @@
  */
 package org.apache.tomcat.websocket.server;
 
-import java.io.EOFException;
 import java.io.IOException;
 
 import javax.servlet.ServletInputStream;
@@ -50,12 +49,9 @@ public class WsFrameServer extends WsFrameBase {
                 // Fill up the input buffer with as much data as we can
                 int read = sis.read(
                         inputBuffer, writePos, inputBuffer.length - writePos);
-                if (read == 0) {
+                if (read <= 0) {
                     return;
                 }
-                if (read == -1) {
-                    throw new EOFException();
-                }
                 writePos += read;
                 processInputBuffer();
             }

==================================================
