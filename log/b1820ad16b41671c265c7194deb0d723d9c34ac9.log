b1820ad16b41671c265c7194deb0d723d9c34ac9
==================================================
Allow detection of Graal via reflection or system property
==================================================
Filip Hanik
==================================================
0700
==================================================
JspRuntimeLibrary.java
Allow detection of Graal via reflection or system property



==================================================
NamingContext.java
index cfb6e759ca..73b149fbc1 100644
--- a/java/org/apache/jasper/runtime/JspRuntimeLibrary.java
+++ b/java/org/apache/jasper/runtime/JspRuntimeLibrary.java
@@ -69,7 +69,7 @@ public class JspRuntimeLibrary {
         } catch (ReflectiveOperationException | IllegalArgumentException e) {
             // Should never happen
         }
-        GRAAL = result;
+        GRAAL = result || System.getProperty("org.graalvm.nativeimage.imagecode") != null;
     }
 
     /**

==================================================
GraalCompat.java
index 0471279a1f..a064421b8e 100644
--- a/java/org/apache/naming/NamingContext.java
+++ b/java/org/apache/naming/NamingContext.java
@@ -804,7 +804,7 @@ public class NamingContext implements Context {
         } catch (ReflectiveOperationException | IllegalArgumentException e) {
             // Should never happen
         }
-        GRAAL = result;
+        GRAAL = result || System.getProperty("org.graalvm.nativeimage.imagecode") != null;
     }
 
     /**

==================================================
