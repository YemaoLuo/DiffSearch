77f98c1c3c6397066ed9be01fad3834c71cc3a0a
==================================================
Final URL -> URI refactoring
==================================================
Mark Thomas
==================================================
Wed Nov 16 19:19:43 2022 +0000
==================================================
AbstractSingleArchiveResourceSet.java
Final URL -> URI refactoring

These require API changes so no plans to back-port.


==================================================
JarWarResourceSet.java
index 5edf114f77..688e2128ae 100644
--- a/java/org/apache/catalina/webresources/AbstractSingleArchiveResourceSet.java
+++ b/java/org/apache/catalina/webresources/AbstractSingleArchiveResourceSet.java
@@ -18,7 +18,6 @@ package org.apache.catalina.webresources;
 
 import java.io.File;
 import java.io.IOException;
-import java.net.MalformedURLException;
 import java.util.Enumeration;
 import java.util.HashMap;
 import java.util.Map;
@@ -144,7 +143,7 @@ public abstract class AbstractSingleArchiveResourceSet extends AbstractArchiveRe
 
         try {
             setBaseUrl(UriUtil.buildJarSafeUrl(new File(getBase())));
-        } catch (MalformedURLException e) {
+        } catch (IOException e) {
             throw new IllegalArgumentException(e);
         }
     }

==================================================
JarFactory.java
index 37253fc390..215cf3b07f 100644
--- a/java/org/apache/catalina/webresources/JarWarResourceSet.java
+++ b/java/org/apache/catalina/webresources/JarWarResourceSet.java
@@ -19,7 +19,6 @@ package org.apache.catalina.webresources;
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
-import java.net.MalformedURLException;
 import java.util.HashMap;
 import java.util.Iterator;
 import java.util.Map;
@@ -250,7 +249,7 @@ public class JarWarResourceSet extends AbstractArchiveResourceSet {
 
         try {
             setBaseUrl(UriUtil.buildJarSafeUrl(new File(getBase())));
-        } catch (MalformedURLException e) {
+        } catch (IOException e) {
             throw new IllegalArgumentException(e);
         }
     }

==================================================
TesterUriUtilBase.java
index 51c0011ed1..ec6a438ad8 100644
--- a/java/org/apache/tomcat/util/scan/JarFactory.java
+++ b/java/org/apache/tomcat/util/scan/JarFactory.java
@@ -17,7 +17,8 @@
 package org.apache.tomcat.util.scan;
 
 import java.io.IOException;
-import java.net.MalformedURLException;
+import java.net.URI;
+import java.net.URISyntaxException;
 import java.net.URL;
 import java.util.regex.Matcher;
 
@@ -53,8 +54,7 @@ public class JarFactory {
     }
 
 
-    public static URL getJarEntryURL(URL baseUrl, String entryName)
-            throws MalformedURLException {
+    public static URL getJarEntryURL(URL baseUrl, String entryName) throws IOException {
 
         String baseExternal = baseUrl.toExternalForm();
 
@@ -66,6 +66,12 @@ public class JarFactory {
                     Matcher.quoteReplacement(UriUtil.getWarSeparator()));
         }
 
-        return new URL("jar:" + baseExternal + "!/" + entryName);
+        URI uri;
+        try {
+            uri = new URI("jar:" + baseExternal + "!/" + entryName);
+        } catch (URISyntaxException e) {
+            throw new IOException(e);
+        }
+        return uri.toURL();
     }
 }

==================================================
