571dd0e0841bec254c40c49019286bed9c105416
==================================================
Address review comments
==================================================
Mark Emlyn
==================================================
Sat Feb 13 19:22:02 2010 +0000
==================================================
ELSupport.java
Address review comments
Don't use toString() to try and co-erce any old object to an Enum - the spec only mentions String

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@909875 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestELSupport.java
index f627aa3420..6cee357207 100644
--- a/java/org/apache/el/lang/ELSupport.java
+++ b/java/org/apache/el/lang/ELSupport.java
@@ -185,9 +185,15 @@ public class ELSupport {
         if (type.isAssignableFrom(obj.getClass())) {
             return (Enum<?>) obj;
         }
+        
+        if (!(obj instanceof String)) {
+            throw new ELException(MessageFactory.get("error.convert",
+                    obj, obj.getClass(), type));
+        }
+
         Enum<?> result;
         try {
-             result = Enum.valueOf(type, obj.toString());
+             result = Enum.valueOf(type, (String) obj);
         } catch (IllegalArgumentException iae) {
             throw new ELException(MessageFactory.get("error.convert",
                     obj, obj.getClass(), type));

==================================================
