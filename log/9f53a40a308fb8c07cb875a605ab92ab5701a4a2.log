9f53a40a308fb8c07cb875a605ab92ab5701a4a2
==================================================
Further BZ 66508 fix
==================================================
Mark Thomas
==================================================
Wed Apr 12 13:25:00 2023 +0100
==================================================
WsSession.java
Further BZ 66508 fix

Don't close connection before close message has been sent to client.


==================================================
WsHttpUpgradeHandler.java
index 5f947afde7..45703457f5 100644
--- a/java/org/apache/tomcat/websocket/WsSession.java
+++ b/java/org/apache/tomcat/websocket/WsSession.java
@@ -462,6 +462,11 @@ public class WsSession implements Session {
     }
 
 
+    public boolean isClosed() {
+    	return state == State.CLOSED;
+    }
+
+
     @Override
     public long getMaxIdleTimeout() {
         checkState();

==================================================
