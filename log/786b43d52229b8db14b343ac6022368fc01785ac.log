786b43d52229b8db14b343ac6022368fc01785ac
==================================================
Fix MethodExpression when accessing static method via an instance
==================================================
Mark Thomas
==================================================
Wed Aug 31 16:33:49 2022 +0100
==================================================
Util.java
Fix MethodExpression when accessing static method via an instance


==================================================
ReflectionUtil.java
index badccfb892..b0a995c59b 100644
--- a/java/jakarta/el/Util.java
+++ b/java/jakarta/el/Util.java
@@ -544,11 +544,9 @@ class Util {
      * making changes keep the code in sync.
      */
     static Method getMethod(Class<?> type, Object base, Method m) {
-        // If base is null, method MUST be static
-        // If base is non-null, method may be static or non-static
         if (m == null ||
                 (Modifier.isPublic(type.getModifiers()) &&
-                        (canAccess(base, m) || base != null && canAccess(null, m)))) {
+                        (Modifier.isStatic(m.getModifiers()) && canAccess(null, m) || canAccess(base, m)))) {
             return m;
         }
         Class<?>[] interfaces = type.getInterfaces();

==================================================
TestReflectionUtil.java
index 70e7e41056..fd6680dd8f 100644
--- a/java/org/apache/el/util/ReflectionUtil.java
+++ b/java/org/apache/el/util/ReflectionUtil.java
@@ -429,11 +429,9 @@ public class ReflectionUtil {
      * the code in sync.
      */
     private static Method getMethod(Class<?> type, Object base, Method m) {
-        // If base is null, method MUST be static
-        // If base is non-null, method may be static or non-static
         if (m == null ||
                 (Modifier.isPublic(type.getModifiers()) &&
-                        (m.canAccess(base) || base != null && m.canAccess(null)))) {
+                        (Modifier.isStatic(m.getModifiers()) && m.canAccess(null) || m.canAccess(base)))) {
             return m;
         }
         Class<?>[] interfaces = type.getInterfaces();

==================================================
