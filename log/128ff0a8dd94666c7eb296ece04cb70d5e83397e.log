128ff0a8dd94666c7eb296ece04cb70d5e83397e
==================================================
Minor optimizations
==================================================
Filip Hanik
==================================================
Sat Apr 14 02:48:45 2007 +0000
==================================================
NioEndpoint.java
Minor optimizations


git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@528744 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SocketProperties.java
index 2e76cad050..b26da8f82e 100644
--- a/java/org/apache/tomcat/util/net/NioEndpoint.java
+++ b/java/org/apache/tomcat/util/net/NioEndpoint.java
@@ -1326,7 +1326,7 @@ public class NioEndpoint {
         
         public void addEvent(Runnable event) {
             events.offer(event);
-            if ( wakeupCounter.incrementAndGet() < 3 ) selector.wakeup();
+            if ( wakeupCounter.incrementAndGet() == 1 || wakeupCounter.get() > 5 ) selector.wakeup();
         }
 
         /**
@@ -1428,7 +1428,10 @@ public class NioEndpoint {
                     int keyCount = 0;
                     try {
                         if ( !close ) {
-                            keyCount = selector.select(selectorTimeout);
+                            if ( wakeupCounter.get() > 0 )
+                                keyCount = selector.selectNow(); //we have events that need to be processed
+                            else
+                                keyCount = selector.select(selectorTimeout);
                             wakeupCounter.set(0);
                         }
                         if (close) {

==================================================
