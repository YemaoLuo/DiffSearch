d4f9127d4ef7142b18cace30d688350d0988c340
==================================================
Address an edge case. Reject CRCRLF as a line terminator.
==================================================
Mark Thomas
==================================================
Tue Aug 2 16:30:51 2022 +0100
==================================================
Http11InputBuffer.java
Address an edge case. Reject CRCRLF as a line terminator.

Review of CR handling for RFC 9112


==================================================
TestHttp11InputBufferCRLF.java
index 6757e69aae..21491d438a 100644
--- a/java/org/apache/coyote/http11/Http11InputBuffer.java
+++ b/java/org/apache/coyote/http11/Http11InputBuffer.java
@@ -976,7 +976,8 @@ public class Http11InputBuffer implements InputBuffer, ApplicationBufferHandler
 
                     prevChr = chr;
                     chr = byteBuffer.get();
-                    if (chr == Constants.CR) {
+                    if (chr == Constants.CR && prevChr != Constants.CR) {
+                        // CR is only permitted at the start of a CRLF sequence.
                         // Possible start of CRLF - process the next byte.
                     } else if (chr == Constants.LF) {
                         // CRLF or LF is an acceptable line terminator

==================================================
