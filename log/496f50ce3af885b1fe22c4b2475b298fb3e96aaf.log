496f50ce3af885b1fe22c4b2475b298fb3e96aaf
==================================================
Further fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57556
==================================================
Mark Thomas
==================================================
Tue Apr 28 21:03:04 2015 +0000
==================================================
StandardContext.java
Further fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57556
Only include a trailing separator in the real path if the requested path included one.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1676630 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestStandardContext.java
index c1fd5622dc..d43435eb4e 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -4411,7 +4411,8 @@ public class StandardContext extends ContainerBase
                 String canonicalPath = resource.getCanonicalPath();
                 if (canonicalPath == null) {
                     return null;
-                } else if (resource.isDirectory() && !canonicalPath.endsWith(File.separator)) {
+                } else if ((resource.isDirectory() && !canonicalPath.endsWith(File.separator) ||
+                        !resource.exists()) && path.endsWith("/")) {
                     return canonicalPath + File.separatorChar;
                 } else {
                     return canonicalPath;

==================================================
