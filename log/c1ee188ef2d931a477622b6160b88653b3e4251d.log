c1ee188ef2d931a477622b6160b88653b3e4251d
==================================================
Add an upgraded flag to the socket wrapper and set it for connections where an HTTP upgrade has been completed.
==================================================
Mark Emlyn
==================================================
Mon Dec 24 11:04:25 2012 +0000
==================================================
AbstractProtocol.java
Add an upgraded flag to the socket wrapper and set it for connections where an HTTP upgrade has been completed.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1425629 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SocketWrapper.java
index d7a2bbbaa1..9961a464f3 100644
--- a/java/org/apache/coyote/AbstractProtocol.java
+++ b/java/org/apache/coyote/AbstractProtocol.java
@@ -632,6 +632,7 @@ public abstract class AbstractProtocol implements ProtocolHandler,
                         // Create the light-weight upgrade processor
                         processor = createUpgradeProcessor(
                                 socket, httpUpgradeHandler);
+                        socket.setUpgraded(true);
                     }
                     if (getLog().isDebugEnabled()) {
                         getLog().debug("Socket: [" + socket +

==================================================
