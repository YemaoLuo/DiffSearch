a8955911dbb8d86e378c1480c9d1233e3115a4fd
==================================================
Fix another NPE observed in logs during unit test runs
==================================================
Mark Thomas
==================================================
Thu Jan 29 19:12:11 2015 +0000
==================================================
SocketWrapperBase.java
Fix another NPE observed in logs during unit test runs

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1655812 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsRemoteEndpointImplServer.java
index 84322166a2..a56cdc28b3 100644
--- a/java/org/apache/tomcat/util/net/SocketWrapperBase.java
+++ b/java/org/apache/tomcat/util/net/SocketWrapperBase.java
@@ -27,9 +27,13 @@ import java.util.concurrent.locks.ReentrantReadWriteLock;
 import java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock;
 
 import org.apache.tomcat.util.buf.ByteBufferHolder;
+import org.apache.tomcat.util.res.StringManager;
 
 public abstract class SocketWrapperBase<E> {
 
+    protected static final StringManager sm = StringManager.getManager(
+            SocketWrapperBase.class.getPackage().getName());
+
     private volatile E socket;
     private final AbstractEndpoint<E> endpoint;
 
@@ -284,6 +288,9 @@ public abstract class SocketWrapperBase<E> {
 
 
     public boolean canWrite() {
+        if (socketBufferHandler == null) {
+            throw new IllegalStateException(sm.getString("socket.closed"));
+        }
         return socketBufferHandler.isWriteBufferWritable() && bufferedWrites.size() == 0;
     }
 

==================================================
