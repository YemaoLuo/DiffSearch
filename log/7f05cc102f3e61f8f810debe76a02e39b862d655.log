7f05cc102f3e61f8f810debe76a02e39b862d655
==================================================
Add an additional layer of protection in case app fails to protect against an XSS.
==================================================
Mark Emlyn
==================================================
Sun Jun 8 11:30:44 2008 +0000
==================================================
SecurityUtil.java
Add an additional layer of protection in case app fails to protect against an XSS.
Copied filter code to jasper module so no new dependency is created.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@664483 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspServlet.java
index 657a87208f..22d0668e49 100644
--- a/java/org/apache/jasper/security/SecurityUtil.java
+++ b/java/org/apache/jasper/security/SecurityUtil.java
@@ -40,5 +40,42 @@ public final class SecurityUtil{
         return false;
     }
     
-    
+
+    /**
+     * Filter the specified message string for characters that are sensitive
+     * in HTML.  This avoids potential attacks caused by including JavaScript
+     * codes in the request URL that is often reported in error messages.
+     *
+     * @param message The message string to be filtered
+     */
+    public static String filter(String message) {
+
+        if (message == null)
+            return (null);
+
+        char content[] = new char[message.length()];
+        message.getChars(0, message.length(), content, 0);
+        StringBuffer result = new StringBuffer(content.length + 50);
+        for (int i = 0; i < content.length; i++) {
+            switch (content[i]) {
+            case '<':
+                result.append("&lt;");
+                break;
+            case '>':
+                result.append("&gt;");
+                break;
+            case '&':
+                result.append("&amp;");
+                break;
+            case '"':
+                result.append("&quot;");
+                break;
+            default:
+                result.append(content[i]);
+            }
+        }
+        return (result.toString());
+
+    }
+
 }

==================================================
