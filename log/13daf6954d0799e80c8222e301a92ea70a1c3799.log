13daf6954d0799e80c8222e301a92ea70a1c3799
==================================================
Fix bug 48004. Allow applications to set the server header.
==================================================
Mark Emlyn
==================================================
Tue Jan 12 21:36:49 2010 +0000
==================================================
Http11AprProcessor.java
Fix bug 48004. Allow applications to set the server header.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@898527 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11NioProcessor.java
index dc80c58039..a53076b995 100644
--- a/java/org/apache/coyote/http11/Http11AprProcessor.java
+++ b/java/org/apache/coyote/http11/Http11AprProcessor.java
@@ -1688,8 +1688,10 @@ public class Http11AprProcessor implements ActionHook {
 
         // Add server header
         if (server != null) {
+            // Always overrides anything the app might set
             headers.setValue("Server").setString(server);
-        } else {
+        } else if (headers.getValue("Server") == null) {
+            // If app didn't set the header, use the default
             outputBuffer.write(Constants.SERVER_BYTES);
         }
 

==================================================
Http11Processor.java
index ede09ee2d1..9d9a442622 100644
--- a/java/org/apache/coyote/http11/Http11NioProcessor.java
+++ b/java/org/apache/coyote/http11/Http11NioProcessor.java
@@ -1187,8 +1187,10 @@ public class Http11NioProcessor extends AbstractHttp11Processor implements Actio
 
         // Add server header
         if (server != null) {
+            // Always overrides anything the app might set
             headers.setValue("Server").setString(server);
-        } else {
+        } else if (headers.getValue("Server") == null) {
+            // If app didn't set the header, use the default
             outputBuffer.write(Constants.SERVER_BYTES);
         }
 

==================================================
