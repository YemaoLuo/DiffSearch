2b4a853dae39fd1242042be8ad165a8c0c538398
==================================================
Followup to getSubjectX500Principal() changes - retain original name
==================================================
Mark Thomas
==================================================
Thu Jan 12 17:06:14 2023 +0000
==================================================
CombinedRealm.java
Followup to getSubjectX500Principal() changes - retain original name

As per BZ 66009 getSubjectX500Principal().toString() returns the same
result as getSubjectDN().getName()


==================================================
LockOutRealm.java
index 0968241e9a..8c880e6396 100644
--- a/java/org/apache/catalina/realm/CombinedRealm.java
+++ b/java/org/apache/catalina/realm/CombinedRealm.java
@@ -320,7 +320,7 @@ public class CombinedRealm extends RealmBase {
         Principal authenticatedUser = null;
         String username = null;
         if (certs != null && certs.length >0) {
-            username = certs[0].getSubjectX500Principal().getName();
+            username = certs[0].getSubjectX500Principal().toString();
         }
 
         for (Realm realm : realms) {

==================================================
RealmBase.java
index 90fe1b64e9..f4254dcb64 100644
--- a/java/org/apache/catalina/realm/LockOutRealm.java
+++ b/java/org/apache/catalina/realm/LockOutRealm.java
@@ -166,7 +166,7 @@ public class LockOutRealm extends CombinedRealm {
     public Principal authenticate(X509Certificate[] certs) {
         String username = null;
         if (certs != null && certs.length >0) {
-            username = certs[0].getSubjectX500Principal().getName();
+            username = certs[0].getSubjectX500Principal().toString();
         }
 
         Principal authenticatedUser = super.authenticate(certs);

==================================================
ResolverImpl.java
index 3ff9c336e2..0bac871696 100644
--- a/java/org/apache/catalina/realm/RealmBase.java
+++ b/java/org/apache/catalina/realm/RealmBase.java
@@ -452,7 +452,7 @@ public abstract class RealmBase extends LifecycleMBeanBase implements Realm {
             for (X509Certificate cert : certs) {
                 if (log.isDebugEnabled()) {
                     log.debug(" Checking validity for '" +
-                            cert.getSubjectX500Principal().getName() + "'");
+                            cert.getSubjectX500Principal().toString() + "'");
                 }
                 try {
                     cert.checkValidity();

==================================================
