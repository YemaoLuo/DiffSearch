b90393e523abfd24f620c29e30d3c13837c3ed49
==================================================
Try swapping the headers complete processing order
==================================================
remm remm@apache.org
==================================================
Mon Apr 15 10:57:02 2019 +0200
==================================================
Http2Parser.java
Try swapping the headers complete processing order

First update state as needed, then dispatch the new request, even though
it is a bit counter intuitive.


==================================================
TestStream.java
index f5e19865b2..967175f048 100644
--- a/java/org/apache/coyote/http2/Http2Parser.java
+++ b/java/org/apache/coyote/http2/Http2Parser.java
@@ -580,13 +580,13 @@ class Http2Parser {
         // going to be thrown.
         hpackDecoder.getHeaderEmitter().validateHeaders();
 
-        output.headersEnd(streamId);
-
         if (headersEndStream) {
             output.receivedEndOfStream(streamId);
             headersEndStream = false;
         }
 
+        output.headersEnd(streamId);
+
         // Reset size for new request if the buffer was previously expanded
         if (headerReadBuffer.capacity() > Constants.DEFAULT_HEADER_READ_BUFFER_SIZE) {
             headerReadBuffer = ByteBuffer.allocate(Constants.DEFAULT_HEADER_READ_BUFFER_SIZE);

==================================================
