f3c7dba9ae5990c405af33500b98e72022fc56de
==================================================
Pull up init of outputStreamOutputBuffer
==================================================
Mark Thomas
==================================================
Thu Jan 1 17:14:20 2015 +0000
==================================================
AbstractOutputBuffer.java
Pull up init of outputStreamOutputBuffer

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1648903 13f79535-47bb-0310-9956-ffa450edef68



==================================================
InternalAprOutputBuffer.java
index b88f37adb2..2bab7b8b7f 100644
--- a/java/org/apache/coyote/http11/AbstractOutputBuffer.java
+++ b/java/org/apache/coyote/http11/AbstractOutputBuffer.java
@@ -131,6 +131,8 @@ public abstract class AbstractOutputBuffer<S> implements OutputBuffer {
         committed = false;
         finished = false;
 
+        outputStreamOutputBuffer = new SocketOutputBuffer();
+
         // Cause loading of HttpMessages
         HttpMessages.getInstance(response.getLocale()).getMessage(200);
     }

==================================================
InternalNio2OutputBuffer.java
index c71993745c..10ea57211f 100644
--- a/java/org/apache/coyote/http11/InternalAprOutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalAprOutputBuffer.java
@@ -52,8 +52,6 @@ public class InternalAprOutputBuffer extends AbstractOutputBuffer<Long> {
         } else {
             socketWriteBuffer = ByteBuffer.allocateDirect((headerBufferSize / 1500 + 1) * 1500);
         }
-
-        outputStreamOutputBuffer = new SocketOutputBuffer();
     }
 
 

==================================================
InternalNioOutputBuffer.java
index e17fac552a..121d0a056e 100644
--- a/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalNio2OutputBuffer.java
@@ -49,7 +49,6 @@ public class InternalNio2OutputBuffer extends AbstractOutputBuffer<Nio2Channel>
      */
     public InternalNio2OutputBuffer(Response response, int headerBufferSize) {
         super(response, headerBufferSize);
-        outputStreamOutputBuffer = new SocketOutputBuffer();
     }
 
     private static final ByteBuffer[] EMPTY_BUF_ARRAY = new ByteBuffer[0];

==================================================
