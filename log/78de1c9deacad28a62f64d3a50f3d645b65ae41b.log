78de1c9deacad28a62f64d3a50f3d645b65ae41b
==================================================
Make the outbound buffer sizes configurable
==================================================
Mark Emlyn
==================================================
Wed Feb 29 21:22:10 2012 +0000
==================================================
StreamInbound.java
Make the outbound buffer sizes configurable

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1295279 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsOutbound.java
index 6072e7d9dc..10fee125fc 100644
--- a/java/org/apache/catalina/websocket/StreamInbound.java
+++ b/java/org/apache/catalina/websocket/StreamInbound.java
@@ -38,10 +38,51 @@ public abstract class StreamInbound implements UpgradeInbound {
 
     private UpgradeProcessor<?> processor = null;
     private WsOutbound outbound;
+    private int outboundByteBufferSize = WsOutbound.DEFAULT_BUFFER_SIZE;
+    private int outboundCharBufferSize = WsOutbound.DEFAULT_BUFFER_SIZE;
+
+
+
+    public int getOutboundByteBufferSize() {
+        return outboundByteBufferSize;
+    }
+
+
+    /**
+     * This only applies to the {@link WsOutbound} instance returned from
+     * {@link #getWsOutbound()} created by a subsequent call to
+     * {@link #setUpgradeOutbound(UpgradeOutbound)}. The current
+     * {@link WsOutbound} instance, if any, is not affected.
+     *
+     * @param outboundByteBufferSize
+     */
+    public void setOutboundByteBufferSize(int outboundByteBufferSize) {
+        this.outboundByteBufferSize = outboundByteBufferSize;
+    }
+
+
+    public int getOutboundCharBufferSize() {
+        return outboundCharBufferSize;
+    }
+
+
+    /**
+     * This only applies to the {@link WsOutbound} instance returned from
+     * {@link #getWsOutbound()} created by a subsequent call to
+     * {@link #setUpgradeOutbound(UpgradeOutbound)}. The current
+     * {@link WsOutbound} instance, if any, is not affected.
+     *
+     * @param outboundCharBufferSize
+     */
+    public void setOutboundCharBufferSize(int outboundCharBufferSize) {
+        this.outboundCharBufferSize = outboundCharBufferSize;
+    }
+
 
     @Override
     public final void setUpgradeOutbound(UpgradeOutbound upgradeOutbound) {
-        outbound = new WsOutbound(upgradeOutbound);
+        outbound = new WsOutbound(upgradeOutbound, outboundByteBufferSize,
+                outboundCharBufferSize);
     }
 
 

==================================================
