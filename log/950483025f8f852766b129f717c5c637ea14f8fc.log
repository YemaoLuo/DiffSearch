950483025f8f852766b129f717c5c637ea14f8fc
==================================================
Action review comments
==================================================
Mark Emlyn
==================================================
Tue Jan 11 18:35:42 2011 +0000
==================================================
Host.java
Action review comments
Store deployIgnore as a Pattern in the Host

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1057788 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardHost.java
index 37b1f98469..e827f20d55 100644
--- a/java/org/apache/catalina/Host.java
+++ b/java/org/apache/catalina/Host.java
@@ -16,6 +16,8 @@
  */
 package org.apache.catalina;
 
+import java.util.regex.Pattern;
+
 
 /**
  * A <b>Host</b> is a Container that represents a virtual host in the
@@ -153,6 +155,14 @@ public interface Host extends Container {
     public String getDeployIgnore();
 
 
+    /**
+     * Return the compiled regular expression that defines the files and
+     * directories in the host's {@link #appBase} that will be ignored by the
+     * automatic deployment process.
+     */
+    public Pattern getDeployIgnorePattern();
+
+
     /**
      * Set the regular expression that defines the files and directories in
      * the host's {@link #appBase} that will be ignored by the automatic

==================================================
HostConfig.java
index d7a60552af..c78dbe9cba 100644
--- a/java/org/apache/catalina/core/StandardHost.java
+++ b/java/org/apache/catalina/core/StandardHost.java
@@ -22,6 +22,7 @@ import java.util.List;
 import java.util.Locale;
 import java.util.Map;
 import java.util.WeakHashMap;
+import java.util.regex.Pattern;
 
 import org.apache.catalina.Container;
 import org.apache.catalina.Context;
@@ -173,7 +174,7 @@ public class StandardHost extends ContainerBase implements Host {
       * be ignored by the automatic deployment process (both
       * {@link #deployOnStartup} and {@link #autoDeploy}).
       */
-     private String deployIgnore = null;
+     private Pattern deployIgnore = null;
 
 
     // ------------------------------------------------------------- Properties
@@ -515,6 +516,20 @@ public class StandardHost extends ContainerBase implements Host {
      */
     @Override
     public String getDeployIgnore() {
+        if (deployIgnore == null) {
+            return null;
+        } 
+        return this.deployIgnore.toString();
+    }
+
+
+    /**
+     * Return the compiled regular expression that defines the files and
+     * directories in the host's {@link #appBase} that will be ignored by the
+     * automatic deployment process.
+     */
+    @Override
+    public Pattern getDeployIgnorePattern() {
         return this.deployIgnore;
     }
 
@@ -526,11 +541,20 @@ public class StandardHost extends ContainerBase implements Host {
      */
     @Override
     public void setDeployIgnore(String deployIgnore) {
-        String oldDeployIgnore = this.deployIgnore;
-        this.deployIgnore = deployIgnore;
+        String oldDeployIgnore;
+        if (this.deployIgnore == null) {
+            oldDeployIgnore = null;
+        } else {
+            oldDeployIgnore = this.deployIgnore.toString();
+        }
+        if (deployIgnore == null) {
+            this.deployIgnore = null;
+        } else {
+            this.deployIgnore = Pattern.compile(deployIgnore);
+        }
         support.firePropertyChange("deployIgnore",
                                    oldDeployIgnore, 
-                                   this.deployIgnore);
+                                   deployIgnore);
     }
 
 

==================================================
