ea2b04721e5259a116a99c2b1ac3ae54e53f76e1
==================================================
Add STRICT compliance flag to impact cookie value handling to provide backwards compatibility
==================================================
Filip Hanik
==================================================
Thu Feb 14 13:59:00 2008 +0000
==================================================
ApplicationContext.java
Add STRICT compliance flag to impact cookie value handling to provide backwards compatibility
Add STRICT complanice flag to impact ServletContext.getResource(AsStream) to be backwards compatible


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@627743 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ServerCookie.java
index 6bcd9e4d26..43708d7622 100644
--- a/java/org/apache/catalina/core/ApplicationContext.java
+++ b/java/org/apache/catalina/core/ApplicationContext.java
@@ -52,6 +52,7 @@ import org.apache.naming.resources.Resource;
 import org.apache.tomcat.util.buf.CharChunk;
 import org.apache.tomcat.util.buf.MessageBytes;
 import org.apache.tomcat.util.http.mapper.MappingData;
+import org.apache.catalina.Globals;
 
 
 /**
@@ -453,9 +454,12 @@ public class ApplicationContext
     public URL getResource(String path)
         throws MalformedURLException {
 
-        if (path == null || !path.startsWith("/")) {
+        if (path == null)
             throw new MalformedURLException(sm.getString("applicationContext.requestDispatcher.iae", path));
-        }
+
+        if (!path.startsWith("/") && Globals.STRICT_SERVLET_COMPLIANCE)
+            throw new MalformedURLException(sm.getString("applicationContext.requestDispatcher.iae", path));
+
         
         path = normalize(path);
         if (path == null)
@@ -507,9 +511,12 @@ public class ApplicationContext
     public InputStream getResourceAsStream(String path) {
 
         path = normalize(path);
-        if (path == null || !path.startsWith("/"))
+        if (path == null)
             return (null);
 
+        if (!path.startsWith("/") && Globals.STRICT_SERVLET_COMPLIANCE)
+            return null;
+        
         DirContext resources = context.getResources();
         if (resources != null) {
             try {

==================================================
