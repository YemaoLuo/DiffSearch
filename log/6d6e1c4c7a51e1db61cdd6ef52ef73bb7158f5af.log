6d6e1c4c7a51e1db61cdd6ef52ef73bb7158f5af
==================================================
Fix https://github.com/apache/tomcat/pull/187 Avoid NPE
==================================================
Mark Thomas
==================================================
Fri Aug 9 15:17:06 2019 +0100
==================================================
CrawlerSessionManagerValve.java
Fix https://github.com/apache/tomcat/pull/187 Avoid NPE

Avoid a NullPointerException in the CrawlerSessionManagerValve if no
ROOT Context is deployed and a request does not map to any of the other
deployed Contexts.
Patch provided by Jop Zinkweg.


==================================================
TestCrawlerSessionManagerValve.java
index 0a7968d414..da01da8cbc 100644
--- a/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java
+++ b/java/org/apache/catalina/valves/CrawlerSessionManagerValve.java
@@ -265,7 +265,7 @@ public class CrawlerSessionManagerValve extends ValveBase {
         if (isHostAware) {
             result.append('-').append(host.getName());
         }
-        if (isContextAware) {
+        if (isContextAware && context != null) {
             result.append(context.getName());
         }
         return result.toString();

==================================================
