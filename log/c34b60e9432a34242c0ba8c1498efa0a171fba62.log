c34b60e9432a34242c0ba8c1498efa0a171fba62
==================================================
Refactor setReadListener() in preparation for fix for BZ 64771
==================================================
Mark Thomas
==================================================
Mon Mar 22 21:45:21 2021 +0000
==================================================
InputBuffer.java
Refactor setReadListener() in preparation for fix for BZ 64771

https://bz.apache.org/bugzilla/show_bug.cgi?id=64771


==================================================
Request.java
index 79090ee825..bcf0571e1c 100644
--- a/java/org/apache/catalina/connector/InputBuffer.java
+++ b/java/org/apache/catalina/connector/InputBuffer.java
@@ -236,22 +236,6 @@ public class InputBuffer extends Reader
 
     public void setReadListener(ReadListener listener) {
         coyoteRequest.setReadListener(listener);
-
-        // The container is responsible for the first call to
-        // listener.onDataAvailable(). If isReady() returns true, the container
-        // needs to call listener.onDataAvailable() from a new thread. If
-        // isReady() returns false, the socket will be registered for read and
-        // the container will call listener.onDataAvailable() once data arrives.
-        // Must call isFinished() first as a call to isReady() if the request
-        // has been finished will register the socket for read interest and that
-        // is not required.
-        if (!coyoteRequest.isFinished() && isReady()) {
-            coyoteRequest.action(ActionCode.DISPATCH_READ, null);
-            if (!ContainerThreadMarker.isContainerThread()) {
-                // Not on a container thread so need to execute the dispatch
-                coyoteRequest.action(ActionCode.DISPATCH_EXECUTE, null);
-            }
-        }
     }
 
 

==================================================
