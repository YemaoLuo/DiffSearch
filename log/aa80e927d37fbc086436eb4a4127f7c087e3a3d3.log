aa80e927d37fbc086436eb4a4127f7c087e3a3d3
==================================================
Use registerForEvent on SocketWrapper
==================================================
Mark Thomas
==================================================
Sun Nov 23 22:50:37 2014 +0000
==================================================
AbstractAjpProcessor.java
Use registerForEvent on SocketWrapper

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1641281 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpAprProcessor.java
index 18240a9202..d477bb48ce 100644
--- a/java/org/apache/coyote/ajp/AbstractAjpProcessor.java
+++ b/java/org/apache/coyote/ajp/AbstractAjpProcessor.java
@@ -1675,8 +1675,14 @@ public abstract class AbstractAjpProcessor<S> extends AbstractProcessor<S> {
         }
     }
 
-    // ------------------------------------- InputStreamInputBuffer Inner Class
 
+    @Override
+    protected void registerForEvent(boolean read, boolean write) {
+        socketWrapper.regsiterForEvent(read, write);
+    }
+
+
+    // ------------------------------------- InputStreamInputBuffer Inner Class
 
     /**
      * This class is an input buffer which will read its data from an input

==================================================
AjpNio2Processor.java
index 9142021577..5585eeeccf 100644
--- a/java/org/apache/coyote/ajp/AjpAprProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpAprProcessor.java
@@ -42,11 +42,4 @@ public class AjpAprProcessor extends AbstractAjpProcessor<Long> {
     public AjpAprProcessor(int packetSize, AprEndpoint endpoint) {
         super(packetSize, endpoint);
     }
-
-
-    @Override
-    protected void registerForEvent(boolean read, boolean write) {
-        ((AprEndpoint) endpoint).getPoller().add(
-                socketWrapper.getSocket().longValue(), -1, read, write);
-    }
 }

==================================================
AjpNioProcessor.java
index 75f74965c4..1d34bde70f 100644
--- a/java/org/apache/coyote/ajp/AjpNio2Processor.java
+++ b/java/org/apache/coyote/ajp/AjpNio2Processor.java
@@ -35,10 +35,4 @@ public class AjpNio2Processor extends AbstractAjpProcessor<Nio2Channel> {
     public AjpNio2Processor(int packetSize, Nio2Endpoint endpoint0) {
         super(packetSize, endpoint0);
     }
-
-    @Override
-    protected void registerForEvent(boolean read, boolean write) {
-        // Nothing to do here, the appropriate operations should
-        // already be pending
-    }
 }

==================================================
