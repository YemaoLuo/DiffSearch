2e6cc46177cc64a9eba785999c1d81bcded88e9c
==================================================
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644
==================================================
Mark Emlyn
==================================================
Mon Sep 27 20:24:18 2010 +0000
==================================================
AbstractCatalinaTask.java
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644
Don't catch Throwable

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1001899 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ValidatorTask.java
index c514ce3deb..265cbb8ffb 100644
--- a/java/org/apache/catalina/ant/AbstractCatalinaTask.java
+++ b/java/org/apache/catalina/ant/AbstractCatalinaTask.java
@@ -20,6 +20,7 @@ package org.apache.catalina.ant;
 
 
 import java.io.BufferedOutputStream;
+import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.net.HttpURLConnection;
@@ -262,27 +263,27 @@ public abstract class AbstractCatalinaTask extends BaseRedirectorHelperTask {
                 // or error line will be logged twice
                 throw new BuildException(error);
             }
-        } catch (Throwable t) {
+        } catch (Exception e) {
             if (isFailOnError()) {
-                throw new BuildException(t);
+                throw new BuildException(e);
             } else {
-                handleErrorOutput(t.getMessage());
+                handleErrorOutput(e.getMessage());
             }
         } finally {
             closeRedirector();
             if (reader != null) {
                 try {
                     reader.close();
-                } catch (Throwable u) {
-                    ExceptionUtils.handleThrowable(u);
+                } catch (IOException ioe) {
+                    // Ignore
                 }
                 reader = null;
             }
             if (istream != null) {
                 try {
                     istream.close();
-                } catch (Throwable u) {
-                    ExceptionUtils.handleThrowable(u);
+                } catch (IOException ioe) {
+                    // Ignore
                 }
                 istream = null;
             }

==================================================
JMXAccessorQueryTask.java
index f3a611a220..457ad62008 100644
--- a/java/org/apache/catalina/ant/ValidatorTask.java
+++ b/java/org/apache/catalina/ant/ValidatorTask.java
@@ -100,11 +100,11 @@ public class ValidatorTask extends BaseRedirectorHelperTask {
             is.setByteStream(stream);
             digester.parse(is);
             handleOutput("web.xml validated");
-        } catch (Throwable t) {
+        } catch (Exception e) {
             if (isFailOnError()) {
-                throw new BuildException("Validation failure", t);
+                throw new BuildException("Validation failure", e);
             } else {
-                handleErrorOutput("Validation failure: " + t);
+                handleErrorOutput("Validation failure: " + e);
             }
         } finally {
             Thread.currentThread().setContextClassLoader(oldCL);

==================================================
JMXAccessorTask.java
index e49acddab5..db614b205d 100644
--- a/java/org/apache/catalina/ant/jmx/JMXAccessorQueryTask.java
+++ b/java/org/apache/catalina/ant/jmx/JMXAccessorQueryTask.java
@@ -196,11 +196,11 @@ public class JMXAccessorQueryTask extends JMXAccessorTask {
                     try {
                         value = jmxServerConnection
                                 .getAttribute(oname, attName);
-                    } catch (Throwable t) {
+                    } catch (Exception e) {
                         if (isEcho())
                             handleErrorOutput("Error getting attribute "
                                     + oname + " " + pname + attName + " "
-                                    + t.toString());
+                                    + e.toString());
                         continue;
                     }
                     if (value == null)

==================================================
