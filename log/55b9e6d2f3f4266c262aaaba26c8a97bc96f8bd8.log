55b9e6d2f3f4266c262aaaba26c8a97bc96f8bd8
==================================================
And now update after I find the later discussion about empty segments not being permitted (which is good since Tomcat will have normalized them out anyway)
==================================================
Mark Emlyn
==================================================
Mon Sep 9 12:41:10 2013 +0000
==================================================
UriTemplate.java
index b43fb0b667..4180a6f3d1 100644
--- a/java/org/apache/tomcat/websocket/server/LocalStrings.properties
+++ b/java/org/apache/tomcat/websocket/server/LocalStrings.properties
@@ -24,6 +24,7 @@ serverContainer.servletContextMismatch=Attempted to register a POJO annotated fo
 serverContainer.servletContextMissing=No ServletContext was specified
 
 uriTemplate.duplicateParameter=The parameter [{0}] appears more than once in the path which is not permitted
+uriTemplate.emptySegment=The path [{0}] contains one or more empty segments which are is not permitted
 uriTemplate.invalidPath=The path [{0}] is not valid.
 uriTemplate.invalidSegment=The segment [{0}] is not valid in the provided path [{1}]
 

==================================================
TestUriTemplate.java
index 3e03f77239..0529b3886e 100644
--- a/java/org/apache/tomcat/websocket/server/UriTemplate.java
+++ b/java/org/apache/tomcat/websocket/server/UriTemplate.java
@@ -59,10 +59,17 @@ public class UriTemplate {
 
         for (int i = 0; i < segments.length; i++) {
             String segment = segments[i];
-            // Ignore the first empty segment as the path must always start
-            // with '/'
-            if (i == 0 && segment.length() == 0) {
-                continue;
+            if (segment.length() == 0) {
+                if (i == 0) {
+                    // Ignore the first empty segment as the path must always
+                    // start with '/'
+                    continue;
+                } else {
+                    // As per EG discussion, all other empty segments are
+                    // invalid
+                    throw new IllegalArgumentException(sm.getString(
+                            "uriTemplate.emptySegment", path));
+                }
             }
             normalized.append('/');
             int index = -1;

==================================================
