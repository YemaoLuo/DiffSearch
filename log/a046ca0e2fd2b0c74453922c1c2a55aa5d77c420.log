a046ca0e2fd2b0c74453922c1c2a55aa5d77c420
==================================================
Refactor to reduce duplicate(ish) code
==================================================
Mark Thomas
==================================================
Thu Apr 6 20:00:51 2017 +0000
==================================================
PageContextImpl.java
Refactor to reduce duplicate(ish) code

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1790447 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityClassLoad.java
index 3080546533..3971c2a3f2 100644
--- a/java/org/apache/jasper/runtime/PageContextImpl.java
+++ b/java/org/apache/jasper/runtime/PageContextImpl.java
@@ -278,31 +278,7 @@ public class PageContextImpl extends PageContext {
 
     @Override
     public void setAttribute(final String name, final Object attribute) {
-
-        if (name == null) {
-            throw new NullPointerException(Localizer
-                    .getMessage("jsp.error.attribute.null_name"));
-        }
-
-        if (SecurityUtil.isPackageProtectionEnabled()) {
-            AccessController.doPrivileged(new PrivilegedAction<Void>() {
-                @Override
-                public Void run() {
-                    doSetAttribute(name, attribute);
-                    return null;
-                }
-            });
-        } else {
-            doSetAttribute(name, attribute);
-        }
-    }
-
-    private void doSetAttribute(String name, Object attribute) {
-        if (attribute != null) {
-            attributes.put(name, attribute);
-        } else {
-            removeAttribute(name, PAGE_SCOPE);
-        }
+        setAttribute(name, attribute, PAGE_SCOPE);
     }
 
     @Override

==================================================
