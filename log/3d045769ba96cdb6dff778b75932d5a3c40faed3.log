3d045769ba96cdb6dff778b75932d5a3c40faed3
==================================================
Extend work-around to all text/plain responses from Manager and Host Manager.
==================================================
Mark Thomas
==================================================
Fri Mar 2 18:45:28 2018 +0000
==================================================
JMXProxyServlet.java
Extend work-around to all text/plain responses from Manager and Host Manager.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1825738 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ManagerServlet.java
index f47c7b9c9a..e9edcd80bf 100644
--- a/java/org/apache/catalina/manager/JMXProxyServlet.java
+++ b/java/org/apache/catalina/manager/JMXProxyServlet.java
@@ -88,7 +88,6 @@ public class JMXProxyServlet extends HttpServlet {
         // in the line above for a reason. IE's behaviour is unwanted at best
         // and dangerous at worst.
         response.setHeader("X-Content-Type-Options", "nosniff");
-
         PrintWriter writer = response.getWriter();
 
         if (mBeanServer == null) {

==================================================
HostManagerServlet.java
index 9312e478f9..30e30fbe62 100644
--- a/java/org/apache/catalina/manager/ManagerServlet.java
+++ b/java/org/apache/catalina/manager/ManagerServlet.java
@@ -340,6 +340,10 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
 
         // Prepare our output writer to generate the response message
         response.setContentType("text/plain; charset=" + Constants.CHARSET);
+        // Stop older versions of IE thinking they know best. We set text/plain
+        // in the line above for a reason. IE's behaviour is unwanted at best
+        // and dangerous at worst.
+        response.setHeader("X-Content-Type-Options", "nosniff");
         PrintWriter writer = response.getWriter();
 
         // Process the requested command
@@ -435,6 +439,10 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
 
         // Prepare our output writer to generate the response message
         response.setContentType("text/plain;charset="+Constants.CHARSET);
+        // Stop older versions of IE thinking they know best. We set text/plain
+        // in the line above for a reason. IE's behaviour is unwanted at best
+        // and dangerous at worst.
+        response.setHeader("X-Content-Type-Options", "nosniff");
         PrintWriter writer = response.getWriter();
 
         // Process the requested command

==================================================
