1631be1994773ab7024ea8562838fd01a8aae74f
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54801
==================================================
Mark Emlyn
==================================================
Thu Apr 25 13:16:45 2013 +0000
==================================================
JspDocumentParser.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54801
and
https://issues.apache.org/bugzilla/show_bug.cgi?id=54821
Don'try to parse EL expressions if EL is disabled or inside scriptlets.
Based on patches by kkolinko

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1475750 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestJspDocumentParser.java
index acddd354de..8ab06613ff 100644
--- a/java/org/apache/jasper/compiler/JspDocumentParser.java
+++ b/java/org/apache/jasper/compiler/JspDocumentParser.java
@@ -484,7 +484,8 @@ class JspDocumentParser
             tagDependentNesting++;
         }
 
-        if (tagDependentNesting > 0) {
+        if (tagDependentNesting > 0 || pageInfo.isELIgnored() ||
+                current instanceof Node.ScriptingElement) {
             if (charBuffer.length() > 0) {
                 @SuppressWarnings("unused")
                 Node unused = new Node.TemplateText(

==================================================
