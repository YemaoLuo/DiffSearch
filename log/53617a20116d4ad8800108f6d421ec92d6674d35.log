53617a20116d4ad8800108f6d421ec92d6674d35
==================================================
Implment a standard isBlocking() method for output
==================================================
Mark Emlyn
==================================================
Thu May 2 13:03:52 2013 +0000
==================================================
AbstractOutputBuffer.java
Implment a standard isBlocking() method for output

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1478358 13f79535-47bb-0310-9956-ffa450edef68



==================================================
InternalAprOutputBuffer.java
index edafa14a6f..e18e2bca4f 100644
--- a/java/org/apache/coyote/http11/AbstractOutputBuffer.java
+++ b/java/org/apache/coyote/http11/AbstractOutputBuffer.java
@@ -578,7 +578,6 @@ public abstract class AbstractOutputBuffer<S> implements OutputBuffer {
 
     protected abstract boolean hasDataToWrite();
     protected abstract void setBlocking(boolean blocking);
-    protected abstract boolean isBlocking();
 
     /**
      * Writes any remaining buffered data.
@@ -591,6 +590,14 @@ public abstract class AbstractOutputBuffer<S> implements OutputBuffer {
     protected abstract boolean flushBuffer(boolean block) throws IOException;
 
 
+    /**
+     * Is standard Servlet blocking IO being used for output?
+     */
+    protected final boolean isBlocking() {
+        return response.getWriteListener() == null;
+    }
+
+
     protected final boolean isReady() {
         return !hasDataToWrite();
     }

==================================================
InternalNioOutputBuffer.java
index 9a76d5a535..b6ad5c6da9 100644
--- a/java/org/apache/coyote/http11/InternalAprOutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalAprOutputBuffer.java
@@ -180,13 +180,6 @@ public class InternalAprOutputBuffer extends AbstractOutputBuffer<Long> {
     }
 
 
-    @Override
-    public boolean isBlocking() {
-        // TODO
-        return false;
-    }
-
-
     // ----------------------------------- OutputStreamOutputBuffer Inner Class
 
     /**

==================================================
InternalOutputBuffer.java
index 4c9a8f58c9..e08e6083de 100644
--- a/java/org/apache/coyote/http11/InternalNioOutputBuffer.java
+++ b/java/org/apache/coyote/http11/InternalNioOutputBuffer.java
@@ -366,11 +366,6 @@ public class InternalNioOutputBuffer extends AbstractOutputBuffer<NioChannel> {
         this.bufferedWriteSize = bufferedWriteSize;
     }
 
-    @Override
-    public boolean isBlocking() {
-        return bufferedWrite == null;
-    }
-
     private boolean hasBufferedData() {
         boolean result = false;
         if (bufferedWrite!=null) {

==================================================
