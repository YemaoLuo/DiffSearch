4f96d21ad75e82292282abfd423c2035a1144adf
==================================================
fixes for
==================================================
Filip Hanik
==================================================
Tue Mar 27 04:44:06 2007 +0000
==================================================
ApplicationContext.java
fixes for
http://issues.apache.org/bugzilla/show_bug.cgi?id=41166
although there is still work to be done, need to separate Tomcat attributes vs. application attributes


git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@522745 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ReplicatedContext.java
index d313820fef..c6999d2896 100644
--- a/java/org/apache/catalina/core/ApplicationContext.java
+++ b/java/org/apache/catalina/core/ApplicationContext.java
@@ -804,12 +804,17 @@ public class ApplicationContext
 
 
     // -------------------------------------------------------- Package Methods
-
-
+    protected StandardContext getContext() {
+        return this.context;
+    }
+    
+    protected Map getReadonlyAttributes() {
+        return this.readOnlyAttributes;
+    }
     /**
      * Clear all application-created attributes.
      */
-    void clearAttributes() {
+    protected void clearAttributes() {
 
         // Create list of attributes to be removed
         ArrayList list = new ArrayList();

==================================================
AbstractReplicatedMap.java
index ee36b2e299..a108e572b1 100644
--- a/java/org/apache/catalina/ha/context/ReplicatedContext.java
+++ b/java/org/apache/catalina/ha/context/ReplicatedContext.java
@@ -26,6 +26,11 @@ import org.apache.catalina.core.ApplicationContext;
 import org.apache.catalina.Globals;
 import javax.servlet.ServletContext;
 import java.util.AbstractMap;
+import org.apache.catalina.tribes.tipis.AbstractReplicatedMap;
+import java.util.ArrayList;
+import java.util.Iterator;
+import javax.servlet.ServletContextAttributeListener;
+import javax.servlet.ServletContextAttributeEvent;
 
 /**
  * @author Filip Hanik
@@ -98,6 +103,12 @@ public class ReplicatedContext extends StandardContext {
     }
     
     public ServletContext getServletContext() {
+        if (context == null) {
+            context = new ReplApplContext(getBasePath(), this);
+            if (getAltDDName() != null)
+                context.setAttribute(Globals.ALT_DD_ATTR,getAltDDName());
+        }
+
         return ((ReplApplContext)context).getFacade();
 
     }
@@ -118,8 +129,19 @@ public class ReplicatedContext extends StandardContext {
         public void setAttributeMap(AbstractMap map) {
             this.attributes = map;
         }
-
+        
+        public void removeAttribute(String name) {
+            //do nothing
+            super.removeAttribute(name);
+        }
+        
+        public void setAttribute(String name, Object value) {
+            //do nothing
+            super.setAttribute(name,value);
+        }
+        
     }
 
 
+
 }
\ No newline at end of file

==================================================
