9d542ed0cdab0d5ef58af4bddfbbcb5482e9ef98
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50826
==================================================
Mark Emlyn
==================================================
Thu Feb 24 17:25:38 2011 +0000
==================================================
StandardContext.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50826
Avoid IAE when Tomcat instance is destroyed without every being started.
Add a test case for this.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1074225 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestTomcat.java
index b16bde7131..4291d39780 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -5486,11 +5486,15 @@ public class StandardContext extends ContainerBase
             ((Lifecycle) loader).destroy();
         }
 
-        // Send j2ee.object.deleted notification 
-        Notification notification = 
-            new Notification("j2ee.object.deleted", this.getObjectName(), 
-                             sequenceNumber.getAndIncrement());
-        broadcaster.sendNotification(notification);
+        // If in state NEW when destroy is called, the object name will never
+        // have been set so the notification can't be created
+        if (getObjectName() != null) { 
+            // Send j2ee.object.deleted notification 
+            Notification notification = 
+                new Notification("j2ee.object.deleted", this.getObjectName(), 
+                                 sequenceNumber.getAndIncrement());
+            broadcaster.sendNotification(notification);
+        }
 
         if (namingResources != null) {
             namingResources.destroy();

==================================================
