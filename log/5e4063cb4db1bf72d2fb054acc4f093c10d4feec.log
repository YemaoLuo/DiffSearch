5e4063cb4db1bf72d2fb054acc4f093c10d4feec
==================================================
Revert r733072 after feedback from EG that original INVALID for https://issues.apache.org/bugzilla/show_bug.cgi?id=46339 was correct.
==================================================
Mark Emlyn
==================================================
Mon Jan 12 21:29:40 2009 +0000
==================================================
Generator.java
Revert r733072 after feedback from EG that original INVALID for https://issues.apache.org/bugzilla/show_bug.cgi?id=46339 was correct.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@733905 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspContextWrapper.java
index 495981d50f..8804f5e222 100644
--- a/java/org/apache/jasper/compiler/Generator.java
+++ b/java/org/apache/jasper/compiler/Generator.java
@@ -2032,6 +2032,9 @@ class Generator {
 
             n.setBeginJavaLine(out.getJavaLine());
 
+            // Copy virtual page scope of tag file to page scope of invoking
+            // page
+            out.printil("((org.apache.jasper.runtime.JspContextWrapper) this.jspContext).syncBeforeInvoke();");
             String varReaderAttr = n.getTextAttribute("varReader");
             String varAttr = n.getTextAttribute("var");
             if (varReaderAttr != null || varAttr != null) {
@@ -2045,11 +2048,6 @@ class Generator {
             out.print(toGetterMethod(n.getTextAttribute("fragment")));
             out.println(" != null) {");
             out.pushIndent();
-            // Copy virtual page scope of tag file to page scope of invoking
-            // page
-            out.printil("((org.apache.jasper.runtime.JspContextWrapper) this.jspContext).syncBeforeInvoke(");
-            out.print(toGetterMethod(n.getTextAttribute("fragment")));
-            out.println(".getJspContext());");
             out.printin(toGetterMethod(n.getTextAttribute("fragment")));
             out.println(".invoke(_jspx_sout);");
             out.popIndent();

==================================================
