9d296f71db81845d6bc17697b440f8f01130504f
==================================================
Remove unnecessary privileged block from include.
==================================================
Mark Thomas
==================================================
Thu Apr 6 20:52:59 2017 +0000
==================================================
PageContextImpl.java
Remove unnecessary privileged block from include.
I can't see anything in doInclude that would trigger a security check.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1790462 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityClassLoad.java
index 79e35e121a..12e29c6d64 100644
--- a/java/org/apache/jasper/runtime/PageContextImpl.java
+++ b/java/org/apache/jasper/runtime/PageContextImpl.java
@@ -21,8 +21,6 @@ import java.io.IOException;
 import java.io.Writer;
 import java.security.AccessController;
 import java.security.PrivilegedAction;
-import java.security.PrivilegedActionException;
-import java.security.PrivilegedExceptionAction;
 import java.util.Collections;
 import java.util.Enumeration;
 import java.util.HashMap;
@@ -544,33 +542,7 @@ public class PageContextImpl extends PageContext {
     @Override
     public void include(final String relativeUrlPath, final boolean flush)
             throws ServletException, IOException {
-        if (SecurityUtil.isPackageProtectionEnabled()) {
-            try {
-                AccessController.doPrivileged(
-                        new PrivilegedExceptionAction<Void>() {
-                    @Override
-                    public Void run() throws Exception {
-                        doInclude(relativeUrlPath, flush);
-                        return null;
-                    }
-                });
-            } catch (PrivilegedActionException e) {
-                Exception ex = e.getException();
-                if (ex instanceof IOException) {
-                    throw (IOException) ex;
-                } else {
-                    throw (ServletException) ex;
-                }
-            }
-        } else {
-            doInclude(relativeUrlPath, flush);
-        }
-    }
-
-    private void doInclude(String relativeUrlPath, boolean flush)
-            throws ServletException, IOException {
-        JspRuntimeLibrary.include(request, response, relativeUrlPath, out,
-                flush);
+        JspRuntimeLibrary.include(request, response, relativeUrlPath, out, flush);
     }
 
     @Override

==================================================
