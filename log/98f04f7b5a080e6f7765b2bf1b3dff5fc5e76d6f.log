98f04f7b5a080e6f7765b2bf1b3dff5fc5e76d6f
==================================================
In some drivers, the call to setTransactionIsolation should be the very first call
==================================================
Filip Hanik
==================================================
Fri Feb 19 23:02:49 2010 +0000
==================================================
PooledConnection.java
index b1373b0efc..cebdd999ad 100644
--- a/modules/jdbc-pool/build.xml
+++ b/modules/jdbc-pool/build.xml
@@ -348,7 +348,7 @@
     <delete file="${base.path}/file.zip"/>
   </target>
   
-  <target name="download">
+  <target name="download" unless="skip.download">
     <mkdir dir="${base.path}"/>
 <!-- 
     <antcall target="downloadzip">

==================================================
ConnectionState.java
index 2720f35f45..b27a229bd4 100644
--- a/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
+++ b/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/PooledConnection.java
@@ -159,10 +159,10 @@ public class PooledConnection {
         
         //set up the default state, unless we expect the interceptor to do it
         if (poolProperties.getJdbcInterceptors()==null || poolProperties.getJdbcInterceptors().indexOf(ConnectionState.class.getName())<0) {
+            if (poolProperties.getDefaultTransactionIsolation()!=DataSourceFactory.UNKNOWN_TRANSACTIONISOLATION) connection.setTransactionIsolation(poolProperties.getDefaultTransactionIsolation());
             if (poolProperties.getDefaultReadOnly()!=null) connection.setReadOnly(poolProperties.getDefaultReadOnly().booleanValue());
             if (poolProperties.getDefaultAutoCommit()!=null) connection.setAutoCommit(poolProperties.getDefaultAutoCommit().booleanValue());
             if (poolProperties.getDefaultCatalog()!=null) connection.setCatalog(poolProperties.getDefaultCatalog());
-            if (poolProperties.getDefaultTransactionIsolation()!=DataSourceFactory.UNKNOWN_TRANSACTIONISOLATION) connection.setTransactionIsolation(poolProperties.getDefaultTransactionIsolation());
         }        
         this.discarded = false;
         this.lastConnected = System.currentTimeMillis();

==================================================
