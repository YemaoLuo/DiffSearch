b5b64f2123268dcf243e06a04682643c140b279c
==================================================
Restore the naming resource MBeans
==================================================
Mark Emlyn
==================================================
Tue May 25 22:43:45 2010 +0000
==================================================
StandardContext.java
Restore the naming resource MBeans

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@948232 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardServer.java
index e77f0ba02f..9b393d885d 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -418,7 +418,7 @@ public class StandardContext extends ContainerBase
      * The naming resources for this web application.
      */
     private NamingResources namingResources = null;
-
+    private ObjectName onameNamingResoucres;
 
     /**
      * The message destinations for this web application.
@@ -1745,7 +1745,10 @@ public class StandardContext extends ContainerBase
         namingResources.setContainer(this);
         support.firePropertyChange("namingResources",
                                    oldNamingResources, this.namingResources);
-
+        
+        unregister(onameNamingResoucres);
+        onameNamingResoucres = register(namingResources,
+                "type=NamingResources," + getObjectNameKeyProperties());
     }
 
 
@@ -4992,6 +4995,8 @@ public class StandardContext extends ContainerBase
                             sequenceNumber++);
         broadcaster.sendNotification(notification);
 
+        unregister(onameNamingResoucres);
+
         synchronized (instanceListenersLock) {
             instanceListeners = new String[0];
         }
@@ -5542,6 +5547,12 @@ public class StandardContext extends ContainerBase
             this.addLifecycleListener(new TldConfig());
         }
 
+        // Register the naming resources
+        if (namingResources != null) {
+            onameNamingResoucres = register(namingResources,
+                    "type=NamingResources," + getObjectNameKeyProperties());
+        }
+
         // Send j2ee.object.created notification 
         if (this.getObjectName() != null) {
             Notification notification = new Notification(

==================================================
