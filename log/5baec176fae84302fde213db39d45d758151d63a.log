5baec176fae84302fde213db39d45d758151d63a
==================================================
Refactor Hostname validation to improve performance.
==================================================
Mark Thomas
==================================================
Tue Apr 30 12:17:23 2019 +0100
==================================================
HttpParser.java
Refactor Hostname validation to improve performance.

Patch provided by Uwe Hees.


==================================================
TesterHostPerformance.java
index 9523a50c67..8702059d61 100644
--- a/java/org/apache/tomcat/util/http/parser/HttpParser.java
+++ b/java/org/apache/tomcat/util/http/parser/HttpParser.java
@@ -890,7 +890,14 @@ public class HttpParser {
         }
 
         public DomainParseState next(int c) {
-            if (HttpParser.isAlpha(c)) {
+            if (c == -1) {
+                if (allowsEnd) {
+                    return END;
+                } else {
+                    throw new IllegalArgumentException(
+                            sm.getString("http.invalidSegmentEndState", this.name()));
+                }
+            } else if (HttpParser.isAlpha(c)) {
                 return ALPHA;
             } else if (HttpParser.isNumeric(c)) {
                 return NUMERIC;
@@ -908,13 +915,6 @@ public class HttpParser {
                     throw new IllegalArgumentException(sm.getString(errorMsg,
                             Character.toString((char) c)));
                 }
-            } else if (c == -1) {
-                if (allowsEnd) {
-                    return END;
-                } else {
-                    throw new IllegalArgumentException(
-                            sm.getString("http.invalidSegmentEndState", this.name()));
-                }
             } else if (c == '-') {
                 if (allowsHyphen) {
                     return HYPHEN;

==================================================
