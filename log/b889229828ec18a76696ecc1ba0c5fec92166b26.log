b889229828ec18a76696ecc1ba0c5fec92166b26
==================================================
Alternative fix for NIO2
==================================================
Mark Thomas
==================================================
Sun Nov 23 22:50:13 2014 +0000
==================================================
AbstractProtocol.java
Alternative fix for NIO2

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1641276 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpNio2Protocol.java
index 3a4cd3cf94..13108200c9 100644
--- a/java/org/apache/coyote/AbstractProtocol.java
+++ b/java/org/apache/coyote/AbstractProtocol.java
@@ -693,7 +693,7 @@ public abstract class AbstractProtocol<S> implements ProtocolHandler,
                     // In keep-alive but between requests. OK to recycle
                     // processor. Continue to poll for the next request.
                     connections.remove(socket);
-                    release(wrapper, processor, false, false);
+                    release(wrapper, processor, false, true);
                 } else if (state == SocketState.SENDFILE) {
                     // Sendfile in progress. If it fails, the socket will be
                     // closed. If it works, the socket will be re-added to the

==================================================
