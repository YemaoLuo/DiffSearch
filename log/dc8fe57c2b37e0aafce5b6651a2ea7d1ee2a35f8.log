dc8fe57c2b37e0aafce5b6651a2ea7d1ee2a35f8
==================================================
If an async dispatch results in the completion of request processing, ensure that any remaining requets body is swallowed before starting the processing of the next request else the remaining body may be read as the start of the next request leading to a 400 response.
==================================================
Mark Thomas
==================================================
Thu Jun 2 22:37:48 2016 +0000
==================================================
Http11Processor.java
If an async dispatch results in the completion of request processing, ensure that any remaining requets body is swallowed before starting the processing of the next request else the remaining body may be read as the start of the next request leading to a 400 response.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1746649 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestHttp11Processor.java
index 2fb324b926..1ebb373f1f 100644
--- a/java/org/apache/coyote/http11/Http11Processor.java
+++ b/java/org/apache/coyote/http11/Http11Processor.java
@@ -1727,6 +1727,7 @@ public class Http11Processor extends AbstractProcessor {
         if (!keepAlive) {
             return SocketState.CLOSED;
         } else {
+            endRequest();
             inputBuffer.nextRequest();
             outputBuffer.nextRequest();
             if (socketWrapper.isReadPending()) {

==================================================
