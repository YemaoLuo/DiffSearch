bac352411cf9219cd85c6c7688c5094e408af8a5
==================================================
Implemented SSLEngine attribute on the Java HTTP connectors.
==================================================
Filip Hanik
==================================================
Wed Oct 18 17:10:44 2006 +0000
==================================================
Http11NioProcessor.java
Implemented SSLEngine attribute on the Java HTTP connectors.
This allows one to specify secure=true and scheme=https to prevent tomcat from redirecting 
when using a SSL accelerator in front of tomcat


git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@465303 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11NioProtocol.java
index 19700de97d..122b8e7e3d 100644
--- a/java/org/apache/coyote/http11/Http11NioProcessor.java
+++ b/java/org/apache/coyote/http11/Http11NioProcessor.java
@@ -103,7 +103,7 @@ public class Http11NioProcessor implements ActionHook {
         response.setOutputBuffer(outputBuffer);
         request.setResponse(response);
 
-        ssl = endpoint.getSecure();
+        ssl = "on".equalsIgnoreCase(endpoint.getSSLEngine());
 
         initializeFilters();
 

==================================================
Http11Protocol.java
index 84c14c0e10..a8ff9e3c7e 100644
--- a/java/org/apache/coyote/http11/Http11NioProtocol.java
+++ b/java/org/apache/coyote/http11/Http11NioProtocol.java
@@ -516,6 +516,8 @@ public class Http11NioProtocol implements ProtocolHandler, MBeanRegistration
 
     public String getKeystoreFile() { return ep.getKeystoreFile();}
     public void setKeystoreFile(String s ) { ep.setKeystoreFile(s);}
+    public void setKeystore(String s) { setKeystoreFile(s);}
+    public String getKeystore(){ return getKeystoreFile();}
     
     public String getAlgorithm() { return ep.getAlgorithm();}
     public void setAlgorithm(String s ) { ep.setAlgorithm(s);}
@@ -535,6 +537,10 @@ public class Http11NioProtocol implements ProtocolHandler, MBeanRegistration
     public String getCiphers() { return ep.getCiphers();}
     public void setCiphers(String s) { ep.setCiphers(s);}
     
+    public String getSSLEngine() { return ep.getSSLEngine(); }
+    public void setSSLEngine(String SSLEngine) { ep.setSSLEngine(SSLEngine); }
+    
+    
 
     // --------------------  Connection handler --------------------
 

==================================================
NioEndpoint.java
index ca219d04cc..5e83b83f2a 100644
--- a/java/org/apache/coyote/http11/Http11Protocol.java
+++ b/java/org/apache/coyote/http11/Http11Protocol.java
@@ -146,7 +146,7 @@ public class Http11Protocol
 
         // Verify the validity of the configured socket factory
         try {
-            if (secure) {
+            if ("on".equalsIgnoreCase(getSSLEngine())) {
                 sslImplementation =
                     SSLImplementation.getInstance(sslImplementationName);
                 socketFactory = sslImplementation.getServerSocketFactory();
@@ -251,7 +251,10 @@ public class Http11Protocol
     protected boolean secure;
     public boolean getSecure() { return secure; }
     public void setSecure(boolean b) { secure = b; }
-    
+
+    protected String SSLEngine = "off";
+    public String getSSLEngine() { return SSLEngine;}
+    public void setSSLEngine(String SSLEngine) {this.SSLEngine = SSLEngine;}    
     
     /**
      * Name of the socket factory.

==================================================
