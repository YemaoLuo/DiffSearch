65d8fc8039e62bf5752614ae076f918a8a21b33c
==================================================
Cleanup and simplify.
==================================================
Remy Maucherat
==================================================
Wed Jan 28 12:11:54 2015 +0000
==================================================
Http11Nio2Protocol.java
Cleanup and simplify.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1655272 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Nio2Endpoint.java
index 3565c82c05..de4cb00065 100644
--- a/java/org/apache/coyote/http11/Http11Nio2Protocol.java
+++ b/java/org/apache/coyote/http11/Http11Nio2Protocol.java
@@ -161,7 +161,7 @@ public class Http11Nio2Protocol extends AbstractHttp11JsseProtocol<Nio2Channel>
                 ((Nio2Endpoint) proto.getEndpoint()).removeTimeout(socket);
             }
             if (addToPoller) {
-                ((Nio2Endpoint) proto.getEndpoint()).awaitBytes(socket);
+                ((Nio2SocketWrapper) socket).awaitBytes();
             }
         }
 
@@ -191,7 +191,7 @@ public class Http11Nio2Protocol extends AbstractHttp11JsseProtocol<Nio2Channel>
             } else if (processor.isUpgrade()) {
                 if (((Nio2SocketWrapper) socket).isUpgradeInit()) {
                     try {
-                        ((Nio2Endpoint) proto.getEndpoint()).awaitBytes(socket);
+                        ((Nio2SocketWrapper) socket).awaitBytes();
                     } catch (ReadPendingException e) {
                         // Ignore, the initial state after upgrade is
                         // impossible to predict, and a read must be pending

==================================================
