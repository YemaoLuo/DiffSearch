f277b145b167154ed8028be7bca3c841e89b5dc3
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52440
==================================================
Mark Emlyn
==================================================
Thu Jan 12 19:33:17 2012 +0000
==================================================
AstIdentifier.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52440
Need to resolve EL variables when returning ValueReferences
Includes a new test case.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1230711 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestValueExpressionImpl.java
index f689ee50b7..fe489939ae 100644
--- a/java/org/apache/el/parser/AstIdentifier.java
+++ b/java/org/apache/el/parser/AstIdentifier.java
@@ -24,6 +24,7 @@ import javax.el.MethodInfo;
 import javax.el.MethodNotFoundException;
 import javax.el.PropertyNotFoundException;
 import javax.el.ValueExpression;
+import javax.el.ValueReference;
 import javax.el.VariableMapper;
 
 import org.apache.el.lang.EvaluationContext;
@@ -135,6 +136,25 @@ public final class AstIdentifier extends SimpleNode {
         this.image = image;
     }
 
+
+    @Override
+    public ValueReference getValueReference(EvaluationContext ctx) {
+        VariableMapper varMapper = ctx.getVariableMapper();
+
+        if (varMapper == null) {
+            return null;
+        }
+
+        ValueExpression expr = varMapper.resolveVariable(this.image);
+
+        if (expr == null) {
+            return null;
+        }
+
+        return expr.getValueReference(ctx);
+    }
+
+
     private final MethodExpression getMethodExpression(EvaluationContext ctx)
             throws ELException {
         Object obj = null;

==================================================
