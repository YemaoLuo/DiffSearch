b299dba9051d8661c9ac9f86bd2b3baa811255be
==================================================
Address a handful of SpotBugs warnings
==================================================
Mark Thomas
==================================================
Fri Dec 1 19:02:44 2017 +0000
==================================================
AntCompiler.java
Address a handful of SpotBugs warnings

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1816898 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Compiler.java
index 637f36f5d2..12a0bb815f 100644
--- a/java/org/apache/jasper/compiler/AntCompiler.java
+++ b/java/org/apache/jasper/compiler/AntCompiler.java
@@ -250,7 +250,10 @@ public class AntCompiler extends Compiler {
 
         if (!ctxt.keepGenerated()) {
             File javaFile = new File(javaFileName);
-            javaFile.delete();
+            if (!javaFile.delete()) {
+                throw new JasperException(Localizer.getMessage(
+                        "jsp.warning.compiler.javafile.delete.fail", javaFile));
+            }
         }
 
         if (be != null) {

==================================================
JDTCompiler.java
index c63271a50b..84ef856352 100644
--- a/java/org/apache/jasper/compiler/Compiler.java
+++ b/java/org/apache/jasper/compiler/Compiler.java
@@ -384,14 +384,19 @@ public abstract class Compiler {
             Map<String,SmapStratum> smaps = generateJava();
             File javaFile = new File(ctxt.getServletJavaFileName());
             Long jspLastModified = ctxt.getLastModified(ctxt.getJspFile());
-            javaFile.setLastModified(jspLastModified.longValue());
+            if (!javaFile.setLastModified(jspLastModified.longValue())) {
+                throw new JasperException(Localizer.getMessage("jsp.error.setLastModified", javaFile));
+            }
             if (compileClass) {
                 generateClass(smaps);
                 // Fix for bugzilla 41606
                 // Set JspServletWrapper.servletClassLastModifiedTime after successful compile
                 File targetFile = new File(ctxt.getClassFileName());
                 if (targetFile.exists()) {
-                    targetFile.setLastModified(jspLastModified.longValue());
+                    if (!targetFile.setLastModified(jspLastModified.longValue())) {
+                        throw new JasperException(
+                                Localizer.getMessage("jsp.error.setLastModified", targetFile));
+                    }
                     if (jsw != null) {
                         jsw.setServletClassLastModifiedTime(
                                 jspLastModified.longValue());

==================================================
OneLineFormatter.java
index fa6938633b..b4cbc16856 100644
--- a/java/org/apache/jasper/resources/LocalStrings.properties
+++ b/java/org/apache/jasper/resources/LocalStrings.properties
@@ -360,6 +360,7 @@ jsp.error.unbalanced.endtag=The end tag "&lt;/{0}" is unbalanced
 jsp.error.invalid.bean=The value for the useBean class attribute [{0}] is invalid.
 jsp.error.prefix.use_before_dcl=The prefix [{0}] specified in this tag directive has been previously used by an action in file [{1}] line [{2}].
 jsp.error.lastModified=Unable to determine last modified date for file [{0}]
+jsp.error.setLastModified=Unable to set last modified date for file [{0}]
 jsp.info.ignoreSetting=Ignored setting for [{0}] of [{1}] because a SecurityManager was enabled
 
 jsp.exception=An exception occurred processing [{0}] at line [{1}]

==================================================
