a8fe5aa21cb5a3b10f6d733192dc15d7c7bd4ac8
==================================================
Undo accidental commit of files that should not have been included in r786471. These will follow separately with the correct comments. Sorry for the noise.
==================================================
Mark Emlyn
==================================================
Fri Jun 19 12:16:25 2009 +0000
==================================================
AccessLogValve.java
Undo accidental commit of files that should not have been included in r786471. These will follow separately with the correct comments. Sorry for the noise.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@786473 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspRuntimeContext.java
index 2c688f7318..7df274046a 100644
--- a/java/org/apache/catalina/valves/AccessLogValve.java
+++ b/java/org/apache/catalina/valves/AccessLogValve.java
@@ -690,12 +690,10 @@ public class AccessLogValve
         }
 
         // Log this message
-        synchronized(this) {
-            if (writer != null) {
-                writer.println(message);
-                if (!buffered) {
-                    writer.flush();
-                }
+        if (writer != null) {
+            writer.println(message);
+            if (!buffered) {
+                writer.flush();
             }
         }
 

==================================================
TestRequest.java
index af728b7854..aac6c55e8f 100644
--- a/java/org/apache/jasper/compiler/JspRuntimeContext.java
+++ b/java/org/apache/jasper/compiler/JspRuntimeContext.java
@@ -394,19 +394,16 @@ public final class JspRuntimeContext {
                 docBase = docBase + "-";
                 permissionCollection.add(new FilePermission(docBase,"read"));
 
-                // Spec says apps should have read/write for their temp
-                // directory. This is fine, as no security sensitive files, at
-                // least any that the app doesn't have full control of anyway,
-                // will be written here.
+                // Create a file read permission for web app tempdir (work)
+                // directory
                 String workDir = options.getScratchDir().toString();
                 if (!workDir.endsWith(File.separator)){
                     permissionCollection.add
-                        (new FilePermission(workDir,"read,write"));
+                        (new FilePermission(workDir,"read"));
                     workDir = workDir + File.separator;
                 }
                 workDir = workDir + "-";
-                permissionCollection.add(new FilePermission(
-                        workDir,"read,write,delete"));
+                permissionCollection.add(new FilePermission(workDir,"read"));
 
                 // Allow the JSP to access org.apache.jasper.runtime.HttpJspBase
                 permissionCollection.add( new RuntimePermission(

==================================================
