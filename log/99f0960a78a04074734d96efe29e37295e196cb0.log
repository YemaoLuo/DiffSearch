99f0960a78a04074734d96efe29e37295e196cb0
==================================================
Expose the global naming context for all Server implementations
==================================================
Mark Emlyn
==================================================
Tue Mar 8 15:58:53 2011 +0000
==================================================
Server.java
Expose the global naming context for all Server implementations

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1079405 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardServer.java
index 5e36f05d9c..6b4a05490b 100644
--- a/java/org/apache/catalina/Server.java
+++ b/java/org/apache/catalina/Server.java
@@ -75,6 +75,12 @@ public interface Server extends Lifecycle {
         (NamingResources globalNamingResources);
 
 
+    /**
+     * Return the global naming resources context.
+     */
+    public javax.naming.Context getGlobalNamingContext();
+
+
     /**
      * Return the port number we listen to for shutdown commands.
      */

==================================================
ManagerServlet.java
index f529ab7968..7c8ec0cb9b 100644
--- a/java/org/apache/catalina/core/StandardServer.java
+++ b/java/org/apache/catalina/core/StandardServer.java
@@ -173,6 +173,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
     /**
      * Return the global naming resources context.
      */
+    @Override
     public javax.naming.Context getGlobalNamingContext() {
 
         return (this.globalNamingContext);

==================================================
DataSourceRealm.java
index bf1e8f5fc8..72cf687ce1 100644
--- a/java/org/apache/catalina/manager/ManagerServlet.java
+++ b/java/org/apache/catalina/manager/ManagerServlet.java
@@ -457,8 +457,8 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
 
         // Acquire global JNDI resources if available
         Server server = ((Engine)host.getParent()).getService().getServer();
-        if ((server != null) && (server instanceof StandardServer)) {
-            global = ((StandardServer) server).getGlobalNamingContext();
+        if (server != null) {
+            global = server.getGlobalNamingContext();
         }
 
         // Calculate the directory into which we will be deploying applications

==================================================
UserDatabaseRealm.java
index e013bcedcf..4777251be5 100644
--- a/java/org/apache/catalina/realm/DataSourceRealm.java
+++ b/java/org/apache/catalina/realm/DataSourceRealm.java
@@ -30,7 +30,6 @@ import javax.naming.Context;
 import javax.sql.DataSource;
 
 import org.apache.catalina.LifecycleException;
-import org.apache.catalina.core.StandardServer;
 import org.apache.naming.ContextBindings;
 
 /**
@@ -390,8 +389,7 @@ public class DataSourceRealm
                 context = ContextBindings.getClassLoader();
                 context = (Context) context.lookup("comp/env");
             } else {
-                context =
-                    ((StandardServer)getServer()).getGlobalNamingContext();
+                context = getServer().getGlobalNamingContext();
             }
             DataSource dataSource = (DataSource)context.lookup(dataSourceName);
         return dataSource.getConnection();

==================================================
