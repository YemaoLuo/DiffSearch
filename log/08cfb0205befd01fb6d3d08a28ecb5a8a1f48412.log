08cfb0205befd01fb6d3d08a28ecb5a8a1f48412
==================================================
Cleanup, use the main Request type like the current authenticators and remove code duplication with the "classic" BASIC authenticator.
==================================================
Remy Maucherat
==================================================
Wed Oct 21 12:44:40 2015 +0000
==================================================
BasicAuthenticator.java
Cleanup, use the main Request type like the current authenticators and remove code duplication with the "classic" BASIC authenticator.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1709818 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JaspicAuthenticator.java
index f86ec7d645..f77dfa8d49 100644
--- a/java/org/apache/catalina/authenticator/BasicAuthenticator.java
+++ b/java/org/apache/catalina/authenticator/BasicAuthenticator.java
@@ -117,7 +117,7 @@ public class BasicAuthenticator extends AuthenticatorBase {
      * as per RFC 2617 section 2, and the Base64 encoded credentials as
      * per RFC 2045 section 6.8.
      */
-    protected static class BasicCredentials {
+    public static class BasicCredentials {
 
         // the only authentication method supported by this parser
         // note: we include single white space as its delimiter

==================================================
MessageInfoImpl.java
index ca9d3dcf7c..1115d4e6d8 100644
--- a/java/org/apache/catalina/authenticator/jaspic/LocalStrings.properties
+++ b/java/org/apache/catalina/authenticator/jaspic/LocalStrings.properties
@@ -16,3 +16,5 @@
 authenticator.jaspic.unauthorized=Cannot authenticate with the provided credentials
 authenticator.jaspic.unknownCallback=Unknown JASPIC callback: [{0}]
 authenticator.jaspic.unknownAuthType=Unknown authentication type: [{0}]
+authenticator.jaspic.badRequestType=Request [{0}] is not a Catalina request
+authenticator.jaspic.badResponseType=Response [{0}] is not a Servlet response
\ No newline at end of file

==================================================
BasicAuthModule.java
index 7c01dde85f..1c27a7976a 100644
--- a/java/org/apache/catalina/authenticator/jaspic/MessageInfoImpl.java
+++ b/java/org/apache/catalina/authenticator/jaspic/MessageInfoImpl.java
@@ -20,16 +20,18 @@ import java.util.HashMap;
 import java.util.Map;
 
 import javax.security.auth.message.MessageInfo;
-import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 
 import org.apache.catalina.connector.Request;
+import org.apache.tomcat.util.res.StringManager;
 
 public class MessageInfoImpl implements MessageInfo {
+    protected static final StringManager sm = StringManager.getManager(MessageInfoImpl.class);
+
     public static final String IS_MANDATORY = "javax.security.auth.message.MessagePolicy.isMandatory";
 
     private final Map<String, Object> map = new HashMap<>();
-    private HttpServletRequest request;
+    private Request request;
     private HttpServletResponse response;
 
     public MessageInfoImpl() {
@@ -60,18 +62,18 @@ public class MessageInfoImpl implements MessageInfo {
 
     @Override
     public void setRequestMessage(Object request) {
-        if (!(request instanceof HttpServletRequest)) {
-            throw new IllegalArgumentException("Request is not a servlet request but "
-                    + request.getClass().getName());
+        if (!(request instanceof Request)) {
+            throw new IllegalArgumentException(sm.getString("authenticator.jaspic.badRequestType",
+                    request.getClass().getName()));
         }
-        this.request = (HttpServletRequest) request;
+        this.request = (Request) request;
     }
 
     @Override
     public void setResponseMessage(Object response) {
         if (!(response instanceof HttpServletResponse)) {
-            throw new IllegalArgumentException("response is not a servlet response but "
-                    + response.getClass().getName());
+            throw new IllegalArgumentException(sm.getString("authenticator.jaspic.badResponseType",
+                    response.getClass().getName()));
         }
         this.response = (HttpServletResponse) response;
     }

==================================================
