aa43e7e241f5d174d91ac1937fb918d412dbd4af
==================================================
Followup to Mark's r1228724
==================================================
Konstantin Kolinko
==================================================
Sun Jan 8 19:33:57 2012 +0000
==================================================
Connector.java
Followup to Mark's r1228724
The ObjectName.quote() must always be called with address, because ip6 addresses have characters that are must be quoted in QName. The Connector.java changes in r1228724 bypassed that call.
Update TestRegistration.java accordingly.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1228929 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestRegistration.java
index b1a548383e..c24d0879ce 100644
--- a/java/org/apache/catalina/connector/Connector.java
+++ b/java/org/apache/catalina/connector/Connector.java
@@ -882,15 +882,15 @@ public class Connector extends LifecycleMBeanBase  {
             sb.append("auto-");
             sb.append(getProperty("nameIndex"));
         }
+        String address = "";
         if (addressObj instanceof InetAddress) {
+            address = ((InetAddress) addressObj).getHostAddress();
+        } else if (addressObj != null) {
+            address = addressObj.toString();
+        }
+        if (address.length() > 0) {
             sb.append(",address=");
-            sb.append(((InetAddress) addressObj).getHostAddress());
-        } else if(addressObj != null) {
-            String address = addressObj.toString();
-            if (address.length() > 0) {
-                sb.append(",address=");
-                sb.append(ObjectName.quote(address));
-            }
+            sb.append(ObjectName.quote(address));
         }
         return sb.toString();
     }

==================================================
