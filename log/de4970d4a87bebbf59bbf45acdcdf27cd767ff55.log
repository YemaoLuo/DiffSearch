de4970d4a87bebbf59bbf45acdcdf27cd767ff55
==================================================
Improve Connector.stop() handling and APR. This particularly affects Comet where a unit test failure was seen on some Linux platforms.
==================================================
Mark Emlyn
==================================================
Mon Jul 9 14:15:27 2012 +0000
==================================================
Http11AprProtocol.java
Improve Connector.stop() handling and APR. This particularly affects Comet where a unit test failure was seen on some Linux platforms.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1359183 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AprEndpoint.java
index c0ecf79102..8d3c36ddc7 100644
--- a/java/org/apache/coyote/http11/Http11AprProtocol.java
+++ b/java/org/apache/coyote/http11/Http11AprProtocol.java
@@ -282,11 +282,9 @@ public class Http11AprProtocol extends AbstractHttp11Protocol {
                 socket.setAsync(true);
             } else if (processor.isComet()) {
                 // Comet
-                if (proto.endpoint.isRunning()) {
-                    ((AprEndpoint) proto.endpoint).getCometPoller().add(
-                            socket.getSocket().longValue(),
-                            proto.endpoint.getSoTimeout());
-                }
+                ((AprEndpoint) proto.endpoint).getCometPoller().add(
+                        socket.getSocket().longValue(),
+                        proto.endpoint.getSoTimeout());
             } else {
                 // Upgraded
                 ((AprEndpoint) proto.endpoint).getPoller().add(

==================================================
