c454a1c5d996c47081c15718d41052c463cdf074
==================================================
Merging from sandbox: the casts are redundant for now, but in a future commit RequestInfo won't directly depend on JMX
==================================================
Costin Manolache
==================================================
Sun Sep 7 15:36:46 2008 +0000
==================================================
AjpAprProtocol.java
Merging from sandbox: the casts are redundant for now, but in a future commit RequestInfo won't directly depend on JMX
( this is the only dep between base coyote/tomcat-lite and JMX ). Tomcat-lite still uses JMX, but optionally.
Also exposing the endpoint, for easier programmatic config.

 


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@692880 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpProtocol.java
index e31bbfde5e..a51bb15203 100644
--- a/java/org/apache/coyote/ajp/AjpAprProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpAprProtocol.java
@@ -447,7 +447,7 @@ public class AjpAprProtocol
                     try {
                         RequestInfo rp = processor.getRequest().getRequestProcessor();
                         rp.setGlobalProcessor(null);
-                        ObjectName rpName = rp.getRpName();
+                        ObjectName rpName = (ObjectName) rp.getRpName();
                         if (log.isDebugEnabled()) {
                             log.debug("Unregister " + rpName);
                         }

==================================================
Http11AprProtocol.java
index d54885f896..1ff2881700 100644
--- a/java/org/apache/coyote/ajp/AjpProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpProtocol.java
@@ -433,7 +433,7 @@ public class AjpProtocol
                     try {
                         RequestInfo rp = processor.getRequest().getRequestProcessor();
                         rp.setGlobalProcessor(null);
-                        ObjectName rpName = rp.getRpName();
+                        ObjectName rpName = (ObjectName) rp.getRpName();
                         if (log.isDebugEnabled()) {
                             log.debug("Unregister " + rpName);
                         }

==================================================
Http11NioProtocol.java
index 09ae4c6cf3..c19c38c4f2 100644
--- a/java/org/apache/coyote/http11/Http11AprProtocol.java
+++ b/java/org/apache/coyote/http11/Http11AprProtocol.java
@@ -652,7 +652,7 @@ public class Http11AprProtocol implements ProtocolHandler, MBeanRegistration {
                     try {
                         RequestInfo rp = processor.getRequest().getRequestProcessor();
                         rp.setGlobalProcessor(null);
-                        ObjectName rpName = rp.getRpName();
+                        ObjectName rpName = (ObjectName) rp.getRpName();
                         if (log.isDebugEnabled()) {
                             log.debug("Unregister " + rpName);
                         }

==================================================
Http11Protocol.java
index dc6d83559f..310346016f 100644
--- a/java/org/apache/coyote/http11/Http11NioProtocol.java
+++ b/java/org/apache/coyote/http11/Http11NioProtocol.java
@@ -81,6 +81,10 @@ public class Http11NioProtocol implements ProtocolHandler, MBeanRegistration
         attributes.put(name, value);
     }
 
+    public NioEndpoint getEndpoint() {
+        return ep;
+    }
+    
     public Object getAttribute( String key ) {
         if( log.isTraceEnabled())
             log.trace(sm.getString("http11protocol.getattribute", key));
@@ -809,7 +813,7 @@ public class Http11NioProtocol implements ProtocolHandler, MBeanRegistration
                         if (log.isDebugEnabled()) log.debug("Deregister ["+processor+"] count="+registerCount.get());
                         RequestInfo rp = processor.getRequest().getRequestProcessor();
                         rp.setGlobalProcessor(null);
-                        ObjectName rpName = rp.getRpName();
+                        ObjectName rpName = (ObjectName) rp.getRpName();
                         Registry.getRegistry(null, null).unregisterComponent(rpName);
                         rp.setRpName(null);
                     } catch (Exception e) {

==================================================
