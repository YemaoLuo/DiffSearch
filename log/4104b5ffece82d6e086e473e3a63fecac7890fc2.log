4104b5ffece82d6e086e473e3a63fecac7890fc2
==================================================
Noticed requirement for null values to trigger removal when reading the EL 3.0 spec.
==================================================
Mark Emlyn
==================================================
Wed Jul 3 14:27:46 2013 +0000
==================================================
VariableMapperImpl.java
Noticed requirement for null values to trigger removal when reading the EL 3.0 spec.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1499419 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ELContextImpl.java
index 90071e01a3..ee3910e17f 100644
--- a/java/org/apache/el/lang/VariableMapperImpl.java
+++ b/java/org/apache/el/lang/VariableMapperImpl.java
@@ -45,7 +45,11 @@ public class VariableMapperImpl extends VariableMapper implements Externalizable
     @Override
     public ValueExpression setVariable(String variable,
             ValueExpression expression) {
-        return this.vars.put(variable, expression);
+        if (expression == null) {
+            return vars.remove(variable);
+        } else {
+            return vars.put(variable, expression);
+        }
     }
 
     @Override

==================================================
TestBeanELResolverVarargsInvocation.java
index ede2edf47a..dba2901802 100644
--- a/java/org/apache/jasper/el/ELContextImpl.java
+++ b/java/org/apache/jasper/el/ELContextImpl.java
@@ -63,11 +63,15 @@ public final class ELContextImpl extends ELContext {
         @Override
         public ValueExpression setVariable(String variable,
                 ValueExpression expression) {
-            if (vars == null)
+            if (vars == null) {
                 vars = new HashMap<>();
-            return vars.put(variable, expression);
+            }
+            if (expression == null) {
+                return vars.remove(variable);
+            } else {
+                return vars.put(variable, expression);
+            }
         }
-
     }
 
     private static final ELResolver DefaultResolver;

==================================================
