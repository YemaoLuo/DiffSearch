9728aabec39125739be8d304da78ea9e0f69d8a8
==================================================
Avoid wheel re-invention. Use the available utility class for copying between streams.
==================================================
Mark Thomas
==================================================
Wed Jan 6 20:06:51 2016 +0000
==================================================
HostManagerServlet.java
Avoid wheel re-invention. Use the available utility class for copying between streams.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1723410 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestStandardContextResources.java
index 4f1aae0af4..a5247898a7 100644
--- a/java/org/apache/catalina/manager/host/HostManagerServlet.java
+++ b/java/org/apache/catalina/manager/host/HostManagerServlet.java
@@ -39,6 +39,7 @@ import org.apache.catalina.Wrapper;
 import org.apache.catalina.core.ContainerBase;
 import org.apache.catalina.core.StandardHost;
 import org.apache.catalina.startup.HostConfig;
+import org.apache.catalina.util.IOTools;
 import org.apache.tomcat.util.ExceptionUtils;
 import org.apache.tomcat.util.res.StringManager;
 
@@ -386,16 +387,9 @@ public class HostManagerServlet
                     OutputStream os = new FileOutputStream(
                             new File(configBaseFile, "manager.xml"))) {
                 byte buffer[] = new byte[512];
-                int len = buffer.length;
-                while (true) {
-                    len = is.read(buffer);
-                    if (len == -1)
-                        break;
-                    os.write(buffer, 0, len);
-                }
+                IOTools.flow(is, os, buffer);
             } catch (IOException e) {
-                writer.println(smClient.getString(
-                        "hostManagerServlet.managerXml"));
+                writer.println(smClient.getString("hostManagerServlet.managerXml"));
                 return;
             }
         }

==================================================
TomcatBaseTest.java
index 04dec12f88..3cc16eafaa 100644
--- a/test/org/apache/catalina/core/TestStandardContextResources.java
+++ b/test/org/apache/catalina/core/TestStandardContextResources.java
@@ -41,6 +41,7 @@ import org.apache.catalina.startup.Constants;
 import org.apache.catalina.startup.ContextConfig;
 import org.apache.catalina.startup.Tomcat;
 import org.apache.catalina.startup.TomcatBaseTest;
+import org.apache.catalina.util.IOTools;
 import org.apache.tomcat.util.buf.ByteChunk;
 import org.apache.tomcat.util.descriptor.web.WebXml;
 
@@ -255,10 +256,7 @@ public class TestStandardContextResources extends TomcatBaseTest {
 
             try (InputStream input = url.openStream();
                     OutputStream output = resp.getOutputStream()) {
-                byte[] buffer = new byte[4000];
-                for (int len; (len = input.read(buffer)) > 0;) {
-                    output.write(buffer, 0, len);
-                }
+                IOTools.flow(input, output);
             }
         }
     }

==================================================
