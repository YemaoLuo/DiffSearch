ee2e35b364de64f478b746d40d7bf2352cc97006
==================================================
Expand debugging for async processing
==================================================
Mark Thomas
==================================================
Wed Oct 9 16:35:42 2019 +0100
==================================================
AbstractProcessor.java
Expand debugging for async processing


==================================================
AbstractProcessorLight.java
index 03984f9356..fc3274519c 100644
--- a/java/org/apache/coyote/AbstractProcessor.java
+++ b/java/org/apache/coyote/AbstractProcessor.java
@@ -252,15 +252,25 @@ public abstract class AbstractProcessor extends AbstractProcessorLight implement
 
         rp.setStage(org.apache.coyote.Constants.STAGE_ENDED);
 
+        SocketState state;
+
         if (getErrorState().isError()) {
             request.updateCounters();
-            return SocketState.CLOSED;
+            state = SocketState.CLOSED;
         } else if (isAsync()) {
-            return SocketState.LONG;
+            state = SocketState.LONG;
         } else {
             request.updateCounters();
-            return dispatchEndRequest();
+            state = dispatchEndRequest();
+        }
+
+        if (getLog().isDebugEnabled()) {
+            getLog().debug("Socket: [" + socketWrapper +
+                    "], Status in: [" + status +
+                    "], State out: [" + state + "]");
         }
+
+        return state;
     }
 
 

==================================================
