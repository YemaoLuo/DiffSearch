9303a897b8b78e711db361602ad07bc2c38450ab
==================================================
Partial code clean-up for o.a.catalina.tribes
==================================================
Mark Emlyn
==================================================
Tue Aug 7 19:48:33 2012 +0000
==================================================
Arrays.java
Partial code clean-up for o.a.catalina.tribes
 - Add final prompted by UCDetector
 - Java 7 use of <>

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1370471 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StringManager.java
index b24cce4bc0..cac35f0eba 100644
--- a/java/org/apache/catalina/tribes/util/Arrays.java
+++ b/java/org/apache/catalina/tribes/util/Arrays.java
@@ -143,8 +143,7 @@ public class Arrays {
     public static Member[] merge(Member[] m1, Member[] m2) {
         AbsoluteOrder.absoluteOrder(m1);
         AbsoluteOrder.absoluteOrder(m2);
-        ArrayList<Member> list =
-            new ArrayList<Member>(java.util.Arrays.asList(m1));
+        ArrayList<Member> list = new ArrayList<>(java.util.Arrays.asList(m1));
         for (int i=0; i<m2.length; i++) if ( !list.contains(m2[i]) ) list.add(m2[i]);
         Member[] result = new Member[list.size()];
         list.toArray(result);
@@ -157,7 +156,7 @@ public class Arrays {
     }
 
     public static Member[] diff(Membership complete, Membership local, MemberImpl ignore) {
-        ArrayList<Member> result = new ArrayList<Member>();
+        ArrayList<Member> result = new ArrayList<>();
         MemberImpl[] comp = complete.getMembers();
         for ( int i=0; i<comp.length; i++ ) {
             if ( ignore!=null && ignore.equals(comp[i]) ) continue;
@@ -172,7 +171,7 @@ public class Arrays {
 
     public static Member[] extract(Member[] all, Member[] remove) {
         List<Member> alist = java.util.Arrays.asList(all);
-        ArrayList<Member> list = new ArrayList<Member>(alist);
+        ArrayList<Member> list = new ArrayList<>(alist);
         for (int i=0; i<remove.length; i++ ) list.remove(remove[i]);
         return list.toArray(new Member[list.size()]);
     }

==================================================
UUIDGenerator.java
index 69f87c6329..502414fe33 100644
--- a/java/org/apache/catalina/tribes/util/StringManager.java
+++ b/java/org/apache/catalina/tribes/util/StringManager.java
@@ -55,8 +55,8 @@ public class StringManager {
     /**
      * The ResourceBundle for this StringManager.
      */
-    private ResourceBundle bundle;
-    private Locale locale;
+    private final ResourceBundle bundle;
+    private final Locale locale;
 
     /**
      * Creates a new StringManager for a given package. This is a
@@ -67,9 +67,11 @@ public class StringManager {
      * @param packageName Name of package to create StringManager for.
      */
     private StringManager(String packageName) {
+        ResourceBundle b = null;
+
         String bundleName = packageName + ".LocalStrings";
         try {
-            bundle = ResourceBundle.getBundle(bundleName, Locale.getDefault());
+            b = ResourceBundle.getBundle(bundleName, Locale.getDefault());
         } catch( MissingResourceException ex ) {
             // Try from the current loader (that's the case for trusted apps)
             // Should only be required if using a TC5 style classloader structure
@@ -77,7 +79,7 @@ public class StringManager {
             ClassLoader cl = Thread.currentThread().getContextClassLoader();
             if( cl != null ) {
                 try {
-                    bundle = ResourceBundle.getBundle(
+                    b = ResourceBundle.getBundle(
                             bundleName, Locale.getDefault(), cl);
                 } catch(MissingResourceException ex2) {
                     // Ignore
@@ -85,8 +87,11 @@ public class StringManager {
             }
         }
         // Get the actual locale, which may be different from the requested one
+        this.bundle = b;
         if (bundle != null) {
             locale = bundle.getLocale();
+        } else {
+            locale = null;
         }
     }
 
@@ -149,8 +154,8 @@ public class StringManager {
     // STATIC SUPPORT METHODS
     // --------------------------------------------------------------
 
-    private static Hashtable<String, StringManager> managers =
-        new Hashtable<String, StringManager>();
+    private static final Hashtable<String, StringManager> managers =
+        new Hashtable<>();
 
     /**
      * Get the StringManager for a particular package. If a manager for

==================================================
