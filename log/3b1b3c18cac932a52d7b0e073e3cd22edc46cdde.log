3b1b3c18cac932a52d7b0e073e3cd22edc46cdde
==================================================
Fix bug searching for single character Strings (search would always fail)
==================================================
Mark Thomas
==================================================
Tue Jan 16 12:18:30 2018 +0000
==================================================
CharChunk.java
Fix bug searching for single character Strings (search would always fail)
Bug found during comparison of indexOf() implementations between ByteChunk and CharChunk

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1821235 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestCharChunk.java
index b68e394027..e2f73ec97f 100644
--- a/java/org/apache/tomcat/util/buf/CharChunk.java
+++ b/java/org/apache/tomcat/util/buf/CharChunk.java
@@ -615,7 +615,11 @@ public final class CharChunk extends AbstractChunk implements CharSequence {
             if (buff[i] != first) {
                 continue;
             }
-            // found first char, now look for a match
+            // Special case - search string is a single character
+            if (srcLen == 1) {
+                return i - start;
+            }
+            // Found first char, now look for a match
             int myPos = i + 1;
             for (int srcPos = srcOff + 1; srcPos < srcEnd;) {
                 if (buff[myPos++] != src.charAt(srcPos++)) {

==================================================
