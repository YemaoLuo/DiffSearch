bb6ecc1c28d8960a755cd6f233a6a1b654c241a9
==================================================
Partial revert of r1645465 since StoreConfig is at the Server/JVM level so there is only ever one of them.
==================================================
Mark Thomas
==================================================
Sun Dec 14 17:17:09 2014 +0000
==================================================
StandardServer.java
Partial revert of r1645465 since StoreConfig is at the Server/JVM level so there is only ever one of them.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1645473 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ManagerServlet.java
index c1e908fb16..9b0a8c928f 100644
--- a/java/org/apache/catalina/core/StandardServer.java
+++ b/java/org/apache/catalina/core/StandardServer.java
@@ -690,7 +690,8 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
      */
     public synchronized void storeConfig() throws Exception {
         try {
-            ObjectName sname = new ObjectName(getDomain() + ":type=StoreConfig");
+            // Note: Hard-coded domain used since this object is per Server/JVM
+            ObjectName sname = new ObjectName("Catalina:type=StoreConfig");
             if (mserver.isRegistered(sname)) {
                 mserver.invoke(sname, "storeConfig", null, null);
             } else {
@@ -716,7 +717,8 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
      */
     public synchronized void storeContext(Context context) throws Exception {
         try {
-            ObjectName sname = new ObjectName(getDomain() + ":type=StoreConfig");
+            // Note: Hard-coded domain used since this object is per Server/JVM
+            ObjectName sname = new ObjectName("Catalina:type=StoreConfig");
             if (mserver.isRegistered(sname)) {
                 mserver.invoke(sname, "store",
                     new Object[] {context},

==================================================
StoreConfigLifecycleListener.java
index d1c96f0f22..6301f36f57 100644
--- a/java/org/apache/catalina/manager/ManagerServlet.java
+++ b/java/org/apache/catalina/manager/ManagerServlet.java
@@ -583,8 +583,7 @@ public class ManagerServlet extends HttpServlet implements ContainerServlet {
 
         ObjectName storeConfigOname;
         try {
-            // Note that there is only ever one StoreConfig per JVM and the
-            // name of the MBean is hard-coded.
+            // Note: Hard-coded domain used since this object is per Server/JVM
             storeConfigOname = new ObjectName("Catalina:type=StoreConfig");
         } catch (MalformedObjectNameException e) {
             // Should never happen. The name above is valid.

==================================================
TestRegistration.java
index ad6bd98223..4f7f7b198d 100644
--- a/java/org/apache/catalina/storeconfig/StoreConfigLifecycleListener.java
+++ b/java/org/apache/catalina/storeconfig/StoreConfigLifecycleListener.java
@@ -92,7 +92,8 @@ public class StoreConfigLifecycleListener implements LifecycleListener {
             return;
         }
         try {
-            oname = new ObjectName(server.getDomain() + ":type=StoreConfig" );
+            // Note: Hard-coded domain used since this object is per Server/JVM
+            oname = new ObjectName("Catalina:type=StoreConfig" );
             registry.registerComponent(storeConfig, oname, "StoreConfig");
         } catch (Exception ex) {
             log.error("createMBean register MBean", ex);

==================================================
