3ba4a5ef2352ef12f026594b10226ce9f8c4ad42
==================================================
Move destruction of ContainerBase objects to ContainerBase to ensure
==================================================
Mark Emlyn
==================================================
Thu Jan 12 20:34:24 2012 +0000
==================================================
ContainerBase.java
Move destruction of ContainerBase objects to ContainerBase to ensure
that they are destroyed.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1230765 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardContext.java
index 5a081e3719..8025914b12 100644
--- a/java/org/apache/catalina/core/ContainerBase.java
+++ b/java/org/apache/catalina/core/ContainerBase.java
@@ -1195,6 +1195,20 @@ public abstract class ContainerBase extends LifecycleMBeanBase
     @Override
     protected void destroyInternal() throws LifecycleException {
 
+        if ((manager != null) && (manager instanceof Lifecycle)) {
+            ((Lifecycle) manager).destroy();
+        }
+        Realm realm = getRealmInternal();
+        if ((realm != null) && (realm instanceof Lifecycle)) {
+            ((Lifecycle) realm).destroy();
+        }
+        if ((cluster != null) && (cluster instanceof Lifecycle)) {
+            ((Lifecycle) cluster).destroy();
+        }
+        if ((loader != null) && (loader instanceof Lifecycle)) {
+            ((Lifecycle) loader).destroy();
+        }
+
         // Stop the Valves in our pipeline (including the basic), if any
         if (pipeline instanceof Lifecycle) {
             ((Lifecycle) pipeline).destroy();

==================================================
