897f4f6f862904379662e215d3dc9d956fb5652f
==================================================
Add new, standard method for direct upgrade to WebSocket
==================================================
Mark Thomas
==================================================
Thu Oct 7 18:10:37 2021 +0100
==================================================
ServerContainer.java
Add new, standard method for direct upgrade to WebSocket


==================================================
WsServerContainer.java
index a210311cda..4820cb6d04 100644
--- a/java/jakarta/websocket/server/ServerContainer.java
+++ b/java/jakarta/websocket/server/ServerContainer.java
@@ -16,6 +16,9 @@
  */
 package jakarta.websocket.server;
 
+import java.io.IOException;
+import java.util.Map;
+
 import jakarta.websocket.DeploymentException;
 import jakarta.websocket.WebSocketContainer;
 
@@ -25,6 +28,33 @@ import jakarta.websocket.WebSocketContainer;
 public interface ServerContainer extends WebSocketContainer {
     public abstract void addEndpoint(Class<?> clazz) throws DeploymentException;
 
-    public abstract void addEndpoint(ServerEndpointConfig sec)
-            throws DeploymentException;
+    public abstract void addEndpoint(ServerEndpointConfig sec) throws DeploymentException;
+
+    /**
+     * Upgrade the HTTP connection represented by the {@code HttpServletRequest} and {@code HttpServletResponse} to the
+     * WebSocket protocol and establish a WebSocket connection as per the provided {@link ServerEndpointConfig}.
+     * <p>
+     * This method is primarily intended to be used by frameworks that implement the front-controller pattern. It does
+     * not deploy the provided endpoint.
+     * <p>
+     * If the WebSocket implementation is not deployed as part of a Jakarta Servlet container, this method will throw an
+     * {@link UnsupportedOperationException}.
+     *
+     * @param httpServletRequest    The {@code HttpServletRequest} to be processed as a WebSocket handshake as per
+     *                              section 4.0 of RFC 6455.
+     * @param httpServletResponse   The {@code HttpServletResponse} to be used when processing the
+     *                              {@code httpServletRequest} as a WebSocket handshake as per section 4.0 of RFC 6455.
+     * @param sec                   The server endpoint configuration to use to configure the WebSocket endpoint
+     * @param pathParameters        Provides a mapping of path parameter names and values, if any, to be used for the
+     *                              WebSocket connection established by the call to this method. If no such mapping is
+     *                              defined, an empty Map must be passed.
+     *
+     * @throws IllegalStateException if the provided request does not meet the requirements of the WebSocket handshake
+     * @throws UnsupportedOperationException if the WebSocket implementation is not deployed as part of a Jakarta
+     *                                       Servlet container
+     * @throws IOException if an I/O error occurs during the establishment of a WebSocket connection
+     * @throws DeploymentException if a configuration error prevents the establishment of a WebSocket connection
+     */
+    public void upgradeHttpToWebSocket(Object httpServletRequest, Object httpServletResponse, ServerEndpointConfig sec,
+            Map<String,String> pathParameters) throws IOException, DeploymentException;
 }

==================================================
