cd1379bb84740f439262442c353b658f9fb06c29
==================================================
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56390
==================================================
Mark Emlyn
==================================================
Wed Apr 16 14:21:47 2014 +0000
==================================================
WebappClassLoader.java
index d20e1a7ba3..304ecbe195 100644
--- a/java/org/apache/catalina/loader/LocalStrings.properties
+++ b/java/org/apache/catalina/loader/LocalStrings.properties
@@ -42,6 +42,7 @@ webappClassLoader.stackTrace=Stack trace of thread "{0}":{1}
 webappClassLoader.stackTraceRequestThread=Stack trace of request processing thread "{0}":{1}
 webappClassLoader.stopThreadFail=Failed to terminate thread named [{0}] for web application [{1}]
 webappClassLoader.stopTimerThreadFail=Failed to terminate TimerThread named [{0}] for web application [{1}]
+webappClassLoader.superCloseFail=Failure calling close() on super class
 webappClassLoader.validationErrorJarPath=Unable to validate JAR entry with name {0}
 webappClassLoader.warnRequestThread=The web application [{0}] is still processing a request that has yet to finish. This is very likely to create a memory leak. You can control the time allowed for requests to finish by using the unloadDelay attribute of the standard Context implementation.
 webappClassLoader.warnThread=The web application [{0}] appears to have started a thread named [{1}] but has failed to stop it. This is very likely to create a memory leak.

==================================================
WebappLoader.java
index 42b18be4bc..3ff633131b 100644
--- a/java/org/apache/catalina/loader/WebappClassLoader.java
+++ b/java/org/apache/catalina/loader/WebappClassLoader.java
@@ -1503,6 +1503,13 @@ public class WebappClassLoader extends URLClassLoader
 
     @Override
     public void destroy() {
+        state = LifecycleState.DESTROYING;
+
+        try {
+            super.close();
+        } catch (IOException ioe) {
+            log.warn(sm.getString("webappClassLoader.superCloseFail"), ioe);
+        }
         state = LifecycleState.DESTROYED;
     }
 

==================================================
