9734c80789a3ff314ff02701f59003259b7a2cc5
==================================================
- Remove an extra throwable.
==================================================
Remy Maucherat
==================================================
Fri Nov 3 10:56:25 2006 +0000
==================================================
Connector.java
- Remove an extra throwable.
- Add a specific flag for recycling facades (when security is on, recycling will always be done, obviously).

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@470756 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Request.java
index babc2f62c9..05eba1d1c6 100644
--- a/java/org/apache/catalina/connector/Connector.java
+++ b/java/org/apache/catalina/connector/Connector.java
@@ -59,6 +59,13 @@ public class Connector
     private static Log log = LogFactory.getLog(Connector.class);
 
 
+    /**
+     * Alternate flag to enable recycling of facades.
+     */
+    public static final boolean RECYCLE_FACADES =
+        Boolean.valueOf(System.getProperty("org.apache.catalina.connector.RECYCLE_FACADES", "false")).booleanValue();
+
+    
     // ------------------------------------------------------------ Constructor
 
 

==================================================
Response.java
index 61e3de203a..ec358624d7 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -423,7 +423,7 @@ public class Request
         requestedSessionId = null;
         requestedSessionURL = false;
 
-        if (Constants.SECURITY) {
+        if (Constants.SECURITY || Connector.RECYCLE_FACADES) {
             parameterMap = new ParameterMap();
         } else {
             parameterMap.setLocked(false);
@@ -432,7 +432,7 @@ public class Request
 
         mappingData.recycle();
 
-        if (Constants.SECURITY) {
+        if (Constants.SECURITY || Connector.RECYCLE_FACADES) {
             if (facade != null) {
                 facade.clear();
                 facade = null;

==================================================
ErrorReportValve.java
index d9c4bc81ec..4ab3c7217d 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -268,7 +268,7 @@ public class Response
         
         cookies.clear();
 
-        if (Constants.SECURITY) {
+        if (Constants.SECURITY || Connector.RECYCLE_FACADES) {
             if (facade != null) {
                 facade.clear();
                 facade = null;

==================================================
