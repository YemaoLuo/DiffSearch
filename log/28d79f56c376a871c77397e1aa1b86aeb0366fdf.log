28d79f56c376a871c77397e1aa1b86aeb0366fdf
==================================================
Simplify code.
==================================================
Remy Maucherat
==================================================
Thu Nov 8 18:51:16 2018 +0000
==================================================
ContainerBase.java
Simplify code.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1846181 13f79535-47bb-0310-9956-ffa450edef68



==================================================
GroupChannel.java
index 938aeb7997..91d29e8b45 100644
--- a/java/org/apache/catalina/core/ContainerBase.java
+++ b/java/org/apache/catalina/core/ContainerBase.java
@@ -936,11 +936,10 @@ public abstract class ContainerBase extends LifecycleMBeanBase
         setState(LifecycleState.STARTING);
 
         // Start our thread
-        threadStart();
         if (backgroundProcessorDelay > 0) {
             monitorFuture = Container.getService(ContainerBase.this)
                     .getUtilityExecutor().scheduleWithFixedDelay(
-                            new ContainerBackgroundProcessorMonitor(), 60, 60, TimeUnit.SECONDS);
+                            new ContainerBackgroundProcessorMonitor(), 0, 60, TimeUnit.SECONDS);
         }
     }
 

==================================================
AbstractProtocol.java
index 60d1c98b66..9686d39132 100644
--- a/java/org/apache/catalina/tribes/group/GroupChannel.java
+++ b/java/org/apache/catalina/tribes/group/GroupChannel.java
@@ -479,26 +479,23 @@ public class GroupChannel extends ChannelInterceptorBase
             ownExecutor = true;
         }
         super.start(svc);
-        startHeartbeat();
         monitorFuture = utilityExecutor.scheduleWithFixedDelay(
                 new Runnable() {
                     @Override
                     public void run() {
                         startHeartbeat();
                     }
-                }, 60, 60, TimeUnit.SECONDS);
+                }, 0, 60, TimeUnit.SECONDS);
     }
 
     protected void startHeartbeat() {
         if (heartbeat && (heartbeatFuture == null || (heartbeatFuture != null && heartbeatFuture.isDone()))) {
             if (heartbeatFuture != null && heartbeatFuture.isDone()) {
-                if (heartbeatFuture != null && heartbeatFuture.isDone()) {
-                    // There was an error executing the scheduled task, get it and log it
-                    try {
-                        heartbeatFuture.get();
-                    } catch (InterruptedException | ExecutionException e) {
-                        log.error(sm.getString("groupChannel.unable.sendHeartbeat"), e);
-                    }
+                // There was an error executing the scheduled task, get it and log it
+                try {
+                    heartbeatFuture.get();
+                } catch (InterruptedException | ExecutionException e) {
+                    log.error(sm.getString("groupChannel.unable.sendHeartbeat"), e);
                 }
             }
             heartbeatFuture = utilityExecutor.scheduleWithFixedDelay(new HeartbeatRunnable(),

==================================================
