8133d65bf21cdd597997018062f44d1edb22200d
==================================================
Further 49464 fixes - precompression
==================================================
markt markt@unknown
==================================================
Mon Jul 10 21:29:58 2017 +0000
==================================================
DefaultServlet.java
Further 49464 fixes - precompression
Update unit tests to avoid conversion

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1801540 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestDefaultServlet.java
index 369d47f733..96d420df3a 100644
--- a/java/org/apache/catalina/servlets/DefaultServlet.java
+++ b/java/org/apache/catalina/servlets/DefaultServlet.java
@@ -965,7 +965,8 @@ public class DefaultServlet extends HttpServlet {
         String outputEncoding = response.getCharacterEncoding();
         Charset charset = B2CConverter.getCharset(outputEncoding);
         boolean conversionRequired;
-        if (isText(contentType) && !charset.equals(fileEncodingCharset)) {
+        if (!usingPrecompressedVersion && isText(contentType) &&
+                !charset.equals(fileEncodingCharset)) {
             conversionRequired = true;
             // Conversion often results fewer/more/different bytes.
             // That does not play nicely with range requests.

==================================================
