03ae0436fa1ffefe334432238b020532a7165016
==================================================
Replace manually invoke close method with try-with-resources. (#590)
==================================================
Andrei Briukhov
==================================================
Fri Feb 10 12:16:41 2023 +0300
==================================================
ChunkedOutputFilter.java
Replace manually invoke close method with try-with-resources. (#590)




==================================================
ReflectionLessCodeGenerator.java
index 6eedd81eea..c7a6f27a48 100644
--- a/java/org/apache/coyote/http11/filters/ChunkedOutputFilter.java
+++ b/java/org/apache/coyote/http11/filters/ChunkedOutputFilter.java
@@ -177,20 +177,22 @@ public class ChunkedOutputFilter implements OutputFilter {
             lastChunk.position(0).limit(lastChunk.capacity());
 
            ByteArrayOutputStream baos = new ByteArrayOutputStream(1024);
-           OutputStreamWriter osw = new OutputStreamWriter(baos, StandardCharsets.ISO_8859_1);
-            for (Map.Entry<String,String> trailerField : trailerFields.entrySet()) {
-                // Ignore disallowed headers
-                if (disallowedTrailerFieldNames.contains(
-                        trailerField.getKey().toLowerCase(Locale.ENGLISH))) {
-                    continue;
-                }
-                osw.write(trailerField.getKey());
-                osw.write(':');
-                osw.write(' ');
-                osw.write(trailerField.getValue());
-                osw.write("\r\n");
-            }
-            osw.close();
+
+           try (OutputStreamWriter osw = new OutputStreamWriter(baos, StandardCharsets.ISO_8859_1)) {
+               for (Map.Entry<String, String> trailerField : trailerFields.entrySet()) {
+                   // Ignore disallowed headers
+                   if (disallowedTrailerFieldNames.contains(
+                           trailerField.getKey().toLowerCase(Locale.ENGLISH))) {
+                       continue;
+                   }
+                   osw.write(trailerField.getKey());
+                   osw.write(':');
+                   osw.write(' ');
+                   osw.write(trailerField.getValue());
+                   osw.write("\r\n");
+               }
+           }
+
             buffer.doWrite(ByteBuffer.wrap(baos.toByteArray()));
 
             buffer.doWrite(crlfChunk);

==================================================
TestAsyncContextImpl.java
index a06d78dce5..d79983e4f9 100644
--- a/java/org/apache/tomcat/util/xreflection/ReflectionLessCodeGenerator.java
+++ b/java/org/apache/tomcat/util/xreflection/ReflectionLessCodeGenerator.java
@@ -185,10 +185,10 @@ final class ReflectionLessCodeGenerator {
             .append(System.lineSeparator());
         //end - class
         File destination = new File(directory, className+".java");
-        BufferedWriter writer = new BufferedWriter(new FileWriter(destination, false));
-        writer.write(code.toString());
-        writer.flush();
-        writer.close();
+        try (BufferedWriter writer = new BufferedWriter(new FileWriter(destination, false))) {
+            writer.write(code.toString());
+            writer.flush();
+        }
 
     }
 

==================================================
