277d583b32b874357626f16182eebbc30cc8d1d8
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61777
==================================================
Mark Thomas
==================================================
Mon Nov 20 11:53:20 2017 +0000
==================================================
AuthConfigFactoryImpl.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61777
Avoid a NullPointerException when detaching a JASPIC RegistrationListener.
Patch provided by Lazar.
This closes #85

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1815793 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAuthConfigFactoryImpl.java
index 94d558e326..e2c7e311d5 100644
--- a/java/org/apache/catalina/authenticator/jaspic/AuthConfigFactoryImpl.java
+++ b/java/org/apache/catalina/authenticator/jaspic/AuthConfigFactoryImpl.java
@@ -243,7 +243,7 @@ public class AuthConfigFactoryImpl extends AuthConfigFactory {
     public String[] detachListener(RegistrationListener listener, String layer, String appContext) {
         String registrationID = getRegistrationID(layer, appContext);
         RegistrationContextImpl registrationContext = findRegistrationContextImpl(layer, appContext);
-        if (registrationContext.removeListener(listener)) {
+        if (registrationContext != null && registrationContext.removeListener(listener)) {
             return new String[] { registrationID };
         }
         return EMPTY_STRING_ARRAY;

==================================================
