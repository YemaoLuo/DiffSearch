9418af24af81aa3d1c9b4b572ebf759b6cdeb8ce
==================================================
More normalization edge cases
==================================================
Mark Thomas
==================================================
Wed Sep 2 20:39:00 2015 +0000
==================================================
RequestUtil.java
More normalization edge cases

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1700896 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestRequestUtil.java
index 2292242156..1512c51d8b 100644
--- a/java/org/apache/tomcat/util/http/RequestUtil.java
+++ b/java/org/apache/tomcat/util/http/RequestUtil.java
@@ -67,14 +67,6 @@ public class RequestUtil {
         if (!normalized.startsWith("/"))
             normalized = "/" + normalized;
 
-        if (normalized.equals("/.")) {
-            return "/";
-        }
-
-        if (normalized.equals("/..")) {
-            return null;  // Trying to go outside our context
-        }
-
         // Resolve occurrences of "//" in the normalized path
         while (true) {
             int index = normalized.indexOf("//");
@@ -106,6 +98,14 @@ public class RequestUtil {
             normalized = normalized.substring(0, index2) + normalized.substring(index + 3);
         }
 
+        if (normalized.equals("/.")) {
+            return "/";
+        }
+
+        if (normalized.equals("/..")) {
+            return null;  // Trying to go outside our context
+        }
+
         // Return the normalized path that we have completed
         return normalized;
     }

==================================================
