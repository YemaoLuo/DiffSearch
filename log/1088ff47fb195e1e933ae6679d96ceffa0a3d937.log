1088ff47fb195e1e933ae6679d96ceffa0a3d937
==================================================
Prevent spurious log warnings on container stop if a child component has previously failed.
==================================================
Mark Emlyn
==================================================
Fri Aug 5 16:31:41 2011 +0000
==================================================
ContainerBase.java
Prevent spurious log warnings on container stop if a child component has previously failed.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1154298 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardContext.java
index 96fe008d1a..4a736a656a 100644
--- a/java/org/apache/catalina/core/ContainerBase.java
+++ b/java/org/apache/catalina/core/ContainerBase.java
@@ -1062,7 +1062,8 @@ public abstract class ContainerBase extends LifecycleMBeanBase
         setState(LifecycleState.STOPPING);
 
         // Stop the Valves in our pipeline (including the basic), if any
-        if (pipeline instanceof Lifecycle) {
+        if (pipeline instanceof Lifecycle &&
+                ((Lifecycle) pipeline).getState().isAvailable()) {
             ((Lifecycle) pipeline).stop();
         }
 
@@ -1082,7 +1083,8 @@ public abstract class ContainerBase extends LifecycleMBeanBase
         if ((cluster != null) && (cluster instanceof Lifecycle)) {
             ((Lifecycle) cluster).stop();
         }
-        if ((manager != null) && (manager instanceof Lifecycle)) {
+        if ((manager != null) && (manager instanceof Lifecycle) &&
+                ((Lifecycle) manager).getState().isAvailable() ) {
             ((Lifecycle) manager).stop();
         }
         if ((logger != null) && (logger instanceof Lifecycle)) {

==================================================
