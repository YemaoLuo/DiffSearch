40e7b0ca2e63600d69e72807b492f17667592d75
==================================================
Fix failures in newly added tests
==================================================
Mark Emlyn
==================================================
Fri Jan 10 11:04:08 2014 +0000
==================================================
AbstractServletInputStream.java
Fix failures in newly added tests

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1557082 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractServletOutputStream.java
index 8c08c2d6ef..aee5c0699b 100644
--- a/java/org/apache/coyote/http11/upgrade/AbstractServletInputStream.java
+++ b/java/org/apache/coyote/http11/upgrade/AbstractServletInputStream.java
@@ -81,6 +81,10 @@ public abstract class AbstractServletInputStream extends ServletInputStream {
             throw new IllegalArgumentException(
                     sm.getString("upgrade.sis.readListener.null"));
         }
+        if (this.listener != null) {
+            throw new IllegalArgumentException(
+                    sm.getString("upgrade.sis.readListener.set"));
+        }
         this.listener = listener;
         this.applicationLoader = Thread.currentThread().getContextClassLoader();
         // Switching to non-blocking. Don't know if data is available.

==================================================
