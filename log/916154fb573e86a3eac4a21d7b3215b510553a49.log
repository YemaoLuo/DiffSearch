916154fb573e86a3eac4a21d7b3215b510553a49
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48668
==================================================
Konstantin Kolinko
==================================================
Sat Mar 6 21:03:14 2010 +0000
==================================================
Parser.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48668
Honor isELIgnored and isDeferredSyntaxAllowed in the Parser

Uncommented the test cases in TestParser/bug48668a.jsp that now are passing.
The ##12,13,16,17 remain commented, because they are still failing.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@919851 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestParser.java
index 3955859e96..7cfb2bcdbe 100644
--- a/java/org/apache/jasper/compiler/Parser.java
+++ b/java/org/apache/jasper/compiler/Parser.java
@@ -1462,9 +1462,11 @@ class Parser implements TagConstants {
             err.jspError(reader.mark(), "jsp.error.no.scriptlets");
         } else if (reader.matches("<jsp:text")) {
             parseXMLTemplateText(parent);
-        } else if (reader.matches("${")) {
+        } else if (!pageInfo.isELIgnored() && reader.matches("${")) {
             parseELExpression(parent, '$');
-        } else if (reader.matches("#{")) {
+        } else if (!pageInfo.isELIgnored()
+                && !pageInfo.isDeferredSyntaxAllowedAsLiteral()
+                && reader.matches("#{")) {
             parseELExpression(parent, '#');
         } else if (reader.matches("<jsp:")) {
             parseStandardAction(parent);
@@ -1513,10 +1515,12 @@ class Parser implements TagConstants {
         } else if (reader.matches("<jsp:text")) {
             err.jspError(reader.mark(), "jsp.error.not.in.template",
                     "&lt;jsp:text");
-        } else if (reader.matches("${")) {
+        } else if (!pageInfo.isELIgnored() && reader.matches("${")) {
             err.jspError(reader.mark(), "jsp.error.not.in.template",
                     "Expression language");
-        } else if (reader.matches("#{")) {
+        } else if (!pageInfo.isELIgnored()
+                && !pageInfo.isDeferredSyntaxAllowedAsLiteral()
+                && reader.matches("#{")) {
             err.jspError(reader.mark(), "jsp.error.not.in.template",
                     "Expression language");
         } else if (reader.matches("<jsp:")) {

==================================================
