0c39935431c8b15bb405325623727a8667d02e0e
==================================================
Use the standard utility method for List to comma separated string
==================================================
Mark Thomas
==================================================
Tue Jun 15 20:46:27 2021 +0100
==================================================
RemoteIpValve.java
Use the standard utility method for List to comma separated string


==================================================
TestRemoteIpValve.java
index 61dcbfba9a..770c7c44c4 100644
--- a/java/org/apache/catalina/valves/RemoteIpValve.java
+++ b/java/org/apache/catalina/valves/RemoteIpValve.java
@@ -33,6 +33,7 @@ import org.apache.catalina.connector.Request;
 import org.apache.catalina.connector.Response;
 import org.apache.juli.logging.Log;
 import org.apache.juli.logging.LogFactory;
+import org.apache.tomcat.util.buf.StringUtils;
 import org.apache.tomcat.util.http.MimeHeaders;
 import org.apache.tomcat.util.http.parser.Host;
 
@@ -379,7 +380,11 @@ public class RemoteIpValve extends ValveBase {
      * Convert an array of strings in a comma delimited string
      * @param stringList The string list to convert
      * @return The concatenated string
+     *
+     * @deprecated Unused. This will be removed in Tomcat 10.1.x onwards.
+     *             Use {@link StringUtils#join(java.util.Collection)} instead
      */
+    @Deprecated
     protected static String listToCommaDelimitedString(List<String> stringList) {
         if (stringList == null) {
             return "";
@@ -680,13 +685,13 @@ public class RemoteIpValve extends ValveBase {
                 if (proxiesHeaderValue.size() == 0) {
                     request.getCoyoteRequest().getMimeHeaders().removeHeader(proxiesHeader);
                 } else {
-                    String commaDelimitedListOfProxies = listToCommaDelimitedString(proxiesHeaderValue);
+                    String commaDelimitedListOfProxies = StringUtils.join(proxiesHeaderValue);
                     request.getCoyoteRequest().getMimeHeaders().setValue(proxiesHeader).setString(commaDelimitedListOfProxies);
                 }
                 if (newRemoteIpHeaderValue.size() == 0) {
                     request.getCoyoteRequest().getMimeHeaders().removeHeader(remoteIpHeader);
                 } else {
-                    String commaDelimitedRemoteIpHeaderValue = listToCommaDelimitedString(newRemoteIpHeaderValue);
+                    String commaDelimitedRemoteIpHeaderValue = StringUtils.join(newRemoteIpHeaderValue);
                     request.getCoyoteRequest().getMimeHeaders().setValue(remoteIpHeader).setString(commaDelimitedRemoteIpHeaderValue);
                 }
             }

==================================================
