1ee42fa7d131bcf6ecf2c3d0fa02040bf823e4b3
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61780
==================================================
Mark Thomas
==================================================
Mon Nov 20 13:38:30 2017 +0000
==================================================
AuthConfigFactoryImpl.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61780
Only include the default JASPIC registration ID in the return value for a call to AuthConfigFactory.getRegistrationIDs() if a RegistrationContext has been registered using the default registration ID.
Patch provided by Lazar.
This closes #88

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1815806 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAuthConfigFactoryImpl.java
index 18e136c6e2..29da345912 100644
--- a/java/org/apache/catalina/authenticator/jaspic/AuthConfigFactoryImpl.java
+++ b/java/org/apache/catalina/authenticator/jaspic/AuthConfigFactoryImpl.java
@@ -60,7 +60,7 @@ public class AuthConfigFactoryImpl extends AuthConfigFactory {
             new ConcurrentHashMap<>();
     // Note: Although there will only ever be a maximum of one entry in this
     //       Map, use a ConcurrentHashMap for consistency
-    private volatile Map<String,RegistrationContextImpl> defaultRegistration =
+    private final Map<String,RegistrationContextImpl> defaultRegistration =
             new ConcurrentHashMap<>(1);
 
 
@@ -259,7 +259,7 @@ public class AuthConfigFactoryImpl extends AuthConfigFactory {
             result.addAll(layerAppContextRegistrations.keySet());
             result.addAll(appContextRegistrations.keySet());
             result.addAll(layerRegistrations.keySet());
-            if (defaultRegistration != null) {
+            if (!defaultRegistration.isEmpty()) {
                 result.add(DEFAULT_REGISTRATION_ID);
             }
         } else {

==================================================
