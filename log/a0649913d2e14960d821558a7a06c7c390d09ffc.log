a0649913d2e14960d821558a7a06c7c390d09ffc
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61916
==================================================
Mark Thomas
==================================================
Thu Jan 4 17:23:41 2018 +0000
==================================================
AddDefaultCharsetFilter.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61916
Extend the AddDefaultCharsetFilter to add a character set when the content type is set via setHeader() or addHeader() as well as when it is set via setContentType().

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1820138 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAddCharSetFilter.java
index 0f6c830e57..fbddf63957 100644
--- a/java/org/apache/catalina/filters/AddDefaultCharsetFilter.java
+++ b/java/org/apache/catalina/filters/AddDefaultCharsetFilter.java
@@ -120,6 +120,24 @@ public class AddDefaultCharsetFilter extends FilterBase {
 
         }
 
+        @Override
+        public void setHeader(String name, String value) {
+            if (name.trim().equalsIgnoreCase("content-type")) {
+                setContentType(value);
+            } else {
+                super.setHeader(name, value);
+            }
+        }
+
+        @Override
+        public void addHeader(String name, String value) {
+            if (name.trim().equalsIgnoreCase("content-type")) {
+                setContentType(value);
+            } else {
+                super.setHeader(name, value);
+            }
+        }
+
         @Override
         public void setCharacterEncoding(String charset) {
             super.setCharacterEncoding(charset);

==================================================
