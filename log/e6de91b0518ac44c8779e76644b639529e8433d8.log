e6de91b0518ac44c8779e76644b639529e8433d8
==================================================
Re-work multiple-write registration fix.
==================================================
Mark Thomas
==================================================
Wed Feb 4 23:18:45 2015 +0000
==================================================
UpgradeProcessor.java
Re-work multiple-write registration fix.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1657442 13f79535-47bb-0310-9956-ffa450edef68



==================================================
UpgradeServletOutputStream.java
index 83b9508f34..910f8855a8 100644
--- a/java/org/apache/coyote/http11/upgrade/UpgradeProcessor.java
+++ b/java/org/apache/coyote/http11/upgrade/UpgradeProcessor.java
@@ -99,6 +99,7 @@ public class UpgradeProcessor implements Processor, WebConnection {
     public final SocketState upgradeDispatch(SocketStatus status) throws IOException {
         if (status == SocketStatus.OPEN_READ) {
             upgradeServletInputStream.onDataAvailable();
+            upgradeServletOutputStream.checkWriteDispatch();
         } else if (status == SocketStatus.OPEN_WRITE) {
             upgradeServletOutputStream.onWritePossible();
         } else if (status == SocketStatus.STOP) {

==================================================
