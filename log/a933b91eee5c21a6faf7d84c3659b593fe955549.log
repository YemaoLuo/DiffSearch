a933b91eee5c21a6faf7d84c3659b593fe955549
==================================================
BZ 58999: Fix class and resource name
==================================================
Rainer Jung
==================================================
Fri Feb 12 20:35:26 2016 +0000
==================================================
WebappClassLoaderBase.java
BZ 58999: Fix class and resource name
filtering in WebappClassLoader.

It throws a StringIndexOutOfBoundsException
if the name is "org" or "javax".

We currently do not filter class or resource
names which are exactly equals to one of the
package names of classes and resources to
filter. Only classes or resources underneath
that packages.

Example:
- "javax.servlet" will not be filtered
- "javax.servlet.Class" will be filtered


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1730101 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestWebappClassLoader.java
index 5bb16e975f..32c93a75e3 100644
--- a/java/org/apache/catalina/loader/WebappClassLoaderBase.java
+++ b/java/org/apache/catalina/loader/WebappClassLoaderBase.java
@@ -2765,6 +2765,9 @@ public abstract class WebappClassLoaderBase extends URLClassLoader
         char ch;
         if (name.startsWith("javax")) {
             /* 5 == length("javax") */
+            if (name.length() == 5) {
+                return false;
+            }
             ch = name.charAt(5);
             if (isClassName && ch == '.') {
                 /* 6 == length("javax.") */
@@ -2791,6 +2794,9 @@ public abstract class WebappClassLoaderBase extends URLClassLoader
             }
         } else if (name.startsWith("org")) {
             /* 3 == length("org") */
+            if (name.length() == 3) {
+                return false;
+            }
             ch = name.charAt(3);
             if (isClassName && ch == '.') {
                 /* 4 == length("org.") */

==================================================
