685504bcbcdb4a2b6ca3c87aea386fb11e1bc38c
==================================================
Follow-up to r1658804 (kkolinko review)
==================================================
Mark Thomas
==================================================
Tue Feb 10 23:36:37 2015 +0000
==================================================
StandardContext.java
Follow-up to r1658804 (kkolinko review)
Handle case where canonical path ends in File.separator

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1658840 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestStandardContext.java
index 5a5d8fdd2a..c20a0604b7 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -4408,10 +4408,13 @@ public class StandardContext extends ContainerBase
         if (resources != null) {
             try {
                 WebResource resource = resources.getResource(path);
-                if (resource.isDirectory()) {
-                    return resource.getCanonicalPath() + File.separatorChar;
+                String canonicalPath = resource.getCanonicalPath();
+                if (canonicalPath == null) {
+                    return null;
+                } else if (resource.isDirectory() && !canonicalPath.endsWith(File.separator)) {
+                    return canonicalPath + File.separatorChar;
                 } else {
-                    return resource.getCanonicalPath();
+                    return canonicalPath;
                 }
             } catch (IllegalArgumentException iae) {
                 // ServletContext.getRealPath() does not allow this to be thrown

==================================================
