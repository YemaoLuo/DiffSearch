b6287893b8fba3b00d2ffb736ff4c69ec294a4bd
==================================================
More fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026
==================================================
Tim Whittington
==================================================
Mon Oct 4 20:37:11 2010 +0000
==================================================
DefaultServlet.java
More fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026
Calculating path prefix used in listings correctly so links in listings produced by WebdavServlet mounted to a subpath are correct.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1004415 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WebdavServlet.java
index 5e5b126d82..30af597fef 100644
--- a/java/org/apache/catalina/servlets/DefaultServlet.java
+++ b/java/org/apache/catalina/servlets/DefaultServlet.java
@@ -373,6 +373,18 @@ public class DefaultServlet
     }
 
 
+    /**
+     * Determines the appropriate path to prepend resources with
+     * when generating directory listings. Depending on the behaviour of 
+     * {@link #getRelativePath(HttpServletRequest)} this will change.
+     * @param request the request to determine the path for
+     * @return the prefix to apply to all resources in the listing.
+     */
+    protected String getPathPrefix(final HttpServletRequest request) {
+        return request.getContextPath();
+    }
+
+
     /**
      * Process a GET request for the specified resource.
      *
@@ -890,8 +902,7 @@ public class DefaultServlet
 
                 if (serveContent) {
                     // Serve the directory browser
-                    renderResult =
-                        render(request.getContextPath(), cacheEntry);
+                    renderResult = render(getPathPrefix(request), cacheEntry);
                 }
 
             }

==================================================
