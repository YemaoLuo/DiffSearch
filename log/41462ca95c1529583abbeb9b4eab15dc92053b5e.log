41462ca95c1529583abbeb9b4eab15dc92053b5e
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54974
==================================================
Violeta Georgieva
==================================================
Wed May 15 08:31:32 2013 +0000
==================================================
ApplicationContext.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54974
SessionCookieConfig.setXXX methods will throw IllegalStateException if the ServletContext from which this SessionCookieConfig was acquired has already been initialized.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1482720 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ApplicationSessionCookieConfig.java
index 782dd74721..c41aa7c688 100644
--- a/java/org/apache/catalina/core/ApplicationContext.java
+++ b/java/org/apache/catalina/core/ApplicationContext.java
@@ -117,6 +117,7 @@ public class ApplicationContext
         super();
         this.context = context;
         this.service = ((Engine) context.getParent().getParent()).getService();
+        this.sessionCookieConfig = new ApplicationSessionCookieConfig(context);
 
         // Populate session tracking modes
         populateSessionTrackingModes();
@@ -192,8 +193,7 @@ public class ApplicationContext
     /**
      * Session Cookie config
      */
-    private final SessionCookieConfig sessionCookieConfig =
-        new ApplicationSessionCookieConfig();
+    private SessionCookieConfig sessionCookieConfig;
 
     /**
      * Session tracking modes

==================================================
TestApplicationSessionCookieConfig.java
index e70f3a58dd..a934fb5cad 100644
--- a/java/org/apache/catalina/core/LocalStrings.properties
+++ b/java/org/apache/catalina/core/LocalStrings.properties
@@ -48,6 +48,7 @@ applicationFilterRegistration.nullInitParam=Unable to set initialisation paramet
 applicationFilterRegistration.nullInitParams=Unable to set initialisation parameters for filter due to null name and/or value. Name [{0}], Value [{1}]
 applicationServletRegistration.setServletSecurity.iae=Null constraint specified for servlet [{0}] deployed to context with name [{1}]
 applicationServletRegistration.setServletSecurity.ise=Security constraints can't be added to servlet [{0}] deployed to context with name [{1}] as the context has already been initialised
+applicationSessionCookieConfig.ise=Property {0} can not be added to SessionCookieConfig for context {1} as the context has been initialised
 aprListener.aprInit=The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: {0}
 aprListener.tcnInvalid=An incompatible version {0} of the APR based Apache Tomcat Native library is installed, while Tomcat requires version {1}
 aprListener.tcnVersion=An older version {0} of the APR based Apache Tomcat Native library is installed, while Tomcat recommends a minimum version of {1}

==================================================
