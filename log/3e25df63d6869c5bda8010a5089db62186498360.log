3e25df63d6869c5bda8010a5089db62186498360
==================================================
Fix COMPLEMENTOFDEFAULT alias
==================================================
Mark Emlyn
==================================================
Fri Aug 1 19:35:49 2014 +0000
==================================================
OpenSSLCipherConfigurationParser.java
Fix COMPLEMENTOFDEFAULT alias

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1615209 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestOpenSSLCipherConfigurationParser.java
index eaea89c32e..757073eaff 100644
--- a/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java
+++ b/java/org/apache/tomcat/util/net/jsse/openssl/OpenSSLCipherConfigurationParser.java
@@ -457,8 +457,10 @@ public class OpenSSLCipherConfigurationParser {
         initialized = true;
         // Despite what the OpenSSL docs say, DEFAULT also excludes SSLv2
         addListAlias(DEFAULT, parse("ALL:!eNULL:!aNULL:!SSLv2"));
-        LinkedHashSet<Cipher> complementOfDefault = new LinkedHashSet<>(all);
-        complementOfDefault.removeAll(aliases.get(DEFAULT));
+        // COMPLEMENTOFDEFAULT is also not exactly as defined by the docs
+        Set<Cipher> complementOfDefault = filterByKeyExchange(all, new HashSet<>(Arrays.asList(KeyExchange.EDH,KeyExchange.EECDH)));
+        complementOfDefault = filterByAuthentication(complementOfDefault, Collections.singleton(Authentication.aNULL));
+        complementOfDefault.removeAll(aliases.get(eNULL));
         addListAlias(COMPLEMENTOFDEFAULT, complementOfDefault);
     }
 

==================================================
