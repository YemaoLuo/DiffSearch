82cf5dc6c2fc1a1dd0611267d5115aaeeaf48f2d
==================================================
Alternative partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55855. Don't do the expensive 'Is this a WebSocket upgrade request check' if no endpoints have been registered
==================================================
Mark Emlyn
==================================================
Wed Dec 18 17:29:08 2013 +0000
==================================================
WsFilter.java
Alternative partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55855. Don't do the expensive 'Is this a WebSocket upgrade request check' if no endpoints have been registered

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1552042 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsServerContainer.java
index 5160865f43..f4ee91695e 100644
--- a/java/org/apache/tomcat/websocket/server/WsFilter.java
+++ b/java/org/apache/tomcat/websocket/server/WsFilter.java
@@ -47,7 +47,8 @@ public class WsFilter implements Filter {
             FilterChain chain) throws IOException, ServletException {
 
         // This filter only needs to handle WebSocket upgrade requests
-        if (!UpgradeUtil.isWebSocketUpgradeRequest(request, response)) {
+        if (!sc.areEndpointsRegistered() ||
+                !UpgradeUtil.isWebSocketUpgradeRequest(request, response)) {
             chain.doFilter(request, response);
             return;
         }

==================================================
