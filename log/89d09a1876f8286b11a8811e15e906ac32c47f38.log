89d09a1876f8286b11a8811e15e906ac32c47f38
==================================================
Add the channel name to the thread which is invoked by channel services in order to identify the associated channel.
==================================================
Keiichi Fujino
==================================================
Tue Apr 19 09:23:56 2016 +0000
==================================================
GroupChannel.java
Add the channel name to the thread which is invoked by channel services in order to identify the associated channel.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1739877 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MessageDispatchInterceptor.java
index 29234f2cf4..92b1aba444 100644
--- a/java/org/apache/catalina/tribes/group/GroupChannel.java
+++ b/java/org/apache/catalina/tribes/group/GroupChannel.java
@@ -695,7 +695,9 @@ public class GroupChannel extends ChannelInterceptorBase implements ManagedChann
         public HeartbeatThread(GroupChannel channel, long sleepTime) {
             super();
             this.setPriority(MIN_PRIORITY);
-            setName("GroupChannel-Heartbeat-"+inc());
+            String channelName = "";
+            if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+            setName("GroupChannel-Heartbeat" + channelName + "-" +inc());
             setDaemon(true);
             this.channel = channel;
             this.sleepTime = sleepTime;

==================================================
TcpPingInterceptor.java
index f5fd91d690..e3465445c5 100644
--- a/java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java
+++ b/java/org/apache/catalina/tribes/group/interceptors/MessageDispatchInterceptor.java
@@ -110,9 +110,11 @@ public class MessageDispatchInterceptor extends ChannelInterceptorBase {
         if (run) {
             return;
         }
+        String channelName = "";
+        if (getChannel().getName() != null) channelName = "[" + getChannel().getName() + "]";
         executor = ExecutorFactory.newThreadPool(maxSpareThreads, maxThreads, keepAliveTime,
                 TimeUnit.MILLISECONDS,
-                new TcclThreadFactory("MessageDispatchInterceptor.MessageDispatchThread"));
+                new TcclThreadFactory("MessageDispatchInterceptor.MessageDispatchThread" + channelName));
         run = true;
     }
 

==================================================
McastServiceImpl.java
index e047872d6c..3d6a1c1c61 100644
--- a/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
+++ b/java/org/apache/catalina/tribes/group/interceptors/TcpPingInterceptor.java
@@ -69,7 +69,9 @@ public class TcpPingInterceptor extends ChannelInterceptorBase {
         if ( thread == null && useThread) {
             thread = new PingThread();
             thread.setDaemon(true);
-            thread.setName("TcpPingInterceptor.PingThread-"+cnt.addAndGet(1));
+            String channelName = "";
+            if (getChannel().getName() != null) channelName = "[" + getChannel().getName() + "]";
+            thread.setName("TcpPingInterceptor.PingThread" + channelName +"-"+cnt.addAndGet(1));
             thread.start();
         }
 

==================================================
ReceiverBase.java
index ba4758c843..958cbd6966 100644
--- a/java/org/apache/catalina/tribes/membership/McastServiceImpl.java
+++ b/java/org/apache/catalina/tribes/membership/McastServiceImpl.java
@@ -545,7 +545,9 @@ public class McastServiceImpl {
         int errorCounter = 0;
         public ReceiverThread() {
             super();
-            setName("Tribes-MembershipReceiver");
+            String channelName = "";
+            if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+            setName("Tribes-MembershipReceiver" + channelName);
         }
         @Override
         public void run() {
@@ -578,7 +580,9 @@ public class McastServiceImpl {
         int errorCounter=0;
         public SenderThread(long time) {
             this.time = time;
-            setName("Tribes-MembershipSender");
+            String channelName = "";
+            if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+            setName("Tribes-MembershipSender" + channelName);
 
         }
         @Override
@@ -615,8 +619,9 @@ public class McastServiceImpl {
             }
 
             Thread t = new RecoveryThread(parent);
-
-            t.setName("Tribes-MembershipRecovery");
+            String channelName = "";
+            if (parent.getChannel().getName() != null) channelName = "[" + parent.getChannel().getName() + "]";
+            t.setName("Tribes-MembershipRecovery" + channelName);
             t.setDaemon(true);
             t.start();
         }

==================================================
BioReceiver.java
index e45dca2c16..3f043a17a1 100644
--- a/java/org/apache/catalina/tribes/transport/ReceiverBase.java
+++ b/java/org/apache/catalina/tribes/transport/ReceiverBase.java
@@ -89,7 +89,9 @@ public abstract class ReceiverBase implements ChannelReceiver, ListenCallback, R
     public void start() throws IOException {
         if ( executor == null ) {
             //executor = new ThreadPoolExecutor(minThreads,maxThreads,60,TimeUnit.SECONDS,new LinkedBlockingQueue<Runnable>());
-            TaskThreadFactory tf = new TaskThreadFactory("Tribes-Task-Receiver-");
+            String channelName = "";
+            if (channel.getName() != null) channelName = "[" + channel.getName() + "]";
+            TaskThreadFactory tf = new TaskThreadFactory("Tribes-Task-Receiver" + channelName + "-");
             executor = ExecutorFactory.newThreadPool(minThreads, maxThreads, maxIdleTime, TimeUnit.MILLISECONDS, tf);
         }
     }

==================================================
NioReceiver.java
index 5fc600faf1..965e59c8bd 100644
--- a/java/org/apache/catalina/tribes/transport/bio/BioReceiver.java
+++ b/java/org/apache/catalina/tribes/transport/bio/BioReceiver.java
@@ -53,7 +53,9 @@ public class BioReceiver extends ReceiverBase implements Runnable {
         try {
             getBind();
             bind();
-            Thread t = new Thread(this, "BioReceiver");
+            String channelName = "";
+            if (getChannel().getName() != null) channelName = "[" + getChannel().getName() + "]";
+            Thread t = new Thread(this, "BioReceiver" + channelName);
             t.setDaemon(true);
             t.start();
         } catch (Exception x) {

==================================================
