77e6902a47577d9636e284b62bfec19384a3e59e
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48870
==================================================
Mark Emlyn
==================================================
Fri Feb 18 21:44:13 2011 +0000
==================================================
Bootstrap.java
index a6dd3047ad..a620aa20a4 100644
--- a/build.xml
+++ b/build.xml
@@ -259,8 +259,7 @@
     <include name="org/apache/catalina/startup/catalina.properties" />
     <include name="org/apache/catalina/startup/CatalinaProperties.*" />
     <include name="org/apache/catalina/startup/ClassLoaderFactory.*" />
-    <include name="org/apache/catalina/startup/ClassLoaderFactory$1.*" />
-    <include name="org/apache/catalina/startup/ClassLoaderFactory$2.*" />
+    <include name="org/apache/catalina/startup/ClassLoaderFactory$*.*" />
     <include name="org/apache/catalina/startup/Tool.*" />
     <include name="org/apache/catalina/loader/StandardClassLoader*.*" />
     <include name="org/apache/catalina/loader/Extension.*" />

==================================================
ClassLoaderFactory.java
index 770fde63d9..6457dcef60 100644
--- a/java/org/apache/catalina/startup/Bootstrap.java
+++ b/java/org/apache/catalina/startup/Bootstrap.java
@@ -26,6 +26,7 @@ import java.lang.reflect.Method;
 import java.net.MalformedURLException;
 import java.net.URL;
 import java.util.ArrayList;
+import java.util.List;
 import java.util.StringTokenizer;
 
 import javax.management.MBeanServer;
@@ -34,6 +35,8 @@ import javax.management.ObjectName;
 
 import org.apache.catalina.Globals;
 import org.apache.catalina.security.SecurityClassLoad;
+import org.apache.catalina.startup.ClassLoaderFactory.Repository;
+import org.apache.catalina.startup.ClassLoaderFactory.RepositoryType;
 import org.apache.juli.logging.Log;
 import org.apache.juli.logging.LogFactory;
 
@@ -113,8 +116,7 @@ public final class Bootstrap {
         if ((value == null) || (value.equals("")))
             return parent;
 
-        ArrayList<String> repositoryLocations = new ArrayList<String>();
-        ArrayList<Integer> repositoryTypes = new ArrayList<Integer>();
+        List<Repository> repositories = new ArrayList<Repository>();
         int i;
 
         StringTokenizer tokenizer = new StringTokenizer(value, ",");
@@ -150,8 +152,8 @@ public final class Bootstrap {
             // Check for a JAR URL repository
             try {
                 new URL(repository);
-                repositoryLocations.add(repository);
-                repositoryTypes.add(ClassLoaderFactory.IS_URL);
+                repositories.add(
+                        new Repository(repository, RepositoryType.URL));
                 continue;
             } catch (MalformedURLException e) {
                 // Ignore
@@ -160,22 +162,19 @@ public final class Bootstrap {
             if (repository.endsWith("*.jar")) {
                 repository = repository.substring
                     (0, repository.length() - "*.jar".length());
-                repositoryLocations.add(repository);
-                repositoryTypes.add(ClassLoaderFactory.IS_GLOB);
+                repositories.add(
+                        new Repository(repository, RepositoryType.GLOB));
             } else if (repository.endsWith(".jar")) {
-                repositoryLocations.add(repository);
-                repositoryTypes.add(ClassLoaderFactory.IS_JAR);
+                repositories.add(
+                        new Repository(repository, RepositoryType.JAR));
             } else {
-                repositoryLocations.add(repository);
-                repositoryTypes.add(ClassLoaderFactory.IS_DIR);
+                repositories.add(
+                        new Repository(repository, RepositoryType.DIR));
             }
         }
 
-        String[] locations = repositoryLocations.toArray(new String[0]);
-        Integer[] types = repositoryTypes.toArray(new Integer[0]);
-
         ClassLoader classLoader = ClassLoaderFactory.createClassLoader
-            (locations, types, parent);
+            (repositories, parent);
 
         // Retrieving MBean server
         MBeanServer mBeanServer = null;

==================================================
