8b03dcf4b400bd36314fcc8004fa74228b02990a
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55454
==================================================
Violeta Georgieva
==================================================
Tue Aug 20 15:02:23 2013 +0000
==================================================
HttpParser.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55454
Fixed NPE thrown when parsing an invalid content type.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1515841 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestMediaType.java
index 54ef5c2dba..6965404806 100644
--- a/java/org/apache/tomcat/util/http/parser/HttpParser.java
+++ b/java/org/apache/tomcat/util/http/parser/HttpParser.java
@@ -208,11 +208,13 @@ public class HttpParser {
         while (lookForSemiColon == SkipConstantResult.FOUND) {
             String attribute = readToken(input);
 
+            String value = "";
             if (skipConstant(input, "=") == SkipConstantResult.FOUND) {
-                String value = readTokenOrQuotedString(input, true);
+                value = readTokenOrQuotedString(input, true);
+            }
+
+            if (attribute != null) {
                 parameters.put(attribute.toLowerCase(Locale.ENGLISH), value);
-            } else {
-                parameters.put(attribute.toLowerCase(Locale.ENGLISH), "");
             }
 
             lookForSemiColon = skipConstant(input, ";");

==================================================
