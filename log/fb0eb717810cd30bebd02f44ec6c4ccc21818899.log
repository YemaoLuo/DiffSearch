fb0eb717810cd30bebd02f44ec6c4ccc21818899
==================================================
Handle the client dropping the connection during the SSL handshake in the same way as it is handled at any other time.
==================================================
Mark Emlyn
==================================================
Wed Oct 16 11:15:42 2013 +0000
==================================================
AprServletInputStream.java
Handle the client dropping the connection during the SSL handshake in the same way as it is handled at any other time.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1532721 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AprServletOutputStream.java
index 62c04aed55..c8f0bea2cd 100644
--- a/java/org/apache/coyote/http11/upgrade/AprServletInputStream.java
+++ b/java/org/apache/coyote/http11/upgrade/AprServletInputStream.java
@@ -100,6 +100,9 @@ public class AprServletInputStream extends AbstractServletInputStream {
                 (-result == Status.APR_OS_START_SYSERR + 10053)) {
             // 10053 on Windows is connection aborted
             throw new EOFException(sm.getString("apr.clientAbort"));
+        } else if (-result == Status.APR_EGENERAL && wrapper.isSecure()) {
+            // Connection abort by client during SSL handshake
+            throw new EOFException(sm.getString("apr.clientAbort"));
         } else {
             throw new IOException(sm.getString("apr.read.error",
                     Integer.valueOf(-result), Long.valueOf(socket)));

==================================================
