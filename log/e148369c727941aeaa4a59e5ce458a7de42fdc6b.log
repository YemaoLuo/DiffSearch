e148369c727941aeaa4a59e5ce458a7de42fdc6b
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46011
==================================================
Mark Emlyn
==================================================
Wed Nov 5 16:17:16 2008 +0000
==================================================
ApplicationFilterChain.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46011
Make Principal accessible (if set) via Subject.getSubject(AccessController.getContext()) when processing filters.
Based on a patch provided by tsveg1

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@711600 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityUtil.java
index 24ae109eed..5b47576926 100644
--- a/java/org/apache/catalina/core/ApplicationFilterChain.java
+++ b/java/org/apache/catalina/core/ApplicationFilterChain.java
@@ -228,7 +228,7 @@ final class ApplicationFilterChain implements FilterChain, CometFilterChain {
 
                     Object[] args = new Object[]{req, res, this};
                     SecurityUtil.doAsPrivilege
-                        ("doFilter", filter, classType, args);
+                        ("doFilter", filter, classType, args, principal);
                     
                     args = null;
                 } else {  

==================================================
