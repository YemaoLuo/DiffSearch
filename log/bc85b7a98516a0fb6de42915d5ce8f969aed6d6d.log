bc85b7a98516a0fb6de42915d5ce8f969aed6d6d
==================================================
Refactor with an eye to fixing BZ 62988 that also needs to determine the session cookie path from the Context.
==================================================
Mark Thomas
==================================================
Thu Dec 6 18:55:23 2018 +0000
==================================================
ApplicationSessionCookieConfig.java
Refactor with an eye to fixing BZ 62988 that also needs to determine the session cookie path from the Context.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1848347 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SessionConfig.java
index 5b99b47ac1..3127ea2aca 100644
--- a/java/org/apache/catalina/core/ApplicationSessionCookieConfig.java
+++ b/java/org/apache/catalina/core/ApplicationSessionCookieConfig.java
@@ -197,29 +197,7 @@ public class ApplicationSessionCookieConfig implements SessionCookieConfig {
             cookie.setHttpOnly(true);
         }
 
-        String contextPath = context.getSessionCookiePath();
-        if (contextPath == null || contextPath.length() == 0) {
-            contextPath = scc.getPath();
-        }
-        if (contextPath == null || contextPath.length() == 0) {
-            contextPath = context.getEncodedPath();
-        }
-        if (context.getSessionCookiePathUsesTrailingSlash()) {
-            // Handle special case of ROOT context where cookies require a path of
-            // '/' but the servlet spec uses an empty string
-            // Also ensure the cookies for a context with a path of /foo don't get
-            // sent for requests with a path of /foobar
-            if (!contextPath.endsWith("/")) {
-                contextPath = contextPath + "/";
-            }
-        } else {
-            // Only handle special case of ROOT context where cookies require a
-            // path of '/' but the servlet spec uses an empty string
-            if (contextPath.length() == 0) {
-                contextPath = "/";
-            }
-        }
-        cookie.setPath(contextPath);
+        cookie.setPath(SessionConfig.getSessionCookiePath(context));
 
         return cookie;
     }

==================================================
