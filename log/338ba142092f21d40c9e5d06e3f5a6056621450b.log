338ba142092f21d40c9e5d06e3f5a6056621450b
==================================================
Small steps towards aligning action() implementations.
==================================================
Mark Thomas
==================================================
Wed Sep 30 13:32:19 2015 +0000
==================================================
AjpProcessor.java
Small steps towards aligning action() implementations.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1706030 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11Processor.java
index 9070861c9e..512ac51482 100644
--- a/java/org/apache/coyote/ajp/AjpProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpProcessor.java
@@ -332,16 +332,14 @@ public class AjpProcessor extends AbstractProcessor {
 
         switch (actionCode) {
         case COMMIT: {
-            if (response.isCommitted())
-                return;
-
-            try {
-                // Validate and write response headers
-                prepareResponse();
-            } catch (IOException e) {
-                setErrorState(ErrorState.CLOSE_NOW, e);
+            if (!response.isCommitted()) {
+                try {
+                    // Validate and write response headers
+                    prepareResponse();
+                } catch (IOException e) {
+                    setErrorState(ErrorState.CLOSE_NOW, e);
+                }
             }
-
             break;
         }
         case CLOSE: {

==================================================
