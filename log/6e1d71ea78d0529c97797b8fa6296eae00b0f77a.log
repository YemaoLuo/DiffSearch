6e1d71ea78d0529c97797b8fa6296eae00b0f77a
==================================================
- Pull up common clode code to base class.
==================================================
Rainer Jung
==================================================
Tue Sep 20 11:36:29 2011 +0000
==================================================
BackupManager.java
- Pull up common clode code to base class.
- Add sessionAttributeFilter to clone method
- Reduce visibility of notifyListenersOnReplication


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1173090 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ClusterManagerBase.java
index 73e889aa53..b332cc7de0 100644
--- a/java/org/apache/catalina/ha/session/BackupManager.java
+++ b/java/org/apache/catalina/ha/session/BackupManager.java
@@ -225,10 +225,8 @@ public class BackupManager extends ClusterManagerBase
     @Override
     public ClusterManager cloneFromTemplate() {
         BackupManager result = new BackupManager();
+        clone(result);
         result.mExpireSessionsOnShutdown = mExpireSessionsOnShutdown;
-        result.name = "Clone-from-"+name;
-        result.cluster = cluster;
-        result.notifyListenersOnReplication = notifyListenersOnReplication;
         result.mapSendOptions = mapSendOptions;
         result.maxActiveSessions = maxActiveSessions;
         result.rpcTimeout = rpcTimeout;

==================================================
DeltaManager.java
index 2829c3a092..561de7ba27 100644
--- a/java/org/apache/catalina/ha/session/ClusterManagerBase.java
+++ b/java/org/apache/catalina/ha/session/ClusterManagerBase.java
@@ -45,7 +45,7 @@ public abstract class ClusterManagerBase extends ManagerBase
     /**
      * Should listeners be notified?
      */
-    protected boolean notifyListenersOnReplication = true;
+    private boolean notifyListenersOnReplication = true;
 
     /**
      * The pattern used for including session attributes to
@@ -179,4 +179,13 @@ public abstract class ClusterManagerBase extends ManagerBase
     public void unload() {
         // NOOP
     }
+
+    protected void clone(ClusterManagerBase copy) {
+        copy.name = "Clone-from-" + getName();
+        copy.cluster = getCluster();
+        copy.maxActiveSessions = getMaxActiveSessions();
+        copy.notifyListenersOnReplication = isNotifyListenersOnReplication();
+        copy.sessionAttributeFilter = getSessionAttributeFilter();
+    }
+
 }

==================================================
