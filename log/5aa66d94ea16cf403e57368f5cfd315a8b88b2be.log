5aa66d94ea16cf403e57368f5cfd315a8b88b2be
==================================================
Ensure that the web application resources implementation does not incorrectly cache results for resources that are only visible as class loader resources.
==================================================
Mark Thomas
==================================================
Fri May 18 07:56:10 2018 +0000
==================================================
Cache.java
Ensure that the web application resources implementation does not incorrectly cache results for resources that are only visible as class loader resources.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1831828 13f79535-47bb-0310-9956-ffa450edef68



==================================================
CachedResource.java
index f8797f410e..24945273cf 100644
--- a/java/org/apache/catalina/webresources/Cache.java
+++ b/java/org/apache/catalina/webresources/Cache.java
@@ -74,8 +74,8 @@ public class Cache {
         if (cacheEntry == null) {
             // Local copy to ensure consistency
             int objectMaxSizeBytes = getObjectMaxSizeBytes();
-            CachedResource newCacheEntry =
-                    new CachedResource(this, root, path, getTtl(), objectMaxSizeBytes);
+            CachedResource newCacheEntry = new CachedResource(this, root, path, getTtl(),
+                    objectMaxSizeBytes, useClassLoaderResources);
 
             // Concurrent callers will end up with the same CachedResource
             // instance
@@ -134,8 +134,8 @@ public class Cache {
         if (cacheEntry == null) {
             // Local copy to ensure consistency
             int objectMaxSizeBytes = getObjectMaxSizeBytes();
-            CachedResource newCacheEntry =
-                    new CachedResource(this, root, path, getTtl(), objectMaxSizeBytes);
+            CachedResource newCacheEntry = new CachedResource(this, root, path, getTtl(),
+                    objectMaxSizeBytes, useClassLoaderResources);
 
             // Concurrent callers will end up with the same CachedResource
             // instance

==================================================
