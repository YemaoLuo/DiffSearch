a7ab00e11b09db65588b6066dfa1a525b7868461
==================================================
Remove call to System.exit() reported by Veracode and related code clean-up
==================================================
Mark Emlyn
==================================================
Fri Mar 25 11:20:50 2011 +0000
==================================================
GroupMBean.java
Remove call to System.exit() reported by Veracode and related code clean-up

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1085323 13f79535-47bb-0310-9956-ffa450edef68



==================================================
MBeanUtils.java
index ff5050032c..893572a7b1 100644
--- a/java/org/apache/catalina/mbeans/GroupMBean.java
+++ b/java/org/apache/catalina/mbeans/GroupMBean.java
@@ -22,7 +22,6 @@ import java.util.ArrayList;
 import java.util.Iterator;
 
 import javax.management.MBeanException;
-import javax.management.MBeanServer;
 import javax.management.MalformedObjectNameException;
 import javax.management.ObjectName;
 import javax.management.RuntimeOperationsException;
@@ -74,12 +73,6 @@ public class GroupMBean extends BaseModelMBean {
     protected Registry registry = MBeanUtils.createRegistry();
 
 
-    /**
-     * The <code>MBeanServer</code> in which we are registered.
-     */
-    protected MBeanServer mserver = MBeanUtils.createServer();
-
-
     /**
      * The <code>ManagedBean</code> information describing this MBean.
      */

==================================================
MemoryUserDatabaseMBean.java
index aa0f7aa725..193ccc0fc4 100644
--- a/java/org/apache/catalina/mbeans/MBeanUtils.java
+++ b/java/org/apache/catalina/mbeans/MBeanUtils.java
@@ -622,8 +622,7 @@ public class MBeanUtils {
      *
      * @exception MalformedObjectNameException if a name cannot be created
      */
-    static ObjectName createObjectName(String domain,
-            @SuppressWarnings("unused") Engine engine)
+    static ObjectName createObjectName(String domain, Engine engine)
         throws MalformedObjectNameException {
 
         ObjectName name = null;
@@ -785,8 +784,7 @@ public class MBeanUtils {
      *
      * @exception MalformedObjectNameException if a name cannot be created
      */
-    static ObjectName createObjectName(String domain,
-            @SuppressWarnings("unused") MBeanFactory factory)
+    static ObjectName createObjectName(String domain, MBeanFactory factory)
         throws MalformedObjectNameException {
 
         ObjectName name = new ObjectName(domain + ":type=MBeanFactory");
@@ -861,8 +859,7 @@ public class MBeanUtils {
      *
      * @exception MalformedObjectNameException if a name cannot be created
      */
-    static ObjectName createObjectName(String domain,
-            @SuppressWarnings("unused") Server server)
+    static ObjectName createObjectName(String domain, Server server)
         throws MalformedObjectNameException {
 
         ObjectName name = null;
@@ -1055,13 +1052,7 @@ public class MBeanUtils {
     public static synchronized MBeanServer createServer() {
 
         if (mserver == null) {
-            try {
-                mserver = Registry.getRegistry(null, null).getMBeanServer();
-            } catch (Throwable t) {
-                ExceptionUtils.handleThrowable(t);
-                t.printStackTrace(System.out);
-                System.exit(1);
-            }
+            mserver = Registry.getRegistry(null, null).getMBeanServer();
         }
         return (mserver);
 

==================================================
RoleMBean.java
index 454c3f3f48..33bc94fe3f 100644
--- a/java/org/apache/catalina/mbeans/MemoryUserDatabaseMBean.java
+++ b/java/org/apache/catalina/mbeans/MemoryUserDatabaseMBean.java
@@ -22,7 +22,6 @@ import java.util.ArrayList;
 import java.util.Iterator;
 
 import javax.management.MBeanException;
-import javax.management.MBeanServer;
 import javax.management.MalformedObjectNameException;
 import javax.management.ObjectName;
 import javax.management.RuntimeOperationsException;
@@ -75,12 +74,6 @@ public class MemoryUserDatabaseMBean extends BaseModelMBean {
     protected Registry registry = MBeanUtils.createRegistry();
 
 
-    /**
-     * The <code>MBeanServer</code> in which we are registered.
-     */
-    protected MBeanServer mserver = MBeanUtils.createServer();
-
-
     /**
      * The <code>ManagedBean</code> information describing this MBean.
      */

==================================================
UserMBean.java
index d47031a1d4..6e874198b2 100644
--- a/java/org/apache/catalina/mbeans/RoleMBean.java
+++ b/java/org/apache/catalina/mbeans/RoleMBean.java
@@ -19,7 +19,6 @@ package org.apache.catalina.mbeans;
 
 
 import javax.management.MBeanException;
-import javax.management.MBeanServer;
 import javax.management.RuntimeOperationsException;
 
 import org.apache.tomcat.util.modeler.BaseModelMBean;
@@ -67,17 +66,10 @@ public class RoleMBean extends BaseModelMBean {
     protected Registry registry = MBeanUtils.createRegistry();
 
 
-    /**
-     * The <code>MBeanServer</code> in which we are registered.
-     */
-    protected MBeanServer mserver = MBeanUtils.createServer();
-
-
     /**
      * The <code>ManagedBean</code> information describing this MBean.
      */
-    protected ManagedBean managed =
-        registry.findManagedBean("Role");
+    protected ManagedBean managed = registry.findManagedBean("Role");
 
 
     // ------------------------------------------------------------- Attributes

==================================================
