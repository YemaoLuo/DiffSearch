3bc2c26ac9f5bbd736ad9c43067d0ea5e62bc180
==================================================
modify test code to report more info
==================================================
Filip Hanik
==================================================
Thu Feb 21 16:06:17 2008 +0000
==================================================
NioReceiver.java
modify test code to report more info
avoid concurrency during closedown


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@629843 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestUdpPackages.java
index 0c91f1f690..d166b166db 100644
--- a/java/org/apache/catalina/tribes/transport/nio/NioReceiver.java
+++ b/java/org/apache/catalina/tribes/transport/nio/NioReceiver.java
@@ -281,7 +281,7 @@ public class NioReceiver extends ReceiverBase implements Runnable, ChannelReceiv
                 // get an iterator over the set of selected keys
                 Iterator it = selector.selectedKeys().iterator();
                 // look at each key in the selected set
-                while (it.hasNext()) {
+                while (it.hasNext() && selector!=null) {
                     SelectionKey key = (SelectionKey) it.next();
                     // Is a new connection coming in?
                     if (key.isAcceptable()) {
@@ -310,7 +310,7 @@ public class NioReceiver extends ReceiverBase implements Runnable, ChannelReceiv
                     }
 
                     // remove key from selected set, it's been handled
-                    it.remove();
+                    if (selector!=null) it.remove();
                 }
             } catch (java.nio.channels.ClosedSelectorException cse) {
                 // ignore is normal at shutdown or stop listen socket

==================================================
