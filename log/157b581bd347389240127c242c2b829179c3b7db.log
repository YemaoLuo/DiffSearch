157b581bd347389240127c242c2b829179c3b7db
==================================================
Jasper only sets a default stratum.
==================================================
Mark Thomas
==================================================
Sat Jun 3 20:53:45 2017 +0000
==================================================
SmapGenerator.java
Jasper only sets a default stratum.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1797540 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SmapUtil.java
index 3a6060ae57..01dd1f7d35 100644
--- a/java/org/apache/jasper/compiler/SmapGenerator.java
+++ b/java/org/apache/jasper/compiler/SmapGenerator.java
@@ -65,6 +65,17 @@ public class SmapGenerator {
         outputFileName = x;
     }
 
+
+    /**
+     * Sets the default and only stratum for the smap.
+     *
+     * @param stratum the SmapStratum object to add
+     */
+    public synchronized void setStratum(SmapStratum stratum) {
+        addStratum(stratum, true);
+    }
+
+
     /**
      * Adds the given SmapStratum object, representing a Stratum with
      * logically associated FileSection and LineSection blocks, to
@@ -76,7 +87,10 @@ public class SmapGenerator {
      * @param defaultStratum if <tt>true</tt>, this SmapStratum is considered
      *                to represent the default SMAP stratum unless
      *                overwritten
+     *
+     * @deprecated Use {@link #setStratum(SmapStratum)}
      */
+    @Deprecated
     public synchronized void addStratum(SmapStratum stratum,
                                         boolean defaultStratum) {
         strata.add(stratum);

==================================================
TestSmapGenerator.java
index 5507392c34..48ac789900 100644
--- a/java/org/apache/jasper/compiler/SmapUtil.java
+++ b/java/org/apache/jasper/compiler/SmapUtil.java
@@ -87,7 +87,7 @@ public class SmapUtil {
         // Map out Node.Nodes
         evaluateNodes(pageNodes, s, map, ctxt.getOptions().getMappedFile());
         s.optimizeLineSection();
-        g.addStratum(s, true);
+        g.setStratum(s);
 
         if (ctxt.getOptions().isSmapDumped()) {
             File outSmap = new File(ctxt.getClassFileName() + ".smap");
@@ -113,7 +113,7 @@ public class SmapUtil {
             s.optimizeLineSection();
             g = new SmapGenerator();
             g.setOutputFileName(unqualify(ctxt.getServletJavaFileName()));
-            g.addStratum(s, true);
+            g.setStratum(s);
 
             String innerClassFileName =
                 classFileName.substring(0, classFileName.indexOf(".class")) +

==================================================
