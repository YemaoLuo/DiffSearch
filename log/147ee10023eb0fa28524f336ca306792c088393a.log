147ee10023eb0fa28524f336ca306792c088393a
==================================================
Fix remaining SpotBugs failures in the jdbc-pool code when the rank is set to 16
==================================================
Mark Thomas
==================================================
Fri Oct 13 17:22:07 2017 +0000
==================================================
ConnectionPool.java
Fix remaining SpotBugs failures in the jdbc-pool code when the rank is set to 16
(the maximum rank is 20 so there are still quite a few other issues to look at)

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1812154 13f79535-47bb-0310-9956-ffa450edef68



==================================================
PoolProperties.java
index 0ab1090b02..5f5b9487e6 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
@@ -621,7 +621,10 @@ public class ConnectionPool {
         // we could have threads stuck in idle.poll(timeout) that will never be
         // notified
         if (waitcount.get() > 0) {
-            idle.offer(create(true));
+            if (!idle.offer(create(true))) {
+                log.warn("Failed to add a new connection to the pool after releasing a connection " +
+                        "when at least one thread was waiting for a connection.");
+            }
         }
     }
 

==================================================
