45a9b914b814e3a2a8998bde20a6df9df9cab985
==================================================
Improve support for resources.
==================================================
Remy Maucherat
==================================================
Thu Feb 7 10:22:25 2013 +0000
==================================================
WebResourceRoot.java
Improve support for resources.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1443388 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WebResourceRootSF.java
index c0735debc5..ef851aae1b 100644
--- a/java/org/apache/catalina/WebResourceRoot.java
+++ b/java/org/apache/catalina/WebResourceRoot.java
@@ -212,18 +212,36 @@ public interface WebResourceRoot extends Lifecycle {
      */
     void addPreResources(WebResourceSet webResourceSet);
 
+    /**
+     * Get the list of WebResourceSet configured to this web application 
+     * as a 'Pre' resource.
+     */
+    WebResourceSet[] getPreResources();
+
     /**
      * Adds the provided WebResourceSet to this web application as a 'Jar'
      * resource.
      */
     void addJarResources(WebResourceSet webResourceSet);
 
+    /**
+     * Get the list of WebResourceSet configured to this web application 
+     * as a 'Jar' resource.
+     */
+    WebResourceSet[] getJarResources();
+
     /**
      * Adds the provided WebResourceSet to this web application as a 'Post'
      * resource.
      */
     void addPostResources(WebResourceSet webResourceSet);
 
+    /**
+     * Get the list of WebResourceSet configured to this web application 
+     * as a 'Post' resource.
+     */
+    WebResourceSet[] getPostResources();
+
     /**
      * Obtain the web application this WebResourceRoot is associated with.
      */

==================================================
StandardRoot.java
index db854007f4..f47f9fb853 100644
--- a/java/org/apache/catalina/storeconfig/server-registry.xml
+++ b/java/org/apache/catalina/storeconfig/server-registry.xml
@@ -17,138 +17,138 @@
 -->
 <Registry name="Tomcat" version="6.0.35" encoding="UTF-8" >
      <Description
-        tag="Server"
-        standard="true"
-        default="true" 
-        externalAllowed="true" 
+	    tag="Server"
+		standard="true"
+		default="true" 
+		externalAllowed="true" 
         childs="true"
         tagClass="org.apache.catalina.core.StandardServer"
         storeFactoryClass="org.apache.catalina.storeconfig.StandardServerSF">
      </Description>
      <Description
-        tag="Service"
-        standard="true"
-        default="true" 
+	    tag="Service"
+		standard="true"
+		default="true" 
         childs="true"
         tagClass="org.apache.catalina.core.StandardService"
         storeFactoryClass="org.apache.catalina.storeconfig.StandardServiceSF">
      </Description>
      <Description
-        tag="Engine"
-        standard="true"
-        default="true" 
+	    tag="Engine"
+		standard="true"
+		default="true" 
         childs="true"
         tagClass="org.apache.catalina.core.StandardEngine"
         storeFactoryClass="org.apache.catalina.storeconfig.StandardEngineSF">
-        <TransientAttribute>domain</TransientAttribute>
+	    <TransientAttribute>domain</TransientAttribute>
      </Description>
      <Description
-        tag="Host"
-        standard="true"
-        default="true" 
+	    tag="Host"
+		standard="true"
+		default="true" 
         childs="true"
         tagClass="org.apache.catalina.core.StandardHost"
         storeFactoryClass="org.apache.catalina.storeconfig.StandardHostSF">
-        <TransientAttribute>domain</TransientAttribute>
+	    <TransientAttribute>domain</TransientAttribute>
      </Description>
      <Description
-        tag="Context"
-        standard="true"
-        default="true" 
-        externalAllowed="true" 
+	    tag="Context"
+		standard="true"
+		default="true" 
+		externalAllowed="true" 
         externalOnly="true" 
-         storeSeparate="true"
-        backup="true" 
+ 		storeSeparate="true"
+		backup="true" 
         childs="true"
         tagClass="org.apache.catalina.core.StandardContext"
         storeFactoryClass="org.apache.catalina.storeconfig.StandardContextSF"
         storeAppenderClass="org.apache.catalina.storeconfig.StoreContextAppender">
-        <TransientAttribute>available</TransientAttribute>
-        <TransientAttribute>configFile</TransientAttribute>
-        <TransientAttribute>configured</TransientAttribute>
-        <TransientAttribute>displayName</TransientAttribute>
-        <TransientAttribute>distributable</TransientAttribute>
-        <TransientAttribute>domain</TransientAttribute>
-        <TransientAttribute>engineName</TransientAttribute>
-        <TransientAttribute>name</TransientAttribute>
-        <TransientAttribute>publicId</TransientAttribute>
-        <TransientAttribute>originalDocBase</TransientAttribute>        
-        <TransientAttribute>replaceWelcomeFiles</TransientAttribute>
-        <TransientAttribute>saveConfig</TransientAttribute>
-        <TransientAttribute>sessionTimeout</TransientAttribute>
-        <TransientAttribute>startupTime</TransientAttribute>
-        <TransientAttribute>tldScanTime</TransientAttribute>
+	    <TransientAttribute>available</TransientAttribute>
+	    <TransientAttribute>configFile</TransientAttribute>
+	    <TransientAttribute>configured</TransientAttribute>
+	    <TransientAttribute>displayName</TransientAttribute>
+	    <TransientAttribute>distributable</TransientAttribute>
+	    <TransientAttribute>domain</TransientAttribute>
+	    <TransientAttribute>engineName</TransientAttribute>
+	    <TransientAttribute>name</TransientAttribute>
+	    <TransientAttribute>publicId</TransientAttribute>
+	    <TransientAttribute>originalDocBase</TransientAttribute>	    
+	    <TransientAttribute>replaceWelcomeFiles</TransientAttribute>
+	    <TransientAttribute>saveConfig</TransientAttribute>
+	    <TransientAttribute>sessionTimeout</TransientAttribute>
+	    <TransientAttribute>startupTime</TransientAttribute>
+	    <TransientAttribute>tldScanTime</TransientAttribute>
      </Description>
      <Description
         id="org.apache.catalina.deploy.NamingResources.[GlobalNamingResources]"
-        tag="GlobalNamingResources"
-        standard="true"
-        default="false"
-        attributes="false"
+	    tag="GlobalNamingResources"
+		standard="true"
+		default="false"
+		attributes="false"
         childs="true"
         tagClass="org.apache.catalina.deploy.NamingResources"
         storeFactoryClass="org.apache.catalina.storeconfig.GlobalNamingResourcesSF">
      </Description>
       <Description
-        tag="Connector"
-        standard="true"
-        default="true" 
+	    tag="Connector"
+		standard="true"
+		default="true" 
         tagClass="org.apache.catalina.connector.Connector"
         childs="true"
         storeFactoryClass="org.apache.catalina.storeconfig.ConnectorSF"
         storeAppenderClass="org.apache.catalina.storeconfig.ConnectorStoreAppender">
-        <TransientAttribute>URIEncoding</TransientAttribute>
-        <TransientAttribute>maxProcessor</TransientAttribute>
-        <TransientAttribute>minProcessor</TransientAttribute>
+	    <TransientAttribute>URIEncoding</TransientAttribute>
+	    <TransientAttribute>maxProcessor</TransientAttribute>
+ 	    <TransientAttribute>minProcessor</TransientAttribute>
      </Description>
      <Description
-        tag="NamingResources"
-        standard="true"
-        default="false"
-        attributes="false"
+	    tag="NamingResources"
+		standard="true"
+		default="false"
+		attributes="false"
         childs="true"
         tagClass="org.apache.catalina.deploy.NamingResources"
         storeFactoryClass="org.apache.catalina.storeconfig.NamingResourcesSF">
      </Description>
-     <Description
-        tag="Manager"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.Manager"
+	 <Description
+	    tag="Manager"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.Manager"
         storeFactoryClass="org.apache.catalina.storeconfig.ManagerSF">
-        <TransientAttribute>entropy</TransientAttribute>
-        <TransientAttribute>distributable</TransientAttribute>
+	    <TransientAttribute>entropy</TransientAttribute>
+	    <TransientAttribute>distributable</TransientAttribute>
     </Description>
     <Description
-        tag="Manager"
-        standard="false"
-        default="false" 
+	    tag="Manager"
+		standard="false"
+		default="false" 
         childs="true"
-        tagClass="org.apache.catalina.session.PersistentManager"
+		tagClass="org.apache.catalina.session.PersistentManager"
         storeFactoryClass="org.apache.catalina.storeconfig.PersistentManagerSF">
         <TransientAttribute>entropy</TransientAttribute>
-        <TransientAttribute>distributable</TransientAttribute>
+	    <TransientAttribute>distributable</TransientAttribute>
      </Description>
      <Description
-        tag="Store"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.session.FileStore"
+	    tag="Store"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.session.FileStore"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Store"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.session.JDBCStore"
+	    tag="Store"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.session.JDBCStore"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Cluster"
-        standard="false"
-        default="false" 
+	    tag="Cluster"
+		standard="false"
+		default="false" 
         childs="true"
-        tagClass="org.apache.catalina.ha.CatalinaCluster"
+		tagClass="org.apache.catalina.ha.CatalinaCluster"
         storeFactoryClass="org.apache.catalina.storeconfig.CatalinaClusterSF">
      </Description>
      <Description
@@ -162,24 +162,24 @@
         <TransientAttribute>realmPath</TransientAttribute>
      </Description>
      <Description
-        tag="Parameter"
-        standard="true"
-        default="false"
-        tagClass="org.apache.catalina.deploy.ApplicationParameter"
+	    tag="Parameter"
+		standard="true"
+		default="false"
+		tagClass="org.apache.catalina.deploy.ApplicationParameter"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Loader"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.loader.WebappLoader"
+	    tag="Loader"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.loader.WebappLoader"
         storeFactoryClass="org.apache.catalina.storeconfig.LoaderSF">
      </Description>
      <Description
-        tag="Listener"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.LifecycleListener"
+	    tag="Listener"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.LifecycleListener"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
        <TransientChild>org.apache.catalina.mbeans.ServerLifecycleListener</TransientChild>
        <TransientChild>org.apache.catalina.core.NamingContextListener</TransientChild>
@@ -193,66 +193,66 @@
      </Description>
      <Description
         id="org.apache.catalina.core.StandardServer.[ServerLifecycleListener]"
-        tag="Listener"
-        standard="false"
-        default="false" 
+	    tag="Listener"
+		standard="false"
+		default="false" 
         tagClass="org.apache.catalina.mbeans.ServerLifecycleListener"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Valve"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.Valve"
+	    tag="Valve"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.Valve"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
-        <TransientChild>org.apache.catalina.authenticator.BasicAuthenticator</TransientChild>
-        <TransientChild>org.apache.catalina.authenticator.DigestAuthenticator</TransientChild>
-        <TransientChild>org.apache.catalina.authenticator.FormAuthenticator</TransientChild>
-        <TransientChild>org.apache.catalina.authenticator.NonLoginAuthenticator</TransientChild>
-        <TransientChild>org.apache.catalina.authenticator.SSLAuthenticator</TransientChild>
-        <TransientChild>org.apache.catalina.core.StandardContextValve</TransientChild>
-        <TransientChild>org.apache.catalina.core.StandardEngineValve</TransientChild>
-        <TransientChild>org.apache.catalina.core.StandardHostValve</TransientChild>
-        <TransientChild>org.apache.catalina.valves.CertificatesValve</TransientChild>
-        <TransientChild>org.apache.catalina.valves.ErrorReportValve</TransientChild>
-        <TransientChild>org.apache.catalina.valves.RequestListenerValve</TransientChild>
+	     <TransientChild>org.apache.catalina.authenticator.BasicAuthenticator</TransientChild>
+	     <TransientChild>org.apache.catalina.authenticator.DigestAuthenticator</TransientChild>
+	     <TransientChild>org.apache.catalina.authenticator.FormAuthenticator</TransientChild>
+	     <TransientChild>org.apache.catalina.authenticator.NonLoginAuthenticator</TransientChild>
+	     <TransientChild>org.apache.catalina.authenticator.SSLAuthenticator</TransientChild>
+	     <TransientChild>org.apache.catalina.core.StandardContextValve</TransientChild>
+	     <TransientChild>org.apache.catalina.core.StandardEngineValve</TransientChild>
+	     <TransientChild>org.apache.catalina.core.StandardHostValve</TransientChild>
+	     <TransientChild>org.apache.catalina.valves.CertificatesValve</TransientChild>
+	     <TransientChild>org.apache.catalina.valves.ErrorReportValve</TransientChild>
+	     <TransientChild>org.apache.catalina.valves.RequestListenerValve</TransientChild>
         <TransientChild>org.apache.catalina.ha.session.JvmRouteBinderValve</TransientChild>
         <TransientChild>org.apache.catalina.ha.tcp.ReplicationValve</TransientChild>
-     </Description>
+	 </Description>
      <Description
-        tag="Environment"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextEnvironment"
+	    tag="Environment"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextEnvironment"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="EJB"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextEjb"
+	    tag="EJB"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextEjb"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="LocalEjb"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextLocalEjb"
+	    tag="LocalEjb"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextLocalEjb"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Resource"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextResource"
+	    tag="Resource"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextResource"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
     <Description
-        tag="Resources"
-        standard="false"
-        default="false" 
+	    tag="Resources"
+		standard="false"
+		default="false" 
         childs="true"
-        tagClass="org.apache.catalina.WebResourceRoot"
+		tagClass="org.apache.catalina.WebResourceRoot"
         storeFactoryClass="org.apache.catalina.storeconfig.WebResourceRootSF">
         <TransientAttribute>allowLinking</TransientAttribute>
         <TransientAttribute>cachingAllowed</TransientAttribute>
@@ -260,10 +260,11 @@
         <TransientAttribute>cacheMaxSize</TransientAttribute>
         <TransientAttribute>cacheMaxObjectSize</TransientAttribute>
         <TransientAttribute>docBase</TransientAttribute>
-        <TransientAttribute>cached</TransientAttribute>
+         <TransientAttribute>cached</TransientAttribute>
         <TransientAttribute>caseSensitive</TransientAttribute>
      </Description>
     <Description
+        id="org.apache.catalina.WebResourceSet.[PreResources]"
         tag="PreResources"
         standard="false"
         default="false" 
@@ -271,6 +272,7 @@
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
     <Description
+        id="org.apache.catalina.WebResourceSet.[JarResources]"
         tag="JarResources"
         standard="false"
         default="false" 
@@ -278,6 +280,7 @@
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
     <Description
+        id="org.apache.catalina.WebResourceSet.[PostResources]"
         tag="PostResources"
         standard="false"
         default="false" 
@@ -285,71 +288,71 @@
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="ResourceEnvRef"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextResourceEnvRef"
+	    tag="ResourceEnvRef"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextResourceEnvRef"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="ResourceLink"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextResourceLink"
+	    tag="ResourceLink"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextResourceLink"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Transaction"
-        standard="true"
-        default="false" 
-        tagClass="org.apache.catalina.deploy.ContextTransaction"
+	    tag="Transaction"
+		standard="true"
+		default="false" 
+		tagClass="org.apache.catalina.deploy.ContextTransaction"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        id="org.apache.catalina.core.StandardContext.[InstanceListener]"
-        tag="InstanceListener"
-        standard="true"
-        default="false" 
-        attributes="false"
+	    id="org.apache.catalina.core.StandardContext.[InstanceListener]"
+	    tag="InstanceListener"
+		standard="true"
+		default="false" 
+		attributes="false"
         storeFactoryClass="org.apache.catalina.storeconfig.InstanceListenerSF">
      </Description>
      <Description
-        id="org.apache.catalina.core.StandardContext.[WrapperLifecycle]"
-        tag="WrapperLifecycle"
-        standard="true"
-        default="false" 
-        attributes="false"
+	    id="org.apache.catalina.core.StandardContext.[WrapperLifecycle]"
+	    tag="WrapperLifecycle"
+		standard="true"
+		default="false" 
+		attributes="false"
         storeFactoryClass="org.apache.catalina.storeconfig.WrapperLifecycleSF">
      </Description>
      <Description
-        id="org.apache.catalina.core.StandardContext.[WrapperListener]"
-        tag="WrapperListener"
-        standard="true"
-        default="false" 
-        attributes="false"
+	    id="org.apache.catalina.core.StandardContext.[WrapperListener]"
+	    tag="WrapperListener"
+		standard="true"
+		default="false" 
+		attributes="false"
         storeFactoryClass="org.apache.catalina.storeconfig.WrapperListenerSF">
      </Description>
      <Description
-        id="org.apache.catalina.core.StandardContext.[WatchedResource]"
-        tag="WatchedResource"
-        standard="true"
-        default="false" 
-        attributes="false"
+	    id="org.apache.catalina.core.StandardContext.[WatchedResource]"
+	    tag="WatchedResource"
+		standard="true"
+		default="false" 
+		attributes="false"
         storeFactoryClass="org.apache.catalina.storeconfig.WatchedResourceSF">
      </Description>
      <Description
-        tag="Sender"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.cluster.tcp.ReplicationTransmitter"
+	    tag="Sender"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.cluster.tcp.ReplicationTransmitter"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Sender"
-        standard="false"
-        default="false" 
+	    tag="Sender"
+		standard="false"
+		default="false" 
         childs="true" 
-        tagClass="org.apache.catalina.tribes.ChannelSender"
+		tagClass="org.apache.catalina.tribes.ChannelSender"
         storeFactoryClass="org.apache.catalina.storeconfig.SenderSF">
      </Description>
      <Description
@@ -360,31 +363,31 @@
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Receiver"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.tribes.ChannelReceiver"
+	    tag="Receiver"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.tribes.ChannelReceiver"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Membership"
-        standard="false"
-        default="false"
-        tagClass="org.apache.catalina.tribes.MembershipService"
+	    tag="Membership"
+		standard="false"
+		default="false"
+		tagClass="org.apache.catalina.tribes.MembershipService"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description
-        tag="Deployer"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.ha.ClusterDeployer"
+	    tag="Deployer"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.ha.ClusterDeployer"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description> 
      <Description
-        tag="ClusterListener"
-        standard="false"
-        default="false" 
-        tagClass="org.apache.catalina.ha.ClusterListener"
+	    tag="ClusterListener"
+		standard="false"
+		default="false" 
+		tagClass="org.apache.catalina.ha.ClusterListener"
         storeFactoryClass="org.apache.catalina.storeconfig.StoreFactoryBase">
      </Description>
      <Description

==================================================
