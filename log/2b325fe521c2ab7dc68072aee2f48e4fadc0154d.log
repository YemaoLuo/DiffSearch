2b325fe521c2ab7dc68072aee2f48e4fadc0154d
==================================================
Add some debug information to memory leak tests that are currently failing on Gump.
==================================================
Mark Thomas
==================================================
Mon Feb 16 17:20:40 2015 +0000
==================================================
TesterCounter.java
Add some debug information to memory leak tests that are currently failing on Gump.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1660168 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TesterLeakingServlet1.java
index b53ce96295..c5930c0f38 100644
--- a/test/org/apache/tomcat/unittest/TesterCounter.java
+++ b/test/org/apache/tomcat/unittest/TesterCounter.java
@@ -16,7 +16,18 @@
  */
 package org.apache.tomcat.unittest;
 
+import org.apache.juli.logging.Log;
+import org.apache.juli.logging.LogFactory;
+
 public class TesterCounter {
+
+    private static final Log log = LogFactory.getLog(TesterCounter.class);
+
+    static {
+        log.info("TestCounter loaded by " + TesterCounter.class.getClassLoader() +
+                " in thread " + Thread.currentThread().getName());
+    }
+
     private int count = 0;
 
     public void increment() {

==================================================
TesterLeakingServlet2.java
index 6b1dcce173..6bc95c1fa8 100644
--- a/test/org/apache/tomcat/unittest/TesterLeakingServlet1.java
+++ b/test/org/apache/tomcat/unittest/TesterLeakingServlet1.java
@@ -23,8 +23,13 @@ import javax.servlet.http.HttpServlet;
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 
+import org.apache.juli.logging.Log;
+import org.apache.juli.logging.LogFactory;
+
 public class TesterLeakingServlet1 extends HttpServlet {
 
+    private static final Log log = LogFactory.getLog(TesterLeakingServlet1.class);
+
     private static final long serialVersionUID = 1L;
 
     private ThreadLocal<TesterCounter> myThreadLocal = new ThreadLocal<>();
@@ -36,6 +41,7 @@ public class TesterLeakingServlet1 extends HttpServlet {
 
         TesterCounter counter = myThreadLocal.get();
         if (counter == null) {
+            log.info("Adding thread local to thread " + Thread.currentThread().getName());
             counter = new TesterCounter();
             myThreadLocal.set(counter);
         }

==================================================
