8409df9a56cba60cf3f44139daf8f42854b72784
==================================================
Confirm connection is dropped if the client preface is skipped
==================================================
Mark Thomas
==================================================
Tue Jun 2 20:48:01 2015 +0000
==================================================
Http2TestBase.java
Confirm connection is dropped if the client preface is skipped

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1683182 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestHttp2Section_3_5.java
index d33ba50e2f..bc9af8de17 100644
--- a/test/org/apache/coyote/http2/Http2TestBase.java
+++ b/test/org/apache/coyote/http2/Http2TestBase.java
@@ -54,6 +54,10 @@ public abstract class Http2TestBase extends TomcatBaseTest {
         { 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00 };
     static final String EMPTY_HTTP2_SETTINGS_HEADER;
 
+    private static final byte[] PING_FRAME = new byte[] {
+        0x00, 0x00, 0x08, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00,
+        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
+
     static {
         byte[] empty = new byte[0];
         EMPTY_HTTP2_SETTINGS_HEADER = "HTTP2-Settings: " + Base64.encodeBase64String(empty) + "\r\n";
@@ -253,6 +257,12 @@ public abstract class Http2TestBase extends TomcatBaseTest {
     }
 
 
+    void sendPing() throws IOException {
+        os.write(PING_FRAME);
+        os.flush();
+    }
+
+
     private static class TestInput implements Http2Parser.Input {
 
         private final InputStream is;

==================================================
