41c9a74c64c8c7043a81f2cb13bf717e9846bd76
==================================================
Allow the factory attribute on the ResourceLink element.
==================================================
Filip Hanik
==================================================
Tue Apr 21 17:03:12 2009 +0000
==================================================
NamingContextListener.java
Allow the factory attribute on the ResourceLink element.
Make sure that ResourceBase properties are transferred to the ResourceLinkRef


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@767223 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ContextResourceLink.java
index d6c3ad4f92..57e5a90465 100644
--- a/java/org/apache/catalina/core/NamingContextListener.java
+++ b/java/org/apache/catalina/core/NamingContextListener.java
@@ -1063,7 +1063,16 @@ public class NamingContextListener
 
         // Create a reference to the resource.
         Reference ref = new ResourceLinkRef
-            (resourceLink.getType(), resourceLink.getGlobal());
+            (resourceLink.getType(), resourceLink.getGlobal(), resourceLink.getFactory(), null);
+        Iterator i = resourceLink.listProperties();
+        while (i.hasNext()) {
+            String key = i.next().toString();
+            Object val = resourceLink.getProperty(key);
+            if (val!=null) {
+                StringRefAddr refAddr = new StringRefAddr(key, val.toString());
+                ref.add(refAddr);
+            }
+        }
         javax.naming.Context ctx = 
             "UserTransaction".equals(resourceLink.getName()) 
             ? compCtx : envCtx;

==================================================
