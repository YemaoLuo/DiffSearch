40e58dcd12671ae257ed7db3c959832abe091e19
==================================================
Rework the fix for 56190 as the previous fix did not recycle the request in all cases leading to mis-routing of requests. 
==================================================
Mark Emlyn
==================================================
Fri Mar 21 23:04:07 2014 +0000
==================================================
AsyncContextImpl.java
Rework the fix for 56190 as the previous fix did not recycle the request in all cases leading to mis-routing of requests. 

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1580080 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AsyncContextCallback.java
index 61af990f5a..1ced9054ce 100644
--- a/java/org/apache/catalina/core/LocalStrings.properties
+++ b/java/org/apache/catalina/core/LocalStrings.properties
@@ -65,6 +65,7 @@ aprListener.tooLateForSSLRandomSeed=Cannot setSSLRandomSeed: SSL has already bee
 aprListener.tooLateForFIPSMode=Cannot setFIPSMode: SSL has already been initialized
 aprListener.initializedOpenSSL=OpenSSL successfully initialized ({0})
 
+asyncContextImpl.finishResponseError=Response did not finish cleanly after AsyncContext completed
 asyncContextImpl.request.ise=It is illegal to call getRequest() after complete() or any of the dispatch() methods has been called
 asyncContextImpl.requestEnded=The request associated with the AsyncContext has already completed processing.
 asyncContextImpl.response.ise=It is illegal to call getResponse() after complete() or any of the dispatch() methods has been called

==================================================
AsyncStateMachine.java
index 4c34bdfa90..2278414a52 100644
--- a/java/org/apache/coyote/AsyncContextCallback.java
+++ b/java/org/apache/coyote/AsyncContextCallback.java
@@ -16,8 +16,6 @@
  */
 package org.apache.coyote;
 
-import java.io.IOException;
-
 /**
  * Provides a mechanism for the Coyote connectors to signal to a
  * {@link javax.servlet.AsyncContext} implementation that an action, such as
@@ -26,5 +24,5 @@ import java.io.IOException;
  * org.apache.coyote package.
  */
 public interface AsyncContextCallback {
-    public void fireOnComplete() throws IOException;
+    public void fireOnComplete();
 }

==================================================
