199e3844df7d8efdc6c5e5f7f7b672851cdd0693
==================================================
minor refactoring, simplify initialization
==================================================
Filip Hanik
==================================================
Fri Aug 7 14:58:41 2009 +0000
==================================================
Request.java
minor refactoring, simplify initialization


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@802032 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AsyncContextImpl.java
index 9a5c0c3b32..078778caad 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -390,7 +390,7 @@ public class Request
     /**
      * AsyncContext 
      */
-    protected AsyncContextImpl asyncContext = null;
+    protected volatile AsyncContextImpl asyncContext = null;
     
     /**
      * async timeout
@@ -1475,9 +1475,7 @@ public class Request
         if (asyncContext==null) asyncContext = new AsyncContextImpl(this);
         else if (asyncContext.isStarted()) throw new IllegalStateException("Already started.");
         asyncContext.setStarted(getContext());
-        asyncContext.setServletRequest(request);
-        asyncContext.setServletResponse(response);
-        asyncContext.initEvent();
+        asyncContext.init(request,response);
         //TODO SERVLET3 - async - need to retrieve the ServletContext here
         //or just the webapp classloader associated with to do 
         //run with start(Runnable)

==================================================
