53e722faf5bb17ee8d3a148a723631ffb9fa4eed
==================================================
Simplify
==================================================
Mark Thomas
==================================================
Thu Jun 11 12:25:12 2015 +0000
==================================================
Http2TestBase.java
Simplify

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1684864 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestHttp2Section_4_1.java
index 7c836bfb10..53a5e1b213 100644
--- a/test/org/apache/coyote/http2/Http2TestBase.java
+++ b/test/org/apache/coyote/http2/Http2TestBase.java
@@ -263,6 +263,7 @@ public abstract class Http2TestBase extends TomcatBaseTest {
         input = new TestInput(is);
         output = new TestOutput();
         parser = new Http2Parser("-1", input, output);
+        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
     }
 
 

==================================================
TestHttp2Section_4_2.java
index b0974b39a0..aad1ca4dfe 100644
--- a/test/org/apache/coyote/http2/TestHttp2Section_4_1.java
+++ b/test/org/apache/coyote/http2/TestHttp2Section_4_1.java
@@ -38,8 +38,6 @@ public class TestHttp2Section_4_1 extends Http2TestBase {
 
     @Test
     public void testUnknownFrameType() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         http2Connect();
         os.write(UNKNOWN_FRAME);
         os.flush();
@@ -54,8 +52,6 @@ public class TestHttp2Section_4_1 extends Http2TestBase {
 
     @Test
     public void testReservedBitIgnored() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 

==================================================
TestHttp2Section_4_3.java
index ae0ea41a7b..6e7064fc09 100644
--- a/test/org/apache/coyote/http2/TestHttp2Section_4_2.java
+++ b/test/org/apache/coyote/http2/TestHttp2Section_4_2.java
@@ -30,8 +30,6 @@ public class TestHttp2Section_4_2 extends Http2TestBase {
 
     @Test
     public void testFrameSizeLimitsTooBig() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 
@@ -67,8 +65,6 @@ public class TestHttp2Section_4_2 extends Http2TestBase {
 
     @Test
     public void testFrameTypeLimitsTooBig() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 
@@ -97,8 +93,6 @@ public class TestHttp2Section_4_2 extends Http2TestBase {
 
     @Test
     public void testFrameTypeLimitsTooSmall() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 
@@ -126,8 +120,6 @@ public class TestHttp2Section_4_2 extends Http2TestBase {
 
     @Test
     public void testFrameTypeLimitsStream() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 

==================================================
TestHttp2Section_5_1.java
index b002c99ffe..11530c365b 100644
--- a/test/org/apache/coyote/http2/TestHttp2Section_4_3.java
+++ b/test/org/apache/coyote/http2/TestHttp2Section_4_3.java
@@ -32,8 +32,6 @@ public class TestHttp2Section_4_3 extends Http2TestBase {
 
     @Test
     public void testHeaderDecodingError() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 
@@ -59,8 +57,6 @@ public class TestHttp2Section_4_3 extends Http2TestBase {
 
     @Test
     public void testHeaderContinuationContiguous() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 
@@ -85,8 +81,6 @@ public class TestHttp2Section_4_3 extends Http2TestBase {
 
     @Test
     public void testHeaderContinuationNonContiguous() throws Exception {
-        hpackEncoder = new HpackEncoder(ConnectionSettings.DEFAULT_HEADER_TABLE_SIZE);
-
         // HTTP2 upgrade
         http2Connect();
 

==================================================
