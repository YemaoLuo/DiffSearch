a420610242fd9d810e9f7cbbb07b8c49dbb4d6d6
==================================================
Fix remainder of failing tests and a related TODO spotted in the tests as well.
==================================================
Mark Emlyn
==================================================
Tue Nov 5 15:41:53 2013 +0000
==================================================
WebappLoader.java
Fix remainder of failing tests and a related TODO spotted in the tests as well.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1539036 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestVirtualWebappLoader.java
index 9b28b3d276..64fe227ff0 100644
--- a/java/org/apache/catalina/loader/WebappLoader.java
+++ b/java/org/apache/catalina/loader/WebappLoader.java
@@ -305,6 +305,9 @@ public class WebappLoader extends LifecycleMBeanBase
 
 
     public String[] getLoaderRepositories() {
+        if (classLoader == null) {
+            return new String[0];
+        }
         URL[] urls = classLoader.getURLs();
         String[] result = new String[urls.length];
         for (int i = 0; i < urls.length; i++) {

==================================================
TestWebappClassLoaderWeaving.java
index ba7809689f..9a19f6711e 100644
--- a/test/org/apache/catalina/loader/TestVirtualWebappLoader.java
+++ b/test/org/apache/catalina/loader/TestVirtualWebappLoader.java
@@ -65,9 +65,9 @@ public class TestVirtualWebappLoader extends TomcatBaseTest {
         String[] repos = loader.getLoaderRepositories();
         assertEquals(3,repos.length);
         loader.stop();
-        // ToDo: Why doesn't remove repositories?
+
         repos = loader.getLoaderRepositories();
-        assertEquals(3, repos.length);
+        assertEquals(0, repos.length);
 
         // no leak
         loader.start();

==================================================
