64a4cf9c226de480c822a90aa28125fa92bddb0d
==================================================
Fix issue reported during 8.0.16 release testing that requestDestroyed
==================================================
Mark Thomas
==================================================
Thu Jan 8 19:47:51 2015 +0000
==================================================
StandardHostValve.java
Fix issue reported during 8.0.16 release testing that requestDestroyed
was not called for a non-async page when the ErrorReportingValve would
be handling the error reporting.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1650365 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestStandardHostValve.java
index 69e8150503..0a5e84ac80 100644
--- a/java/org/apache/catalina/core/StandardHostValve.java
+++ b/java/org/apache/catalina/core/StandardHostValve.java
@@ -180,7 +180,7 @@ final class StandardHostValve extends ValveBase {
                 }
             }
 
-            if (!request.isAsync() && !response.isErrorReportRequired()) {
+            if (!request.isAsync() && (!asyncAtStart || !response.isErrorReportRequired())) {
                 context.fireRequestDestroyEvent(request);
             }
         } finally {

==================================================
