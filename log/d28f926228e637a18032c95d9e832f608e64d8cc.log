d28f926228e637a18032c95d9e832f608e64d8cc
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61779
==================================================
Mark Thomas
==================================================
Mon Nov 20 13:10:15 2017 +0000
==================================================
AuthConfigFactoryImpl.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61779
Avoid a NullPointerException when a null RegistrationListener is passed to AuthConfigFactory.getConfigProvider()
Patch provided by Lazar.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1815802 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAuthConfigFactoryImpl.java
index 6d028f9b16..18e136c6e2 100644
--- a/java/org/apache/catalina/authenticator/jaspic/AuthConfigFactoryImpl.java
+++ b/java/org/apache/catalina/authenticator/jaspic/AuthConfigFactoryImpl.java
@@ -75,9 +75,11 @@ public class AuthConfigFactoryImpl extends AuthConfigFactory {
         RegistrationContextImpl registrationContext =
                 findRegistrationContextImpl(layer, appContext);
         if (registrationContext != null) {
-            RegistrationListenerWrapper wrapper = new RegistrationListenerWrapper(
-                    layer, appContext, listener);
-            registrationContext.addListener(wrapper);
+            if (listener != null) {
+                RegistrationListenerWrapper wrapper = new RegistrationListenerWrapper(
+                        layer, appContext, listener);
+                registrationContext.addListener(wrapper);
+            }
             return registrationContext.getProvider();
         }
         return null;

==================================================
