a1f251bffd96408269ba628475ac83f6f1d5a580
==================================================
Remove checks for UnsatisfiedLinkError, now
==================================================
Rainer Jung
==================================================
Mon Sep 4 18:49:35 2017 +0000
==================================================
AprEndpoint.java
Remove checks for UnsatisfiedLinkError, now
that we require tcnative 1.2.14.


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1807282 13f79535-47bb-0310-9956-ffa450edef68



==================================================
OpenSSLConf.java
index b4e9771012..1919159aa2 100644
--- a/java/org/apache/tomcat/util/net/openssl/LocalStrings.properties
+++ b/java/org/apache/tomcat/util/net/openssl/LocalStrings.properties
@@ -27,7 +27,6 @@ openssl.errCheckConf=Error during OpenSSLConf check
 openssl.assignConf=Assigning SSL context to OpenSSLConfCmd context
 openssl.applyConf=Applying OpenSSLConfCmd to SSL context
 openssl.errApplyConf=Could not apply OpenSSLConf to SSL context
-openssl.missingOpenSSLConfSupport=Your tcnative library has no support for OpenSSLConf, version 1.2.13 or higher is required.
 
 opensslconf.checkCommand=OpenSSLConf checking command (name [{0}], value [{1}])
 opensslconf.checkFailed=Failure while checking OpenSSLConf
@@ -37,7 +36,6 @@ opensslconf.failedCommand=OpenSSLConf failed command (name [{0}], value [{1}]) w
 opensslconf.failedFinish=OpenSSLConf finish failed with result [{2}]
 opensslconf.noCommandName=OpenSSLConf no command name - will be ignored (command value [{0}])
 opensslconf.resultCommand=OpenSSLConf command (name [{0}], value [{1}]) returned [{2}]
-opensslconf.missingOpenSSLConfSupport=Your tcnative library has no support for OpenSSLConf, version 1.2.13 or higher is required.
 
 engine.engineClosed=Engine is closed
 engine.renegotiationUnsupported=Renegotiation is not supported

==================================================
OpenSSLContext.java
index adb16b11b4..ef53705edd 100644
--- a/java/org/apache/tomcat/util/net/openssl/OpenSSLConf.java
+++ b/java/org/apache/tomcat/util/net/openssl/OpenSSLConf.java
@@ -59,8 +59,7 @@ public class OpenSSLConf {
             }
             try {
                 rc = SSLConf.check(cctx, name, value);
-            } catch (UnsatisfiedLinkError e) {
-                log.warn(sm.getString("opensslconf.missingOpenSSLConfSupport"), e);
+            } catch (Exception e) {
                 log.error(sm.getString("opensslconf.checkFailed"));
                 return false;
             }
@@ -81,13 +80,7 @@ public class OpenSSLConf {
 
     public boolean apply(long cctx, long ctx) throws Exception {
         boolean result = true;
-        try {
-            SSLConf.assign(cctx, ctx);
-        } catch (UnsatisfiedLinkError e) {
-            log.warn(sm.getString("opensslconf.missingOpenSSLConfSupport"), e);
-            log.error(sm.getString("opensslconf.applyFailed"));
-            return false;
-        }
+        SSLConf.assign(cctx, ctx);
         OpenSSLConfCmd cmd;
         String name;
         String value;
@@ -106,8 +99,7 @@ public class OpenSSLConf {
             }
             try {
                 rc = SSLConf.apply(cctx, name, value);
-            } catch (UnsatisfiedLinkError e) {
-                log.warn(sm.getString("opensslconf.missingOpenSSLConfSupport"), e);
+            } catch (Exception e) {
                 log.error(sm.getString("opensslconf.applyFailed"));
                 return false;
             }
@@ -120,13 +112,7 @@ public class OpenSSLConf {
                         Integer.toString(rc)));
             }
         }
-        try {
-            rc = SSLConf.finish(cctx);
-        } catch (UnsatisfiedLinkError e) {
-            log.warn(sm.getString("opensslconf.missingOpenSSLConfSupport"), e);
-            log.error(sm.getString("opensslconf.applyFailed"));
-            return false;
-        }
+        rc = SSLConf.finish(cctx);
         if (rc <= 0) {
             log.error(sm.getString("opensslconf.finishFailed", Integer.toString(rc)));
             result = false;

==================================================
