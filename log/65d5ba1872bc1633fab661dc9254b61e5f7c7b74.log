65d5ba1872bc1633fab661dc9254b61e5f7c7b74
==================================================
Fix regression in previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43656
==================================================
Mark Emlyn
==================================================
Fri Oct 3 16:19:01 2008 +0000
==================================================
ELSupport.java
Fix regression in previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43656
Patch provided by Nils Eckert.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@701432 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestELSupport.java
index 51e3649902..d65a6b3f61 100644
--- a/java/org/apache/el/lang/ELSupport.java
+++ b/java/org/apache/el/lang/ELSupport.java
@@ -224,18 +224,18 @@ public class ELSupport {
                 return ((BigDecimal) number).toBigInteger();
             }
             if (number instanceof BigInteger) {
-                return new BigInteger(number.toString());
+                return number;
             }
             return BigInteger.valueOf(number.longValue());
         }
         if (BigDecimal.class.equals(type)) {
             if (number instanceof BigDecimal) {
-                return new BigDecimal(number.toString());
+                return number;
             }
             if (number instanceof BigInteger) {
                 return new BigDecimal((BigInteger) number);
             }
-            return new BigDecimal(number.doubleValue());
+            return new BigDecimal(number.toString());
         }
         if (Byte.TYPE == type || Byte.class.equals(type)) {
             return new Byte(number.byteValue());
@@ -341,7 +341,7 @@ public class ELSupport {
     public final static Object coerceToType(final Object obj, final Class type)
             throws IllegalArgumentException {
         if (type == null || Object.class.equals(type) ||
-                (obj != null && type.equals(obj.getClass()))) {
+                (obj != null && type.isAssignableFrom(obj.getClass()))) {
             return obj;
         }
         if (String.class.equals(type)) {
@@ -356,9 +356,6 @@ public class ELSupport {
         if (Boolean.class.equals(type) || Boolean.TYPE == type) {
             return coerceToBoolean(obj);
         }
-        if (obj != null && type.isAssignableFrom(obj.getClass())) {
-            return obj;
-        }
         if (type.isEnum()) {
             return coerceToEnum(obj, type);
         }

==================================================
