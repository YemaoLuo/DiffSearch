1cddae8da4ecb4ac04575d3b5fba2daa2e0c8ead
==================================================
Correct calculation of payload length when using 4 or more bytes
==================================================
Mark Thomas
==================================================
Mon Jun 29 15:08:25 2020 +0100
==================================================
WsFrameBase.java
Correct calculation of payload length when using 4 or more bytes



==================================================
TestWsFrame.java
index ba5813bc27..a5d2aaa051 100644
--- a/java/org/apache/tomcat/websocket/WsFrameBase.java
+++ b/java/org/apache/tomcat/websocket/WsFrameBase.java
@@ -678,7 +678,7 @@ public abstract class WsFrameBase {
         int shift = 0;
         long result = 0;
         for (int i = start + len - 1; i >= start; i--) {
-            result = result + ((b[i] & 0xFF) << shift);
+            result = result + ((b[i] & 0xFFL) << shift);
             shift += 8;
         }
         return result;

==================================================
