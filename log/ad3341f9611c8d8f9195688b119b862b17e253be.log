ad3341f9611c8d8f9195688b119b862b17e253be
==================================================
Aligning the readMessage() method implementation and the read() method signature between BIO and NIo to aid future refactoring
==================================================
Mark Emlyn
==================================================
Mon Sep 2 13:17:26 2013 +0000
==================================================
AjpNioProcessor.java
Aligning the readMessage() method implementation and the read() method signature between BIO and NIo to aid future refactoring

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1519431 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpProcessor.java
index 5da4fc85d6..89e671f0ea 100644
--- a/java/org/apache/coyote/ajp/AjpNioProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpNioProcessor.java
@@ -141,7 +141,7 @@ public class AjpNioProcessor extends AbstractAjpProcessor<NioChannel> {
     /**
      * Read the specified amount of bytes, and place them in the input buffer.
      */
-    protected int read(byte[] buf, int pos, int n, boolean blockFirstRead)
+    protected boolean read(byte[] buf, int pos, int n, boolean blockFirstRead)
         throws IOException {
 
         int read = 0;
@@ -153,13 +153,13 @@ public class AjpNioProcessor extends AbstractAjpProcessor<NioChannel> {
             if (res > 0) {
                 read += res;
             } else if (res == 0 && !block) {
-                break;
+                return false;
             } else {
                 throw new IOException(sm.getString("ajpprocessor.failedread"));
             }
             block = true;
         }
-        return read;
+        return true;
     }
 
 
@@ -205,13 +205,6 @@ public class AjpNioProcessor extends AbstractAjpProcessor<NioChannel> {
     }
 
 
-    /**
-     * Read an AJP message.
-     *
-     * @return <code>true</code> if a message was read, otherwise false
-     *
-     * @throws IOException any other failure, including incomplete reads
-     */
     @Override
     protected boolean readMessage(AjpMessage message, boolean blockFirstRead)
         throws IOException {
@@ -219,9 +212,7 @@ public class AjpNioProcessor extends AbstractAjpProcessor<NioChannel> {
         byte[] buf = message.getBuffer();
         int headerLength = message.getHeaderLength();
 
-        int bytesRead = read(buf, 0, headerLength, blockFirstRead);
-
-        if (bytesRead == 0) {
+        if (!read(buf, 0, headerLength, blockFirstRead)) {
             return false;
         }
 

==================================================
