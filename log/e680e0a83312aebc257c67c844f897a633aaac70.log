e680e0a83312aebc257c67c844f897a633aaac70
==================================================
Add deprecated constructors
==================================================
remm remm@apache.org
==================================================
Tue Jan 14 09:39:11 2020 +0100
==================================================
AuthenticatorBase.java
Add deprecated constructors

Also add a new constructor with only the principal name. Resolve
ambiguous calls from (name, null, null) to (name). Revert
cb791c14e5760247a0bfd585b67a48e2494e4323.
This will not give 100% compatibility with custom realms for Tomcat 9,
but once the ambiguous calls are resolved it is possible to have code
compatible with both branches.


==================================================
AuthenticatedUserRealm.java
index 4fc5d56921..00a02a884e 100644
--- a/java/org/apache/catalina/authenticator/AuthenticatorBase.java
+++ b/java/org/apache/catalina/authenticator/AuthenticatorBase.java
@@ -1024,7 +1024,7 @@ public abstract class AuthenticatorBase extends ValveBase
                     if (log.isDebugEnabled()) {
                         log.debug(sm.getString("authenticator.check.authorizeFail", username));
                     }
-                    authorized = new GenericPrincipal(username, null, null);
+                    authorized = new GenericPrincipal(username);
                 }
                 String authType = request.getAuthType();
                 if (authType == null || authType.length() == 0) {

==================================================
GenericPrincipal.java
index 96abe6ce05..ab6c4b9c9e 100644
--- a/java/org/apache/catalina/realm/AuthenticatedUserRealm.java
+++ b/java/org/apache/catalina/realm/AuthenticatedUserRealm.java
@@ -41,6 +41,6 @@ public class AuthenticatedUserRealm extends RealmBase {
     protected Principal getPrincipal(String username) {
         // The authentication mechanism has authenticated the user so create
         // the Principal directly
-        return new GenericPrincipal(username, null, null);
+        return new GenericPrincipal(username);
     }
 }

==================================================
JAASMemoryLoginModule.java
index 1c29f5cd94..560b123556 100644
--- a/java/org/apache/catalina/realm/GenericPrincipal.java
+++ b/java/org/apache/catalina/realm/GenericPrincipal.java
@@ -39,6 +39,16 @@ public class GenericPrincipal implements TomcatPrincipal, Serializable {
 
     // ----------------------------------------------------------- Constructors
 
+    /**
+     * Construct a new Principal, associated with the specified Realm, for the
+     * specified username, with no roles.
+     *
+     * @param name The username of the user represented by this Principal
+     */
+    public GenericPrincipal(String name) {
+        this(name, null);
+    }
+
     /**
      * Construct a new Principal, associated with the specified Realm, for the
      * specified username, with the specified role names (as Strings).
@@ -50,6 +60,11 @@ public class GenericPrincipal implements TomcatPrincipal, Serializable {
         this(name, roles, null);
     }
 
+    @Deprecated
+    public GenericPrincipal(String name, String password, List<String> roles) {
+        this(name, roles, null);
+    }
+
     /**
      * Construct a new Principal, associated with the specified Realm, for the
      * specified username, with the specified role names (as Strings).
@@ -64,6 +79,12 @@ public class GenericPrincipal implements TomcatPrincipal, Serializable {
         this(name, roles, userPrincipal, null);
     }
 
+    @Deprecated
+    public GenericPrincipal(String name, String password, List<String> roles,
+            Principal userPrincipal) {
+        this(name, roles, userPrincipal, null);
+    }
+
     /**
      * Construct a new Principal, associated with the specified Realm, for the
      * specified username, with the specified role names (as Strings).
@@ -80,6 +101,12 @@ public class GenericPrincipal implements TomcatPrincipal, Serializable {
         this(name, roles, userPrincipal, loginContext, null);
     }
 
+    @Deprecated
+    public GenericPrincipal(String name, String password, List<String> roles,
+            Principal userPrincipal, LoginContext loginContext) {
+        this(name, roles, userPrincipal, loginContext, null);
+    }
+
     /**
      * Construct a new Principal, associated with the specified Realm, for the
      * specified username, with the specified role names (as Strings).
@@ -111,6 +138,14 @@ public class GenericPrincipal implements TomcatPrincipal, Serializable {
     }
 
 
+    @Deprecated
+    public GenericPrincipal(String name, String password, List<String> roles,
+            Principal userPrincipal, LoginContext loginContext,
+            GSSCredential gssCredential) {
+        this(name, roles, userPrincipal, loginContext, gssCredential);
+    }
+
+
     // -------------------------------------------------------------- Properties
 
     /**

==================================================
