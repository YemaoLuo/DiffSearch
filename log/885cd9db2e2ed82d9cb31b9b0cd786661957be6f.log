885cd9db2e2ed82d9cb31b9b0cd786661957be6f
==================================================
The single quote replacement code has never been quite right. Add some unit tests and use a regexp that better handles the various edge cases
==================================================
Mark Thomas
==================================================
Mon Dec 10 09:28:46 2018 +0000
==================================================
Utils.java
The single quote replacement code has never been quite right. Add some unit tests and use a regexp that better handles the various edge cases

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1848558 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestUtils.java
index 528e7915c9..9a5f5d7bc3 100644
--- a/java/org/apache/tomcat/buildutil/translate/Utils.java
+++ b/java/org/apache/tomcat/buildutil/translate/Utils.java
@@ -29,7 +29,7 @@ public class Utils {
 
     private static final Pattern ADD_CONTINUATION = Pattern.compile("\\n", Pattern.MULTILINE);
     private static final Pattern ESCAPE_LEADING_SPACE = Pattern.compile("^(\\s)", Pattern.MULTILINE);
-    private static final Pattern FIX_SINGLE_QUOTE = Pattern.compile("([^'])'([^'])", Pattern.MULTILINE);
+    private static final Pattern FIX_SINGLE_QUOTE = Pattern.compile("(?<!')'(?!')", Pattern.MULTILINE);
 
     private Utils() {
         // Utility class. Hide default constructor.
@@ -66,7 +66,7 @@ public class Utils {
         }
 
         if (result.contains("[{0}]")) {
-            result = FIX_SINGLE_QUOTE.matcher(result).replaceAll("$1''$2");
+            result = FIX_SINGLE_QUOTE.matcher(result).replaceAll("''");
         }
         return result;
     }

==================================================
