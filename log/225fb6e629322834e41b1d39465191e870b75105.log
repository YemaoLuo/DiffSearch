225fb6e629322834e41b1d39465191e870b75105
==================================================
FindBugs: Fix unused code by implementing the TODO associated with it
==================================================
Mark Emlyn
==================================================
Thu Aug 16 21:50:44 2012 +0000
==================================================
Response.java
FindBugs: Fix unused code by implementing the TODO associated with it

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1374073 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index 87c1d5153e..4a7b47708b 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -51,6 +51,7 @@ import org.apache.tomcat.util.buf.CharChunk;
 import org.apache.tomcat.util.buf.UEncoder;
 import org.apache.tomcat.util.http.FastHttpDateFormat;
 import org.apache.tomcat.util.http.MimeHeaders;
+import org.apache.tomcat.util.http.ResponseUtil;
 import org.apache.tomcat.util.http.ServerCookie;
 import org.apache.tomcat.util.http.parser.AstMediaType;
 import org.apache.tomcat.util.http.parser.HttpParser;
@@ -1023,8 +1024,8 @@ public class Response
     /**
      * An extended version of this exists in {@link org.apache.coyote.Response}.
      * This check is required here to ensure that the usingWriter checks in
-     * {@link #setContentType(String)} are applied since usingWriter is not
-     * visible to {@link org.apache.coyote.Response}
+     * {@link #setContentType(String)} and {@link #setLocale(Locale) are applied
+     * since usingWriter is not visible to {@link org.apache.coyote.Response}
      *
      * Called from set/addHeader.
      * Return true if the header is special, no need to set the header.
@@ -1034,6 +1035,15 @@ public class Response
             setContentType(value);
             return true;
         }
+        if (name.equalsIgnoreCase("Content-Language")) {
+            Locale locale = ResponseUtil.getLocaleFromLanguageHeader(value);
+            if (locale == null) {
+                return false;
+            } else {
+                setLocale(locale);
+                return true;
+            }
+        }
         return false;
     }
 

==================================================
ResponseUtil.java
index 975d905684..b237c9fdb0 100644
--- a/java/org/apache/coyote/Response.java
+++ b/java/org/apache/coyote/Response.java
@@ -26,6 +26,7 @@ import javax.servlet.WriteListener;
 import org.apache.coyote.http11.AbstractOutputBuffer;
 import org.apache.tomcat.util.buf.ByteChunk;
 import org.apache.tomcat.util.http.MimeHeaders;
+import org.apache.tomcat.util.http.ResponseUtil;
 import org.apache.tomcat.util.http.parser.AstMediaType;
 import org.apache.tomcat.util.http.parser.HttpParser;
 import org.apache.tomcat.util.http.parser.ParseException;
@@ -342,8 +343,14 @@ public final class Response {
                 return false;
             }
         }
-        if( name.equalsIgnoreCase( "Content-Language" ) ) {
-            // XXX XXX Need to construct Locale or something else
+        if (name.equalsIgnoreCase("Content-Language")) {
+            Locale locale = ResponseUtil.getLocaleFromLanguageHeader(value);
+            if (locale == null) {
+                return false;
+            } else {
+                setLocale(locale);
+                return true;
+            }
         }
         return false;
     }

==================================================
