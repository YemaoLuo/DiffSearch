41b76370b2bcd373f521fe4637e02a45edd20f98
==================================================
Fix an edge case spotted while testing other functionality.
==================================================
Mark Emlyn
==================================================
Thu Dec 12 21:41:11 2013 +0000
==================================================
HostConfig.java
Fix an edge case spotted while testing other functionality.
If a context.xml file is added to a DIR it was always ignored. It will now trigger a redeploy.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1550541 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestHostConfigAutomaticDeployment.java
index dfc2d60a68..382bcbf247 100644
--- a/java/org/apache/catalina/startup/HostConfig.java
+++ b/java/org/apache/catalina/startup/HostConfig.java
@@ -1168,6 +1168,11 @@ public class HostConfig
                 deployedApp.redeployResources.put(
                         xmlCopy.getAbsolutePath(),
                         Long.valueOf(0));
+                if (!xml.exists()) {
+                    deployedApp.redeployResources.put(
+                            xml.getAbsolutePath(),
+                            Long.valueOf(0));
+                }
             }
             addWatchedResources(deployedApp, dir.getAbsolutePath(), context);
             // Add the global redeploy resources (which are never deleted) at

==================================================
