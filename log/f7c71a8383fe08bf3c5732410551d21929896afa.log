f7c71a8383fe08bf3c5732410551d21929896afa
==================================================
Remove unnecessary ActionCode.SET_READ_LISTENER
==================================================
Mark Emlyn
==================================================
Mon Apr 29 19:49:24 2013 +0000
==================================================
InputBuffer.java
Remove unnecessary ActionCode.SET_READ_LISTENER
Add missing tests when setting a non-blocking ReadListener and use i18n for all exception messages if a test fails

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1477301 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ActionCode.java
index debbbcf7b4..64272c9db4 100644
--- a/java/org/apache/catalina/connector/LocalStrings.properties
+++ b/java/org/apache/catalina/connector/LocalStrings.properties
@@ -13,10 +13,12 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+cometEvent.nullRequest=The event object has been recycled and is no longer associated with a request
+
+coyoteAdapter.parsePathParam=Unable to parse the path parameters using encoding [{0}]. The path parameters in the URL will be ignored.
+coyoteAdapter.debug=The variable [{0}] has value [{1}]
+coyoteAdapter.accesslogFail=Exception while attempting to add an entry to the access log
 
-#
-# CoyoteConnector
-#
 coyoteConnector.invalidPort=The connector cannot start since the specified port value of [{0}] is invalid
 coyoteConnector.protocolHandlerDestroyFailed=Protocol handler destroy failed
 coyoteConnector.protocolHandlerInitializationFailed=Protocol handler initialization failed
@@ -27,28 +29,9 @@ coyoteConnector.protocolHandlerPauseFailed=Protocol handler pause failed
 coyoteConnector.protocolHandlerResumeFailed=Protocol handler resume failed
 coyoteConnector.parseBodyMethodNoTrace=TRACE method MUST NOT include an entity (see RFC 2616 Section 9.6)
 
-#
-# CoyoteAdapter
-#
-coyoteAdapter.parsePathParam=Unable to parse the path parameters using encoding [{0}]. The path parameters in the URL will be ignored.
-coyoteAdapter.debug=The variable [{0}] has value [{1}]
-coyoteAdapter.accesslogFail=Exception while attempting to add an entry to the access log
-
-#
-# CoyoteResponse
-#
-coyoteResponse.getOutputStream.ise=getWriter() has already been called for this response
-coyoteResponse.getWriter.ise=getOutputStream() has already been called for this response
-coyoteResponse.reset.ise=Cannot call reset() after response has been committed
-coyoteResponse.resetBuffer.ise=Cannot reset buffer after response has been committed
-coyoteResponse.sendError.ise=Cannot call sendError() after the response has been committed
-coyoteResponse.sendRedirect.ise=Cannot call sendRedirect() after the response has been committed
-coyoteResponse.sendRedirect.note=<html><body><p>Redirecting to <a href="{0}">{0}</a></p></body></html>
-coyoteResponse.setBufferSize.ise=Cannot change buffer size after data has been written
+inputBuffer.listenerSet=The non-blocking read listener has already been set
+inputBuffer.nullListener=The listener passed to setReadListener() may not be null
 
-#
-# CoyoteRequest
-#
 coyoteRequest.getInputStream.ise=getReader() has already been called for this request
 coyoteRequest.getReader.ise=getInputStream() has already been called for this request
 coyoteRequest.sessionCreateCommitted=Cannot create a session after the response has been committed
@@ -65,10 +48,20 @@ coyoteRequest.sessionEndAccessFail=Exception triggered ending access to session
 coyoteRequest.sendfileNotCanonical=Unable to determine canonical name of file [{0}] specified for use with sendfile
 coyoteRequest.maxPostSizeExceeded=The multi-part request contained parameter data (excluding uploaded files) that exceeded the limit for maxPostSize set on the associated connector
 
-requestFacade.nullRequest=The request object has been recycled and is no longer associated with this facade
+coyoteResponse.getOutputStream.ise=getWriter() has already been called for this response
+coyoteResponse.getWriter.ise=getOutputStream() has already been called for this response
+coyoteResponse.reset.ise=Cannot call reset() after response has been committed
+coyoteResponse.resetBuffer.ise=Cannot reset buffer after response has been committed
+coyoteResponse.sendError.ise=Cannot call sendError() after the response has been committed
+coyoteResponse.sendRedirect.ise=Cannot call sendRedirect() after the response has been committed
+coyoteResponse.sendRedirect.note=<html><body><p>Redirecting to <a href="{0}">{0}</a></p></body></html>
+coyoteResponse.setBufferSize.ise=Cannot change buffer size after data has been written
 
-responseFacade.nullResponse=The response object has been recycled and is no longer associated with this facade
+inputBuffer.listenerSet=The non-blocking read listener has already been set
+inputBuffer.notAsync=It is only valid to switch to non-blocking IO within async processing or HTTP upgrade processing
+inputBuffer.nullListener=The listener passed to setReadListener() may not be null
+inputBuffer.streamClosed=Stream closed
 
-cometEvent.nullRequest=The event object has been recycled and is no longer associated with a request
+requestFacade.nullRequest=The request object has been recycled and is no longer associated with this facade
 
-inputBuffer.streamClosed=Stream closed
+responseFacade.nullResponse=The response object has been recycled and is no longer associated with this facade

==================================================
Http11NioProcessor.java
index 3380eab220..8557dbdaca 100644
--- a/java/org/apache/coyote/ActionCode.java
+++ b/java/org/apache/coyote/ActionCode.java
@@ -205,11 +205,6 @@ public enum ActionCode {
      */
     UPGRADE,
 
-    /**
-     * Callback to trigger setting the ReadListener
-     */
-    SET_READ_LISTENER,
-
     /**
      * Callback to trigger setting the WriteListener
      */

==================================================
