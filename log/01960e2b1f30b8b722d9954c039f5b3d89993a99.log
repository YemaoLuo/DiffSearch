01960e2b1f30b8b722d9954c039f5b3d89993a99
==================================================
Fixed https://bz.apache.org/bugzilla/show_bug.cgi?id=62032
==================================================
Coty Sutherland
==================================================
Wed Jan 24 19:45:00 2018 +0000
==================================================
AbstractJsseEndpoint.java
Fixed https://bz.apache.org/bugzilla/show_bug.cgi?id=62032
Fix NullPointerException when certificateFile is not defined on an SSLHostConfig and unify the behavior when a certificateFile is defined but the file does not exist for both JKS and PEM file types.

I also fixed one TODO in SSLHostConfig and changed how the IllegalArgumentException is thrown in AbstractJsseEndpoint so that it's message is consistent with other logging messages.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1822150 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SSLHostConfig.java
index cb8f59a92a..b344e884ae 100644
--- a/java/org/apache/tomcat/util/net/LocalStrings.properties
+++ b/java/org/apache/tomcat/util/net/LocalStrings.properties
@@ -146,6 +146,7 @@ sslHostConfig.prefix_missing=The protocol [{0}] was added to the list of protoco
 sslHostConfigCertificate.mismatch=The property [{0}] was set on the SSLHostConfigCertificate named [{1}] and is for certificate storage type [{2}] but the certificate is being used with a storage of type [{3}]
 sslHostConfig.opensslconf.null=Attempt to set null OpenSSLConf ignored
 sslHostConfig.opensslconf.alreadyset=Attempt to set another OpenSSLConf ignored
+sslHostConfig.fileNotFound=Configured file [{0}] does not exist
 
 sslImplementation.cnfe= Unable to create SSLImplementation for class [{0}]
 

==================================================
SSLUtilBase.java
index 73f687942f..c11b31ab5d 100644
--- a/java/org/apache/tomcat/util/net/SSLHostConfig.java
+++ b/java/org/apache/tomcat/util/net/SSLHostConfig.java
@@ -17,6 +17,7 @@
 package org.apache.tomcat.util.net;
 
 import java.io.File;
+import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.io.Serializable;
 import java.security.KeyStore;
@@ -824,7 +825,7 @@ public class SSLHostConfig implements Serializable {
 
     // --------------------------------------------------------- Support methods
 
-    public static String adjustRelativePath(String path) {
+    public static String adjustRelativePath(String path) throws FileNotFoundException {
         // Empty or null path can't point to anything useful. The assumption is
         // that the value is deliberately empty / null so leave it that way.
         if (path == null || path.length() == 0) {
@@ -837,8 +838,7 @@ public class SSLHostConfig implements Serializable {
             f = new File(newPath);
         }
         if (!f.exists()) {
-            // TODO i18n, sm
-            log.warn("configured file:["+newPath+"] does not exist.");
+            throw new FileNotFoundException(sm.getString("sslHostConfig.fileNotFound", newPath));
         }
         return newPath;
     }

==================================================
JSSEUtil.java
index 08dff571cc..f72b52b696 100644
--- a/java/org/apache/tomcat/util/net/SSLUtilBase.java
+++ b/java/org/apache/tomcat/util/net/SSLUtilBase.java
@@ -138,8 +138,6 @@ public abstract class SSLUtilBase implements SSLUtil {
             }
             ks.load(istream, storePass);
         } catch (FileNotFoundException fnfe) {
-            log.error(sm.getString("jsse.keystore_load_failed", type, path,
-                    fnfe.getMessage()), fnfe);
             throw fnfe;
         } catch (IOException ioe) {
             // May be expected when working with a trust store

==================================================
