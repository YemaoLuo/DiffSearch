eea2b53224d0652bace6d52146d92fb24abdf68d
==================================================
Add "denyStatus" attribute to RequestFilterValve, RequestFilter.
==================================================
Konstantin Kolinko
==================================================
Wed Nov 16 07:49:06 2011 +0000
==================================================
RequestFilter.java
Add "denyStatus" attribute to RequestFilterValve, RequestFilter.
Add overridable denyRequest() method to RequestFilterValve.
The denyStatus attribute is used to change HTTP status code that is used when rejecting denied request.
E.g. to be 404 instead of default 403.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1202565 13f79535-47bb-0310-9956-ffa450edef68



==================================================
RequestFilterValve.java
index 83afa761b6..e6c79ddb01 100644
--- a/java/org/apache/catalina/filters/RequestFilter.java
+++ b/java/org/apache/catalina/filters/RequestFilter.java
@@ -70,6 +70,12 @@ public abstract class RequestFilter extends FilterBase implements CometFilter {
      */
     protected Pattern deny = null;
 
+    /**
+     * The HTTP response status code that is used when rejecting denied
+     * request. It is 403 by default, but may be changed to be 404.
+     */
+    protected int denyStatus = HttpServletResponse.SC_FORBIDDEN;
+
     /**
      * mime type -- "text/plain"
      */
@@ -133,6 +139,22 @@ public abstract class RequestFilter extends FilterBase implements CometFilter {
     }
 
 
+    /**
+     * Return response status code that is used to reject denied request.
+     */
+    public int getDenyStatus() {
+        return denyStatus;
+    }
+
+
+    /**
+     * Set response status code that is used to reject denied request.
+     */
+    public void setDenyStatus(int denyStatus) {
+        this.denyStatus = denyStatus;
+    }
+
+
     // --------------------------------------------------------- Public Methods
 
 
@@ -183,8 +205,7 @@ public abstract class RequestFilter extends FilterBase implements CometFilter {
             chain.doFilter(request, response);
         } else {
             if (response instanceof HttpServletResponse) {
-                ((HttpServletResponse) response)
-                        .sendError(HttpServletResponse.SC_FORBIDDEN);
+                ((HttpServletResponse) response).sendError(denyStatus);
             } else {
                 sendErrorWhenNotHttp(response);
             }
@@ -209,7 +230,7 @@ public abstract class RequestFilter extends FilterBase implements CometFilter {
         if (isAllowed(property)) {
             chain.doFilterEvent(event);
         } else {
-            response.sendError(HttpServletResponse.SC_FORBIDDEN);
+            response.sendError(denyStatus);
             event.close();
         }
     }

==================================================
