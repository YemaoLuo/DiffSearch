2b87b7d95750063b68b2cc687c428629c2221e3f
==================================================
WebSocket 1.0. Section 4.1.1
==================================================
Mark Emlyn
==================================================
Tue Jun 25 10:19:54 2013 +0000
==================================================
WsServerContainer.java
index f308cdacf8..c565c54ae7 100644
--- a/java/org/apache/tomcat/websocket/server/LocalStrings.properties
+++ b/java/org/apache/tomcat/websocket/server/LocalStrings.properties
@@ -15,6 +15,7 @@
 sci.newInstance.fail=Failed to create an Endpoint instance of type [{0}]
 
 serverContainer.configuratorFail=Failed to create configurator of type [{0}] for POJO of type [{1}]
+serverContainer.duplicatePaths=Multiple Endpoints may not be deployed to using the same path [{0}]
 serverContainer.endpointDeploy=Endpoint class [{0}] deploying to path [{1}] in ServletContext [{2}]
 serverContainer.missingAnnotation=Cannot deploy POJO class [{0}] as it is not annotated with @ServerEndpoint
 serverContainer.missingEndpoint=An Endpoint instance has been request for path [{0}] but no matching Endpoint class was found

==================================================
TestWsServerContainer.java
index 14b56250bd..89f6591af8 100644
--- a/java/org/apache/tomcat/websocket/server/WsServerContainer.java
+++ b/java/org/apache/tomcat/websocket/server/WsServerContainer.java
@@ -148,10 +148,19 @@ public class WsServerContainer extends WsWebSocketContainer
                         TemplatePathMatchComparator.getInstance());
                 configTemplateMatchMap.put(key, templateMatches);
             }
-            templateMatches.add(new TemplatePathMatch(sec, uriTemplate));
+            if (!templateMatches.add(new TemplatePathMatch(sec, uriTemplate))) {
+                // Duplicate uriTemplate;
+                throw new DeploymentException(
+                        sm.getString("serverContainer.duplicatePaths", path));
+            }
         } else {
             // Exact match
-            configExactMatchMap.put(path, sec);
+            ServerEndpointConfig old = configExactMatchMap.put(path, sec);
+            if (old != null) {
+                // Duplicate path mappings
+                throw new DeploymentException(
+                        sm.getString("serverContainer.duplicatePaths", path));
+            }
         }
     }
 

==================================================
