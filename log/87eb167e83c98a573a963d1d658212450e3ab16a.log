87eb167e83c98a573a963d1d658212450e3ab16a
==================================================
Add test for size of leftover buffer and increase buffer size to support more character sets
==================================================
Mark Emlyn
==================================================
Thu Feb 28 22:37:14 2013 +0000
==================================================
B2CConverter.java
Add test for size of leftover buffer and increase buffer size to support more character sets

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1451408 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestB2CConverter.java
index 0ece9ce2f2..c27ef07691 100644
--- a/java/org/apache/tomcat/util/buf/B2CConverter.java
+++ b/java/org/apache/tomcat/util/buf/B2CConverter.java
@@ -43,6 +43,9 @@ public class B2CConverter {
     public static final Charset ISO_8859_1;
     public static final Charset UTF_8;
 
+    // Protected so unit tests can use it
+    protected static final int LEFTOVER_SIZE = 9;
+
     static {
         for (Charset charset: Charset.availableCharsets().values()) {
             encodingToCharsetCache.put(
@@ -100,7 +103,7 @@ public class B2CConverter {
     private final ByteBuffer leftovers;
 
     public B2CConverter(String encoding) throws IOException {
-        byte[] left = new byte[4];
+        byte[] left = new byte[LEFTOVER_SIZE];
         leftovers = ByteBuffer.wrap(left);
         decoder = getCharset(encoding).newDecoder();
     }

==================================================
