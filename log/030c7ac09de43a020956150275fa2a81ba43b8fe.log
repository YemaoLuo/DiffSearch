030c7ac09de43a020956150275fa2a81ba43b8fe
==================================================
Revert back to original patch proposed for UTF8 parsing.
==================================================
Filip Hanik
==================================================
Wed Feb 27 20:12:18 2008 +0000
==================================================
InputBuffer.java
Revert back to original patch proposed for UTF8 parsing.
This also fixes the regression for 6.0.16 and 5.5.26 (and possibly 4.1.37) mentioned in 
http://issues.apache.org/bugzilla/show_bug.cgi?id=44494

The original patch can be viewed
http://svn.apache.org/viewvc?rev=568307&view=rev
http://svn.apache.org/viewvc?rev=568605&view=rev



git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@631700 13f79535-47bb-0310-9956-ffa450edef68



==================================================
B2CConverter.java
index f989ce61c9..d6f19394e9 100644
--- a/java/org/apache/catalina/connector/InputBuffer.java
+++ b/java/org/apache/catalina/connector/InputBuffer.java
@@ -354,9 +354,9 @@ public class InputBuffer extends Reader
             cb.setEnd(0);
         }
 
-        state = CHAR_STATE;
-        conv.convert(bb, cb, len);
+        conv.convert(bb, cb);
         bb.setOffset(bb.getEnd());
+        state = CHAR_STATE;
 
         return cb.getLength();
 

==================================================
