c2d9e7a99b26b0873cce9ab78c68e074403ed3b0
==================================================
Fix possible NPE
==================================================
Mark Emlyn
==================================================
Wed Feb 25 15:46:46 2009 +0000
==================================================
DataSourceRealm.java
Fix possible NPE

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@747834 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JDBCRealm.java
index 9288ff7659..c6ec6e93ae 100644
--- a/java/org/apache/catalina/realm/DataSourceRealm.java
+++ b/java/org/apache/catalina/realm/DataSourceRealm.java
@@ -270,8 +270,9 @@ public class DataSourceRealm
      */
     public Principal authenticate(String username, String credentials) {
     	
-    	// No user - can't possibly authenticate, don't bother the database then
-    	if (username == null) {
+    	// No user or no credentials
+        // Can't possibly authenticate, don't bother the database then
+    	if (username == null || credentials == null) {
     		return null;
     	}
         

==================================================
MemoryRealm.java
index 7cd17d0a0a..05fd1fa888 100644
--- a/java/org/apache/catalina/realm/JDBCRealm.java
+++ b/java/org/apache/catalina/realm/JDBCRealm.java
@@ -393,9 +393,10 @@ public class JDBCRealm
                                                String username,
                                                String credentials) {
 
-        // No user - can't possibly authenticate
-        if (username == null) {
-            return (null);
+        // No user or no credentials
+        // Can't possibly authenticate, don't bother the database then
+        if (username == null || credentials == null) {
+            return null;
         }
 
         // Look up the user's credentials

==================================================
