67a6d0ead4861c15d15a337aee9821eef643d7ec
==================================================
Spotbugs fixes (rank >=16) in tribes.io
==================================================
Mark Thomas
==================================================
Sat Dec 2 20:38:36 2017 +0000
==================================================
ChannelData.java
Spotbugs fixes (rank >=16) in tribes.io

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1816984 13f79535-47bb-0310-9956-ffa450edef68



==================================================
XByteBuffer.java
index 885c696b1f..53588fe02c 100644
--- a/java/org/apache/catalina/tribes/io/ChannelData.java
+++ b/java/org/apache/catalina/tribes/io/ChannelData.java
@@ -302,15 +302,17 @@ public class ChannelData implements ChannelMessage {
      * @return ClusterData
      */
     @Override
-    public Object clone() {
-//        byte[] d = this.getDataPackage();
-//        return ClusterData.getDataFromPackage(d);
-        ChannelData clone = new ChannelData(false);
-        clone.options = this.options;
-        clone.message = new XByteBuffer(this.message.getBytesDirect(),false);
-        clone.timestamp = this.timestamp;
-        clone.uniqueId = this.uniqueId;
-        clone.address = this.address;
+    public ChannelData clone() {
+        ChannelData clone;
+        try {
+            clone = (ChannelData) super.clone();
+        } catch (CloneNotSupportedException e) {
+            // Cannot happen
+            throw new AssertionError();
+        }
+        if (this.message != null) {
+            clone.message = new XByteBuffer(this.message.getBytesDirect(),false);
+        }
         return clone;
     }
 

==================================================
TestChannelData.java
index 7f86682110..08c1a21a46 100644
--- a/java/org/apache/catalina/tribes/io/XByteBuffer.java
+++ b/java/org/apache/catalina/tribes/io/XByteBuffer.java
@@ -47,7 +47,9 @@ import org.apache.juli.logging.LogFactory;
  * <li><b>END_DATA</b>  - 7 bytes - <i>TLF2003</i></li>
  * </ul>
  */
-public class XByteBuffer {
+public class XByteBuffer implements Serializable {
+
+    private static final long serialVersionUID = 1L;
 
     private static final Log log = LogFactory.getLog(XByteBuffer.class);
     protected static final StringManager sm = StringManager.getManager(XByteBuffer.class);

==================================================
