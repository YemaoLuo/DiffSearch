97cefcccebd1b57fd382a79e75b0d99b01eebafa
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52777
==================================================
Mark Emlyn
==================================================
Sat Sep 8 21:00:32 2012 +0000
==================================================
Host.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52777
Implement optional automatic removal of old applications where parallel deployment has been used.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1382366 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardHost.java
index 6146250c9b..2f7129263a 100644
--- a/java/org/apache/catalina/Host.java
+++ b/java/org/apache/catalina/Host.java
@@ -210,6 +210,22 @@ public interface Host extends Container {
     public void setCreateDirs(boolean createDirs);
 
 
+    /**
+     * Returns true of the Host is configured to automatically undeploy old
+     * versions of applications deployed using parallel deployment. This only
+     * takes effect is {@link #getAutoDeploy()} also returns true.
+     */
+    public boolean getUndeployOldVersions();
+
+
+    /**
+     * Set to true if the Host should automatically undeploy old versions of
+     * applications deployed using parallel deployment. This only takes effect
+     * if {@link #getAutoDeploy()} returns true.
+     */
+    public void setUndeployOldVersions(boolean undeployOldVersions);
+
+
     // --------------------------------------------------------- Public Methods
 
     /**

==================================================
HostConfig.java
index b6001d2578..e2755e3aac 100644
--- a/java/org/apache/catalina/core/mbeans-descriptors.xml
+++ b/java/org/apache/catalina/core/mbeans-descriptors.xml
@@ -1181,6 +1181,10 @@
                type="java.lang.String"
                writeable="false"/>
 
+    <attribute name="undeployOldVersions"
+               description="Determines if old versions of applications deployed using parallel deployment are automatically undeployed when no longer used. Requires autoDeploy to be enabled."
+               type="boolean"/>
+
     <attribute name="unpackWARs"
                description="Unpack WARs property"
                is="true"

==================================================
