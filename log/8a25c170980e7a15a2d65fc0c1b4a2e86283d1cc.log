8a25c170980e7a15a2d65fc0c1b4a2e86283d1cc
==================================================
- Fix apparent bad cut & paste from the HTTP connector for parseHost, and use the code from the org.apache.jk connector instead.
==================================================
Remy Maucherat
==================================================
Tue Feb 10 13:33:58 2009 +0000
==================================================
AjpAprProcessor.java
- Fix apparent bad cut & paste from the HTTP connector for parseHost, and use the code from the org.apache.jk connector instead.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@742962 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpProcessor.java
index 5e977127fa..14bcd9fcfb 100644
--- a/java/org/apache/coyote/ajp/AjpAprProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpAprProcessor.java
@@ -848,9 +848,13 @@ public class AjpAprProcessor implements ActionHook {
 
         if (valueMB == null || (valueMB != null && valueMB.isNull()) ) {
             // HTTP/1.0
-            // Default is what the socket tells us. Overriden if a host is
-            // found/parsed
-            request.setServerPort(endpoint.getPort());
+            request.setServerPort(request.getLocalPort());
+            try {
+                request.serverName().duplicate(request.localName());
+            } catch (IOException e) {
+                response.setStatus(400);
+                error = true;
+            }
             return;
         }
 

==================================================
