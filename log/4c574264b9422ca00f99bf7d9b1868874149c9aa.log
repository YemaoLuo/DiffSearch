4c574264b9422ca00f99bf7d9b1868874149c9aa
==================================================
Calls to associate need to trigger a Map update as well
==================================================
Mark Thomas
==================================================
Fri Dec 19 13:54:47 2014 +0000
==================================================
SingleSignOn.java
Calls to associate need to trigger a Map update as well

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1646720 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ClusterSingleSignOn.java
index 9b873c2c3b..57523bb67b 100644
--- a/java/org/apache/catalina/authenticator/SingleSignOn.java
+++ b/java/org/apache/catalina/authenticator/SingleSignOn.java
@@ -354,18 +354,24 @@ public class SingleSignOn extends ValveBase implements SessionListener {
      *
      * @param ssoId Single sign on identifier
      * @param session Session to be associated
+     *
+     * @return <code>true</code> if the session was associated to the given SSO
+     *         session, otherwise <code>false</code>
      */
-    protected void associate(String ssoId, Session session) {
+    protected boolean associate(String ssoId, Session session) {
 
         if (containerLog.isDebugEnabled()) {
             containerLog.debug("Associate sso id " + ssoId + " with session " + session);
         }
 
         SingleSignOnEntry sso = cache.get(ssoId);
-        if (sso != null) {
+        if (sso == null) {
+            return false;
+        } else {
             sso.addSession(this, session);
+            reverse.put(new SingleSignOnSessionKey(session), ssoId);
+            return true;
         }
-        reverse.put(new SingleSignOnSessionKey(session), ssoId);
     }
 
 

==================================================
