ed6b638500b85f1c6d0249acdbbf1be4576cc790
==================================================
Partial fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=47214
==================================================
Mark Thomas
==================================================
Wed Apr 5 15:25:29 2017 +0000
==================================================
InputBuffer.java
Partial fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=47214
Replace explicitly referenced anonymous inner classes in InputBuffer with named inner classes.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1790292 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityClassLoad.java
index 5f711f2173..1287d89f85 100644
--- a/java/org/apache/catalina/connector/InputBuffer.java
+++ b/java/org/apache/catalina/connector/InputBuffer.java
@@ -582,13 +582,7 @@ public class InputBuffer extends Reader
     private static B2CConverter createConverter(Charset charset) throws IOException {
         if (SecurityUtil.isPackageProtectionEnabled()) {
             try {
-                return AccessController.doPrivileged(new PrivilegedExceptionAction<B2CConverter>() {
-
-                    @Override
-                    public B2CConverter run() throws IOException {
-                        return new B2CConverter(charset);
-                    }
-                });
+                return AccessController.doPrivileged(new PrivilegedCreateConverter(charset));
             } catch (PrivilegedActionException ex) {
                 Exception e = ex.getException();
                 if (e instanceof IOException) {
@@ -674,4 +668,20 @@ public class InputBuffer extends Reader
         cb = tmp;
         tmp = null;
     }
+
+
+    private static class PrivilegedCreateConverter
+            implements PrivilegedExceptionAction<B2CConverter> {
+
+        private final Charset charset;
+
+        public PrivilegedCreateConverter(Charset charset) {
+            this.charset = charset;
+        }
+
+        @Override
+        public B2CConverter run() throws IOException {
+            return new B2CConverter(charset);
+        }
+    }
 }

==================================================
