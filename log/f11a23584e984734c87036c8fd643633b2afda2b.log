f11a23584e984734c87036c8fd643633b2afda2b
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56578
==================================================
Mark Emlyn
==================================================
Fri Jun 6 10:25:49 2014 +0000
==================================================
DeltaSession.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56578
Correct regression in the fix for 56339 that prevented sessions from expiring when using clustering.
The effect of removing expiring = true; from the DeltaSession is that if parallel calls are made to expire() then there is a slightly greater chance of some of those calls blocking while the first completes. This is because expiring is now set to true a little later.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1600839 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestStandardSession.java
index c6ee0b6a30..b23c023b0f 100644
--- a/java/org/apache/catalina/ha/session/DeltaSession.java
+++ b/java/org/apache/catalina/ha/session/DeltaSession.java
@@ -446,10 +446,6 @@ public class DeltaSession extends StandardSession implements Externalizable,Clus
             if (manager == null)
                 return;
 
-            // Mark this session as "being expired". The flag will be unset in
-            // the call to super.expire(notify)
-            expiring = true;
-
             String expiredId = getIdInternal();
 
             if(notifyCluster && expiredId != null &&

==================================================
