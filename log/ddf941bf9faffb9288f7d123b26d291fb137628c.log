ddf941bf9faffb9288f7d123b26d291fb137628c
==================================================
Implement first part of pull request from Greg Wilkins to make Jasper more independent from Tomcat.
==================================================
Mark Emlyn
==================================================
Mon May 26 14:46:22 2014 +0000
==================================================
JasperInitializer.java
Implement first part of pull request from Greg Wilkins to make Jasper more independent from Tomcat.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1597597 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SimpleInstanceManager.java
index 29df81d98d..4acc3b342e 100644
--- a/java/org/apache/jasper/servlet/JasperInitializer.java
+++ b/java/org/apache/jasper/servlet/JasperInitializer.java
@@ -31,6 +31,8 @@ import org.apache.jasper.runtime.JspFactoryImpl;
 import org.apache.jasper.security.SecurityClassLoad;
 import org.apache.juli.logging.Log;
 import org.apache.juli.logging.LogFactory;
+import org.apache.tomcat.InstanceManager;
+import org.apache.tomcat.SimpleInstanceManager;
 import org.xml.sax.SAXException;
 
 /**
@@ -79,6 +81,11 @@ public class JasperInitializer implements ServletContainerInitializer {
             log.debug(Localizer.getMessage(MSG + ".onStartup", context.getServletContextName()));
         }
 
+        // Setup a simple default Instance Manager
+        if (context.getAttribute(InstanceManager.class.getName())==null) {
+            context.setAttribute(InstanceManager.class.getName(), new SimpleInstanceManager());
+        }
+
         boolean validate = Boolean.parseBoolean(
                 context.getInitParameter(Constants.XML_VALIDATION_TLD_INIT_PARAM));
         String blockExternalString = context.getInitParameter(

==================================================
