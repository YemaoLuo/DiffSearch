a072883bc59691a1efd78e9863bb7ef9b90b81e9
==================================================
- Port patches.
==================================================
Remy Maucherat
==================================================
Thu Apr 13 21:51:35 2006 +0000
==================================================
StandardSession.java
index dcf0ac5d08..bc0f6b9661 100644
--- a/java/org/apache/catalina/core/mbeans-descriptors.xml
+++ b/java/org/apache/catalina/core/mbeans-descriptors.xml
@@ -125,6 +125,10 @@
                description="The object used for mapping"
                type="java.lang.Object"/>
       
+    <attribute name="namingContextListener"
+               description="Associated naming context listener."
+               type="org.apache.catalina.core.NamingContextListener" />
+      
     <attribute name="objectName"
                description="Name of the object"
                type="java.lang.String"/>

==================================================
TldConfig.java
index 5749dc270f..1a5088e5be 100644
--- a/java/org/apache/catalina/session/StandardSession.java
+++ b/java/org/apache/catalina/session/StandardSession.java
@@ -590,7 +590,6 @@ public class StandardSession
      * @param isValid The new value for the <code>isValid</code> flag
      */
     public void setValid(boolean isValid) {
-
         this.isValid = isValid;
     }
 
@@ -607,9 +606,6 @@ public class StandardSession
 
         this.lastAccessedTime = this.thisAccessedTime;
         this.thisAccessedTime = System.currentTimeMillis();
-
-        evaluateIfValid();
-
         accessCount++;
 
     }
@@ -1494,19 +1490,6 @@ public class StandardSession
     }
 
 
-    protected void evaluateIfValid() {
-        /*
-     * If this session has expired or is in the process of expiring or
-     * will never expire, return
-     */
-        if (!this.isValid || expiring || maxInactiveInterval < 0)
-            return;
-
-        isValid();
-
-    }
-
-
     // ------------------------------------------------------ Protected Methods
 
 

==================================================
TagLibraryInfoImpl.java
index 46e2613c6c..68e4f2c60a 100644
--- a/java/org/apache/catalina/startup/TldConfig.java
+++ b/java/org/apache/catalina/startup/TldConfig.java
@@ -22,6 +22,7 @@ import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileOutputStream;
 import java.io.IOException;
+import java.io.InputStream;
 import java.io.ObjectInputStream;
 import java.io.ObjectOutputStream;
 import java.net.URL;
@@ -534,9 +535,14 @@ public final class TldConfig  {
 
         InputSource inputSource = null;
         try {
-            inputSource =
-                new InputSource(
-                    context.getServletContext().getResourceAsStream(resourcePath));
+            InputStream stream =
+                context.getServletContext().getResourceAsStream(resourcePath);
+            if (stream == null) {
+                throw new IllegalArgumentException
+                (sm.getString("contextConfig.tldResourcePath",
+                        resourcePath));
+            }
+            inputSource = new InputSource(stream);
             if (inputSource == null) {
                 throw new IllegalArgumentException
                     (sm.getString("contextConfig.tldResourcePath",

==================================================
FileDirContext.java
index fbea8bff04..d7d4681a8c 100644
--- a/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
+++ b/java/org/apache/jasper/compiler/TagLibraryInfoImpl.java
@@ -455,6 +455,10 @@ class TagLibraryInfoImpl extends TagLibraryInfo implements TagConstants {
                 // Ignore <example> element: Bugzilla 33538
             } else if ("tag-extension".equals(tname)) {
                 // Ignore <tag-extension> element: Bugzilla 33538
+            } else if ("icon".equals(tname) 
+                    || "display-name".equals(tname) 
+                    || "description".equals(tname)) {
+                // Ignore these elements: Bugzilla 38015
             } else {
                 if (log.isWarnEnabled()) {
                     log.warn(Localizer.getMessage(

==================================================
