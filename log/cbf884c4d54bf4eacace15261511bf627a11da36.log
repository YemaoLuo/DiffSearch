cbf884c4d54bf4eacace15261511bf627a11da36
==================================================
BZ 66183. Log all values for given cookie, not just the first.
==================================================
Mark Thomas
==================================================
Tue Aug 23 09:20:38 2022 +0100
==================================================
AbstractAccessLogValve.java
BZ 66183. Log all values for given cookie, not just the first.

https://bz.apache.org/bugzilla/show_bug.cgi?id=66183
Based on #541 by Han Li.


==================================================
ExtendedAccessLogValve.java
index 31ed2c15e0..879da82d5d 100644
--- a/java/org/apache/catalina/valves/AbstractAccessLogValve.java
+++ b/java/org/apache/catalina/valves/AbstractAccessLogValve.java
@@ -1545,17 +1545,26 @@ public abstract class AbstractAccessLogValve extends ValveBase implements Access
         @Override
         public void addElement(CharArrayWriter buf, Date date, Request request,
                 Response response, long time) {
-            String value = "-";
+            StringBuilder value = new StringBuilder();
+            boolean first = true;
             Cookie[] cookies = request.getCookies();
             if (cookies != null) {
                 for (Cookie cookie : cookies) {
                     if (cookieNameToLog.equals(cookie.getName())) {
-                        value = cookie.getValue();
-                        break;
+                        if (first) {
+                            first = false;
+                        } else {
+                            value.append(',');
+                        }
+                        value.append(cookie.getValue());
                     }
                 }
             }
-            escapeAndAppend(value, buf);
+            if (value.length() == 0) {
+                buf.append('-');
+            } else {
+                escapeAndAppend(value.toString(), buf);
+            }
         }
     }
 

==================================================
