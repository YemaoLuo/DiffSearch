aea724d05dcb32f83403082caa44e3c25a24a17a
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56082
==================================================
Mark Emlyn
==================================================
Thu Jan 30 09:09:34 2014 +0000
==================================================
ClassLoaderLogManager.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56082
Fix thread safety issue in JULI's LogManager implementation

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1562742 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestClassLoaderLogManager.java
index 362046fc1d..f4fa801cc5 100644
--- a/java/org/apache/juli/ClassLoaderLogManager.java
+++ b/java/org/apache/juli/ClassLoaderLogManager.java
@@ -36,6 +36,7 @@ import java.util.Map;
 import java.util.Properties;
 import java.util.StringTokenizer;
 import java.util.WeakHashMap;
+import java.util.concurrent.ConcurrentHashMap;
 import java.util.logging.Handler;
 import java.util.logging.Level;
 import java.util.logging.LogManager;
@@ -706,7 +707,7 @@ public class ClassLoaderLogManager extends LogManager {
 
     protected static final class ClassLoaderLogInfo {
         final LogNode rootNode;
-        final Map<String, Logger> loggers = new HashMap<>();
+        final Map<String, Logger> loggers = new ConcurrentHashMap<>();
         final Map<String, Handler> handlers = new HashMap<>();
         final Properties props = new Properties();
 

==================================================
