7cae03d9f3e42177a69bdc367e05b21bd1b9f8bb
==================================================
Improve handling of SSL renegotiation by failing earlier when the request body contains more bytes than maxSavePostSize.
==================================================
Mark Emlyn
==================================================
Tue Mar 1 12:32:25 2011 +0000
==================================================
SSLAuthenticator.java
Improve handling of SSL renegotiation by failing earlier when the request body contains more bytes than maxSavePostSize.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1075792 13f79535-47bb-0310-9956-ffa450edef68



==================================================
BufferedInputFilter.java
index 9af893a0de..988f248362 100644
--- a/java/org/apache/catalina/authenticator/SSLAuthenticator.java
+++ b/java/org/apache/catalina/authenticator/SSLAuthenticator.java
@@ -132,8 +132,15 @@ public class SSLAuthenticator
         X509Certificate certs[] = (X509Certificate[])
             request.getAttribute(Globals.CERTIFICATES_ATTR);
         if ((certs == null) || (certs.length < 1)) {
-            request.getCoyoteRequest().action
-                              (ActionCode.REQ_SSL_CERTIFICATE, null);
+            try {
+                request.getCoyoteRequest().action
+                                  (ActionCode.REQ_SSL_CERTIFICATE, null);
+            } catch (IllegalStateException ise) {
+                // Request body was too large for save buffer
+                response.sendError(HttpServletResponse.SC_UNAUTHORIZED,
+                        sm.getString("authenticator.certificates"));
+                return false;
+            }
             certs = (X509Certificate[])
                 request.getAttribute(Globals.CERTIFICATES_ATTR);
         }

==================================================
