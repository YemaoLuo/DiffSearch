e38a097dd91a1d8d389bc2775e90d1890025f394
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53702
==================================================
Mark Emlyn
==================================================
Wed Aug 15 20:32:44 2012 +0000
==================================================
ApplicationJspPropertyGroupDescriptor.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53702
<jsp-property-group> may contain multiple <url-pattern>

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1373618 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspPropertyGroup.java
index c3fcab2e34..056eca5486 100644
--- a/java/org/apache/catalina/core/ApplicationJspPropertyGroupDescriptor.java
+++ b/java/org/apache/catalina/core/ApplicationJspPropertyGroupDescriptor.java
@@ -14,11 +14,9 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-
 package org.apache.catalina.core;
 
 import java.util.Collection;
-import java.util.HashSet;
 
 import javax.servlet.descriptor.JspPropertyGroupDescriptor;
 
@@ -160,13 +158,6 @@ public class ApplicationJspPropertyGroupDescriptor
 
     @Override
     public Collection<String> getUrlPatterns() {
-        Collection<String> result = new HashSet<>();
-
-        if (jspPropertyGroup.getUrlPattern() != null) {
-            result.add(jspPropertyGroup.getUrlPattern());
-        }
-
-        return result;
+        return jspPropertyGroup.getUrlPatterns();
     }
-
 }

==================================================
WebXml.java
index 2bc038f548..f424117b5c 100644
--- a/java/org/apache/catalina/deploy/JspPropertyGroup.java
+++ b/java/org/apache/catalina/deploy/JspPropertyGroup.java
@@ -16,6 +16,7 @@
  */
 package org.apache.catalina.deploy;
 
+import java.util.HashSet;
 import java.util.LinkedHashSet;
 import java.util.Set;
 
@@ -71,11 +72,11 @@ public class JspPropertyGroup {
     }
     public Boolean getTrimWhitespace() { return trimWhitespace; }
 
-    private String urlPattern = null;
-    public void setUrlPattern(String urlPattern) {
-        this.urlPattern = urlPattern;
+    private Set<String> urlPattern = new HashSet<>();
+    public void addUrlPattern(String urlPattern) {
+        this.urlPattern.add(urlPattern);
     }
-    public String getUrlPattern() { return this.urlPattern; }
+    public Set<String> getUrlPatterns() { return this.urlPattern; }
 
     private String defaultContentType = null;
     public void setDefaultContentType(String defaultContentType) {

==================================================
WebRuleSet.java
index 7cb12fcb56..363a35986a 100644
--- a/java/org/apache/catalina/deploy/WebXml.java
+++ b/java/org/apache/catalina/deploy/WebXml.java
@@ -801,7 +801,9 @@ public class WebXml {
             }
             for (JspPropertyGroup jpg : jspPropertyGroups) {
                 sb.append("    <jsp-property-group>\n");
-                appendElement(sb, INDENT6, "url-pattern", jpg.getUrlPattern());
+                for (String urlPattern : jpg.getUrlPatterns()) {
+                    appendElement(sb, INDENT6, "url-pattern", urlPattern);
+                }
                 appendElement(sb, INDENT6, "el-ignored", jpg.getElIgnored());
                 appendElement(sb, INDENT6, "scripting-invalid",
                         jpg.getScriptingInvalid());
@@ -1345,12 +1347,16 @@ public class WebXml {
                 jspServletName = "jsp";
             }
             if (context.findChild(jspServletName) != null) {
-                context.addServletMapping(jspPropertyGroup.getUrlPattern(),
-                        jspServletName, true);
+                for (String urlPattern : jspPropertyGroup.getUrlPatterns()) {
+                    context.addServletMapping(urlPattern, jspServletName, true);
+                }
             } else {
-                if(log.isDebugEnabled())
-                    log.debug("Skiping " + jspPropertyGroup.getUrlPattern() +
-                            " , no servlet " + jspServletName);
+                if(log.isDebugEnabled()) {
+                    for (String urlPattern : jspPropertyGroup.getUrlPatterns()) {
+                        log.debug("Skiping " + urlPattern + " , no servlet " +
+                                jspServletName);
+                    }
+                }
             }
         }
     }

==================================================
