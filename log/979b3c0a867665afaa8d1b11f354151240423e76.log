979b3c0a867665afaa8d1b11f354151240423e76
==================================================
Better way to avoid NPE in resource cache - don't let the request get that far when we know we are going to fail it anyway.
==================================================
Mark Emlyn
==================================================
Sun Mar 2 21:28:25 2014 +0000
==================================================
AbstractResourceSet.java
Better way to avoid NPE in resource cache - don't let the request get that far when we know we are going to fail it anyway.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1573370 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Cache.java
index 9f54070e27..05e14eb705 100644
--- a/java/org/apache/catalina/webresources/AbstractResourceSet.java
+++ b/java/org/apache/catalina/webresources/AbstractResourceSet.java
@@ -39,7 +39,8 @@ public abstract class AbstractResourceSet extends LifecycleBase
 
     protected final void checkPath(String path) {
         if (path == null || path.length() == 0 || path.charAt(0) != '/') {
-            throw new IllegalArgumentException();
+            throw new IllegalArgumentException(
+                    sm.getString("abstractResourceSet.checkPath", path));
         }
     }
 

==================================================
StandardRoot.java
index 2774e0cc99..770b5e8312 100644
--- a/java/org/apache/catalina/webresources/LocalStrings.properties
+++ b/java/org/apache/catalina/webresources/LocalStrings.properties
@@ -14,9 +14,12 @@
 # limitations under the License.
 
 abstractArchiveResourceSet.setReadOnlyFalse=Archive based WebResourceSets such as those based on JARs are hard-coded to be read-only and may not be configured to be read-write
+
 abstractResource.getContentFail=Unable to return [{0}] as a byte array
 abstractResource.getContentTooLarge=Unable to return [{0}] as a byte array since the resource is [{1}] bytes in size which is larger than the maximum size of a byte array
 
+abstractResourceSet.checkPath=The requested path [{0}] is not valid. It must begin with "/".
+
 cache.addFail=Unable to add the resource at [{0}] to the cache because there was insufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache
 cache.backgroundEvictFail=The background cache eviction process was unable to free [{0}] percent of the cache for Context [{1}] - consider increasing the maximum size of the cache. After eviction approximately [{2}] KB of data remained in the cache.
 cache.objectMaxSizeTooBig=The value of [{0}]kB for objectMaxSize is larger than the limit of maxSize/20 so has been reduced to [{1}]kB
@@ -37,6 +40,7 @@ standardRoot.createInvalidFile=Unable to create WebResourceSet from [{0}]
 standardRoot.createNoFileResourceSet=The FileResourceSet feature has not yet been implemented
 standardRoot.createUnknownType=Unable to create WebResourceSet of unknown type [{0}]
 standardRoot.invalidPath=The resource path [{0}] is not valid
+standardRoot.invalidPathNormal=The resource path [{0}] has been normalized to [{1}] which is not valid
 standardRoot.lockedFile=The web application [{0}] failed to close the file [{1}] opened via the following stack trace
 standardRoot.noContext=A Context has not been configured for this WebResourceRoot
 standardRoot.startInvalidMain=The main resource set specified [{0}] is not valid

==================================================
