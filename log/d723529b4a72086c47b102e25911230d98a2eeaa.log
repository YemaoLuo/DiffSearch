d723529b4a72086c47b102e25911230d98a2eeaa
==================================================
Fix bad logic. Need to postProcess if socket is *not* closed and it is an async request.
==================================================
Mark Emlyn
==================================================
Wed Jun 29 22:34:37 2011 +0000
==================================================
AjpAprProtocol.java
Fix bad logic. Need to postProcess if socket is *not* closed and it is an async request.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1141299 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpNioProtocol.java
index ccb3e96a4e..83a6b25c38 100644
--- a/java/org/apache/coyote/ajp/AjpAprProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpAprProtocol.java
@@ -152,7 +152,7 @@ public class AjpAprProtocol extends AbstractAjpProtocol {
                         state = processor.process(socket);
                     }
 
-                    if (state == SocketState.CLOSED && processor.isAsync()) {
+                    if (state != SocketState.CLOSED && processor.isAsync()) {
                         state = processor.asyncPostProcess();
                     }
                 } while (state == SocketState.ASYNC_END);

==================================================
AjpProtocol.java
index 51d4988dba..6052497502 100644
--- a/java/org/apache/coyote/ajp/AjpNioProtocol.java
+++ b/java/org/apache/coyote/ajp/AjpNioProtocol.java
@@ -190,7 +190,7 @@ public class AjpNioProtocol extends AbstractAjpProtocol {
                         state = processor.process(socket);
                     }
 
-                    if (state == SocketState.CLOSED && processor.isAsync()) {
+                    if (state != SocketState.CLOSED && processor.isAsync()) {
                         state = processor.asyncPostProcess();
                     }
                 } while (state == SocketState.ASYNC_END);

==================================================
