3f692cd26a33c4759608e90ddefaf456ae5f3d2d
==================================================
Implement o.a.catalina.connector.OutputBuffer.realWriteBytes(ByteBuffer)
==================================================
Violeta Georgieva
==================================================
Mon Aug 29 16:55:54 2016 +0000
==================================================
OutputBuffer.java
Implement o.a.catalina.connector.OutputBuffer.realWriteBytes(ByteBuffer)

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1758261 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index 7569eab4ce..467c10afe2 100644
--- a/java/org/apache/catalina/connector/OutputBuffer.java
+++ b/java/org/apache/catalina/connector/OutputBuffer.java
@@ -395,7 +395,27 @@ public class OutputBuffer extends Writer
      */
     @Override
     public void realWriteBytes(ByteBuffer buf) throws IOException {
-        // To be implemented
+
+        if (closed) {
+            return;
+        }
+        if (coyoteResponse == null) {
+            return;
+        }
+
+        // If we really have something to write
+        if (buf.remaining() > 0) {
+            // real write to the adapter
+            try {
+                coyoteResponse.doWrite(buf.slice());
+            } catch (IOException e) {
+                // An IOException on a write is almost always due to
+                // the remote client aborting the request.  Wrap this
+                // so that it can be handled better by the error dispatcher.
+                throw new ClientAbortException(e);
+            }
+        }
+
     }
 
 

==================================================
