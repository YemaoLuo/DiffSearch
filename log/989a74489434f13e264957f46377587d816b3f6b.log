989a74489434f13e264957f46377587d816b3f6b
==================================================
Fix SpotBugs warning (rank <=16)
==================================================
Mark Thomas
==================================================
Tue Dec 5 22:37:33 2017 +0000
==================================================
ByteChunk.java
Fix SpotBugs warning (rank <=16)
serialization for ByteChunk

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1817248 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestByteChunk.java
index 6c6a479f3e..a0dcd6a92d 100644
--- a/java/org/apache/tomcat/util/buf/ByteChunk.java
+++ b/java/org/apache/tomcat/util/buf/ByteChunk.java
@@ -17,6 +17,8 @@
 package org.apache.tomcat.util.buf;
 
 import java.io.IOException;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
 import java.io.Serializable;
 import java.nio.ByteBuffer;
 import java.nio.CharBuffer;
@@ -127,7 +129,7 @@ public final class ByteChunk implements Cloneable, Serializable {
     private int start=0;
     private int end;
 
-    private Charset charset;
+    private transient Charset charset;
 
     private boolean isSet=false; // XXX
 
@@ -149,6 +151,19 @@ public final class ByteChunk implements Cloneable, Serializable {
         allocate( initial, -1 );
     }
 
+
+    private void writeObject(ObjectOutputStream oos) throws IOException {
+        oos.defaultWriteObject();
+        oos.writeUTF(getCharset().name());
+    }
+
+
+    private void readObject(ObjectInputStream ois) throws ClassNotFoundException, IOException {
+        ois.defaultReadObject();
+        this.charset = Charset.forName(ois.readUTF());
+    }
+
+
     @Override
     public Object clone() throws CloneNotSupportedException {
         return super.clone();
@@ -799,6 +814,7 @@ public final class ByteChunk implements Cloneable, Serializable {
         return (ret >= start) ? ret - start : -1;
     }
 
+
     /**
      * Returns the first instance of the given character in the given byte array
      * between the specified start and end.

==================================================
