9a9e9c6b3c0ccfffd9993bd3c80e99acf2ea825e
==================================================
implemented use equals attribute everywhere
==================================================
Filip Hanik
==================================================
Mon Nov 24 20:41:38 2008 +0000
==================================================
JdbcInterceptor.java
index 40ec6b34d4..7f80352ed8 100644
--- a/modules/jdbc-pool/doc/jdbc-pool.xml
+++ b/modules/jdbc-pool/doc/jdbc-pool.xml
@@ -328,7 +328,8 @@
       <p>(boolean) Set to true if you wish the <code>ProxyConnection</code> class to use <code>String.equals</code> instead of 
          <code>==</code> when comparing method names. This property does not apply to added interceptors as those are configured individually.
          The default value is <code>false</code>.
-      </p>   
+      </p> 
+    </attribute>    
   </attributes>  
   </subsection>
 </section>

==================================================
AbstractCreateStatementInterceptor.java
index 6e8aedabe2..212be1a7cd 100644
--- a/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/JdbcInterceptor.java
+++ b/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/JdbcInterceptor.java
@@ -56,14 +56,18 @@ public abstract class JdbcInterceptor implements InvocationHandler {
         this.next = next;
     }
     
-    public boolean compare(String methodName, Method method) {
+    public boolean compare(String name1, String name2) {
         if (useEquals()) {
-            return methodName.equals(method.getName());
+            return name1.equals(name2);
         } else {
-            return methodName==method.getName();
+            return name1==name2;
         }
     }
     
+    public boolean compare(String methodName, Method method) {
+        return compare(methodName, method.getName());
+    }
+    
     /**
      * Gets called each time the connection is borrowed from the pool
      * @param parent - the connection pool owning the connection

==================================================
ConnectionState.java
index 80f04b65f8..3609ac0f74 100644
--- a/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/AbstractCreateStatementInterceptor.java
+++ b/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/interceptor/AbstractCreateStatementInterceptor.java
@@ -40,7 +40,7 @@ public abstract class  AbstractCreateStatementInterceptor extends JdbcIntercepto
     
     @Override
     public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
-        if (CLOSE_VAL==method.getName()) {
+        if (compare(CLOSE_VAL,method)) {
             closeInvoked();
             return super.invoke(proxy, method, args);
         } else {
@@ -70,7 +70,7 @@ public abstract class  AbstractCreateStatementInterceptor extends JdbcIntercepto
 
     protected boolean process(String[] names, Method method, boolean process) {
         for (int i=0; (!process) && i<names.length; i++) {
-            process = (method.getName()==names[i]);
+            process = compare(names[i],method);
         }
         return process;
     }

==================================================
