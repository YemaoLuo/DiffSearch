80e88a0efe32f9d243ca94ac3bb9a6abff9f2ef8
==================================================
Add displayName to ContextName
==================================================
Mark Emlyn
==================================================
Fri Nov 19 10:33:54 2010 +0000
==================================================
ContextName.java
Add displayName to ContextName
Fix some bugs in ContextName constructors
Add a test case for ContextName

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1036792 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestContextName.java
index 7a1aa3eaa3..b58243009a 100644
--- a/java/org/apache/catalina/util/ContextName.java
+++ b/java/org/apache/catalina/util/ContextName.java
@@ -47,21 +47,21 @@ public final class ContextName {
             baseName = name;
         }
 
+        String tmp;
         // Extract version number
         int versionIndex = baseName.indexOf(VERSION_MARKER);
         if (versionIndex > -1) {
             version = baseName.substring(versionIndex + 2);
+            tmp = baseName.substring(0, versionIndex);
         } else {
             version = "";
+            tmp = baseName;
         }
 
-        if (ROOT_NAME.equals(baseName)) {
+        if (ROOT_NAME.equals(tmp)) {
             path = "";
-        } else if (versionIndex > -1) {
-            path = "/" + baseName.substring(0, versionIndex).replaceAll(
-                    FWD_SLASH_REPLACEMENT, "/");
         } else {
-            path = "/" + baseName.replaceAll(FWD_SLASH_REPLACEMENT, "/");
+            path = "/" + tmp.replaceAll(FWD_SLASH_REPLACEMENT, "/");
         }
         
         if (versionIndex > -1) {
@@ -101,7 +101,7 @@ public final class ContextName {
 
         // Base name is converted path + version
         StringBuilder tmp = new StringBuilder();
-        if ("".equals(path)) {
+        if ("".equals(this.path)) {
             tmp.append(ROOT_NAME);
         } else {
             tmp.append(this.path.substring(1).replaceAll("/",
@@ -129,4 +129,25 @@ public final class ContextName {
     public String getName() {
         return name;
     }
+
+    public String getDisplayName() {
+        StringBuilder tmp = new StringBuilder();
+        if (path == "") {
+            tmp.append('/');
+        } else {
+            tmp.append(path);
+        }
+        
+        if (version != "") {
+            tmp.append(VERSION_MARKER);
+            tmp.append(version);
+        }
+        
+        return tmp.toString();
+    }
+    
+    @Override
+    public String toString() {
+        return getDisplayName();
+    }
 }

==================================================
