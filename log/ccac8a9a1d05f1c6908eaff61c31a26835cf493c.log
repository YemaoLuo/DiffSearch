ccac8a9a1d05f1c6908eaff61c31a26835cf493c
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50957
==================================================
Mark Emlyn
==================================================
Wed Apr 6 16:39:38 2011 +0000
==================================================
Http11Processor.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50957
Fix regression in processing of pipe-lined requests.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1089531 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAbstractHttp11Processor.java
index cc95597d65..5fd2b01644 100644
--- a/java/org/apache/coyote/http11/Http11Processor.java
+++ b/java/org/apache/coyote/http11/Http11Processor.java
@@ -314,9 +314,12 @@ public class Http11Processor extends AbstractHttp11Processor {
                 inputBuffer.nextRequest();
                 outputBuffer.nextRequest();
             }
-            
-            //hack keep alive behavior
-            break;
+
+            // If we don't have a pipe-lined request allow this thread to be
+            // used by another connection
+            if (isAsync() || error || inputBuffer.lastValid == 0) {
+                break;
+            }
         }
 
         rp.setStage(org.apache.coyote.Constants.STAGE_ENDED);

==================================================
