ab70f07bbd9715c526e4d91b25348b1ad57994e1
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55442
==================================================
Violeta Georgieva
==================================================
Tue Aug 20 08:38:29 2013 +0000
==================================================
AstFunction.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55442
Handle calls to a constructor of an imported class or to a static method, imported statically.
Unit test based on a patch provided by Daniel Mikusa.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1515744 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAstFunction.java
index c2b14f25d6..23cedbced3 100644
--- a/java/org/apache/el/parser/AstFunction.java
+++ b/java/org/apache/el/parser/AstFunction.java
@@ -21,6 +21,7 @@ package org.apache.el.parser;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 
+import javax.el.ELClass;
 import javax.el.ELException;
 import javax.el.FunctionMapper;
 import javax.el.LambdaExpression;
@@ -130,6 +131,18 @@ public final class AstFunction extends SimpleNode {
                 }
                 return obj;
             }
+
+            // Call to a constructor or a static method
+            obj = ctx.getImportHandler().resolveClass(this.localName);
+            if (obj != null) {
+                return ctx.getELResolver().invoke(ctx, new ELClass((Class<?>) obj), "<init>", null,
+                        ((AstMethodParameters) this.children[0]).getParameters(ctx));
+            }
+            obj = ctx.getImportHandler().resolveStatic(this.localName);
+            if (obj != null) {
+                return ctx.getELResolver().invoke(ctx, new ELClass((Class<?>) obj), this.localName,
+                        null, ((AstMethodParameters) this.children[0]).getParameters(ctx));
+            }
         }
 
         if (m == null) {

==================================================
