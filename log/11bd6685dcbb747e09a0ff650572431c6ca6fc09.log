11bd6685dcbb747e09a0ff650572431c6ca6fc09
==================================================
Further review of socketWrapper.isReadyForWrite()
==================================================
Mark Thomas
==================================================
Fri Jan 9 18:33:08 2015 +0000
==================================================
AjpProcessor.java
Further review of socketWrapper.isReadyForWrite()

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1650623 13f79535-47bb-0310-9956-ffa450edef68



==================================================
UpgradeServletOutputStream.java
index 910eaba649..9584d669fc 100644
--- a/java/org/apache/coyote/ajp/AjpProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpProcessor.java
@@ -588,11 +588,8 @@ public class AjpProcessor<S> extends AbstractProcessor<S> {
         }
         case NB_WRITE_INTEREST: {
             AtomicBoolean isReady = (AtomicBoolean)param;
-            boolean result = socketWrapper.isReadyForWrite() && responseMsgPos == -1;
+            boolean result = responseMsgPos == -1 && socketWrapper.isReadyForWrite();
             isReady.set(result);
-            if (!result) {
-                registerForEvent(false, true);
-            }
             break;
         }
         case REQUEST_BODY_FULLY_READ: {

==================================================
