2cd5fd92c0a357ec43791237c4ba5264e7d35c47
==================================================
Store.load() implementations assume (in places) that getManager().getContext() always returns a non-null and we haven't had reports of NPEs so make the assumption consistently throughout the method.
==================================================
Mark Thomas
==================================================
Fri Jan 8 15:15:13 2016 +0000
==================================================
FileStore.java
Store.load() implementations assume (in places) that getManager().getContext() always returns a non-null and we haven't had reports of NPEs so make the assumption consistently throughout the method.
Add a local reference to the Context's logger to shorten some of the logging lines

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1723736 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JDBCStore.java
index c55091fbd1..1146d0c3c4 100644
--- a/java/org/apache/catalina/session/FileStore.java
+++ b/java/org/apache/catalina/session/FileStore.java
@@ -33,6 +33,7 @@ import org.apache.catalina.Context;
 import org.apache.catalina.Loader;
 import org.apache.catalina.Session;
 import org.apache.catalina.util.CustomObjectInputStream;
+import org.apache.juli.logging.Log;
 
 /**
  * Concrete implementation of the <b>Store</b> interface that utilizes
@@ -217,9 +218,12 @@ public final class FileStore extends StoreBase {
         if (!file.exists()) {
             return null;
         }
-        if (manager.getContext().getLogger().isDebugEnabled()) {
-            manager.getContext().getLogger().debug(sm.getString(getStoreName()+".loading",
-                             id, file.getAbsolutePath()));
+
+        Context context = getManager().getContext();
+        Log contextLog = context.getLogger();
+
+        if (contextLog.isDebugEnabled()) {
+            contextLog.debug(sm.getString(getStoreName()+".loading", id, file.getAbsolutePath()));
         }
 
         ObjectInputStream ois = null;
@@ -228,10 +232,7 @@ public final class FileStore extends StoreBase {
         ClassLoader oldThreadContextCL = Thread.currentThread().getContextClassLoader();
         try (FileInputStream fis = new FileInputStream(file.getAbsolutePath());
                 BufferedInputStream bis = new BufferedInputStream(fis)) {
-            Context context = manager.getContext();
-            if (context != null) {
-                loader = context.getLoader();
-            }
+            loader = context.getLoader();
             if (loader != null) {
                 classLoader = loader.getClassLoader();
             }
@@ -247,8 +248,8 @@ public final class FileStore extends StoreBase {
             session.setManager(manager);
             return session;
         } catch (FileNotFoundException e) {
-            if (manager.getContext().getLogger().isDebugEnabled()) {
-                manager.getContext().getLogger().debug("No persisted data file found");
+            if (contextLog.isDebugEnabled()) {
+                contextLog.debug("No persisted data file found");
             }
             return null;
         } finally {

==================================================
