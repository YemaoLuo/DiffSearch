76da78031b9a4f28d2386e8fb71662bcecce7380
==================================================
More try-with-resources
==================================================
Mark Emlyn
==================================================
Wed Mar 26 14:40:03 2014 +0000
==================================================
StandardContextSF.java
index 9148f81599..5479ff114e 100644
--- a/TOMCAT-NEXT.txt
+++ b/TOMCAT-NEXT.txt
@@ -214,7 +214,7 @@ but possibly 7.1.x).
     - Use of try with resources
       - Started.
         - javax.* complete
-        - o.a.catalina.[ant to startup] complete
+        - o.a.catalina.[ant to storeconfig] complete
         - remainder TODO
     - Catching multiple exceptions
       - Started

==================================================
StoreConfig.java
index 07b318b29d..1c48526258 100644
--- a/java/org/apache/catalina/storeconfig/StandardContextSF.java
+++ b/java/org/apache/catalina/storeconfig/StandardContextSF.java
@@ -116,7 +116,6 @@ public class StandardContextSF extends StoreFactoryBase {
     protected void storeContextSeparate(PrintWriter aWriter, int indent,
             StandardContext aContext) throws Exception {
         URL configFile = aContext.getConfigFile();
-        PrintWriter writer = null;
         if (configFile != null) {
             File config = new File(configFile.toURI());
             if (!config.isAbsolute()) {
@@ -133,25 +132,11 @@ public class StandardContextSF extends StoreFactoryBase {
             if (log.isInfoEnabled())
                 log.info("Store Context " + aContext.getPath()
                         + " separate at file " + config);
-            try {
-                writer = new PrintWriter(new OutputStreamWriter(
-                        new FileOutputStream(config), getRegistry()
-                                .getEncoding()));
+            try (FileOutputStream fos = new FileOutputStream(config);
+                    PrintWriter writer = new PrintWriter(new OutputStreamWriter(
+                            fos , getRegistry().getEncoding()))) {
                 storeXMLHead(writer);
                 super.store(writer, -2, aContext);
-            } finally {
-                if (writer != null) {
-                    try {
-                        writer.flush();
-                    } catch (Exception e) {
-                        // Ignore
-                    }
-                    try {
-                        writer.close();
-                    } catch (Throwable t) {
-                        // Ignore
-                    }
-                }
             }
         } else {
             super.store(aWriter, indent, aContext);
@@ -190,25 +175,9 @@ public class StandardContextSF extends StoreFactoryBase {
                         + " separate with backup (at file "
                         + mover.getConfigSave() + " )");
 
-            PrintWriter writer = null;
-            try {
-                writer = mover.getWriter();
+            try (PrintWriter writer = mover.getWriter()) {
                 storeXMLHead(writer);
                 super.store(writer, -2, aContext);
-            } finally {
-                if (writer != null) {
-                    // Flush and close the output file
-                    try {
-                        writer.flush();
-                    } catch (Exception e) {
-                        log.error(e);
-                    }
-                    try {
-                        writer.close();
-                    } catch (Exception e) {
-                        throw (e);
-                    }
-                }
             }
             mover.move();
         }

==================================================
