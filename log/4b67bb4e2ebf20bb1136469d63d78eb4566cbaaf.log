4b67bb4e2ebf20bb1136469d63d78eb4566cbaaf
==================================================
Modify rsv handling and complain if it is non-zero (will need to handle
==================================================
Mark Emlyn
==================================================
Mon Feb 20 23:43:30 2012 +0000
==================================================
StreamInbound.java
Modify rsv handling and complain if it is non-zero (will need to handle
non-zero values for extensions).

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1291524 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsFrameHeader.java
index dcfea463f0..6d2daae235 100644
--- a/java/org/apache/catalina/websocket/StreamInbound.java
+++ b/java/org/apache/catalina/websocket/StreamInbound.java
@@ -54,6 +54,13 @@ public abstract class StreamInbound implements UpgradeInbound {
         WsInputStream wsIs = new WsInputStream(processor);
 
         WsFrameHeader header = wsIs.getFrameHeader();
+
+        // TODO User defined extensions may define values for rsv
+        if (header.getRsv() > 0) {
+            getOutbound().close(1002, null);
+            return SocketState.CLOSED;
+        }
+
         byte opCode = header.getOpCode();
         validateOpCode(opCode);
 

==================================================
