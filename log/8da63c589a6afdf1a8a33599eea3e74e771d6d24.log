8da63c589a6afdf1a8a33599eea3e74e771d6d24
==================================================
Refactoring in preparation for fixing issue with running tests in parallel
==================================================
Mark Thomas
==================================================
Tue Sep 22 19:46:30 2015 +0000
==================================================
AbstractTestDirResourceSet.java
Refactoring in preparation for fixing issue with running tests in parallel

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1704706 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractTestFileResourceSet.java
index cf31010ada..848ea11331 100644
--- a/test/org/apache/catalina/webresources/AbstractTestDirResourceSet.java
+++ b/test/org/apache/catalina/webresources/AbstractTestDirResourceSet.java
@@ -33,9 +33,9 @@ public abstract class AbstractTestDirResourceSet extends AbstractTestResourceSet
 
     @Override
     public WebResourceRoot getWebResourceRoot() {
-        File f = new File(getBaseDir());
         TesterWebResourceRoot root = new TesterWebResourceRoot();
-        WebResourceSet webResourceSet = new DirResourceSet(root, "/", f.getAbsolutePath(), "/");
+        WebResourceSet webResourceSet =
+                new DirResourceSet(root, "/", getBaseDir().getAbsolutePath(), "/");
         webResourceSet.setReadOnly(readOnly);
         root.setMainResources(webResourceSet);
         return root;
@@ -47,8 +47,8 @@ public abstract class AbstractTestDirResourceSet extends AbstractTestResourceSet
     }
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources/dir1";
+    public File getBaseDir() {
+        return new File("test/webresources/dir1");
     }
 
     @Override

==================================================
AbstractTestResourceSet.java
index 48db9685ca..32adaa44e5 100644
--- a/test/org/apache/catalina/webresources/AbstractTestFileResourceSet.java
+++ b/test/org/apache/catalina/webresources/AbstractTestFileResourceSet.java
@@ -33,9 +33,8 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
 
     @Override
     public WebResourceRoot getWebResourceRoot() {
-        File f = new File(getBaseDir());
         TesterWebResourceRoot root = new TesterWebResourceRoot();
-        WebResourceSet webResourceSet = new DirResourceSet(root, "/", f.getAbsolutePath(), "/");
+        WebResourceSet webResourceSet = new DirResourceSet(root, "/", getBaseDir().getAbsolutePath(), "/");
         webResourceSet.setReadOnly(readOnly);
         root.setMainResources(webResourceSet);
 
@@ -68,8 +67,8 @@ public abstract class AbstractTestFileResourceSet extends AbstractTestResourceSe
     }
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources/dir2";
+    public File getBaseDir() {
+        return new File("test/webresources/dir2");
     }
 
     @Override

==================================================
TestDirResourceSetMount.java
index 283fb99f4b..39522dae99 100644
--- a/test/org/apache/catalina/webresources/AbstractTestResourceSet.java
+++ b/test/org/apache/catalina/webresources/AbstractTestResourceSet.java
@@ -44,7 +44,7 @@ public abstract class AbstractTestResourceSet {
         return "";
     }
 
-    public abstract String getBaseDir();
+    public abstract File getBaseDir();
 
     @Before
     public final void setup() throws LifecycleException {

==================================================
TestDirResourceSetVirtual.java
index 967f68c2a0..9538606bda 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSetMount.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSetMount.java
@@ -25,11 +25,10 @@ public class TestDirResourceSetMount extends AbstractTestResourceSetMount {
 
     @Override
     public WebResourceRoot getWebResourceRoot() {
-        File f = new File(getBaseDir());
         TesterWebResourceRoot root = new TesterWebResourceRoot();
         WebResourceSet webResourceSet =
                 new DirResourceSet(new TesterWebResourceRoot(), getMount(),
-                        f.getAbsolutePath(), "/");
+                        getBaseDir().getAbsolutePath(), "/");
         root.setMainResources(webResourceSet);
         return root;
     }
@@ -40,7 +39,7 @@ public class TestDirResourceSetMount extends AbstractTestResourceSetMount {
     }
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources/dir1";
+    public File getBaseDir() {
+        return new File("test/webresources/dir1");
     }
 }

==================================================
TestFileResourceSetVirtual.java
index e55dd4a9c2..2412bc2897 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSetVirtual.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSetVirtual.java
@@ -25,11 +25,10 @@ public class TestDirResourceSetVirtual extends TestDirResourceSet {
 
     @Override
     public WebResourceRoot getWebResourceRoot() {
-        File f = new File(getBaseDir());
         TesterWebResourceRoot root = new TesterWebResourceRoot();
         WebResourceSet webResourceSet =
                 new DirResourceSet(new TesterWebResourceRoot(), "/",
-                        f.getAbsolutePath(), "/");
+                        getBaseDir().getAbsolutePath(), "/");
         root.setMainResources(webResourceSet);
 
         WebResourceSet f1 = new FileResourceSet(root, "/f1.txt",
@@ -57,7 +56,7 @@ public class TestDirResourceSetVirtual extends TestDirResourceSet {
     }
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources/dir3";
+    public File getBaseDir() {
+        return new File("test/webresources/dir3");
     }
 }

==================================================
TestJarResourceSet.java
index 19553d8446..5d9bcd05fa 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSetVirtual.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSetVirtual.java
@@ -16,6 +16,8 @@
  */
 package org.apache.catalina.webresources;
 
+import java.io.File;
+
 /**
  * Mounts file resources in sub directories that do not exist in the main
  * resoucres.
@@ -23,8 +25,8 @@ package org.apache.catalina.webresources;
 public class TestFileResourceSetVirtual extends TestFileResourceSet {
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources/dir3";
+    public File getBaseDir() {
+        return new File("test/webresources/dir3");
     }
 
 }

==================================================
TestJarResourceSetInternal.java
index 0cdd72e5cd..89d2b2ded3 100644
--- a/test/org/apache/catalina/webresources/TestJarResourceSet.java
+++ b/test/org/apache/catalina/webresources/TestJarResourceSet.java
@@ -41,8 +41,8 @@ public class TestJarResourceSet extends AbstractTestResourceSet {
     }
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources";
+    public File getBaseDir() {
+        return new File("test/webresources");
     }
 
     @Override

==================================================
TestJarResourceSetMount.java
index f323312fee..c5a3ccea8a 100644
--- a/test/org/apache/catalina/webresources/TestJarResourceSetInternal.java
+++ b/test/org/apache/catalina/webresources/TestJarResourceSetInternal.java
@@ -41,8 +41,8 @@ public class TestJarResourceSetInternal extends AbstractTestResourceSet {
     }
 
     @Override
-    public String getBaseDir() {
-        return "test/webresources";
+    public File getBaseDir() {
+        return new File("test/webresources");
     }
 
     @Override

==================================================
