2d348c52712792325d2ae8b1d2bfe2286cc5cb0c
==================================================
Improve large-file support (more then 4 Gb) at all AccessLogValves, backport from 5.5.25.
==================================================
Peter Rossbach
==================================================
Thu Sep 13 21:56:30 2007 +0000
==================================================
OutputBuffer.java
Improve large-file support (more then 4 Gb) at all AccessLogValves, backport from 5.5.25.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@575478 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index 4f282a2f8d..769f8b4757 100644
--- a/java/org/apache/catalina/connector/OutputBuffer.java
+++ b/java/org/apache/catalina/connector/OutputBuffer.java
@@ -70,13 +70,13 @@ public class OutputBuffer extends Writer
     /**
      * Number of bytes written.
      */
-    private int bytesWritten = 0;
+    private long bytesWritten = 0;
 
 
     /**
      * Number of chars written.
      */
-    private int charsWritten = 0;
+    private long charsWritten = 0;
 
 
     /**
@@ -539,22 +539,32 @@ public class OutputBuffer extends Writer
 
     }
 
-
     public int getBytesWritten() {
-        return bytesWritten;
+        if (bytesWritten < Integer.MAX_VALUE) {
+            return (int) bytesWritten;
+        }
+        return -1;
     }
 
-
     public int getCharsWritten() {
-        return charsWritten;
+        if (charsWritten < Integer.MAX_VALUE) {
+            return (int) charsWritten;
+        }
+        return -1;
     }
 
-
     public int getContentWritten() {
-        return bytesWritten + charsWritten;
+        long size = bytesWritten + charsWritten ;
+        if (size < Integer.MAX_VALUE) {
+            return (int) size;
+        }
+        return -1;
     }
 
-
+    public long getContentWrittenLong() {
+        return bytesWritten + charsWritten;
+    }
+    
     /** 
      * True if this buffer hasn't been used ( since recycle() ) -
      * i.e. no chars or bytes have been added to the buffer.  

==================================================
