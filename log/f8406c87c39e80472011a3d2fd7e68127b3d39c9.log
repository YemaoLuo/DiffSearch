f8406c87c39e80472011a3d2fd7e68127b3d39c9
==================================================
Move the WAR handling code to a separate package to provide the option to register it via the java.protocol.handler.pkgs system property
==================================================
Mark Thomas
==================================================
Tue Oct 4 11:01:44 2016 +0000
==================================================
TomcatURLStreamHandlerFactory.java
Move the WAR handling code to a separate package to provide the option to register it via the java.protocol.handler.pkgs system property

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1763259 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Handler.java
index 665016237f..9fb63e3e2c 100644
--- a/java/org/apache/catalina/webresources/TomcatURLStreamHandlerFactory.java
+++ b/java/org/apache/catalina/webresources/TomcatURLStreamHandlerFactory.java
@@ -22,6 +22,8 @@ import java.net.URLStreamHandlerFactory;
 import java.util.List;
 import java.util.concurrent.CopyOnWriteArrayList;
 
+import org.apache.catalina.webresources.war.Handler;
+
 public class TomcatURLStreamHandlerFactory implements URLStreamHandlerFactory {
 
     private static final String WAR_PROTOCOL = "war";
@@ -155,7 +157,7 @@ public class TomcatURLStreamHandlerFactory implements URLStreamHandlerFactory {
         // Tomcat's handler always takes priority so applications can't override
         // it.
         if (WAR_PROTOCOL.equals(protocol)) {
-            return new WarURLStreamHandler();
+            return new Handler();
         } else if (CLASSPTH_PROTOCOL.equals(protocol)) {
             return new ClasspathURLStreamHandler();
         }

==================================================
WarURLConnection.java
similarity index 91%
rename from java/org/apache/catalina/webresources/WarURLStreamHandler.java
rename to java/org/apache/catalina/webresources/war/Handler.java
index 9f551d64ae..fea82d0ba6 100644
--- a/java/org/apache/catalina/webresources/WarURLStreamHandler.java
+++ b/java/org/apache/catalina/webresources/war/Handler.java
@@ -14,14 +14,14 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.apache.catalina.webresources;
+package org.apache.catalina.webresources.war;
 
 import java.io.IOException;
 import java.net.URL;
 import java.net.URLConnection;
 import java.net.URLStreamHandler;
 
-public class WarURLStreamHandler extends URLStreamHandler {
+public class Handler extends URLStreamHandler {
 
     @Override
     protected URLConnection openConnection(URL u) throws IOException {

==================================================
TestHandler.java
similarity index 97%
rename from java/org/apache/catalina/webresources/WarURLConnection.java
rename to java/org/apache/catalina/webresources/war/WarURLConnection.java
index 00577388b9..82c4bd6ec8 100644
--- a/java/org/apache/catalina/webresources/WarURLConnection.java
+++ b/java/org/apache/catalina/webresources/war/WarURLConnection.java
@@ -14,7 +14,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.apache.catalina.webresources;
+package org.apache.catalina.webresources.war;
 
 import java.io.IOException;
 import java.io.InputStream;

==================================================
TestHandlerIntegration.java
similarity index 94%
rename from test/org/apache/catalina/webresources/TestWarURLStreamHandler.java
rename to test/org/apache/catalina/webresources/war/TestHandler.java
index 60f5a08406..c4b72bee15 100644
--- a/test/org/apache/catalina/webresources/TestWarURLStreamHandler.java
+++ b/test/org/apache/catalina/webresources/war/TestHandler.java
@@ -14,7 +14,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.apache.catalina.webresources;
+package org.apache.catalina.webresources.war;
 
 import java.io.File;
 import java.net.URL;
@@ -24,7 +24,9 @@ import org.junit.Assert;
 import org.junit.Before;
 import org.junit.Test;
 
-public class TestWarURLStreamHandler {
+import org.apache.catalina.webresources.TomcatURLStreamHandlerFactory;
+
+public class TestHandler {
 
     @Before
     public void register() {

==================================================
TestWarURLConnection.java
similarity index 93%
rename from test/org/apache/catalina/webresources/TestWarURLStreamHandlerIntegration.java
rename to test/org/apache/catalina/webresources/war/TestHandlerIntegration.java
index 734072b4b4..15f75a37e3 100644
--- a/test/org/apache/catalina/webresources/TestWarURLStreamHandlerIntegration.java
+++ b/test/org/apache/catalina/webresources/war/TestHandlerIntegration.java
@@ -14,7 +14,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.apache.catalina.webresources;
+package org.apache.catalina.webresources.war;
 
 import java.io.File;
 import java.net.URL;
@@ -27,7 +27,7 @@ import org.apache.catalina.core.StandardHost;
 import org.apache.catalina.startup.Tomcat;
 import org.apache.catalina.startup.TomcatBaseTest;
 
-public class TestWarURLStreamHandlerIntegration extends TomcatBaseTest {
+public class TestHandlerIntegration extends TomcatBaseTest {
 
     @Test
     public void testToURI() throws Exception {

==================================================
