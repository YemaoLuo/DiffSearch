39b9046f7f22ee7a41c2adb67e698350cc6a039f
==================================================
Add in stub methods from servlet draft per 
==================================================
Filip Hanik
==================================================
Tue Jun 26 18:38:09 2012 +0000
==================================================
ServletInputStream.java
Add in stub methods from servlet draft per 
http://java.net/projects/servlet-spec/lists/jsr340-experts/archive/2012-06/message/9
Note this may change at which point we will change it accordingly



git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1354158 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ServletOutputStream.java
index 9226e61965..12eb578e3d 100644
--- a/java/javax/servlet/ServletInputStream.java
+++ b/java/javax/servlet/ServletInputStream.java
@@ -81,4 +81,21 @@ public abstract class ServletInputStream extends InputStream {
         }
         return count > 0 ? count : -1;
     }
+
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public abstract boolean isFinished();
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public abstract boolean isReady();
+
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public abstract void setReadListener(javax.servlet.ReadListener listener);
 }

==================================================
ServletRequest.java
index cbafca1e6e..f80234ab91 100644
--- a/java/javax/servlet/ServletOutputStream.java
+++ b/java/javax/servlet/ServletOutputStream.java
@@ -271,4 +271,15 @@ public abstract class ServletOutputStream extends OutputStream {
         print(d);
         println();
     }
-}
+
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public abstract boolean canWrite();
+
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public abstract void setWriteListener(javax.servlet.WriteListener listener);}

==================================================
ServletRequestWrapper.java
index 1ad1d45743..60d81911fc 100644
--- a/java/javax/servlet/ServletRequest.java
+++ b/java/javax/servlet/ServletRequest.java
@@ -109,6 +109,12 @@ public interface ServletRequest {
      */
     public int getContentLength();
 
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public long getContentLengthLong();
+
     /**
      * Returns the MIME type of the body of the request, or <code>null</code> if
      * the type is not known. For HTTP servlets, same as the value of the CGI

==================================================
ServletResponse.java
index 5f0919e24a..308a29fb04 100644
--- a/java/javax/servlet/ServletRequestWrapper.java
+++ b/java/javax/servlet/ServletRequestWrapper.java
@@ -113,6 +113,11 @@ public class ServletRequestWrapper implements ServletRequest {
         return this.request.getContentLength();
     }
 
+    @Override
+    public long getContentLengthLong() {
+        return this.request.getContentLengthLong();
+    }
+
     /**
      * The default behavior of this method is to return getContentType() on the
      * wrapped request object.

==================================================
ServletResponseWrapper.java
index 2e0880f26f..e245884222 100644
--- a/java/javax/servlet/ServletResponse.java
+++ b/java/javax/servlet/ServletResponse.java
@@ -174,6 +174,11 @@ public interface ServletResponse {
      */
     public void setContentLength(int len);
 
+    /**
+     * TODO SERVLET 3.1
+     */
+    public void setContentLengthLong(long length);
+
     /**
      * Sets the content type of the response being sent to the client, if the
      * response has not been committed yet. The given content type may include a

==================================================
HttpServlet.java
index 157d44c44a..cff27e91ea 100644
--- a/java/javax/servlet/ServletResponseWrapper.java
+++ b/java/javax/servlet/ServletResponseWrapper.java
@@ -114,6 +114,14 @@ public class ServletResponseWrapper implements ServletResponse {
         this.response.setContentLength(len);
     }
 
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void setContentLengthLong(long length) {
+        this.response.setContentLengthLong(length);
+    }
+
     /**
      * The default behavior of this method is to call setContentType(String
      * type) on the wrapped response object.

==================================================
HttpServletRequest.java
index 04be6d1b4d..035237df12 100644
--- a/java/javax/servlet/http/HttpServlet.java
+++ b/java/javax/servlet/http/HttpServlet.java
@@ -819,4 +819,22 @@ class NoBodyOutputStream extends ServletOutputStream {
             throw new IOException(msg);
         }
     }
+
+    /**
+     * TODO SERVLET 3.1
+     * @return
+     */
+    public boolean canWrite() {
+        return false;
+    }
+
+    /**
+     * TODO SERVLET 3.1
+     * @param listener
+     */
+    public void setWriteListener(javax.servlet.WriteListener listener) {
+
+    }
+
+
 }

==================================================
HttpServletRequestWrapper.java
index 2bf2c7cc82..f3f71083c9 100644
--- a/java/javax/servlet/http/HttpServletRequest.java
+++ b/java/javax/servlet/http/HttpServletRequest.java
@@ -483,4 +483,10 @@ public interface HttpServletRequest extends ServletRequest {
      */
     public Part getPart(String name) throws IOException,
             ServletException;
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    public abstract void upgrade(javax.servlet.http.ProtocolHandler handler)
+            throws java.io.IOException;
 }

==================================================
CoyoteInputStream.java
index 78b9b0bca7..fbddd512ec 100644
--- a/java/javax/servlet/http/HttpServletRequestWrapper.java
+++ b/java/javax/servlet/http/HttpServletRequestWrapper.java
@@ -323,4 +323,13 @@ public class HttpServletRequestWrapper extends ServletRequestWrapper implements
             ServletException {
         return this._getHttpServletRequest().getPart(name);
     }
+
+    /**
+     * {@inheritDoc}
+     */
+    @Override
+    public void upgrade(javax.servlet.http.ProtocolHandler handler)
+            throws java.io.IOException {
+        this._getHttpServletRequest().upgrade(handler);
+    }
 }

==================================================
CoyoteOutputStream.java
index bfe32cf204..925df98ce0 100644
--- a/java/org/apache/catalina/connector/CoyoteInputStream.java
+++ b/java/org/apache/catalina/connector/CoyoteInputStream.java
@@ -21,6 +21,7 @@ import java.security.AccessController;
 import java.security.PrivilegedActionException;
 import java.security.PrivilegedExceptionAction;
 
+import javax.servlet.ReadListener;
 import javax.servlet.ServletInputStream;
 
 import org.apache.catalina.security.SecurityUtil;
@@ -241,4 +242,35 @@ public class CoyoteInputStream
         }
     }
 
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public boolean isFinished() {
+        // TODO Auto-generated method stub
+        return false;
+    }
+
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public boolean isReady() {
+        // TODO Auto-generated method stub
+        return false;
+    }
+
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void setReadListener(ReadListener listener) {
+        // TODO Auto-generated method stub
+
+    }
+
+
+
 }

==================================================
Request.java
index 3c7bd410ab..e277ffd674 100644
--- a/java/org/apache/catalina/connector/CoyoteOutputStream.java
+++ b/java/org/apache/catalina/connector/CoyoteOutputStream.java
@@ -19,6 +19,7 @@ package org.apache.catalina.connector;
 import java.io.IOException;
 
 import javax.servlet.ServletOutputStream;
+import javax.servlet.WriteListener;
 
 /**
  * Coyote implementation of the servlet output stream.
@@ -108,6 +109,25 @@ public class CoyoteOutputStream
         ob.close();
     }
 
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public boolean canWrite() {
+        // TODO Auto-generated method stub
+        return false;
+    }
+
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void setWriteListener(WriteListener listener) {
+        // TODO Auto-generated method stub
+
+    }
+
 
 }
 

==================================================
RequestFacade.java
index 3d9af50d71..aeb369c8fa 100644
--- a/java/org/apache/catalina/connector/Request.java
+++ b/java/org/apache/catalina/connector/Request.java
@@ -59,6 +59,7 @@ import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 import javax.servlet.http.HttpSession;
 import javax.servlet.http.Part;
+import javax.servlet.http.ProtocolHandler;
 
 import org.apache.catalina.Context;
 import org.apache.catalina.Globals;
@@ -854,6 +855,7 @@ public class Request
     // ------------------------------------------------- ServletRequest Methods
 
 
+
     /**
      * Return the specified request attribute if it exists; otherwise, return
      * <code>null</code>.
@@ -909,6 +911,11 @@ public class Request
     }
 
 
+    @Override
+    public long getContentLengthLong() {
+        return coyoteRequest.getContentLengthLong();
+    }
+
     /**
      * Test if a given name is one of the special Servlet-spec SSL attributes.
      */
@@ -1837,6 +1844,14 @@ public class Request
 
     // --------------------------------------------- HttpServletRequest Methods
 
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void upgrade(ProtocolHandler handler) throws IOException {
+        // TODO Auto-generated method stub
+
+    }
 
     /**
      * Return the authentication type used for this Request.
@@ -1846,7 +1861,6 @@ public class Request
         return authType;
     }
 
-
     /**
      * Return the portion of the request URI used to select the Context
      * of the Request.

==================================================
Response.java
index 635dff9701..9dd780a1d5 100644
--- a/java/org/apache/catalina/connector/RequestFacade.java
+++ b/java/org/apache/catalina/connector/RequestFacade.java
@@ -38,6 +38,7 @@ import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 import javax.servlet.http.HttpSession;
 import javax.servlet.http.Part;
+import javax.servlet.http.ProtocolHandler;
 
 import org.apache.catalina.Globals;
 import org.apache.catalina.security.SecurityUtil;
@@ -1102,4 +1103,22 @@ public class RequestFacade implements HttpServletRequest {
             throws IOException {
         request.doUpgrade(inbound);
     }
+
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public long getContentLengthLong() {
+        return request.getContentLengthLong();
+    }
+
+
+    /**
+     * TODO SERVLET 3.1
+     */    @Override
+    public void upgrade(ProtocolHandler handler) throws IOException {
+    }
+
+
 }

==================================================
ResponseFacade.java
index 8da98b4572..bbe1780e42 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -667,6 +667,16 @@ public class Response
     @Override
     public void setContentLength(int length) {
 
+        setContentLengthLong(length);
+    }
+
+
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void setContentLengthLong(long length) {
         if (isCommitted()) {
             return;
         }

==================================================
ExpiresFilter.java
index a8d94dbf97..742d7e45a7 100644
--- a/java/org/apache/catalina/connector/ResponseFacade.java
+++ b/java/org/apache/catalina/connector/ResponseFacade.java
@@ -232,6 +232,19 @@ public class ResponseFacade
     }
 
 
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void setContentLengthLong(long length) {
+        if (isCommitted()) {
+            return;
+        }
+
+        response.setContentLengthLong(length);
+
+    }
+
     @Override
     public void setContentType(String type) {
 

==================================================
ByteArrayServletOutputStream.java
index 0964e94b15..1fa4c0fe60 100644
--- a/java/org/apache/catalina/filters/ExpiresFilter.java
+++ b/java/org/apache/catalina/filters/ExpiresFilter.java
@@ -36,6 +36,7 @@ import javax.servlet.ServletException;
 import javax.servlet.ServletOutputStream;
 import javax.servlet.ServletRequest;
 import javax.servlet.ServletResponse;
+import javax.servlet.WriteListener;
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 import javax.servlet.http.HttpServletResponseWrapper;
@@ -992,6 +993,26 @@ public class ExpiresFilter extends FilterBase {
             servletOutputStream.write(b);
         }
 
+        /**
+         * TODO SERVLET 3.1
+         */
+        @Override
+        public boolean canWrite() {
+            // TODO Auto-generated method stub
+            return false;
+        }
+
+        /**
+         * TODO SERVLET 3.1
+         */
+        @Override
+        public void setWriteListener(WriteListener listener) {
+            // TODO Auto-generated method stub
+
+        }
+
+
+
     }
 
     /**

==================================================
Util.java
index c0ad6eac0a..fc6f3bad3b 100644
--- a/java/org/apache/catalina/ssi/ByteArrayServletOutputStream.java
+++ b/java/org/apache/catalina/ssi/ByteArrayServletOutputStream.java
@@ -20,6 +20,7 @@ package org.apache.catalina.ssi;
 import java.io.ByteArrayOutputStream;
 
 import javax.servlet.ServletOutputStream;
+import javax.servlet.WriteListener;
 
 
 /**
@@ -62,4 +63,25 @@ public class ByteArrayServletOutputStream extends ServletOutputStream {
     public void write(int b) {
         buf.write(b);
     }
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public boolean canWrite() {
+        // TODO Auto-generated method stub
+        return false;
+    }
+
+
+    /**
+     * TODO SERVLET 3.1
+     */
+    @Override
+    public void setWriteListener(WriteListener listener) {
+        // TODO Auto-generated method stub
+
+    }
+
+
 }

==================================================
