4b356d590b147b18816b0d7af04a2da20a035e91
==================================================
Fix FindBugs issues (sync on mutated object)
==================================================
Mark Emlyn
==================================================
Thu Jul 12 21:27:13 2012 +0000
==================================================
StandardServer.java
Fix FindBugs issues (sync on mutated object)

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1360957 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StandardService.java
index 3754733313..99609f5c3d 100644
--- a/java/org/apache/catalina/core/StandardServer.java
+++ b/java/org/apache/catalina/core/StandardServer.java
@@ -128,6 +128,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
      * The set of Services associated with this Server.
      */
     private Service services[] = new Service[0];
+    private final Object servicesLock = new Object();
 
 
     /**
@@ -336,7 +337,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
 
         service.setServer(this);
 
-        synchronized (services) {
+        synchronized (servicesLock) {
             Service results[] = new Service[services.length + 1];
             System.arraycopy(services, 0, results, 0, services.length);
             results[services.length] = service;
@@ -518,7 +519,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
         if (name == null) {
             return (null);
         }
-        synchronized (services) {
+        synchronized (servicesLock) {
             for (int i = 0; i < services.length; i++) {
                 if (name.equals(services[i].getName())) {
                     return (services[i]);
@@ -536,7 +537,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
     @Override
     public Service[] findServices() {
 
-        return (services);
+        return services;
 
     }
 
@@ -561,7 +562,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
     @Override
     public void removeService(Service service) {
 
-        synchronized (services) {
+        synchronized (servicesLock) {
             int j = -1;
             for (int i = 0; i < services.length; i++) {
                 if (service == services[i]) {
@@ -739,7 +740,7 @@ public final class StandardServer extends LifecycleMBeanBase implements Server {
         globalNamingResources.start();
 
         // Start our defined Services
-        synchronized (services) {
+        synchronized (servicesLock) {
             for (int i = 0; i < services.length; i++) {
                 services[i].start();
             }

==================================================
