e5802028c1d24fffc7aeaf12f34854187c20e787
==================================================
Enforce ping/pong size limit.
==================================================
Remy Maucherat
==================================================
Mon Dec 1 17:57:30 2014 +0000
==================================================
WsRemoteEndpointImplBase.java
index 23848942cc..16198d145d 100644
--- a/java/org/apache/tomcat/websocket/LocalStrings.properties
+++ b/java/org/apache/tomcat/websocket/LocalStrings.properties
@@ -76,6 +76,7 @@ wsRemoteEndpoint.noEncoder=No encoder specified for object of class [{0}]
 wsRemoteEndpoint.wrongState=The remote endpoint was in state [{0}] which is an invalid state for called method
 wsRemoteEndpoint.nullData=Invalid null data argument
 wsRemoteEndpoint.nullHandler=Invalid null handler argument
+wsRemoteEndpoint.tooMuchData=Ping or pong may not send more than 125 bytes
 
 # Note the following message is used as a close reason in a WebSocket control
 # frame and therefore must be 123 bytes (not characters) or less in length.

==================================================
PojoMessageHandlerBase.java
index 4036ebb060..1c26aa9b24 100644
--- a/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java
+++ b/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java
@@ -168,6 +168,9 @@ public abstract class WsRemoteEndpointImplBase implements RemoteEndpoint {
     @Override
     public void sendPing(ByteBuffer applicationData) throws IOException,
             IllegalArgumentException {
+        if (applicationData.remaining() > 125) {
+            throw new IllegalArgumentException(sm.getString("wsRemoteEndpoint.tooMuchData"));
+        }
         startMessageBlock(Constants.OPCODE_PING, applicationData, true);
     }
 
@@ -175,6 +178,9 @@ public abstract class WsRemoteEndpointImplBase implements RemoteEndpoint {
     @Override
     public void sendPong(ByteBuffer applicationData) throws IOException,
             IllegalArgumentException {
+        if (applicationData.remaining() > 125) {
+            throw new IllegalArgumentException(sm.getString("wsRemoteEndpoint.tooMuchData"));
+        }
         startMessageBlock(Constants.OPCODE_PONG, applicationData, true);
     }
 
@@ -582,7 +588,7 @@ public abstract class WsRemoteEndpointImplBase implements RemoteEndpoint {
                 throw new EncodeException(obj, sm.getString(
                         "wsRemoteEndpoint.noEncoder", obj.getClass()));
             }
-        } catch (EncodeException | IOException e) {
+        } catch (Exception e) {
             SendResult sr = new SendResult(e);
             completion.onResult(sr);
         }

==================================================
