562834d92f077edd57b7d54fd2a0809832753767
==================================================
Send back error code and Initialise jaxrpcmapping path
==================================================
Fabien Carrion
==================================================
Wed Apr 11 21:51:57 2007 +0000
==================================================
NamingContextListener.java
Send back error code and Initialise jaxrpcmapping path

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@527693 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ServiceRefFactory.java
index e81930b5b4..f75ededeca 100644
--- a/java/org/apache/catalina/core/NamingContextListener.java
+++ b/java/org/apache/catalina/core/NamingContextListener.java
@@ -899,6 +899,40 @@ public class NamingContextListener
                 service.setWsdlfile(wsdlURL.toString());
         }
 
+        if (service.getJaxrpcmappingfile() != null) {
+            URL jaxrpcURL = null;
+
+            try {
+                jaxrpcURL = new URL(service.getJaxrpcmappingfile());
+            } catch (MalformedURLException e) {
+                jaxrpcURL = null;
+            }
+            if (jaxrpcURL == null) {
+                try {
+                    jaxrpcURL = ((Context) container).
+                                                    getServletContext().
+                                                    getResource(service.getJaxrpcmappingfile());
+                } catch (MalformedURLException e) {
+                    jaxrpcURL = null;
+                }
+            }
+            if (jaxrpcURL == null) {
+                try {
+                    jaxrpcURL = ((Context) container).
+                                                    getServletContext().
+                                                    getResource("/" + service.getJaxrpcmappingfile());
+                    logger.debug("  Changing service ref jaxrpc file for /" 
+                                + service.getJaxrpcmappingfile());
+                } catch (MalformedURLException e) {
+                    logger.error(sm.getString("naming.wsdlFailed", e));
+                }
+            }
+            if (jaxrpcURL == null)
+                service.setJaxrpcmappingfile(null);
+            else
+                service.setJaxrpcmappingfile(jaxrpcURL.toString());
+        }
+
         // Create a reference to the resource.
         Reference ref = new ServiceRef
             (service.getName(), service.getType(), service.getServiceqname(),

==================================================
