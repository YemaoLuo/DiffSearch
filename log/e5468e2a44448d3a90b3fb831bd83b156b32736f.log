e5468e2a44448d3a90b3fb831bd83b156b32736f
==================================================
Reject invalid HTTP protocols with 400 rather than 505
==================================================
Mark Thomas
==================================================
Wed Apr 28 17:21:13 2021 +0100
==================================================
Http11InputBuffer.java
Reject invalid HTTP protocols with 400 rather than 505



==================================================
TestHttp11InputBufferCRLF.java
index e3ace89237..e6255dda1a 100644
--- a/java/org/apache/coyote/http11/Http11InputBuffer.java
+++ b/java/org/apache/coyote/http11/Http11InputBuffer.java
@@ -554,7 +554,7 @@ public class Http11InputBuffer implements InputBuffer, ApplicationBufferHandler
                 } else if (prevChr == Constants.CR && chr == Constants.LF) {
                     end = pos - 1;
                     parsingRequestLineEol = true;
-                } else if (!HttpParser.isHttpProtocol(chr)) {
+                } else if (prevChr == Constants.CR || !HttpParser.isHttpProtocol(chr)) {
                     String invalidProtocol = parseInvalid(parsingRequestLineStart, byteBuffer);
                     throw new IllegalArgumentException(sm.getString("iib.invalidHttpProtocol", invalidProtocol));
                 }

==================================================
