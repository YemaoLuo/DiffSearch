f18a42ce34afc8f1f9ad8b67e76829c238cab628
==================================================
Make the nonceCountWindowSize configurable else the performance test fails.
==================================================
Mark Emlyn
==================================================
Fri Nov 2 11:05:07 2012 +0000
==================================================
DigestAuthenticator.java
Make the nonceCountWindowSize configurable else the performance test fails.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1404918 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TesterDigestAuthenticatorPerformance.java
index ce3c729bcf..228739e20d 100644
--- a/java/org/apache/catalina/authenticator/DigestAuthenticator.java
+++ b/java/org/apache/catalina/authenticator/DigestAuthenticator.java
@@ -96,6 +96,12 @@ public class DigestAuthenticator extends AuthenticatorBase {
     protected int nonceCacheSize = 1000;
 
 
+    /**
+     * The window size to use to track seen nonce count values for a given
+     * nonce. If not specified, the default of 100 is used.
+     */
+    protected int nonceCountWindowSize = 100;
+
     /**
      * Private key.
      */
@@ -123,6 +129,16 @@ public class DigestAuthenticator extends AuthenticatorBase {
 
     // ------------------------------------------------------------- Properties
 
+    public int getNonceCountWindowSize() {
+        return nonceCountWindowSize;
+    }
+
+
+    public void setNonceCountWindowSize(int nonceCountWindowSize) {
+        this.nonceCountWindowSize = nonceCountWindowSize;
+    }
+
+
     public int getNonceCacheSize() {
         return nonceCacheSize;
     }
@@ -315,7 +331,7 @@ public class DigestAuthenticator extends AuthenticatorBase {
                 ipTimeKey.getBytes(B2CConverter.ISO_8859_1));
         String nonce = currentTime + ":" + MD5Encoder.encode(buffer);
 
-        NonceInfo info = new NonceInfo(currentTime, 100);
+        NonceInfo info = new NonceInfo(currentTime, getNonceCountWindowSize());
         synchronized (nonces) {
             nonces.put(nonce, info);
         }

==================================================
