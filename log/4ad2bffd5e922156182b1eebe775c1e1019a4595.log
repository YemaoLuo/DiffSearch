4ad2bffd5e922156182b1eebe775c1e1019a4595
==================================================
Fix root cause of NPE when using WebSocket clients.
==================================================
Mark Emlyn
==================================================
Mon Jun 30 09:27:33 2014 +0000
==================================================
WsFrameClient.java
Fix root cause of NPE when using WebSocket clients.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1606653 13f79535-47bb-0310-9956-ffa450edef68



==================================================
WsRemoteEndpointImplBase.java
index 083f32ab59..41cf71287f 100644
--- a/java/org/apache/tomcat/websocket/WsFrameClient.java
+++ b/java/org/apache/tomcat/websocket/WsFrameClient.java
@@ -37,7 +37,10 @@ public class WsFrameClient extends WsFrameBase {
         this.response = response;
         this.channel = channel;
         this.handler = new WsFrameClientCompletionHandler();
+    }
+
 
+    void startInputProcessing() {
         try {
             processSocketRead();
         } catch (IOException e) {

==================================================
WsWebSocketContainer.java
index 6d05b28ebe..e4a16e04ba 100644
--- a/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java
+++ b/java/org/apache/tomcat/websocket/WsRemoteEndpointImplBase.java
@@ -260,9 +260,7 @@ public abstract class WsRemoteEndpointImplBase implements RemoteEndpoint {
         messageParts.add(new MessagePart(opCode, payload, last,
                 new EndMessageHandler(this, handler)));
 
-        if (transformation != null) {
-            messageParts = transformation.sendMessagePart(messageParts);
-        }
+        messageParts = transformation.sendMessagePart(messageParts);
 
         MessagePart mp = messageParts.remove(0);
 

==================================================
