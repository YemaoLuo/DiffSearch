b0f0eb0ca7a7418f9d72beeb857678e65529afea
==================================================
- The listener field didn't seem to be recycled anywhere.
==================================================
Remy Maucherat
==================================================
Mon Mar 18 15:15:37 2013 +0000
==================================================
InputBuffer.java
- The listener field didn't seem to be recycled anywhere.
- Throw an ISE if already set (the spec says that).

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1457800 13f79535-47bb-0310-9956-ffa450edef68



==================================================
OutputBuffer.java
index eed9c95f3a..6b5486fda8 100644
--- a/java/org/apache/catalina/connector/InputBuffer.java
+++ b/java/org/apache/catalina/connector/InputBuffer.java
@@ -210,6 +210,7 @@ public class InputBuffer extends Reader
 
         gotEnc = false;
         enc = null;
+        listener = null;
 
     }
 
@@ -251,6 +252,7 @@ public class InputBuffer extends Reader
 
     private volatile ReadListener listener;
     public void setReadListener(ReadListener listener) {
+        if (getReadListener()!=null) throw new IllegalStateException("Read listener already set.");
         this.listener = listener;
         coyoteRequest.action(ActionCode.SET_READ_LISTENER, listener);
     }

==================================================
