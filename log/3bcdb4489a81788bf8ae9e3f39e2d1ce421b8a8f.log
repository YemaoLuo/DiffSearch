3bcdb4489a81788bf8ae9e3f39e2d1ce421b8a8f
==================================================
Optimisation suggested by kkolinko and a test case to make sure it does what it is meant to. The test case is obvious but I missed something in my first look at the code so wrote the test case which may as well be kept.
==================================================
Mark Emlyn
==================================================
Tue Nov 13 15:14:30 2012 +0000
==================================================
JasperELResolver.java
Optimisation suggested by kkolinko and a test case to make sure it does what it is meant to. The test case is obvious but I missed something in my first look at the code so wrote the test case which may as well be kept.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1408774 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestJasperELResolver.java
index 0df9de9777..9b4e41e4da 100644
--- a/java/org/apache/jasper/el/JasperELResolver.java
+++ b/java/org/apache/jasper/el/JasperELResolver.java
@@ -44,8 +44,8 @@ public class JasperELResolver extends CompositeELResolver {
 
     public JasperELResolver(List<ELResolver> appResolvers) {
         appResolversSize = appResolvers.size();
-        resolvers = new ELResolver[0];
-        size = resolvers.length;
+        resolvers = new ELResolver[appResolversSize + 7];
+        size = 0;
 
         add(new ImplicitObjectELResolver());
         for (ELResolver appResolver : appResolvers) {
@@ -63,11 +63,15 @@ public class JasperELResolver extends CompositeELResolver {
     public synchronized void add(ELResolver elResolver) {
         super.add(elResolver);
 
-        ELResolver[] nr = new ELResolver[size + 1];
-        System.arraycopy(resolvers, 0, nr, 0, size);
-        nr[size] = elResolver;
+        if (resolvers.length < size) {
+            resolvers[size] = elResolver;
+        } else {
+            ELResolver[] nr = new ELResolver[size + 1];
+            System.arraycopy(resolvers, 0, nr, 0, size);
+            nr[size] = elResolver;
 
-        resolvers = nr;
+            resolvers = nr;
+        }
         size ++;
     }
 

==================================================
