80bf93b9421147513b608888fb3b3610b7d3f674
==================================================
Update Servlet version to 4.0.
==================================================
Mark Thomas
==================================================
Fri Oct 9 12:58:48 2015 +0000
==================================================
ServletContext.java
index 923605ebbb..da17368d5b 100644
--- a/build.xml
+++ b/build.xml
@@ -44,7 +44,7 @@
   <property name="md5sum.binary-prefix" value=" *" />
 
   <!-- Exact spec versions (for the manifests) -->
-  <property name="servlet.revision" value="FR" />
+  <property name="servlet.revision" value="EDR-b01" />
   <property name="jsp.revision" value="FR" />
   <property name="el.revision" value="FR" />
   <property name="websocket.revision" value="FR" />
@@ -706,7 +706,7 @@
       filesId="files.annotations-api"
       manifest="${tomcat.manifests}/annotations-api.jar.manifest" />
 
-    <!-- Servlet 3.1 Implementation JAR File -->
+    <!-- Servlet 4.0 Implementation JAR File -->
     <jarIt jarfile="${servlet-api.jar}"
       filesDir="${tomcat.classes}"
       filesId="files.servlet-api"
@@ -1923,9 +1923,9 @@ Apache Tomcat ${version} native binaries for Win64 AMD64/EMT64 platform.
       sourcepath="${tomcat.dist}/src/java"
       destdir="${tomcat.dist}/webapps/docs/servletapi"
       version="true"
-      windowtitle="Servlet 3.1 API Documentation - Apache Tomcat ${version}"
-      doctitle="Servlet 3.1 API - Apache Tomcat ${version}"
-      header="&lt;b&gt;Servlet 3.1 - Apache Tomcat ${version}&lt;/b&gt;"
+      windowtitle="Servlet 4.0 API Documentation - Apache Tomcat ${version}"
+      doctitle="Servlet 4.0 API - Apache Tomcat ${version}"
+      header="&lt;b&gt;Servlet 4.0 - Apache Tomcat ${version}&lt;/b&gt;"
       bottom="Copyright &amp;#169; 2000-${year} Apache Software Foundation. All Rights Reserved."
       encoding="UTF-8"
       docencoding="UTF-8"
@@ -2632,7 +2632,7 @@ skip.installer property in build.properties" />
       filesId="files.annotations-api"
       manifest="${tomcat.manifests}/annotations-api.jar.manifest" />
 
-    <!-- Servlet 3.1 Implementation JAR File -->
+    <!-- Servlet 4.0 Implementation JAR File -->
     <jarIt jarfile="${servlet-api-src.jar}"
       filesDir="java"
       filesId="files.servlet-api"

==================================================
CoyoteAdapter.java
index 5ee1ed8a9c..1fdd1e7f4e 100644
--- a/java/javax/servlet/ServletContext.java
+++ b/java/javax/servlet/ServletContext.java
@@ -90,19 +90,19 @@ public interface ServletContext {
 
     /**
      * Returns the major version of the Java Servlet API that this servlet
-     * container supports. All implementations that comply with Version 3.1 must
-     * have this method return the integer 3.
+     * container supports. All implementations that comply with Version 4.0 must
+     * have this method return the integer 4.
      *
-     * @return 3
+     * @return 4
      */
     public int getMajorVersion();
 
     /**
      * Returns the minor version of the Servlet API that this servlet container
-     * supports. All implementations that comply with Version 3.1 must have this
-     * method return the integer 1.
+     * supports. All implementations that comply with Version 4.0 must have this
+     * method return the integer 0.
      *
-     * @return 1
+     * @return 0
      */
     public int getMinorVersion();
 

==================================================
ApplicationContext.java
index b0fc0af803..2ae93a1bcc 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -67,7 +67,7 @@ public class CoyoteAdapter implements Adapter {
 
     // -------------------------------------------------------------- Constants
 
-    private static final String POWERED_BY = "Servlet/3.1 JSP/2.3 " +
+    private static final String POWERED_BY = "Servlet/4.0 JSP/2.3 " +
             "(" + ServerInfo.getServerInfo() + " Java/" +
             System.getProperty("java.vm.vendor") + "/" +
             System.getProperty("java.runtime.version") + ")";

==================================================
Constants.java
index 4235bf38a5..0cdb5585f4 100644
--- a/java/org/apache/catalina/core/ApplicationContext.java
+++ b/java/org/apache/catalina/core/ApplicationContext.java
@@ -324,25 +324,15 @@ public class ApplicationContext
     }
 
 
-    /**
-     * Return the major version of the Java Servlet API that we implement.
-     */
     @Override
     public int getMajorVersion() {
-
-        return (Constants.MAJOR_VERSION);
-
+        return Constants.MAJOR_VERSION;
     }
 
 
-    /**
-     * Return the minor version of the Java Servlet API that we implement.
-     */
     @Override
     public int getMinorVersion() {
-
-        return (Constants.MINOR_VERSION);
-
+        return Constants.MINOR_VERSION;
     }
 
 

==================================================
WebXml.java
index 44f916f29f..197e0c6b8c 100644
--- a/java/org/apache/catalina/core/Constants.java
+++ b/java/org/apache/catalina/core/Constants.java
@@ -14,17 +14,13 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-
-
 package org.apache.catalina.core;
 
-
 public class Constants {
 
     public static final String Package = "org.apache.catalina.core";
-    public static final int MAJOR_VERSION = 3;
-    public static final int MINOR_VERSION = 1;
+    public static final int MAJOR_VERSION = 4;
+    public static final int MINOR_VERSION = 0;
 
-    public static final String JSP_SERVLET_CLASS =
-        "org.apache.jasper.servlet.JspServlet";
+    public static final String JSP_SERVLET_CLASS = "org.apache.jasper.servlet.JspServlet";
 }

==================================================
TestSchemaValidation.java
index 63fba29ebb..5a18167ae2 100644
--- a/res/META-INF/servlet-api.jar.manifest
+++ b/res/META-INF/servlet-api.jar.manifest
@@ -4,8 +4,8 @@ X-Compile-Target-JDK: @target.jdk@
 
 Name: javax/servlet/
 Specification-Title: Java API for Servlets
-Specification-Version: 3.1
+Specification-Version: 4.0
 Specification-Vendor: Sun Microsystems, Inc.
 Implementation-Title: javax.servlet
-Implementation-Version: 3.1.@servlet.revision@
+Implementation-Version: 4.0.@servlet.revision@
 Implementation-Vendor: Apache Software Foundation

==================================================
TestWebXml.java
index 33f03b2dd5..7c60cf4e9b 100644
--- a/test/javax/servlet/resources/TestSchemaValidation.java
+++ b/test/javax/servlet/resources/TestSchemaValidation.java
@@ -129,4 +129,6 @@ public class TestSchemaValidation {
         Assert.assertEquals(0, handler.getErrors().size());
         Assert.assertEquals(0, handler.getWarnings().size());
     }
+
+    // TODO Servlet 4.0
 }

==================================================
