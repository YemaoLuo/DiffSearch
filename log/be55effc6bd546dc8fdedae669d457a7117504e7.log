be55effc6bd546dc8fdedae669d457a7117504e7
==================================================
Fix some SpotBugs false positives
==================================================
Mark Thomas
==================================================
Fri Oct 13 15:04:47 2017 +0000
==================================================
TestLoadBalancerDrainingValve.java
Fix some SpotBugs false positives

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1812139 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestUpgrade.java
index c1786d074d..f57725ac99 100644
--- a/test/org/apache/catalina/valves/TestLoadBalancerDrainingValve.java
+++ b/test/org/apache/catalina/valves/TestLoadBalancerDrainingValve.java
@@ -129,9 +129,11 @@ public class TestLoadBalancerDrainingValve {
 
         @Override
         public boolean equals(Object o) {
-            if(null == o) return false;
-            MyCookie mc = (MyCookie)o;
+            if(!(o instanceof MyCookie)) {
+                return false;
+            }
 
+            MyCookie mc = (MyCookie)o;
             return mc.getName().equals(this.getName())
                 && mc.getPath().equals(this.getPath())
                 && mc.getValue().equals(this.getValue())

==================================================
TestUpgradeInternalHandler.java
index 1e542c0d08..207145390d 100644
--- a/test/org/apache/coyote/http11/upgrade/TestUpgrade.java
+++ b/test/org/apache/coyote/http11/upgrade/TestUpgrade.java
@@ -148,6 +148,7 @@ public class TestUpgrade extends TomcatBaseTest {
         Assert.assertEquals(MESSAGE, response);
 
         uc.shutdownInput();
+        pw.close();
     }
 
 

==================================================
TestJspC.java
index 76d62ab38d..25df6374a1 100644
--- a/test/org/apache/coyote/http11/upgrade/TestUpgradeInternalHandler.java
+++ b/test/org/apache/coyote/http11/upgrade/TestUpgradeInternalHandler.java
@@ -80,6 +80,7 @@ public class TestUpgradeInternalHandler extends TomcatBaseTest {
         Assert.assertEquals(MESSAGE, response);
 
         uc.shutdownInput();
+        pw.close();
     }
 
     private UpgradeConnection doUpgrade(

==================================================
TestJspCompilationContext.java
index 9fbc721905..9014039394 100644
--- a/test/org/apache/jasper/TestJspC.java
+++ b/test/org/apache/jasper/TestJspC.java
@@ -114,7 +114,7 @@ public class TestJspC {
 
     private void precompile(File appDir, File webappOut) throws IOException {
         remove(webappOut);
-        webappOut.mkdirs();
+        Assert.assertTrue("Failed to create [" + webappOut + "]", webappOut.mkdirs());
         jspc.setUriroot(appDir.toString());
         jspc.setOutputDir(webappOut.toString());
         jspc.setValidateTld(false);

==================================================
TesterSupport.java
index 7a9d36c0a8..7c1b7866d3 100644
--- a/test/org/apache/jasper/TestJspCompilationContext.java
+++ b/test/org/apache/jasper/TestJspCompilationContext.java
@@ -58,7 +58,8 @@ public class TestJspCompilationContext extends TomcatBaseTest {
         Assert.assertTrue(body.toString().contains("00 - OK"));
 
         File jsp = new File("test/webapp/jsp/tagFileInJar.jsp");
-        jsp.setLastModified(jsp.lastModified() + 10000);
+        Assert.assertTrue("Failed to set last modified for [" + jsp + "]",
+                jsp.setLastModified(jsp.lastModified() + 10000));
 
         // This test requires that modificationTestInterval is set to zero in
         // web.xml. If not, a sleep longer that modificationTestInterval is

==================================================
