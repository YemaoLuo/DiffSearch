b13a305e64b3a174c8f60bde31ac5fc7f298ccb3
==================================================
Enable test case for BZ54012 and refactor common code to base class.
==================================================
Mark Emlyn
==================================================
Thu Oct 25 11:58:00 2012 +0000
==================================================
AbstractTestTag.java
Enable test case for BZ54012 and refactor common code to base class.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1402115 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestOut.java
new file mode 100644
index 0000000000..5b09e00d88
--- /dev/null
+++ b/test/org/apache/jasper/tagplugins/jstl/core/AbstractTestTag.java
@@ -0,0 +1,55 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.jasper.tagplugins.jstl.core;
+
+import java.io.File;
+
+import org.junit.Before;
+
+import org.apache.catalina.Context;
+import org.apache.catalina.WebResourceRoot;
+import org.apache.catalina.startup.Tomcat;
+import org.apache.catalina.startup.TomcatBaseTest;
+import org.apache.catalina.webresources.StandardRoot;
+
+public abstract class AbstractTestTag extends TomcatBaseTest {
+
+    @Before
+    public void setup() throws Exception {
+        Tomcat tomcat = getTomcatInstance();
+
+        File appDir = new File("test/webapp-3.0");
+        Context ctx = tomcat.addWebapp(null, "/test", appDir.getAbsolutePath());
+
+        ctx.setResources(new StandardRoot(ctx));
+
+        // Add the JSTL (we need the TLD)
+        File lib = new File("webapps/examples/WEB-INF/lib");
+        ctx.getResources().createWebResourceSet(
+                WebResourceRoot.ResourceSetType.POST, lib.getAbsolutePath(),
+                "/WEB-INF/lib", "");
+
+        // Configure the use of the plug-in rather than the standard impl
+        File plugin = new File(
+                "java/org/apache/jasper/tagplugins/jstl/tagPlugins.xml");
+        ctx.getResources().createWebResourceSet(
+                WebResourceRoot.ResourceSetType.POST, plugin.getAbsolutePath(),
+                "/WEB-INF/tagPlugins.xml", "");
+
+        tomcat.start();
+    }
+}

==================================================
TestSet.java
index 16f225cc0f..b0a9b51e6e 100644
--- a/test/org/apache/jasper/tagplugins/jstl/core/TestOut.java
+++ b/test/org/apache/jasper/tagplugins/jstl/core/TestOut.java
@@ -16,46 +16,17 @@
  */
 package org.apache.jasper.tagplugins.jstl.core;
 
-import java.io.File;
-
 import javax.servlet.http.HttpServletResponse;
 
 import org.junit.Assert;
 import org.junit.Test;
 
-import org.apache.catalina.Context;
-import org.apache.catalina.WebResourceRoot;
-import org.apache.catalina.startup.Tomcat;
-import org.apache.catalina.startup.TomcatBaseTest;
-import org.apache.catalina.webresources.StandardRoot;
 import org.apache.tomcat.util.buf.ByteChunk;
 
-public class TestOut extends TomcatBaseTest {
+public class TestOut extends AbstractTestTag {
 
     @Test
     public void testBug54011() throws Exception {
-        Tomcat tomcat = getTomcatInstance();
-
-        File appDir = new File("test/webapp-3.0");
-        Context ctx = tomcat.addWebapp(null, "/test", appDir.getAbsolutePath());
-
-        ctx.setResources(new StandardRoot(ctx));
-
-        // Add the JSTL (we need the TLD)
-        File lib = new File("webapps/examples/WEB-INF/lib");
-        ctx.getResources().createWebResourceSet(
-                WebResourceRoot.ResourceSetType.POST, lib.getAbsolutePath(),
-                "/WEB-INF/lib", "");
-
-        // Configure the use of the plug-in rather than the standard impl
-        File plugin = new File(
-                "java/org/apache/jasper/tagplugins/jstl/tagPlugins.xml");
-        ctx.getResources().createWebResourceSet(
-                WebResourceRoot.ResourceSetType.POST, plugin.getAbsolutePath(),
-                "/WEB-INF/tagPlugins.xml", "");
-
-        tomcat.start();
-
         ByteChunk res = new ByteChunk();
 
         int rc = getUrl("http://localhost:" + getPort() +

==================================================
