4e452a2747298667d6cf31613b8447611eccd13f
==================================================
Pull up sslSupport to the AbstractProcessor.
==================================================
Mark Thomas
==================================================
Thu Oct 8 21:26:24 2015 +0000
==================================================
AbstractProcessor.java
Pull up sslSupport to the AbstractProcessor.
This removes the check for this being set for AJP but that check never detected a bug

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1707622 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpProcessor.java
index 9eb97e1a62..e14db72d2e 100644
--- a/java/org/apache/coyote/AbstractProcessor.java
+++ b/java/org/apache/coyote/AbstractProcessor.java
@@ -26,6 +26,7 @@ import org.apache.juli.logging.Log;
 import org.apache.tomcat.util.ExceptionUtils;
 import org.apache.tomcat.util.net.AbstractEndpoint;
 import org.apache.tomcat.util.net.AbstractEndpoint.Handler.SocketState;
+import org.apache.tomcat.util.net.SSLSupport;
 import org.apache.tomcat.util.net.SocketStatus;
 import org.apache.tomcat.util.net.SocketWrapperBase;
 import org.apache.tomcat.util.res.StringManager;
@@ -44,6 +45,7 @@ public abstract class AbstractProcessor implements ActionHook, Processor {
     protected final Request request;
     protected final Response response;
     protected volatile SocketWrapperBase<?> socketWrapper = null;
+    protected volatile SSLSupport sslSupport;
     private String clientCertProvider = null;
 
     /**
@@ -167,6 +169,15 @@ public abstract class AbstractProcessor implements ActionHook, Processor {
     }
 
 
+    /**
+     * Set the SSL information for this HTTP connection.
+     */
+    @Override
+    public final void setSslSupport(SSLSupport sslSupport) {
+        this.sslSupport = sslSupport;
+    }
+
+
     /**
      * Obtain the Executor used by the underlying endpoint.
      */
@@ -247,6 +258,14 @@ public abstract class AbstractProcessor implements ActionHook, Processor {
     }
 
 
+    /**
+     * Perform any necessary processing for a non-blocking read before
+     * dispatching to the adapter.
+     */
+    protected void dispatchNonBlockingRead() {
+        asyncStateMachine.asyncOperation();
+    }
+
     /**
      * Flush any pending writes. Used during non-blocking writes to flush any
      * remaining data from a previous incomplete write.
@@ -259,14 +278,6 @@ public abstract class AbstractProcessor implements ActionHook, Processor {
      */
     protected abstract boolean flushBufferedWrite() throws IOException ;
 
-    /**
-     * Perform any necessary processing for a non-blocking read before
-     * dispatching to the adapter.
-     */
-    protected void dispatchNonBlockingRead() {
-        asyncStateMachine.asyncOperation();
-    }
-
     /**
      * Perform any necessary clean-up processing if the dispatch resulted in the
      * completion of processing for the current request.

==================================================
Http11Processor.java
index 6eb27108c7..331d7b2583 100644
--- a/java/org/apache/coyote/ajp/LocalStrings.properties
+++ b/java/org/apache/coyote/ajp/LocalStrings.properties
@@ -26,7 +26,6 @@ ajpprocessor.readtimeout=Timeout attempting to read data from the socket
 ajpprocessor.request.prepare=Error preparing request
 ajpprocessor.request.process=Error processing request
 ajpprocessor.certs.fail=Certificate conversion failed
-ajpprocessor.ssl.notsupported=The SSL protocol is not supported by this connector
 ajpprocessor.httpupgrade.notsupported=HTTP upgrade is not supported by the AJP protocol
 
 ajpmessage.null=Cannot append null value

==================================================
StreamProcessor.java
index c54bad5b4e..8f4648918c 100644
--- a/java/org/apache/coyote/http11/Http11Processor.java
+++ b/java/org/apache/coyote/http11/Http11Processor.java
@@ -230,12 +230,6 @@ public class Http11Processor extends AbstractProcessor {
     protected SendfileDataBase sendfileData = null;
 
 
-    /**
-     * SSL information.
-     */
-    protected SSLSupport sslSupport;
-
-
     /**
      * UpgradeProtocol information
      */
@@ -628,15 +622,6 @@ public class Http11Processor extends AbstractProcessor {
     }
 
 
-    /**
-     * Set the SSL information for this HTTP connection.
-     */
-    @Override
-    public void setSslSupport(SSLSupport sslSupport) {
-        this.sslSupport = sslSupport;
-    }
-
-
     /**
      * Send an action to the connector.
      *

==================================================
