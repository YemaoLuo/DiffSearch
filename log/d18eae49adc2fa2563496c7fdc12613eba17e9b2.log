d18eae49adc2fa2563496c7fdc12613eba17e9b2
==================================================
Add logging and JMX support to JSP unloading.
==================================================
Rainer Jung
==================================================
Tue Nov 2 12:14:43 2010 +0000
==================================================
JspRuntimeContext.java
Add logging and JMX support to JSP unloading.

Also need to make getContent() public in
FastRemovalDequeue to support logging.


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1030014 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspServlet.java
index 616eea5733..cae25290a5 100644
--- a/java/org/apache/jasper/resources/LocalStrings.properties
+++ b/java/org/apache/jasper/resources/LocalStrings.properties
@@ -472,3 +472,11 @@ jsp.error.bug48498=Unable to display JSP extract. Probably due to an XML parser
 
 # UniqueAttributesImpl
 jsp.error.duplicateqname=An attribute with duplicate qualified name [{0}] was found. Attribute qualified names must be unique within an element.
+
+# JSP unloading handling
+jsp.message.jsp_queue_created=Created jsp queue with length {0} for context [{1}]
+jsp.message.jsp_added=Adding JSP for path [{0}] to queue of context [{1}]
+jsp.message.jsp_queue_update=Updating JSP for path [{0}] in queue of context [{1}]
+jsp.message.jsp_removed_excess=Removing excess JSP for path [{0}] from queue of context [{1}]
+jsp.message.jsp_removed_idle=Removing idle JSP for path [{0}] in context [{1}] after {2} seconds");
+jsp.message.jsp_unload_check=Checking JSPs for unload in context [{0}], JSP count: {1} queue length: {2}

==================================================
FastRemovalDequeue.java
index d678381bd2..d784537d8d 100644
--- a/java/org/apache/jasper/servlet/mbeans-descriptors.xml
+++ b/java/org/apache/jasper/servlet/mbeans-descriptors.xml
@@ -31,6 +31,14 @@
           description="The number of JSPs that have been reloaded"
                  type="int"/>
 
+    <attribute   name="jspUnloadCount"
+          description="The number of JSPs that have been unloaded"
+                 type="int"/>
+
+    <attribute   name="jspQueueLength"
+          description="The length of the JSP queue (if enabled via maxLoadedJsps)"
+                 type="int"/>
+
   </mbean>
 
-</mbeans-descriptors>
\ No newline at end of file
+</mbeans-descriptors>

==================================================
