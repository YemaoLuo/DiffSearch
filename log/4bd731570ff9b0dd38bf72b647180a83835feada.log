4bd731570ff9b0dd38bf72b647180a83835feada
==================================================
spec says that "started" is defined as started until the thread has returned to the container.
==================================================
Filip Hanik
==================================================
Fri Mar 26 13:38:02 2010 +0000
==================================================
CoyoteAdapter.java
spec says that "started" is defined as started until the thread has returned to the container.


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@927845 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AsyncContextImpl.java
index d8e8d2226e..aebfffa926 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -428,7 +428,7 @@ public class CoyoteAdapter implements Adapter {
 
             }
             AsyncContextImpl asyncConImpl = (AsyncContextImpl)request.getAsyncContext();
-            if (request.isAsyncStarted()) {
+            if (asyncConImpl!=null && asyncConImpl.getState()==AsyncContextImpl.AsyncState.STARTED) {
                 res.action(ActionCode.ACTION_ASYNC_START, request.getAsyncContext());
                 async = true;
             } else if (asyncConImpl!=null && 

==================================================
