82ca0fc04bbc9484e81b817778bab357ecea4a53
==================================================
Use unique file names for each test in an effort to identify where the conflict is that triggers occasional CI failures.
==================================================
Mark Thomas
==================================================
Mon Apr 18 10:07:02 2016 +0000
==================================================
AbstractTestResourceSet.java
Use unique file names for each test in an effort to identify where the conflict is that triggers occasional CI failures.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1739726 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestDirResourceSet.java
index 78fe079caf..0b46ee0ab0 100644
--- a/test/org/apache/catalina/webresources/AbstractTestResourceSet.java
+++ b/test/org/apache/catalina/webresources/AbstractTestResourceSet.java
@@ -382,17 +382,20 @@ public abstract class AbstractTestResourceSet {
 
     @Test
     public final void testMkdirNew() {
+        String newDirName = getNewDirName();
         if (isWriteable()) {
-            Assert.assertTrue(resourceRoot.mkdir(getMount() + "/new-test"));
+            Assert.assertTrue(resourceRoot.mkdir(getMount() + "/" + newDirName));
 
-            File file = new File(getBaseDir(), "new-test");
+            File file = new File(getBaseDir(), newDirName);
             Assert.assertTrue(file.isDirectory());
             Assert.assertTrue(file.delete());
         } else {
-            Assert.assertFalse(resourceRoot.mkdir(getMount() + "/new-test"));
+            Assert.assertFalse(resourceRoot.mkdir(getMount() + "/" + newDirName));
         }
     }
 
+    protected abstract String getNewDirName();
+
     //------------------------------------------------------------------ write()
 
     @Test(expected = IllegalArgumentException.class)
@@ -449,25 +452,30 @@ public abstract class AbstractTestResourceSet {
     }
 
     @Test(expected = NullPointerException.class)
-    public final void testWriteNew() {
-        resourceRoot.write(getMount() + "/new-test", null, false);
+    public final void testWriteNull() {
+        resourceRoot.write(getMount() + "/" + getNewFileNameNull(), null, false);
     }
 
+    protected abstract String getNewFileNameNull();
+
     @Test
     public final void testWrite() {
+        String newFileName = getNewFileName();
         InputStream is = new ByteArrayInputStream("test".getBytes());
         if (isWriteable()) {
             Assert.assertTrue(resourceRoot.write(
-                    getMount() + "/new-test", is, false));
-            File file = new File(getBaseDir(), "new-test");
+                    getMount() + "/" + newFileName, is, false));
+            File file = new File(getBaseDir(), newFileName);
             Assert.assertTrue(file.exists());
             Assert.assertTrue(file.delete());
         } else {
             Assert.assertFalse(resourceRoot.write(
-                    getMount() + "/new-test", is, false));
+                    getMount() + "/" + newFileName, is, false));
         }
     }
 
+    protected abstract String getNewFileName();
+
     // ------------------------------------------------------ getCanonicalPath()
 
     @Test

==================================================
TestDirResourceSetInternal.java
index 2c25cb10fc..33a20cfa1e 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSet.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSet.java
@@ -75,4 +75,19 @@ public class TestDirResourceSet extends AbstractTestResourceSet {
         @SuppressWarnings("unused")
         Object obj = new DirResourceSet();
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-01";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-01";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-01";
+    }
 }

==================================================
TestDirResourceSetMount.java
index f8b7706878..108fc77f9d 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSetInternal.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSetInternal.java
@@ -71,4 +71,19 @@ public class TestDirResourceSetInternal extends AbstractTestResourceSet {
     public void testNoArgConstructor() {
         // NO-OP. Tested in TestDirResource
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-02";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-02";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-02";
+    }
 }

==================================================
TestDirResourceSetReadOnly.java
index 49dd85ee50..dc413c98ec 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSetMount.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSetMount.java
@@ -67,4 +67,19 @@ public class TestDirResourceSetMount extends AbstractTestResourceSetMount {
     public File getBaseDir() {
         return dir1;
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-03";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-03";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-03";
+    }
 }

==================================================
TestDirResourceSetVirtual.java
index 738b3d0ff5..e8e0a58edc 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSetReadOnly.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSetReadOnly.java
@@ -47,4 +47,19 @@ public class TestDirResourceSetReadOnly extends AbstractTestResourceSet {
     public void testNoArgConstructor() {
         // NO-OP. Tested in TestDirResource
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-04";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-04";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-04";
+    }
 }

==================================================
TestFileResourceSet.java
index ce0a9aee4d..bf79b28f62 100644
--- a/test/org/apache/catalina/webresources/TestDirResourceSetVirtual.java
+++ b/test/org/apache/catalina/webresources/TestDirResourceSetVirtual.java
@@ -89,4 +89,19 @@ public class TestDirResourceSetVirtual extends AbstractTestResourceSet {
     public void testNoArgConstructor() {
         // NO-OP. Tested in TestDirResource
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-05";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-05";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-05";
+    }
 }

==================================================
TestFileResourceSetReadOnly.java
index c0f0c02f1c..d4523e1a0f 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSet.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSet.java
@@ -54,4 +54,19 @@ public class TestFileResourceSet extends AbstractTestFileResourceSet {
     protected String getDir1() {
         return dir1.getAbsolutePath();
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-06";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-06";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-06";
+    }
 }
\ No newline at end of file

==================================================
TestFileResourceSetVirtual.java
index f41e0fd779..8b29410426 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSetReadOnly.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSetReadOnly.java
@@ -54,4 +54,19 @@ public class TestFileResourceSetReadOnly extends AbstractTestFileResourceSet {
     protected String getDir1() {
         return dir1.getAbsolutePath();
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-07";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-07";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-07";
+    }
 }
\ No newline at end of file

==================================================
TestJarResourceSet.java
index 86a93cf10c..4c581a9b88 100644
--- a/test/org/apache/catalina/webresources/TestFileResourceSetVirtual.java
+++ b/test/org/apache/catalina/webresources/TestFileResourceSetVirtual.java
@@ -59,4 +59,19 @@ public class TestFileResourceSetVirtual extends TestFileResourceSet {
     protected String getDir1() {
         return dir1.getAbsolutePath();
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-11";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-11";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-11";
+    }
 }

==================================================
TestJarResourceSetInternal.java
index 89d2b2ded3..ed6c65fe47 100644
--- a/test/org/apache/catalina/webresources/TestJarResourceSet.java
+++ b/test/org/apache/catalina/webresources/TestJarResourceSet.java
@@ -51,4 +51,19 @@ public class TestJarResourceSet extends AbstractTestResourceSet {
         @SuppressWarnings("unused")
         Object obj = new JarResourceSet();
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-08";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-08";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-08";
+    }
 }

==================================================
TestJarResourceSetMount.java
index c5a3ccea8a..1eb15f4069 100644
--- a/test/org/apache/catalina/webresources/TestJarResourceSetInternal.java
+++ b/test/org/apache/catalina/webresources/TestJarResourceSetInternal.java
@@ -51,4 +51,19 @@ public class TestJarResourceSetInternal extends AbstractTestResourceSet {
         @SuppressWarnings("unused")
         Object obj = new JarResourceSet();
     }
+
+    @Override
+    protected String getNewDirName() {
+        return "test-dir-09";
+    }
+
+    @Override
+    protected String getNewFileNameNull() {
+        return "test-null-09";
+    }
+
+    @Override
+    protected String getNewFileName() {
+        return "test-file-09";
+    }
 }

==================================================
