49f705b8568db138409f5fc5cf9dcfb210f1f490
==================================================
Add disableKeepAlivePercentage attribute to the HTTP-BIO connector
==================================================
Mark Emlyn
==================================================
Thu May 5 15:01:46 2011 +0000
==================================================
Http11Processor.java
Add disableKeepAlivePercentage attribute to the HTTP-BIO connector

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1099834 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11Protocol.java
index 94dc4c7cbd..bff093cc08 100644
--- a/java/org/apache/coyote/http11/Http11Processor.java
+++ b/java/org/apache/coyote/http11/Http11Processor.java
@@ -118,6 +118,12 @@ public class Http11Processor extends AbstractHttp11Processor {
     protected JIoEndpoint endpoint;
 
 
+    /**
+     * The percentage of threads that have to be in use before keep-alive is
+     * disabled to aid scalability.
+     */
+    private int disableKeepAlivePercentage = 75;
+
     // --------------------------------------------------------- Public Methods
 
 
@@ -137,6 +143,16 @@ public class Http11Processor extends AbstractHttp11Processor {
     }
 
 
+    public int getDisableKeepAlivePercentage() {
+        return disableKeepAlivePercentage;
+    }
+
+
+    public void setDisableKeepAlivePercentage(int disableKeepAlivePercentage) {
+        this.disableKeepAlivePercentage = disableKeepAlivePercentage;
+    }
+
+
     /**
      * Process pipelined HTTP requests on the specified socket.
      *
@@ -181,8 +197,8 @@ public class Http11Processor extends AbstractHttp11Processor {
                     / endpoint.getMaxThreads();     
         }   
         // Disable keep-alive if we are running low on threads      
-        if (threadRatio > 75) {     
-            keepAliveLeft = 1;      
+        if (threadRatio > getDisableKeepAlivePercentage()) {     
+            keepAliveLeft = 1;
         }
 
         try {

==================================================
