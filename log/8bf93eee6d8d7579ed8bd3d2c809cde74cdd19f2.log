8bf93eee6d8d7579ed8bd3d2c809cde74cdd19f2
==================================================
Fix SSL for NIO that was broken by AJP refactoring.
==================================================
Mark Thomas
==================================================
Mon Nov 24 09:37:03 2014 +0000
==================================================
NioChannel.java
Fix SSL for NIO that was broken by AJP refactoring.
Add some TODO markers as this is only a temporary fix.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1641343 13f79535-47bb-0310-9956-ffa450edef68



==================================================
NioEndpoint.java
index e8da5292ec..4de20b1f71 100644
--- a/java/org/apache/tomcat/util/net/NioChannel.java
+++ b/java/org/apache/tomcat/util/net/NioChannel.java
@@ -62,6 +62,8 @@ public class NioChannel implements ByteChannel {
      */
     public void reset() throws IOException {
         bufHandler.getReadBuffer().clear();
+        // TODO AJP and HTTPS have different expectations for the state of
+        // the buffer at the start of a read. These need to be reconciled.
         bufHandler.getReadBuffer().limit(0);
         bufHandler.getWriteBuffer().clear();
         this.sendFile = false;

==================================================
SecureNioChannel.java
index 6f42cfd8bc..7edc88e2d0 100644
--- a/java/org/apache/tomcat/util/net/NioEndpoint.java
+++ b/java/org/apache/tomcat/util/net/NioEndpoint.java
@@ -1635,6 +1635,8 @@ public class NioEndpoint extends AbstractEndpoint<NioChannel> {
                 readbuf = ByteBuffer.allocate(readsize);
                 writebuf = ByteBuffer.allocate(writesize);
             }
+            // TODO AJP and HTTPS have different expectations for the state of
+            // the buffer at the start of a read. These need to be reconciled.
             readbuf.limit(0);
         }
 

==================================================
