cfcca5028eaacb23a5df497d062f4f72c60e5f91
==================================================
Expose the cache size for each connection via JMX in StatementCache.
==================================================
Keiichi Fujino
==================================================
Wed Jan 31 06:37:53 2018 +0000
==================================================
StatementCache.java
Expose the cache size for each connection via JMX in StatementCache.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1822767 13f79535-47bb-0310-9956-ffa450edef68



==================================================
StatementCacheMBean.java
index 432bc59336..bde3557584 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/interceptor/StatementCache.java
@@ -252,6 +252,13 @@ public class StatementCache extends StatementDecoratorInterceptor implements Sta
                 (ConcurrentHashMap<CacheKey,CachedStatement>)pCon.getAttributes().get(STATEMENT_CACHE_ATTR);
         return cache;
     }
+ 
+    @Override
+    public int getCacheSizePerConnection() {
+        ConcurrentHashMap<CacheKey,CachedStatement> cache = getCache();
+        if (cache == null) return 0;
+        return cache.size();
+    }
 
     protected class CachedStatement extends StatementDecoratorInterceptor.StatementProxy<Statement> {
         boolean cached = false;

==================================================
