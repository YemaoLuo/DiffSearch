99693d43c031c9ccbe2b7a691fb7078492936def
==================================================
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=63740 xmlBase != null
==================================================
Mark Thomas
==================================================
Tue Sep 10 18:32:49 2019 +0100
==================================================
Container.java
Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=63740 xmlBase != null

Correctly locate configuration files when a Host has an xmlBase
specified.

Patch provided by uk4sx.


==================================================
ContextConfig.java
index 177b2d24d0..f9da61efe3 100644
--- a/java/org/apache/catalina/Container.java
+++ b/java/org/apache/catalina/Container.java
@@ -319,6 +319,7 @@ public interface Container extends Lifecycle {
         if (host != null && ((Host) host).getXmlBase() != null) {
             result.append(((Host) host).getXmlBase()).append('/');
         } else {
+            result.append("conf/");
             if (engine != null) {
                 result.append(engine.getName()).append('/');
             }

==================================================
RewriteValve.java
index b416f314ef..6b6928abd8 100644
--- a/java/org/apache/catalina/startup/ContextConfig.java
+++ b/java/org/apache/catalina/startup/ContextConfig.java
@@ -472,7 +472,7 @@ public class ContextConfig implements LifecycleListener {
 
             String hostContextFile = Container.getConfigPath(context, Constants.HostContextXml);
             try (ConfigurationSource.Resource contextXmlResource =
-                    ConfigFileLoader.getSource().getConfResource(hostContextFile)) {
+                    ConfigFileLoader.getSource().getResource(hostContextFile)) {
                 URL defaultContextUrl = contextXmlResource.getURI().toURL();
                 processContextConfig(digester, defaultContextUrl, contextXmlResource.getInputStream());
             } catch (MalformedURLException e) {
@@ -1898,7 +1898,7 @@ public class ContextConfig implements LifecycleListener {
                 }
             } else {
                 String hostWebXml = Container.getConfigPath(context, Constants.HostWebXml);
-                webXmlResource = ConfigFileLoader.getSource().getConfResource(hostWebXml);
+                webXmlResource = ConfigFileLoader.getSource().getResource(hostWebXml);
             }
         } catch (IOException e) {
             // Ignore if not found

==================================================
