0f83d0b932c48211fc3efb4f21c9dbbb3a159061
==================================================
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54734
==================================================
Mark Emlyn
==================================================
Mon Mar 25 14:20:35 2013 +0000
==================================================
ServletContext.java
Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54734
Implement new method ServletContext#getgetVirtualServerName()

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1460675 13f79535-47bb-0310-9956-ffa450edef68



==================================================
ApplicationContext.java
index 8d2101b024..bd645a41f0 100644
--- a/java/javax/servlet/ServletContext.java
+++ b/java/javax/servlet/ServletContext.java
@@ -717,4 +717,10 @@ public interface ServletContext {
      * @since Servlet 3.0 TODO SERVLET3 - Add comments
      */
     public void declareRoles(String... roleNames);
+
+    /**
+     * Returns the primary name of the virtual host on which this context is
+     * deployed. The name may or may not be a valid host name.
+     */
+    public String getVirtualServerName();
 }

==================================================
ApplicationContextFacade.java
index 95b343b190..782dd74721 100644
--- a/java/org/apache/catalina/core/ApplicationContext.java
+++ b/java/org/apache/catalina/core/ApplicationContext.java
@@ -1437,6 +1437,13 @@ public class ApplicationContext
     }
 
 
+    @Override
+    public String getVirtualServerName() {
+        // Constructor will fail if context or its parent is null
+        return ((Host) context.getParent()).getName();
+    }
+
+
     // -------------------------------------------------------- Package Methods
     protected StandardContext getContext() {
         return this.context;
@@ -1506,6 +1513,4 @@ public class ApplicationContext
             mappingData = new MappingData();
         }
     }
-
-
 }

==================================================
JspCServletContext.java
index c822d829d6..53d01a0504 100644
--- a/java/org/apache/catalina/core/ApplicationContextFacade.java
+++ b/java/org/apache/catalina/core/ApplicationContextFacade.java
@@ -756,6 +756,17 @@ public class ApplicationContextFacade implements ServletContext {
         }
     }
 
+
+    @Override
+    public String getVirtualServerName() {
+        if (SecurityUtil.isPackageProtectionEnabled()) {
+            return (String) doPrivileged("getVirtualServerName", null);
+        } else  {
+            return context.getVirtualServerName();
+        }
+    }
+
+
     /**
      * Use reflection to invoke the requested method. Cache the method object
      * to speed up the process
@@ -882,5 +893,4 @@ public class ApplicationContextFacade implements ServletContext {
 
         throw realException;
     }
-
 }

==================================================
