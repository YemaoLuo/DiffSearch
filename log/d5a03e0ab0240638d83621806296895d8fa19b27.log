d5a03e0ab0240638d83621806296895d8fa19b27
==================================================
Enable reset the statistics without restarting the pool.
==================================================
Keiichi Fujino
==================================================
Tue Jan 10 07:22:43 2017 +0000
==================================================
ConnectionPool.java
Enable reset the statistics without restarting the pool.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1778090 13f79535-47bb-0310-9956-ffa450edef68



==================================================
DataSourceProxy.java
index 5fca702d7a..88bbfb5367 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java
@@ -1250,6 +1250,19 @@ public class ConnectionPool {
         return releasedIdleCount.get();
     }
 
+    /**
+     * reset the statistics of this pool.
+     */
+    public void resetStats() {
+        borrowedCount.set(0);
+        returnedCount.set(0);
+        createdCount.set(0);
+        releasedCount.set(0);
+        reconnectedCount.set(0);
+        removeAbandonedCount.set(0);
+        releasedIdleCount.set(0);
+    }
+
     /**
      * Tread safe wrapper around a future for the regular queue
      * This one retrieves the pooled connection object

==================================================
ConnectionPool.java
index 275423c464..51ae72e22b 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/DataSourceProxy.java
@@ -837,6 +837,17 @@ public class DataSourceProxy implements PoolConfiguration {
         }
     }
 
+    /**
+     * reset the statistics of this pool.
+     */
+    public void resetStats() {
+        try {
+            createPool().resetStats();
+        } catch (SQLException x) {
+            throw new RuntimeException(x);
+        }
+    }
+
     //=========================================================
     //  PROPERTIES / CONFIGURATION
     //=========================================================

==================================================
ConnectionPoolMBean.java
index 5ccdbf076f..7ae8faa42a 100644
--- a/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java
+++ b/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/jmx/ConnectionPool.java
@@ -218,6 +218,12 @@ public class ConnectionPool extends NotificationBroadcasterSupport implements Co
     public void testIdle() {
         pool.testAllIdle();
     }
+
+    @Override
+    public void resetStats() {
+        pool.resetStats();
+    }
+
     //=================================================================
     //       POOL PROPERTIES
     //=================================================================

==================================================
