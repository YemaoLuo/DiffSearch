964df82b58cccd6914a5ade5d85e9f4beb74a8f2
==================================================
Refactor to remove o.a.c -> o.a.c.util dependency
==================================================
Mark Emlyn
==================================================
Thu Jun 14 13:59:07 2012 +0000
==================================================
Context.java
Refactor to remove o.a.c -> o.a.c.util dependency

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1350241 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Response.java
index e2c292f82e..34f0832ead 100644
--- a/java/org/apache/catalina/Context.java
+++ b/java/org/apache/catalina/Context.java
@@ -17,6 +17,7 @@
 package org.apache.catalina;
 
 import java.net.URL;
+import java.util.Locale;
 import java.util.Set;
 
 import javax.servlet.ServletContainerInitializer;
@@ -157,7 +158,9 @@ public interface Context extends Container {
 
     /**
      * Return the Locale to character set mapper for this Context.
+     * @deprecated Use {@link #getCharset(Locale)}
      */
+    @Deprecated
     public CharsetMapper getCharsetMapper();
 
 
@@ -165,10 +168,21 @@ public interface Context extends Container {
      * Set the Locale to character set mapper for this Context.
      *
      * @param mapper The new mapper
+     *
+     * @deprecated
      */
+    @Deprecated
     public void setCharsetMapper(CharsetMapper mapper);
 
 
+    /**
+     * Obtain the character set name to use with the given Locale. Note that
+     * different Contexts may have different mappings of Locale to character
+     * set.
+     */
+    public String getCharset(Locale locale);
+
+
     /**
      * Return the URL of the XML descriptor for this context.
      */

==================================================
StandardContext.java
index 47bbc7eee0..8da98b4572 100644
--- a/java/org/apache/catalina/connector/Response.java
+++ b/java/org/apache/catalina/connector/Response.java
@@ -44,7 +44,6 @@ import org.apache.catalina.Globals;
 import org.apache.catalina.Session;
 import org.apache.catalina.Wrapper;
 import org.apache.catalina.security.SecurityUtil;
-import org.apache.catalina.util.CharsetMapper;
 import org.apache.catalina.util.DateTool;
 import org.apache.catalina.util.RequestUtil;
 import org.apache.catalina.util.SessionConfig;
@@ -788,12 +787,10 @@ public class Response
             return;
         }
 
-        CharsetMapper cm = getContext().getCharsetMapper();
-        String charset = cm.getCharset( locale );
-        if ( charset != null ){
+        String charset = getContext().getCharset(locale);
+        if (charset != null) {
             coyoteResponse.setCharacterEncoding(charset);
         }
-
     }
 
 

==================================================
FailedContext.java
index f1e4a310e9..5428f6a1c9 100644
--- a/java/org/apache/catalina/core/StandardContext.java
+++ b/java/org/apache/catalina/core/StandardContext.java
@@ -33,6 +33,7 @@ import java.util.Hashtable;
 import java.util.Iterator;
 import java.util.LinkedHashMap;
 import java.util.List;
+import java.util.Locale;
 import java.util.Map;
 import java.util.Set;
 import java.util.Stack;
@@ -1408,7 +1409,9 @@ public class StandardContext extends ContainerBase
 
     /**
      * Return the Locale to character set mapper for this Context.
+     * @deprecated Use {@link #getCharset(Locale)}
      */
+    @Deprecated
     @Override
     public CharsetMapper getCharsetMapper() {
 
@@ -1433,6 +1436,7 @@ public class StandardContext extends ContainerBase
      *
      * @param mapper The new mapper
      */
+    @Deprecated
     @Override
     public void setCharsetMapper(CharsetMapper mapper) {
 
@@ -1445,6 +1449,13 @@ public class StandardContext extends ContainerBase
 
     }
 
+
+    @Override
+    public String getCharset(Locale locale) {
+        return getCharsetMapper().getCharset(locale);
+    }
+
+
     /**
      * Return the URL of the XML descriptor for this context.
      */

==================================================
