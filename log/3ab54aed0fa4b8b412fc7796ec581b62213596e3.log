3ab54aed0fa4b8b412fc7796ec581b62213596e3
==================================================
WebSocket 1.0. Section 4.1.1
==================================================
Mark Emlyn
==================================================
Tue Jun 25 10:08:11 2013 +0000
==================================================
UriTemplate.java
index cbbb736c48..f308cdacf8 100644
--- a/java/org/apache/tomcat/websocket/server/LocalStrings.properties
+++ b/java/org/apache/tomcat/websocket/server/LocalStrings.properties
@@ -22,6 +22,7 @@ serverContainer.pojoDeploy=POJO class [{0}] deploying to path [{1}] in ServletCo
 serverContainer.servletContextMismatch=Attempted to register a POJO annotated for WebSocket at path [{0}] in the ServletContext with context path [{1}] when the WebSocket ServerContainer is allocated to the ServletContext with context path [{2}]
 serverContainer.servletContextMissing=No ServletContext was specified
 
+uriTemplate.invalidPath=The path [{0}] is not valid.
 uriTemplate.invalidSegment=The segment [{0}] is not valid in the provided path [{1}]
 
 wsHttpUpgradeHandler.destroyFailed=Failed to close WebConnection while destroying the WebSocket HttpUpgradeHandler

==================================================
WsServerContainer.java
index 7f06cc9ac4..a790283088 100644
--- a/java/org/apache/tomcat/websocket/server/UriTemplate.java
+++ b/java/org/apache/tomcat/websocket/server/UriTemplate.java
@@ -22,6 +22,8 @@ import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
 
+import javax.websocket.DeploymentException;
+
 import org.apache.tomcat.util.res.StringManager;
 
 /**
@@ -38,7 +40,13 @@ public class UriTemplate {
     private final boolean hasParameters;
 
 
-    public UriTemplate(String path) {
+    public UriTemplate(String path) throws DeploymentException {
+
+        if (path == null || path.length() ==0 || !path.startsWith("/")) {
+            throw new DeploymentException(
+                    sm.getString("uriTemplate.invalidPath", path));
+        }
+
         StringBuilder normalized = new StringBuilder(path.length());
 
         String[] segments = path.split("/");

==================================================
