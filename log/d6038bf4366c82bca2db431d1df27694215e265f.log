d6038bf4366c82bca2db431d1df27694215e265f
==================================================
Remove unused code
==================================================
Mark Thomas
==================================================
Mon Dec 14 14:47:06 2015 +0000
==================================================
CoyoteAdapter.java
Remove unused code

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1719927 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http2UpgradeHandler.java
index 71f1c5f355..f1da78396c 100644
--- a/java/org/apache/catalina/connector/CoyoteAdapter.java
+++ b/java/org/apache/catalina/connector/CoyoteAdapter.java
@@ -157,27 +157,6 @@ public class CoyoteAdapter implements Adapter {
                 if (!asyncConImpl.timeout()) {
                     asyncConImpl.setErrorState(null, false);
                 }
-            } else if (status==SocketEvent.ASYNC_READ_ERROR) {
-                // A async read error is an IO error which means the socket
-                // needs to be closed so set success to false to trigger a
-                // close
-                success = false;
-                Throwable t = (Throwable)req.getAttribute(
-                        RequestDispatcher.ERROR_EXCEPTION);
-                req.getAttributes().remove(RequestDispatcher.ERROR_EXCEPTION);
-                ReadListener readListener = req.getReadListener();
-                if (readListener != null) {
-                    ClassLoader oldCL = null;
-                    try {
-                        oldCL = request.getContext().bind(false, null);
-                        readListener.onError(t);
-                    } finally {
-                        request.getContext().unbind(false, oldCL);
-                    }
-                }
-                if (t != null) {
-                    asyncConImpl.setErrorState(t, true);
-                }
             } else if (status==SocketEvent.ASYNC_WRITE_ERROR) {
                 // A async write error is an IO error which means the socket
                 // needs to be closed so set success to false to trigger a

==================================================
SocketEvent.java
index d5e7e68913..8c653f710a 100644
--- a/java/org/apache/coyote/http2/Http2UpgradeHandler.java
+++ b/java/org/apache/coyote/http2/Http2UpgradeHandler.java
@@ -319,7 +319,6 @@ public class Http2UpgradeHandler extends AbstractStream implements InternalHttpU
                 result = SocketState.UPGRADED;
                 break;
 
-            case ASYNC_READ_ERROR:
             case ASYNC_WRITE_ERROR:
             case CLOSE_NOW:
                 // This should never happen and will be fatal for this connection.

==================================================
WsHttpUpgradeHandler.java
index ff005edabc..464ba4a0bc 100644
--- a/java/org/apache/tomcat/util/net/SocketEvent.java
+++ b/java/org/apache/tomcat/util/net/SocketEvent.java
@@ -64,13 +64,6 @@ public enum SocketEvent {
      */
     ASYNC_WRITE_ERROR,
 
-    /**
-     * Unused as of 9.0.x.
-     *
-     * TODO: Remove this.
-     */
-    ASYNC_READ_ERROR,
-
     /**
      * Initiated by the container when an I/O error is detected on a
      * non-container thread.

==================================================
TestUpgradeInternalHandler.java
index f75506141a..4eea22265d 100644
--- a/java/org/apache/tomcat/websocket/server/WsHttpUpgradeHandler.java
+++ b/java/org/apache/tomcat/websocket/server/WsHttpUpgradeHandler.java
@@ -179,7 +179,6 @@ public class WsHttpUpgradeHandler implements InternalHttpUpgradeHandler {
                 wsSession.doClose(new CloseReason(CloseCodes.GOING_AWAY, msg),
                         new CloseReason(CloseCodes.CLOSED_ABNORMALLY, msg));
                 //$FALL-THROUGH$
-            case ASYNC_READ_ERROR:
             case ASYNC_WRITE_ERROR:
             case CLOSE_NOW:
             case DISCONNECT:

==================================================
