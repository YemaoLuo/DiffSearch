18d45eb015a8c9e25de5aa2c79fc2eeb11683366
==================================================
More refactoring of generated code so tags require less code
==================================================
Mark Thomas
==================================================
Fri Jan 27 08:21:17 2017 +0000
==================================================
Generator.java
More refactoring of generated code so tags require less code

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1780514 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JspRuntimeLibrary.java
index dc0fe37340..f94f51b7fb 100644
--- a/java/org/apache/jasper/compiler/Generator.java
+++ b/java/org/apache/jasper/compiler/Generator.java
@@ -2451,7 +2451,6 @@ class Generator {
                     out.println(" != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE) {");
                     // Assume EVAL_BODY_BUFFERED
                     out.pushIndent();
-                    out.printil("out = _jspx_page_context.pushBody();");
                     if (n.implementsTryCatchFinally()) {
                         out.printin(tagPushBodyCountVar);
                         out.println("[0]++;");
@@ -2459,11 +2458,10 @@ class Generator {
                         out.printin(pushBodyCountVar);
                         out.println("[0]++;");
                     }
-                    out.printin(tagHandlerVar);
-                    out.println(".setBodyContent((javax.servlet.jsp.tagext.BodyContent) out);");
-                    out.printin(tagHandlerVar);
-                    out.println(".doInitBody();");
-
+                    out.printin("out = org.apache.jasper.runtime.JspRuntimeLibrary.startBufferedBody(");
+                    out.print("_jspx_page_context, ");
+                    out.print(tagHandlerVar);
+                    out.println(");");
                     out.popIndent();
                     out.printil("}");
 

==================================================
