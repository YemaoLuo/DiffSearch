ff7d571f41656ddef398ed7227f6c0667802e25f
==================================================
Cleanup temporary files created by tests:
==================================================
Konstantin Kolinko
==================================================
Sat Sep 24 23:31:04 2011 +0000
==================================================
TestCoyoteAdapter.java
Cleanup temporary files created by tests:
register them and delete them in tearDown().
In TestRegistration also aligned mkdir calls with their usage elsewhere.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1175283 13f79535-47bb-0310-9956-ffa450edef68



==================================================
TestAsyncContextImpl.java
index 53d6c8e093..8e05a00678 100644
--- a/test/org/apache/catalina/connector/TestCoyoteAdapter.java
+++ b/test/org/apache/catalina/connector/TestCoyoteAdapter.java
@@ -87,6 +87,7 @@ public class TestCoyoteAdapter extends TomcatBaseTest {
         
         // Create the folder that will trigger the redirect
         File foo = new File(docBase, "foo");
+        addDeleteOnTearDown(foo);
         if (!foo.mkdirs() && !foo.isDirectory()) {
             fail("Unable to create foo directory in docBase");
         }

==================================================
TestRegistration.java
index 66d129ac53..3d9b9416c2 100644
--- a/test/org/apache/catalina/core/TestAsyncContextImpl.java
+++ b/test/org/apache/catalina/core/TestAsyncContextImpl.java
@@ -411,6 +411,7 @@ public class TestAsyncContextImpl extends TomcatBaseTest {
         
         // Create the folder that will trigger the redirect
         File foo = new File(docBase, "async");
+        addDeleteOnTearDown(foo);
         if (!foo.mkdirs() && !foo.isDirectory()) {
             fail("Unable to create async directory in docBase");
         }

==================================================
TestDefaultServlet.java
index 893f0077ad..7336c33386 100644
--- a/test/org/apache/catalina/mbeans/TestRegistration.java
+++ b/test/org/apache/catalina/mbeans/TestRegistration.java
@@ -116,9 +116,9 @@ public class TestRegistration extends TomcatBaseTest {
 
         final Tomcat tomcat = getTomcatInstance();
         final File contextDir = new File(getTemporaryDirectory(), "webappFoo");
-        if (!contextDir.exists()) {
-            if (!contextDir.mkdir())
-                fail("Failed to create: [" + contextDir.toString() + "]");
+        addDeleteOnTearDown(contextDir);
+        if (!contextDir.mkdirs() && !contextDir.isDirectory()) {
+            fail("Failed to create: [" + contextDir.toString() + "]");
         }
         tomcat.addContext(contextName, contextDir.getAbsolutePath());
         tomcat.start();
@@ -172,9 +172,9 @@ public class TestRegistration extends TomcatBaseTest {
         tomcat.getEngine().addChild(host);
 
         final File contextDir2 = new File(getTemporaryDirectory(), "webappFoo2");
-        if (!contextDir2.exists()) {
-            if (!contextDir2.mkdir())
-                fail("Failed to create: [" + contextDir2.toString() + "]");
+        addDeleteOnTearDown(contextDir2);
+        if (!contextDir2.mkdirs() && !contextDir2.isDirectory()) {
+            fail("Failed to create: [" + contextDir2.toString() + "]");
         }
         tomcat.addContext(host, contextName + "2", contextDir2.getAbsolutePath());
         

==================================================
TomcatBaseTest.java
index 5ac2f11a85..d0339db71c 100644
--- a/test/org/apache/catalina/servlets/TestDefaultServlet.java
+++ b/test/org/apache/catalina/servlets/TestDefaultServlet.java
@@ -164,6 +164,7 @@ public class TestDefaultServlet extends TomcatBaseTest {
     public void testCustomErrorPage() throws Exception {
         File appDir = new File(getTemporaryDirectory(), "MyApp");
         File webInf = new File(appDir, "WEB-INF");
+        addDeleteOnTearDown(appDir);
         if (!webInf.mkdirs() && !webInf.isDirectory()) {
             fail("Unable to create directory [" + webInf + "]");
         }
@@ -249,6 +250,7 @@ public class TestDefaultServlet extends TomcatBaseTest {
     public void testCustomErrorPageMissing() throws Exception {
         File appDir = new File(getTemporaryDirectory(), "MyApp");
         File webInf = new File(appDir, "WEB-INF");
+        addDeleteOnTearDown(appDir);
         if (!webInf.mkdirs() && !webInf.isDirectory()) {
             fail("Unable to create directory [" + webInf + "]");
         }

==================================================
