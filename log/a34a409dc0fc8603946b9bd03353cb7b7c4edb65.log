a34a409dc0fc8603946b9bd03353cb7b7c4edb65
==================================================
Handle invocation target exceptions and throw the original exception when it happens
==================================================
Filip Hanik
==================================================
Sat Jan 3 01:25:56 2009 +0000
==================================================
ProxyConnection.java
Handle invocation target exceptions and throw the original exception when it happens


git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@730884 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractQueryReport.java
index da62ebb9a6..2866538f85 100644
--- a/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ProxyConnection.java
+++ b/modules/jdbc-pool/java/org/apache/tomcat/jdbc/pool/ProxyConnection.java
@@ -16,6 +16,7 @@
  */
 package org.apache.tomcat.jdbc.pool;
 
+import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 import java.sql.Connection;
 import java.sql.SQLException;
@@ -84,7 +85,16 @@ public class ProxyConnection extends JdbcInterceptor {
             return connection.getConnection();
         }
         if (isClosed()) throw new SQLException("Connection has already been closed.");
-        return method.invoke(connection.getConnection(),args);
+        try {
+            return method.invoke(connection.getConnection(),args);
+        }catch (Throwable t) {
+            if (t instanceof InvocationTargetException) {
+                InvocationTargetException it = (InvocationTargetException)t;
+                throw it.getCause()!=null?it.getCause():it;
+            } else {
+                throw t;
+            }
+        }
     }
     
     public boolean isClosed() {

==================================================
