2d102b8fc988f0bc5cc7b8e26ae811da7162cb65
==================================================
- Adjust content length fix so that it does the same as for the HTTP connector.
==================================================
Remy Maucherat
==================================================
Mon Aug 28 09:26:51 2006 +0000
==================================================
AjpAprProcessor.java
- Adjust content length fix so that it does the same as for the HTTP connector.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@437620 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AjpProcessor.java
index 41d948b034..2a978d64d2 100644
--- a/java/org/apache/coyote/ajp/AjpAprProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpAprProcessor.java
@@ -571,9 +571,9 @@ public class AjpAprProcessor implements ActionHook {
         } else if (actionCode == ActionCode.ACTION_REQ_SET_BODY_REPLAY) {
 
             // Set the given bytes as the content
-            request.setContentLength(-1); // reset content length
             ByteChunk bc = (ByteChunk) param;
             bodyBytes.setBytes(bc.getBytes(), bc.getStart(), bc.getLength());
+            request.setContentLength(bc.getLength());
             first = false;
             empty = false;
             replay = true;

==================================================
MsgContext.java
index faf8507b93..6e09d0fd11 100644
--- a/java/org/apache/coyote/ajp/AjpProcessor.java
+++ b/java/org/apache/coyote/ajp/AjpProcessor.java
@@ -543,6 +543,7 @@ public class AjpProcessor implements ActionHook {
             // Set the given bytes as the content
             ByteChunk bc = (ByteChunk) param;
             bodyBytes.setBytes(bc.getBytes(), bc.getStart(), bc.getLength());
+            request.setContentLength(bc.getLength());
             first = false;
             empty = false;
             replay = true;

==================================================
