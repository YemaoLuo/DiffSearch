8ac524c915df8f868a782510914ecb0f1f4c904a
==================================================
Pull up reset for remoteHost etc. to a common location
==================================================
Mark Emlyn
==================================================
Thu Jul 7 22:14:07 2011 +0000
==================================================
AbstractHttp11Processor.java
Pull up reset for remoteHost etc. to a common location

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1144077 13f79535-47bb-0310-9956-ffa450edef68



==================================================
Http11AprProcessor.java
index 9f7818f560..5e56b56158 100644
--- a/java/org/apache/coyote/http11/AbstractHttp11Processor.java
+++ b/java/org/apache/coyote/http11/AbstractHttp11Processor.java
@@ -1281,6 +1281,12 @@ public abstract class AbstractHttp11Processor extends AbstractProcessor {
         getInputBuffer().recycle();
         getOutputBuffer().recycle();
         asyncStateMachine.recycle();
+        remoteAddr = null;
+        remoteHost = null;
+        localAddr = null;
+        localName = null;
+        remotePort = -1;
+        localPort = -1;
         recycleInternal();
     }
     

==================================================
Http11NioProcessor.java
index fa87c0fc93..dd0a880feb 100644
--- a/java/org/apache/coyote/http11/Http11AprProcessor.java
+++ b/java/org/apache/coyote/http11/Http11AprProcessor.java
@@ -173,14 +173,6 @@ public class Http11AprProcessor extends AbstractHttp11Processor {
         RequestInfo rp = request.getRequestProcessor();
         rp.setStage(org.apache.coyote.Constants.STAGE_PARSE);
 
-        // Set the remote address
-        remoteAddr = null;
-        remoteHost = null;
-        localAddr = null;
-        localName = null;
-        remotePort = -1;
-        localPort = -1;
-
         // Setting up the socket
         this.socket = socket;
         long socketRef = socket.getSocket().longValue();

==================================================
Http11Processor.java
index f9ef4eaeae..4f30570052 100644
--- a/java/org/apache/coyote/http11/Http11NioProcessor.java
+++ b/java/org/apache/coyote/http11/Http11NioProcessor.java
@@ -406,12 +406,6 @@ public class Http11NioProcessor extends AbstractHttp11Processor {
         socket = null;
         cometClose = false;
         comet = false;
-        remoteAddr = null;
-        remoteHost = null;
-        localAddr = null;
-        localName = null;
-        remotePort = -1;
-        localPort = -1;
         sendfileData = null;
     }
 

==================================================
