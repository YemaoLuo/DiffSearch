be365e5418d929760bdfed57404eb313fe9dba4b
==================================================
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53063
==================================================
Mark Emlyn
==================================================
Thu May 10 21:07:22 2012 +0000
==================================================
AbstractEndpoint.java
Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53063
When using an Executor with BIO, use the executor's maxThreads as the default for maxConnections

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1336884 13f79535-47bb-0310-9956-ffa450edef68



==================================================
JIoEndpoint.java
index 30e34edff5..a39aee0324 100644
--- a/java/org/apache/tomcat/util/net/AbstractEndpoint.java
+++ b/java/org/apache/tomcat/util/net/AbstractEndpoint.java
@@ -305,7 +305,10 @@ public abstract class AbstractEndpoint {
         }
     }
     public int getMaxThreads() {
-        if (running && executor!=null) {
+        return getMaxThreadsExecutor(running);
+    }
+    protected int getMaxThreadsExecutor(boolean useExecutor) {
+        if (useExecutor && executor != null) {
             if (executor instanceof java.util.concurrent.ThreadPoolExecutor) {
                 return ((java.util.concurrent.ThreadPoolExecutor)executor).getMaximumPoolSize();
             } else if (executor instanceof ResizableExecutor) {

==================================================
