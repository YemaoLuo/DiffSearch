17e965d0cf54822d3fd882b26c58a4141f697ee2
==================================================
Move resetting of error state to the processor's recycle method.
==================================================
Mark Emlyn
==================================================
Wed Jun 4 12:54:41 2014 +0000
==================================================
AbstractProcessor.java
Move resetting of error state to the processor's recycle method.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1600162 13f79535-47bb-0310-9956-ffa450edef68



==================================================
AbstractAjpProcessor.java
index 14e2ed8a92..fdac74f691 100644
--- a/java/org/apache/coyote/AbstractProcessor.java
+++ b/java/org/apache/coyote/AbstractProcessor.java
@@ -42,7 +42,7 @@ public abstract class AbstractProcessor<S> implements ActionHook, Processor<S> {
     /**
      * Error state for the request/response currently being processed.
      */
-    private ErrorState errorState;
+    private ErrorState errorState = ErrorState.NONE;
 
 
     /**

==================================================
AbstractHttp11Processor.java
index e8551ac2a5..82d96b67b6 100644
--- a/java/org/apache/coyote/ajp/AbstractAjpProcessor.java
+++ b/java/org/apache/coyote/ajp/AbstractAjpProcessor.java
@@ -739,9 +739,6 @@ public abstract class AbstractAjpProcessor<S> extends AbstractProcessor<S> {
         int soTimeout = endpoint.getSoTimeout();
         boolean cping = false;
 
-        // Error flag
-        resetErrorState();
-
         boolean keptAlive = false;
 
         while (!getErrorState().isError() && !endpoint.isPaused()) {
@@ -936,6 +933,7 @@ public abstract class AbstractAjpProcessor<S> extends AbstractProcessor<S> {
         certificates.recycle();
         swallowResponse = false;
         bytesWritten = 0;
+        resetErrorState();
     }
 
 

==================================================
