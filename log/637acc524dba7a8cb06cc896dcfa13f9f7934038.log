637acc524dba7a8cb06cc896dcfa13f9f7934038
==================================================
Fix bug 42361. Handle multi-part forms when saving request during FORM auth. Patch provided by Peter Runge.
==================================================
Mark Emlyn
==================================================
Tue May 8 23:58:24 2007 +0000
==================================================
FormAuthenticator.java
Fix bug 42361. Handle multi-part forms when saving request during FORM auth. Patch provided by Peter Runge.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@536381 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SavedRequest.java
index f47673dc0c..62bf5eee94 100644
--- a/java/org/apache/catalina/authenticator/FormAuthenticator.java
+++ b/java/org/apache/catalina/authenticator/FormAuthenticator.java
@@ -428,7 +428,14 @@ public class FormAuthenticator
     
                 // Set content type
                 MessageBytes contentType = MessageBytes.newInstance();
-                contentType.setString("application/x-www-form-urlencoded");
+                
+                //If no content type specified, use default for POST
+                String savedContentType = saved.getContentType();
+                if (savedContentType == null) {
+                    savedContentType = "application/x-www-form-urlencoded";
+                }
+
+                contentType.setString(savedContentType);
                 request.getCoyoteRequest().setContentType(contentType);
             }
         }
@@ -487,6 +494,7 @@ public class FormAuthenticator
             while ( (bytesRead = is.read(buffer) ) >= 0) {
                 body.append(buffer, 0, bytesRead);
             }
+            saved.setContentType(request.getContentType());
             saved.setBody(body);
         }
 

==================================================
