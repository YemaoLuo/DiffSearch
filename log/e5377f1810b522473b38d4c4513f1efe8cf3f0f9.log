e5377f1810b522473b38d4c4513f1efe8cf3f0f9
==================================================
Remove unnecessary privileged block for getLocalizeMessage.
==================================================
Mark Thomas
==================================================
Thu Apr 6 22:06:15 2017 +0000
==================================================
JspWriterImpl.java
Remove unnecessary privileged block for getLocalizeMessage.
I can't see anything in getLocalizeMessage that would trigger a security check. I checked back through the svn history and it was the JSP TCK that triggered this. I've been unable to recreate that issue with this method removed.

git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1790476 13f79535-47bb-0310-9956-ffa450edef68



==================================================
SecurityClassLoad.java
index bc109ed6ac..97343bb8da 100644
--- a/java/org/apache/jasper/runtime/JspWriterImpl.java
+++ b/java/org/apache/jasper/runtime/JspWriterImpl.java
@@ -19,15 +19,12 @@ package org.apache.jasper.runtime;
 
 import java.io.IOException;
 import java.io.Writer;
-import java.security.AccessController;
-import java.security.PrivilegedAction;
 
 import javax.servlet.ServletResponse;
 import javax.servlet.jsp.JspWriter;
 
 import org.apache.jasper.Constants;
 import org.apache.jasper.compiler.Localizer;
-import org.apache.jasper.security.SecurityUtil;
 
 /**
  * Write text to a character-output stream, buffering characters so as
@@ -119,19 +116,6 @@ public class JspWriterImpl extends JspWriter {
         }
     }
 
-    private String getLocalizeMessage(final String message){
-        if (SecurityUtil.isPackageProtectionEnabled()){
-            return AccessController.doPrivileged(new PrivilegedAction<String>(){
-                @Override
-                public String run(){
-                    return Localizer.getMessage(message);
-                }
-            });
-        } else {
-            return Localizer.getMessage(message);
-        }
-    }
-
     /**
      * Discard the output buffer.
      */
@@ -140,10 +124,10 @@ public class JspWriterImpl extends JspWriter {
         if ((bufferSize == 0) && (out != null))
             // clear() is illegal after any unbuffered output (JSP.5.5)
             throw new IllegalStateException(
-                    getLocalizeMessage("jsp.error.ise_on_clear"));
+                    Localizer.getMessage("jsp.error.ise_on_clear"));
         if (flushed)
             throw new IOException(
-                    getLocalizeMessage("jsp.error.attempt_to_clear_flushed_buffer"));
+                    Localizer.getMessage("jsp.error.attempt_to_clear_flushed_buffer"));
         ensureOpen();
         nextChar = 0;
     }
@@ -152,13 +136,13 @@ public class JspWriterImpl extends JspWriter {
     public void clearBuffer() throws IOException {
         if (bufferSize == 0)
             throw new IllegalStateException(
-                    getLocalizeMessage("jsp.error.ise_on_clear"));
+                    Localizer.getMessage("jsp.error.ise_on_clear"));
         ensureOpen();
         nextChar = 0;
     }
 
     private final void bufferOverflow() throws IOException {
-        throw new IOException(getLocalizeMessage("jsp.error.overflow"));
+        throw new IOException(Localizer.getMessage("jsp.error.overflow"));
     }
 
     /**

==================================================
